[
    {
        "source_table": "gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}",
        "target_table": "subquery_dg",
        "order_num": 2,
        "relation": [
            {
                "source": "phone_no",
                "target": "phone_no",
                "type": "JOIN",
                "description": "FROM dm.dim_dx_flow a LEFT JOIN gbasedwi.${table_name.name1} b ON a.plan_id=b.plan_id AND a.use_type=b.use_type GROUP BY phone_no"
            }
        ]
    },
    {
        "source_table": "dm.dim_dx_flow",
        "target_table": "subquery_dg",
        "order_num": 2,
        "relation": [
            {
                "source": "plan_id",
                "target": "plan_id",
                "type": "JOIN",
                "description": "FROM dm.dim_dx_flow a LEFT JOIN gbasedwi.${table_name.name1} b ON a.plan_id=b.plan_id AND a.use_type=b.use_type GROUP BY phone_no"
            },
            {
                "source": "use_type",
                "target": "use_type",
                "type": "JOIN",
                "description": "FROM dm.dim_dx_flow a LEFT JOIN gbasedwi.${table_name.name1} b ON a.plan_id=b.plan_id AND a.use_type=b.use_type GROUP BY phone_no"
            }
        ]
    },
    {
        "source_table": "gbasedwi.${table_name.name1}",
        "target_table": "subquery_dg",
        "order_num": 2,
        "relation": [
            {
                "source": "plan_id",
                "target": "plan_id",
                "type": "JOIN",
                "description": "FROM dm.dim_dx_flow a LEFT JOIN gbasedwi.${table_name.name1} b ON a.plan_id=b.plan_id AND a.use_type=b.use_type GROUP BY phone_no"
            },
            {
                "source": "use_type",
                "target": "use_type",
                "type": "JOIN",
                "description": "FROM dm.dim_dx_flow a LEFT JOIN gbasedwi.${table_name.name1} b ON a.plan_id=b.plan_id AND a.use_type=b.use_type GROUP BY phone_no"
            },
            {
                "source": "USE_RES_NUM",
                "target": "dg_USE_RES_NUM",
                "type": "AGGREGATION",
                "description": "SUM(b.USE_RES_NUM/1024/1024) AS dg_USE_RES_NUM"
            },
            {
                "source": "TOTAL_RES_NUM",
                "target": "dg_TOTAL_RES_NUM",
                "type": "AGGREGATION",
                "description": "SUM(b.TOTAL_RES_NUM/1024/1024) AS dg_TOTAL_RES_NUM"
            }
        ]
    },
    {
        "source_table": "subquery_dg",
        "target_table": "tmp_20150512_gprs_${dayid}",
        "order_num": 1,
        "relation": [
            {
                "source": "phone_no",
                "target": "phone_no",
                "type": "EQUAL",
                "description": "SELECT a.phone_no, b.dg_USE_RES_NUM, b.dg_TOTAL_RES_NUM FROM ... ON a.phone_no=b.phone_no"
            },
            {
                "source": "dg_USE_RES_NUM",
                "target": "dg_USE_RES_NUM",
                "type": "EQUAL",
                "description": "SELECT a.phone_no, b.dg_USE_RES_NUM, b.dg_TOTAL_RES_NUM FROM ... ON a.phone_no=b.phone_no"
            },
            {
                "source": "dg_TOTAL_RES_NUM",
                "target": "dg_TOTAL_RES_NUM",
                "type": "EQUAL",
                "description": "SELECT a.phone_no, b.dg_USE_RES_NUM, b.dg_TOTAL_RES_NUM FROM ... ON a.phone_no=b.phone_no"
            }
        ]
    },
    {
        "source_table": "gbasedwi.${table_name.name1}",
        "target_table": "subquery_zs",
        "order_num": 3,
        "relation": [
            {
                "source": "phone_no",
                "target": "phone_no",
                "type": "GROUPBY",
                "description": "GROUP BY phone_no"
            },
            {
                "source": "USE_RES_NUM",
                "target": "zs_USE_RES_NUM",
                "type": "AGGREGATION",
                "description": "SUM(USE_RES_NUM/1024/1024) AS zs_USE_RES_NUM"
            },
            {
                "source": "TOTAL_RES_NUM",
                "target": "zs_TOTAL_RES_NUM",
                "type": "AGGREGATION",
                "description": "SUM(TOTAL_RES_NUM/1024/1024) AS zs_TOTAL_RES_NUM"
            }
        ]
    },
    {
        "source_table": "subquery_zs",
        "target_table": "tmp_20150512_gprs_${dayid}",
        "order_num": 1,
        "relation": [
            {
                "source": "phone_no",
                "target": "phone_no",
                "type": "EQUAL",
                "description": "SELECT a.phone_no, c.zs_USE_RES_NUM, c.zs_TOTAL_RES_NUM FROM ... ON a.phone_no=c.phone_no"
            },
            {
                "source": "zs_USE_RES_NUM",
                "target": "zs_USE_RES_NUM",
                "type": "EQUAL",
                "description": "SELECT a.phone_no, c.zs_USE_RES_NUM, c.zs_TOTAL_RES_NUM FROM ... ON a.phone_no=c.phone_no"
            },
            {
                "source": "zs_TOTAL_RES_NUM",
                "target": "zs_TOTAL_RES_NUM",
                "type": "EQUAL",
                "description": "SELECT a.phone_no, c.zs_USE_RES_NUM, c.zs_TOTAL_RES_NUM FROM ... ON a.phone_no=c.phone_no"
            }
        ]
    },
    {
        "source_table": "gbasedwd.${tablename.dwdfreeres1}",
        "target_table": "subquery_gprs",
        "order_num": 4,
        "relation": [
            {
                "source": "item_code",
                "target": "item_code",
                "type": "JOIN",
                "description": "LEFT JOIN (SELECT item_code FROM dm.dim_pub_freeres_lty_itemcode GROUP BY item_code) b ON a.item_code=b.item_code"
            },
            {
                "source": "FREE_RES_USE_NUM",
                "target": "RES_USE_NUM",
                "type": "AGGREGATION",
                "description": "SUM(CASE WHEN b.item_code IS NOT NULL THEN a.FREE_RES_USE_NUM ELSE 0 END)/1024 AS RES_USE_NUM"
            }
        ]
    },
    {
        "source_table": "dm.dim_pub_freeres_lty_itemcode",
        "target_table": "subquery_gprs",
        "order_num": 4,
        "relation": [
            {
                "source": "item_code",
                "target": "item_code",
                "type": "JOIN",
                "description": "LEFT JOIN (SELECT item_code FROM dm.dim_pub_freeres_lty_itemcode GROUP BY item_code) b ON a.item_code=b.item_code"
            }
        ]
    },
    {
        "source_table": "subquery_gprs",
        "target_table": "tmp_20150512_gprs_${dayid}",
        "order_num": 1,
        "relation": [
            {
                "source": "phone_no",
                "target": "phone_no",
                "type": "EQUAL",
                "description": "SELECT a.phone_no, d.RES_USE_NUM FROM ... ON a.phone_no=d.phone_no"
            },
            {
                "source": "RES_USE_NUM",
                "target": "gprs_USE_RES_NUM",
                "type": "EQUAL",
                "description": "SELECT a.phone_no, d.RES_USE_NUM FROM ... ON a.phone_no=d.phone_no"
            }
        ]
    },
    {
        "source_table": "gbasemsm.msm_dw_basekpi_110673_detail_${dayid}",
        "target_table": "subquery_4g",
        "order_num": 5,
        "relation": [
            {
                "source": "phone_no",
                "target": "phone_no",
                "type": "GROUPBY",
                "description": "GROUP BY phone_no"
            }
        ]
    },
    {
        "source_table": "subquery_4g",
        "target_table": "tmp_20150512_gprs_${dayid}",
        "order_num": 1,
        "relation": [
            {
                "source": "phone_no",
                "target": "phone_no",
                "type": "FILTER",
                "description": "CASE WHEN e.phone_no IS NOT NULL THEN 1 ELSE 0 END AS is_4G_valid_user"
            }
        ]
    }
]