[  
  {  
    "source_table": "gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}",  
    "target_table": "subquery_dg_flow_use",  
    "order_num": 1,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "JOIN",  
        "description": "Left join on a.phone_no = b.phone_no"  
      }  
    ]  
  },  
  {  
    "source_table": "gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}",  
    "target_table": "subquery_zs_flow_use",  
    "order_num": 1,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "JOIN",  
        "description": "Left join on a.phone_no = c.phone_no"  
      }  
    ]  
  },  
  {  
    "source_table": "gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}",  
    "target_table": "subquery_gprs_use",  
    "order_num": 1,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "JOIN",  
        "description": "Left join on a.phone_no = d.phone_no"  
      }  
    ]  
  },  
  {  
    "source_table": "gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}",  
    "target_table": "subquery_4g_valid_user",  
    "order_num": 1,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "JOIN",  
        "description": "Left join on a.phone_no = e.phone_no"  
      },  
      {  
        "source": "phone_no",  
        "target": "is_4G_valid_user",  
        "type": "CONDITION",  
        "description": "CASE WHEN e.phone_no IS NOT NULL THEN 1 ELSE 0 END"  
      }  
    ]  
  },  
  {  
    "source_table": "gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}",  
    "target_table": "gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}",  
    "order_num": 1,  
    "relations": [  
      {  
        "source": "PROD_KIND_CODE",  
        "target": "PROD_KIND_CODE",  
        "type": "FILTER",  
        "description": "WHERE PROD_KIND_CODE='171000000001'"  
      },  
      {  
        "source": "MONTH_ARRIVE_FLAG",  
        "target": "MONTH_ARRIVE_FLAG",  
        "type": "FILTER",  
        "description": "WHERE MONTH_ARRIVE_FLAG = 1"  
      },  
      {  
        "source": "MONTH_OFF_FLAG",  
        "target": "MONTH_OFF_FLAG",  
        "type": "FILTER",  
        "description": "WHERE MONTH_OFF_FLAG = 1"  
      },  
      {  
        "source": "MONTH_NEW_FLAG",  
        "target": "MONTH_NEW_FLAG",  
        "type": "FILTER",  
        "description": "WHERE MONTH_NEW_FLAG = 1"  
      }  
    ]  
  },  
  {  
    "source_table": "subquery_dg_flow_use",  
    "target_table": "subquery_dg_flow_use",  
    "order_num": 2,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "GROUPBY",  
        "description": "GROUP BY phone_no"  
      },  
      {  
        "source": "USE_RES_NUM",  
        "target": "dg_USE_RES_NUM",  
        "type": "AGGREGATION",  
        "description": "SUM(b.USE_RES_NUM/1024/1024) AS dg_USE_RES_NUM"  
      },  
      {  
        "source": "TOTAL_RES_NUM",  
        "target": "dg_TOTAL_RES_NUM",  
        "type": "AGGREGATION",  
        "description": "SUM(b.TOTAL_RES_NUM/1024/1024) AS dg_TOTAL_RES_NUM"  
      }  
    ]  
  },  
  {  
    "source_table": "dm.dim_dx_flow",  
    "target_table": "gbasedwi.${table_name.name1}",  
    "order_num": 3,  
    "relations": [  
      {  
        "source": "plan_id",  
        "target": "plan_id",  
        "type": "JOIN",  
        "description": "Left join on a.plan_id = b.plan_id"  
      },  
      {  
        "source": "use_type",  
        "target": "use_type",  
        "type": "JOIN",  
        "description": "Left join on a.use_type = b.use_type"  
      }  
    ]  
  },  
  {  
    "source_table": "subquery_zs_flow_use",  
    "target_table": "subquery_zs_flow_use",  
    "order_num": 2,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "GROUPBY",  
        "description": "GROUP BY phone_no"  
      },  
      {  
        "source": "USE_RES_NUM",  
        "target": "zs_USE_RES_NUM",  
        "type": "AGGREGATION",  
        "description": "SUM(USE_RES_NUM/1024/1024) AS zs_USE_RES_NUM"  
      },  
      {  
        "source": "TOTAL_RES_NUM",  
        "target": "zs_TOTAL_RES_NUM",  
        "type": "AGGREGATION",  
        "description": "SUM(TOTAL_RES_NUM/1024/1024) AS zs_TOTAL_RES_NUM"  
      },  
      {  
        "source": "plan_id",  
        "target": "plan_id",  
        "type": "FILTER",  
        "description": "WHERE plan_id = '111002069417'"  
      }  
    ]  
  },  
  {  
    "source_table": "gbasedwi.${table_name.name1}",  
    "target_table": "subquery_zs_flow_use",  
    "order_num": 3,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "EQUAL",  
        "description": "SELECT phone_no"  
      },  
      {  
        "source": "USE_RES_NUM",  
        "target": "USE_RES_NUM",  
        "type": "EQUAL",  
        "description": "SELECT USE_RES_NUM"  
      },  
      {  
        "source": "TOTAL_RES_NUM",  
        "target": "TOTAL_RES_NUM",  
        "type": "EQUAL",  
        "description": "SELECT TOTAL_RES_NUM"  
      }  
    ]  
  },  
  {  
    "source_table": "subquery_gprs_use",  
    "target_table": "subquery_gprs_use",  
    "order_num": 2,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "GROUPBY",  
        "description": "GROUP BY a.phone_no"  
      },  
      {  
        "source": "FREE_RES_USE_NUM",  
        "target": "RES_USE_NUM",  
        "type": "AGGREGATION",  
        "description": "SUM(CASE WHEN b.item_code IS NOT NULL THEN a.FREE_RES_USE_NUM ELSE 0 END)/1024 AS RES_USE_NUM"  
      },  
      {  
        "source": "boss_prod_id",  
        "target": "boss_prod_id",  
        "type": "FILTER",  
        "description": "WHERE boss_prod_id NOT IN ('54001105','53005095','50002352','54001809')"  
      },  
      {  
        "source": "FREE_RES_TOTAL_NUM",  
        "target": "FREE_RES_TOTAL_NUM",  
        "type": "FILTER",  
        "description": "WHERE TO_NUMBER(FREE_RES_TOTAL_NUM) < 1e18"  
      }  
    ]  
  },  
  {  
    "source_table": "gbasedwd.${tablename.dwdfreeres1}",  
    "target_table": "dm.dim_pub_freeres_lty_itemcode",  
    "order_num": 3,  
    "relations": [  
      {  
        "source": "item_code",  
        "target": "item_code",  
        "type": "JOIN",  
        "description": "Left join on a.item_code = b.item_code"  
      }  
    ]  
  },  
  {  
    "source_table": "gbasemsm.msm_dw_basekpi_110673_detail_${dayid}",  
    "target_table": "subquery_4g_valid_user",  
    "order_num": 2,  
    "relations": [  
      {  
        "source": "phone_no",  
        "target": "phone_no",  
        "type": "GROUPBY",  
        "description": "GROUP BY phone_no"  
      }  
    ]  
  }  
]