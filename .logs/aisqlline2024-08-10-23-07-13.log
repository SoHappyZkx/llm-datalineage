2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [1]-[index:2]-[2015年5月新增月指标数据表月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_INCREASE_01_${monthid};\\ncreate table DM_PUB_INCREASE_01_${monthid} distributed by ('PRODUCT_NO') as select * from DM_PUB_INCREASE_01_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [2]-[index:3]-[2015年5月新增月指标数据表月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"8.插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_INCREASE_01_${monthid} \\nselect * from DM_PUB_INCREASE_01_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [3]-[index:6]-[call个人客户月视图自动生成程序月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_CALL_${monthid};\\ncreate table DM_AUTORPT_CALL_${monthid} distributed by ('PRODUCT_NO') as select * from DM_AUTORPT_CALL_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [4]-[index:7]-[call个人客户月视图自动生成程序月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_CALL_${monthid} select * from DM_AUTORPT_CALL_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [5]-[index:12]-[his_index个人客户月视图自动生成程序月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_HIS_INDEX_${monthid};\\ncreate table DM_AUTORPT_HIS_INDEX_${monthid} distributed by ('PRODUCT_NO') as \\nselect * from  DM_AUTORPT_HIS_INDEX_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [6]-[index:13]-[his_index个人客户月视图自动生成程序月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_HIS_INDEX_${monthid} select * from DM_AUTORPT_HIS_INDEX_${monthid}@dblink_dm;\\n","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [7]-[index:18]-[测试]-[9]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"9","dsName":"GbaseLOP","sql":"insert into lop.lop_st_beh_maket_area_detail_info\\nselect '${dayid}',a.area,a.lac_ci,b.longitude,b.latitude,d.is_work,c.imsi\\nfrom \\n(select concat(lac_id,'_',cell_id_trans) lac_ci,area\\nfrom\\nlop.dim_market_analysis) a\\nleft join\\n(select concat(lac_id,'_',cell_id_trans) lac_ci,longitude,latitude\\nfrom\\ngbasedwd.dim_pub_cell) b\\non a.lac_ci=b.lac_ci\\ninner join\\ngbasedwd.dwd_evt_cdr_userloc_dtl_ds_${dayid} c\\non b.lac_ci=c.bts\\nleft join\\n(select concat(substr(day_time,1,4),'-',substr(day_time,5,2),'-',substr(day_time,7,2)) date,is_work\\nfrom LOP.LOP_DIM_ST_BEH_WORK_DAY) d\\non c.stat_date=d.date\\ngroup by '${dayid}',a.area,a.lac_ci,b.longitude,b.latitude,d.is_work,c.imsi;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [8]-[index:19]-[测试]-[20]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"20","dsName":"GbaseLOP","sql":"delete from lop.lop_st_beh_maket_area_detail_info\\nwhere date='${dayid}';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [9]-[index:22]-[出账信息月视图]-[52]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into  ${DM_PUB_ACCT_SHOULDITEM_YYYYMM} (\\n                  OP_TIME          ,\\n                  PRODUCT_NO       ,\\n                  FEE_ITEM_ID      ,\\n                  FEE_ITEM_NAME    ,\\n                  SHOULD_FEE       ,\\n                  TAX_RATE    ,\\n                  TAXATION_SHOULD_FEE  ,\\n                  NO_VOLUME_TAX_SHOULD_FEE     ,\\n                  PAY_TYPE      ,\\n                  ACCT_ID       ,\\n                  FEE_ITEM_ID1  ,\\n                  FEE_ITEM_ID2  ,\\n                  DEPT_COUNTY_ID,\\n                  COUNTY_ID,\\n                  innet_date,   -- 入网日期\\n                  is_thinginter, -- 是否为物联网卡用户\\n\\t\\t\\t\\t  cust_name,  -- 客户名称\\n                  orgn_bill_income,\\n                  disc_fee,\\n                  this_backfee,\\n                  this_backfee_no_volume_tax,\\n                  this_backfee_taxation,\\n                  FACT_AMT,FACT_TAX_AMT,TAX_BACK_FACT_AMT,\\n                  owe_fee,\\n                  fact_this_fee,fact_this_taxation_fee,fact_this_not_fee,\\n                  user_id\\n                         )\\nselect to_date('${monthid}','YYYYMM') ,\\n       a.product_no,\\n       a.acct_item_id,\\n       b1.FEE_ITEM_NAME,\\n       '0.000' ,\\n       '0' TAX_RATE,\\n       '0.000',\\n       '0.000',\\n       '0' PAY_TYPE,\\n       a.acct_id,\\n       case when b2.CHARGE_CODE is null then '0123' else b2.charge_code end as fee_item_id1,\\n       nvl(b1.FEE_ITEM_ID,'00') as fee_item_id2,\\n       nvl(b3.dept_county_id,0) as dept_county_id,\\n\\t   nvl(b4.county_id,0) as county_id,\\n\\t   date(b5.innet_date) as innet_date,\\n\\t   case when b6.user_no is not null then 1 else 0 end as is_thinginter,\\n\\t   trim(b7.cust_name),\\n       '0.000',\\n       '0.000',\\n       this_backfee,\\n       this_backfee_no_volume_tax,\\n       this_backfee_taxation,\\n       '0.000',\\n       '0.000',\\n       '0.000',\\n       '0.000' owe_fee, -- 当月欠费（应收-实收）\\n       nvl(this_backfee,0) fact_this_fee, -- 实收收入（含预付费欠费收回）-含税\\n       nvl(this_backfee_taxation,0) fact_this_taxation_fee, -- 实收收入（含预付费欠费收回）-税额\\n       nvl(this_backfee_no_volume_tax,0) fact_this_not_fee, -- 实收收入（含预付费欠费收回）-不含税\\n       a.user_id       \\nfrom (select product_no,acct_id,user_id,fee_item_id acct_item_id,\\n                  sum(this_backfee) this_backfee,\\n                  sum(this_backfee_no_volume_tax) this_backfee_no_volume_tax,\\n                  sum(this_backfee_taxation) this_backfee_taxation\\n                  from gbaserpt.dm_acct_mzback_${monthid} group by product_no,acct_id,user_id,fee_item_id\\n       ) a\\n\\nleft join (select distinct phone_no,acct_item_id,acct_id from gbasedwi.DWI_INCO_BILL_FACT_TOT_MS_${monthid}\\n           ) b on a.product_no=b.phone_no and a.acct_id=b.acct_id and a.acct_item_id=b.acct_item_id\\n           \\nleft join gbasemsm.dim_ckpi_basekpi_feeitem b1 on  a.acct_item_id=b1.FEE_ITEM_ID\\nleft join gbasedwd.dim_rpt_general_sheet1 b2 on  a.acct_item_id=b2.CHARGE_CODE\\nleft join gbasedwi.dwi_usr_pesn_persn_loc_ms_${monthid} b3 on a.product_no=b3.PHONE_NO\\nleft join (select phone_no,max(county_id) county_id,fee_item_id from gbasemsm.msm_dw_basekpi_income_${monthid} group by phone_no,FEE_ITEM_ID\\n\\t\\t\\t) b4 on a.product_no=b4.PHONE_NO and a.acct_item_id=b4.FEE_ITEM_ID\\nleft join gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} b5 on a.product_no=b5.phone_no\\nleft join gbasedwi.dwi_usr_pesn_thinginter_ms_${monthid} b6 on a.product_no=b6.user_no\\nleft join gbasedwi.DWI_USR_PESN_ALLCUST_MS_${monthid} b7 on b6.cust_id=b7.cust_id\\nwhere b.phone_no is null\\nand (a.this_backfee>0 or a.this_backfee_no_volume_tax>0 or a.this_backfee_taxation>0);\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [10]-[index:23]-[出账信息月视图]-[14]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"14.插入目标表数据","nodeId":"14","sql":"insert into  ${DM_PUB_ACCT_SHOULDITEM_YYYYMM} (\\n                  OP_TIME          ,\\n                  PRODUCT_NO       ,\\n                  FEE_ITEM_ID      ,\\n                  FEE_ITEM_NAME    ,\\n                  SHOULD_FEE       ,\\n                  TAX_RATE    ,\\n                  TAXATION_SHOULD_FEE  ,\\n                  NO_VOLUME_TAX_SHOULD_FEE     ,\\n                  PAY_TYPE      ,\\n                  ACCT_ID       ,\\n                  FEE_ITEM_ID1  ,\\n                  FEE_ITEM_ID2  ,\\n                  DEPT_COUNTY_ID,\\n                  COUNTY_ID,\\n                  innet_date,   -- 入网日期\\n                  is_thinginter, -- 是否为物联网卡用户\\n\\t\\t\\t\\t  cust_name,  -- 客户名称\\n                  orgn_bill_income,\\n                  disc_fee,\\n                  this_backfee,\\n                  this_backfee_no_volume_tax,\\n                  this_backfee_taxation,\\n                  FACT_AMT,FACT_TAX_AMT,TAX_BACK_FACT_AMT,\\n                  owe_fee,\\n                  fact_this_fee,fact_this_taxation_fee,fact_this_not_fee,\\n                  user_id\\n                         )\\nselect to_date('${monthid}','YYYYMM') ,\\n       a.phone_no,\\n       a.acct_item_id,\\n       b1.FEE_ITEM_NAME,\\n       sum(SHOULD_FEE) ,\\n       a.TAX_RATE,\\n       sum(SHOULD_TAX_AMT),\\n       sum(TAX_BACK_INCOME),\\n       a.PAY_TYPE,\\n       a.acct_id,\\n       case when b2.CHARGE_CODE is null then '0123' else b2.charge_code end as fee_item_id1,\\n       nvl(b1.FEE_ITEM_ID,'00') as fee_item_id2,\\n       nvl(b3.dept_county_id,0) as dept_county_id,\\n\\t   nvl(b4.county_id,0) as county_id,\\n\\t   date(b5.innet_date) as innet_date,\\n\\t   case when b6.user_no is not null then 1 else 0 end as is_thinginter,\\n\\t   trim(b7.cust_name),\\n       sum(orgn_bill_income),\\n       sum(disc_fee),\\n       sum(nvl(this_backfee,0)),\\n       sum(nvl(this_backfee_no_volume_tax,0)),\\n       sum(nvl(this_backfee_taxation,0)),\\n       sum(FACT_AMT),\\n       sum(FACT_TAX_AMT),\\n       sum(TAX_BACK_FACT_AMT),\\n       sum(nvl(SHOULD_FEE,0)-nvl(FACT_AMT,0)) owe_fee, -- 当月欠费（应收-实收）\\n       sum(nvl(FACT_AMT,0)+nvl(this_backfee,0)) fact_this_fee, -- 实收收入（含预付费欠费收回）-含税\\n       sum(nvl(FACT_TAX_AMT,0)+nvl(this_backfee_taxation,0)) fact_this_taxation_fee, -- 实收收入（含预付费欠费收回）-税额\\n       sum(nvl(TAX_BACK_FACT_AMT,0)+nvl(this_backfee_no_volume_tax,0)) fact_this_not_fee, -- 实收收入（含预付费欠费收回）-不含税\\n       a.user_id       \\nfrom (select phone_no,user_id,acct_id,acct_item_id,TAX_RATE,PAY_TYPE,\\n             sum(SHOULD_FEE) SHOULD_FEE,\\n             sum(SHOULD_TAX_AMT) SHOULD_TAX_AMT,\\n             sum(TAX_BACK_INCOME) TAX_BACK_INCOME,\\n             sum(orgn_bill_income) orgn_bill_income,\\n             sum(disc_fee) disc_fee,\\n             sum(FACT_AMT) FACT_AMT,\\n             sum(FACT_TAX_AMT) FACT_TAX_AMT,\\n             sum(TAX_BACK_FACT_AMT) TAX_BACK_FACT_AMT\\n       from gbasedwi.DWI_INCO_BILL_FACT_TOT_MS_${monthid} group by phone_no,user_id,acct_id,acct_item_id,TAX_RATE,PAY_TYPE\\n       ) a\\n\\nleft join (select product_no,acct_id,user_id,fee_item_id,\\n                  sum(this_backfee) this_backfee,\\n                  sum(this_backfee_no_volume_tax) this_backfee_no_volume_tax,\\n                  sum(this_backfee_taxation) this_backfee_taxation\\n           from gbaserpt.dm_acct_mzback_${monthid} group by product_no,acct_id,user_id,fee_item_id\\n           ) b on a.phone_no=b.product_no and a.acct_id=b.acct_id and a.acct_item_id=b.fee_item_id\\n           \\nleft join gbasemsm.dim_ckpi_basekpi_feeitem b1 on  a.acct_item_id=b1.FEE_ITEM_ID\\nleft join gbasedwd.dim_rpt_general_sheet1 b2 on  a.acct_item_id=b2.CHARGE_CODE\\nleft join gbasedwi.dwi_usr_pesn_persn_loc_ms_${monthid} b3 on a.PHONE_NO=b3.PHONE_NO\\nleft join (select phone_no,max(county_id) county_id,fee_item_id from gbasemsm.msm_dw_basekpi_income_${monthid} group by phone_no,FEE_ITEM_ID\\n\\t\\t\\t) b4 on a.PHONE_NO=b4.PHONE_NO and a.acct_item_id=b4.FEE_ITEM_ID\\nleft join gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} b5 on a.phone_no=b5.phone_no\\nleft join gbasedwi.dwi_usr_pesn_thinginter_ms_${monthid} b6 on a.phone_no=b6.user_no\\nleft join gbasedwi.DWI_USR_PESN_ALLCUST_MS_${monthid} b7 on b6.cust_id=b7.cust_id\\ngroup by a.phone_no,\\n       a.acct_item_id,\\n       b1.FEE_ITEM_NAME,\\n       a.TAX_RATE,\\n       a.PAY_TYPE,\\n       a.acct_id,\\n       case when b2.CHARGE_CODE is null then '0123' else  b2.charge_code  end,\\n       nvl(b1.FEE_ITEM_ID,'00'),\\n       nvl(b3.dept_county_id,0),\\n\\t   nvl(b4.county_id,0) ,\\n\\t   date(b5.innet_date) ,\\n\\t   case when b6.user_no is not null then 1 else 0 end ,\\n\\t   trim(b7.cust_name),\\n       a.user_id"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [11]-[index:24]-[出账信息月视图]-[49]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.dm_pub_acct_shoulditem_${monthid};\\nCREATE TABLE dm.dm_pub_acct_shoulditem_${monthid} (\\n OP_TIME date ,\\n  PRODUCT_NO varchar(20) ,\\n  FEE_ITEM_ID varchar(10) ,\\n  FEE_ITEM_NAME varchar(80) ,\\n  SHOULD_FEE decimal(12,3) ,\\n  TAX_RATE bigint(20) ,\\n  TAXATION_SHOULD_FEE decimal(12,3) ,\\n  NO_VOLUME_TAX_SHOULD_FEE decimal(12,3) ,\\n  PAY_TYPE bigint(20) ,\\n  ACCT_ID varchar(20) ,\\n  FEE_ITEM_ID1 varchar(10) ,\\n  FEE_ITEM_ID2 varchar(10) ,\\n  DEPT_COUNTY_ID bigint(20) ,\\n  COUNTY_ID bigint(20) ,\\n  innet_date date ,\\n  is_thinginter smallint(6) ,\\n  cust_name varchar(100) ,\\n  orgn_bill_income decimal(12,3) ,\\n  disc_fee decimal(12,3) ,\\n  this_backfee decimal(20,2) ,\\n  this_backfee_no_volume_tax decimal(20,2) ,\\n  this_backfee_taxation decimal(20,2) ,\\n  FACT_AMT decimal(12,3) ,\\n  FACT_TAX_AMT decimal(12,3) ,\\n  TAX_BACK_FACT_AMT decimal(12,3) ,\\n  owe_fee decimal(20,3) ,\\n  fact_this_fee decimal(20,3) ,\\n  fact_this_taxation_fee decimal(20,3) ,\\n  fact_this_not_fee decimal(20,3) ,\\n  user_id varchar(50) \\n)DISTRIBUTED BY('product_no')"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [12]-[index:26]-[出账信息月视图]-[46]-['str' object has no attribute 'lfind']:{"name":"更新维表","nodeId":"46","dsName":"GbaseDM","sql":"truncate table dm.dim_rpt_general_sheet1;\\ninsert into dm.dim_rpt_general_sheet1 select * from gbasedwd.dim_rpt_general_sheet1;\\ntruncate table dm.dim_ckpi_basekpi_feeitem;\\ninsert into dm.dim_ckpi_basekpi_feeitem select * from gbasemsm.dim_ckpi_basekpi_feeitem;\\ninsert into dm.dim_ckpi_basekpi_feeitem (fee_item_id,fee_type_name) values('00','其他数据业务');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [13]-[index:28]-[2014年日新增指标数据表]-[45]-['str' object has no attribute 'lfind']:{"name":"45.清楚所有临时表","nodeId":"45","dsName":"GbaseDM","sql":"DROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_01};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_02};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_03};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_04};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_05};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_06};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_07};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_08};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [14]-[index:29]-[2014年日新增指标数据表]-[69]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"69.插入临时表7","nodeId":"69","sql":"insert into ${TARGET_TMP_DM_PUB_INCREASE_DAY_07}   \\n(\\tPHONE_NO\\t\\t            ,\\n\\tIS_IMEI_ABNORMAL        ,\\n  IS_OPEN_ABNORMAL        ,\\n  IS_REAL10_ABNORMAL      ,\\n  IS_REAL6_ABNORMAL       ,\\n  IS_CELL_ABNORMAL        ,\\n  IS_ACTIVE_ABNORMAL      ,\\n  IS_SALE_ABNORMAL        ,\\n  CREDIT_LEVEL    -- 客户星级标识\\n)\\nselect\\n    a.phone_no,\\n    0    ,\\n    0    ,\\n    0  ,\\n    0   ,\\n    0 ,\\n    0  ,\\n    0    ,\\n    nvl(c.CREDIT_LEVEL,-1)   -- 客户星级标识\\n from gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid}  a\\n/* left join (select\\n                phone_no,\\n                max(case when warn_name='IMEI集中异常' then 1 else 0 end) as IS_IMEI_ABNORMAL,\\n                max(case when warn_name='开卡集中异常' then 1 else 0 end) as IS_OPEN_ABNORMAL,\\n                max(case when warn_name='实名登记集中异常10' then 1 else 0 end) as IS_REAL10_ABNORMAL,\\n                max(case when warn_name='实名登记集中异常6' then 1 else 0 end) as IS_REAL6_ABNORMAL,\\n                max(case when warn_name='基站集中异常' then 1 else 0 end) as IS_CELL_ABNORMAL,\\n                max(case when warn_name='登记与激活间隔异常' then 1 else 0 end) as IS_ACTIVE_ABNORMAL,\\n                max(case when warn_name='跨区销售异常' then 1 else 0 end) as IS_SALE_ABNORMAL\\n              from gbasemsm.msm_lens_card_warning_detail_st_${monthid}    \\n             where warn_date='${day_id}'\\n             group by phone_no) b ON a.PHONE_NO=b.PHONE_NO\\n*/\\nleft join (\\n              select a.phone_no,  \\n                     b.crdt_lvl CREDIT_LEVEL\\n              from gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a\\n              left join  (\\n\\t\\t\\t               select  phone_no,\\n                                   max(CRDT_LVL) crdt_lvl\\n                           from gbasedwd.DWD_SVC_USR_CREDIT_dS_${dayid}\\n                           group by phone_no\\n\\t\\t\\t            ) b on a.phone_no=b.phone_no \\n\\t\\t    group by a.phone_no,b.crdt_lvl\\n           ) c ON a.PHONE_NO=c.PHONE_NO\\n\\t where   a.PROD_KIND_CODE='171000000001'  And (a.MONTH_ARRIVE_FLAG = 1 or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1)"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [15]-[index:30]-[2014年日新增指标数据表]-[43]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"43.插入最终表","nodeId":"43","sql":"INSERT INTO ${TARGET_DM_PUB_INCREASE_DAY_YYYYMMDD}\\n(\\tOP_TIME,\\n\\tSTATIS_MONTH,\\n\\tPRODUCT_NO,\\n\\tUSER_OFF_TIME,\\n\\tSTEADY_DEPT_NAME,\\n\\tACTIVE_MARK,\\n\\tHALL_REMAIN_30DAYS_MARK,\\n\\tDISTRICT_NAME,\\n\\tVALID_ACTIVE_TIME,\\n\\tORG_ASSIGN_TIME,\\n\\tACTIVE_MARK_10086,\\n\\tUSER_OFF_MARK,\\n\\tACTIVE_REMAIN_30DAYS_MARK,\\n\\tDISTRICT_ID,\\n\\tVALID_ACTIVE_MARK,\\n\\tDEPOSIT_AMT,\\n\\tBRAND_NAME,\\n\\tCHANNEL_NAME,\\n\\tORG_CHANNEL_NAME,\\n\\tACTIVE_TIME_10086,\\n\\tCARD_TYPE,\\n\\tCARD_WRITE_TYPE,\\n\\tCHANNEL_CATEGORY,\\n\\tASSIGN_TIME,\\n\\tACTIVE_TIME,\\n\\tIS_IMPORT_USER,\\n\\tCUST_TYPE,\\n\\tDEPT_NAME,\\n\\tENTERPRISE_MARK,\\n\\tCURRENT_HOLD_MARK,\\n\\tGPRS_TNET_TOTAL_FLOW,\\n\\tGRID_ID,\\n\\tDAY_FEE,\\n\\tDAY_LAST1_FEE,\\n\\tDAY_LAST2_FEE,\\n\\tDAY_LAST3_FEE,\\n\\tGPRS_FEE,\\n\\tGPRS_AMOUNT,\\n\\tGPRS_WLAN_AMOUNT,\\n\\tGPRS_LAST1_FEE,\\n\\tGPRS_LAST1_AMOUNT,\\n\\tGPRS_WLANLAST1_AMOUNT,\\n\\tIS_2016ENTER_USER_ACT,\\n\\tIS_2016STOCK_USER_ACT,\\n\\tLEAVE_NET_FLAG,\\n\\tIS_REAL_NAME,\\n\\tREAL_TIME,\\n\\tSIM_NO,\\n\\tIS_INTERNET_THINGS,\\n\\tIS_2016STOCK_USER,\\n\\tIS_2016ENTER_USER,\\n  IS_UNIFIED_PACKAGE,\\n\\tBEIXIANG_SCORE,\\n\\tXIAOFEI_SCORE,\\n\\tCONSUME_SCORE,\\n  SCORE_SHIELD_FLAG,\\n  IS_YIJING_ACCT_USER,\\n  CUR_SCORE_BALANCE,\\n  IS_IMEI_ABNORMAL,\\n  IS_OPEN_ABNORMAL,\\n  IS_REAL10_ABNORMAL,\\n  IS_REAL6_ABNORMAL,\\n  IS_CELL_ABNORMAL,\\n  IS_ACTIVE_ABNORMAL,\\n  IS_SALE_ABNORMAL,\\n  CREDIT_LEVEL,\\n  HMT_OUT_NET1,\\n  HMT_IN_NET1,\\n  INTER_OUT_NET1,\\n  INTER_IN_NET1,\\n  HMT_OUT_NET2,\\n  HMT_IN_NET2,\\n  INTER_OUT_NET2,\\n  INTER_IN_NET2,\\n  LOC_HMT_TOLL_NUM,\\n  LOC_INTER_TOLL_NUM,\\n  LOC_HMT_TOLL_CALL_DUR,\\n  LOC_INTER_TOLL_CALL_DUR,\\n  LOC_CALLED_HMT_NUM,\\n  LOC_CALLED_HMT_BILL_DUR,\\n  LOC_CALLED_INTER_BILL_DUR,\\n  LOC_CALLED_INTER_NUM,\\n  HMT_ROAM_NUM,\\n  HMT_ROAM_IN_NUM,\\n  HMT_ROAM_IN_BILL_DUR,\\n  HMT_ROAM_OUT_NUM,\\n  HMT_ROAM_OUT_BILL_DUR,\\n  HMT_ROAM_BILL_DUR,\\n  INTER_ROAM_NUM,\\n  INTER_ROAM_IN_NUM,\\n  INTER_ROAM_IN_BILL_DUR,\\n  INTER_ROAM_OUT_NUM,\\n  INTER_ROAM_OUT_BILL_DUR,\\n  INTER_ROAM_BILL_DUR,\\n  LROAM_OUT_HMT_TOLL_NUM,\\n  LROAM_OUT_HMT_TOLL_BILL_DUR,\\n  LROAM_OUT_INTER_TOLL_NUM,\\n  LROAM_OUT_INTER_TOLL_BILL_DUR,\\n  HMT_TOLL_IP_12593_CALL_NUM,\\n  HMT_TOLL_IP_12593_CALL_DUR,\\n  HMT_TOLL_IP_17950_CALL_NUM,\\n  HMT_TOLL_IP_17950_CALL_DUR,\\n  HMT_TOLL_IP_17951_CALL_NUM,\\n  HMT_TOLL_IP_17951_CALL_DUR,\\n  HMT_TOLL_IP_CALL_NUM,\\n  HMT_TOLL_IP_CALL_DUR,\\n  HMT_TOLL_CALL_NUM,\\n  HMT_TOLL_NOIP_CALL_NUM,\\n  HMT_TOLL_NOIP_CALL_DUR,\\n  HMT_TOLL_CALL_DUR,\\n  INTER_TOLL_IP_12593_CALL_NUM,\\n  INTER_TOLL_IP_12593_CALL_DUR,\\n  INTER_TOLL_IP_17950_CALL_NUM,\\n  INTER_TOLL_IP_17950_CALL_DUR,\\n  INTER_TOLL_IP_17951_CALL_NUM,\\n  INTER_TOLL_IP_17951_CALL_DUR,\\n  INTER_TOLL_IP_CALL_NUM,\\n  INTER_TOLL_IP_CALL_DUR,\\n  INTER_TOLL_CALL_NUM,\\n  INTER_TOLL_NO_IP_CALL_NUM,\\n  INTER_TOLL_NO_IP_CALL_DUR,\\n  INTER_TOLL_CALL_DUR,\\n  GPRS_HMT_ROAM_FLOW,\\n  GPRS_HMT_ROAM_UP_FLOW,\\n  GPRS_HMT_ROAM_DOWN_FLOW,\\n  GPRS_INTER_ROAM_FLOW,\\n  GPRS_INTER_ROAM_UP_FLOW,\\n  GPRS_INTER_ROAM_DOWN_FLOW,\\n  gprs_total_num, -- 当日GPRS使用次数\\n  gprs_total_dur, -- 当日GPRS使用时长（分钟）\\n  SMS_INTER_P2P_NUM,\\n  plan_monthly_fee,\\n  chl_id1,\\n  IS_offer_user,\\n  county_id,\\n  ysj_flow_m , -- 云视界使用流量（MB)\\naqy_flow_m, -- 爱奇艺使用流量（MB)                                                                                                  \\nyk_flow_m, -- 优酷视频类使用流量（MB)\\ntx_flow_m, -- 腾讯视频类使用流量（MB)\\nks_flow_m, -- 快手使用流量（MB)\\ndy_flow_m, -- 抖音短视频使用流量（MB)\\nxg_flow_m, -- 西瓜视频使用流量（MB)\\nmgtv_flow_m, -- 芒果TV使用流量（MB)\\nls_flow_m , -- 乐视视频类使用流量（MB)\\nbst_flow_m, -- 百视通视频类使用流量（MB)\\nsh_flow_m, -- 搜狐视频使用流量（MB)\\nbd_flow_m, -- 百度视频类使用流量（MB)\\nwy_flow_m, -- 网易视频类使用流量（MB)\\nmg_flow_m, -- 咪咕视频类使用流量（MB)\\nxl_flow_m , -- 新浪视频类使用流量（MB)\\njrtt_flow_m , -- 今日头条使用流量（MB)\\nbfyy_flow_m,  -- 暴风影音使用流量（MB)\\nwzry_flow_m,  -- 王者荣耀使用流量（MB)\\nwyyyy_flow_m , -- 网易云音乐使用流量（MB)\\npptv_flow_m, -- PPTV使用流量（MB)\\nis_chunnewadd_user,  -- 是否为当日纯新增用户 \\nis_offnet_user,  -- 是否为当日离网客户（不含物联网）\\nchl_id  , -- CO归属分公司    20190722 new add \\ngroup_cust_level, -- CO重要程度\\ngrp_name,       -- CO客户名称\\ngrp_state_id ,     -- CO在网状态\\nCO_CODE        -- CO编码\\n)\\nSELECT\\t${dayid},\\n\\t\\t${monthid},\\n\\t\\tA.PHONE_NO,\\n\\t\\tA.USER_OFF_TIME,\\n\\t\\tA.STEADY_DEPT_NAME,\\n\\t\\tA.ACTIVE_MARK,\\n\\t\\tA.HALL_REMAIN_30DAYS_MARK,\\n\\t\\tA.DISTRICT_NAME,\\n\\t\\tA.VALID_ACTIVE_TIME,\\n\\t\\tA.ORG_ASSIGN_TIME,\\n\\t\\tA.ACTIVE_MARK_10086,\\n\\t\\tA.USER_OFF_MARK,\\n\\t\\tA.ACTIVE_REMAIN_30DAYS_MARK,\\n\\t\\tA.DISTRICT_ID,\\n\\t\\tA.VALID_ACTIVE_MARK,\\n\\t\\tA.DEPOSIT_AMT,\\n\\t\\tA.BRAND_NAME,\\n\\t\\tA.CHANNEL_NAME,\\n\\t\\tA.ORG_CHANNEL_NAME,\\n\\t\\tA.ACTIVE_TIME_10086,\\n\\t\\tA.CARD_TYPE,\\n\\t\\tA.CARD_WRITE_TYPE,\\n\\t\\tA.CHANNEL_CATEGORY,\\n\\t\\tA.ASSIGN_TIME,\\n\\t\\tA.ACTIVE_TIME,\\n\\t\\tB.IS_IMPORT_USER,\\n\\t\\tB.CUST_TYPE,\\n\\t\\tB.DEPT_NAME,\\n\\t\\tB.ENTERPRISE_MARK,\\n\\t\\tB.CURRENT_HOLD_MARK,\\n\\t\\tB.GPRS_TNET_TOTAL_FLOW,\\n\\t\\tB.GRID_ID,\\n\\t\\tD.DAY_FEE,\\n\\t\\tD.DAY_LAST1_FEE,\\n\\t\\tD.DAY_LAST2_FEE,\\n\\t\\tD.DAY_LAST3_FEE,\\n\\t\\tD.GPRS_FEE,\\n\\t\\tD.GPRS_AMOUNT,\\n\\t\\tD.GPRS_WLAN_AMOUNT,\\n\\t\\tD.GPRS_LAST1_FEE,\\n\\t\\tD.GPRS_LAST1_AMOUNT,\\n\\t\\tD.GPRS_WLANLAST1_AMOUNT,\\n\\t\\tD.IS_2016ENTER_USER_ACT,\\n\\t\\tD.IS_2016STOCK_USER_ACT,\\n\\t\\tC.LEAVE_NET_FLAG,\\n\\t\\tC.IS_REAL_NAME,\\n\\t\\tC.REAL_TIME,\\n\\t\\tC.SIM_NO,\\n\\t\\tC.IS_INTERNET_THINGS,\\n\\t\\tC.IS_2016STOCK_USER,\\n\\t\\tC.IS_2016ENTER_USER,\\n\\t\\tE. IS_UNIFIED_PACKAGE,\\n\\t\\tF.BEIXIANG_SCORE,\\n\\t  F.XIAOFEI_SCORE,\\n\\t  F.CONSUME_SCORE,\\n    F.SCORE_SHIELD_FLAG,\\n    E.IS_YIJING_ACCT_USER,\\n    F.CUR_SCORE_BALANCE,\\n    G.IS_IMEI_ABNORMAL,\\n    G.IS_OPEN_ABNORMAL,\\n    G.IS_REAL10_ABNORMAL,\\n    G.IS_REAL6_ABNORMAL,\\n    G.IS_CELL_ABNORMAL,\\n    G.IS_ACTIVE_ABNORMAL,\\n    G.IS_SALE_ABNORMAL,\\n    G.CREDIT_LEVEL,\\n    H.HMT_OUT_NET1,\\n    H.HMT_IN_NET1,\\n    H.INTER_OUT_NET1,\\n    H.INTER_IN_NET1,\\n    H.HMT_OUT_NET2,\\n    H.HMT_IN_NET2,\\n    H.INTER_OUT_NET2,\\n    H.INTER_IN_NET2,\\n    H.LOC_HMT_TOLL_NUM,\\n    H.LOC_INTER_TOLL_NUM,\\n    H.LOC_HMT_TOLL_CALL_DUR,\\n    H.LOC_INTER_TOLL_CALL_DUR,\\n    H.LOC_CALLED_HMT_NUM,\\n    H.LOC_CALLED_HMT_BILL_DUR,\\n    H.LOC_CALLED_INTER_BILL_DUR,\\n    H.LOC_CALLED_INTER_NUM,\\n    H.HMT_ROAM_NUM,\\n    H.HMT_ROAM_IN_NUM,\\n    H.HMT_ROAM_IN_BILL_DUR,\\n    H.HMT_ROAM_OUT_NUM,\\n    H.HMT_ROAM_OUT_BILL_DUR,\\n    H.HMT_ROAM_BILL_DUR,\\n    H.INTER_ROAM_NUM,\\n    H.INTER_ROAM_IN_NUM,\\n    H.INTER_ROAM_IN_BILL_DUR,\\n    H.INTER_ROAM_OUT_NUM,\\n    H.INTER_ROAM_OUT_BILL_DUR,\\n    H.INTER_ROAM_BILL_DUR,\\n    H.LROAM_OUT_HMT_TOLL_NUM,\\n    H.LROAM_OUT_HMT_TOLL_BILL_DUR,\\n    H.LROAM_OUT_INTER_TOLL_NUM,\\n    H.LROAM_OUT_INTER_TOLL_BILL_DUR,\\n    H.HMT_TOLL_IP_12593_CALL_NUM,\\n    H.HMT_TOLL_IP_12593_CALL_DUR,\\n    H.HMT_TOLL_IP_17950_CALL_NUM,\\n    H.HMT_TOLL_IP_17950_CALL_DUR,\\n    H.HMT_TOLL_IP_17951_CALL_NUM,\\n    H.HMT_TOLL_IP_17951_CALL_DUR,\\n    H.HMT_TOLL_IP_CALL_NUM,\\n    H.HMT_TOLL_IP_CALL_DUR,\\n    H.HMT_TOLL_CALL_NUM,\\n    H.HMT_TOLL_NOIP_CALL_NUM,\\n    H.HMT_TOLL_NOIP_CALL_DUR,\\n    H.HMT_TOLL_CALL_DUR,\\n    H.INTER_TOLL_IP_12593_CALL_NUM,\\n    H.INTER_TOLL_IP_12593_CALL_DUR,\\n    H.INTER_TOLL_IP_17950_CALL_NUM,\\n    H.INTER_TOLL_IP_17950_CALL_DUR,\\n    H.INTER_TOLL_IP_17951_CALL_NUM,\\n    H.INTER_TOLL_IP_17951_CALL_DUR,\\n    H.INTER_TOLL_IP_CALL_NUM,\\n    H.INTER_TOLL_IP_CALL_DUR,\\n    H.INTER_TOLL_CALL_NUM,\\n    H.INTER_TOLL_NO_IP_CALL_NUM,\\n    H.INTER_TOLL_NO_IP_CALL_DUR,\\n    H.INTER_TOLL_CALL_DUR,\\n    H.GPRS_HMT_ROAM_FLOW,\\n    H.GPRS_HMT_ROAM_UP_FLOW,\\n    H.GPRS_HMT_ROAM_DOWN_FLOW,\\n    H.GPRS_INTER_ROAM_FLOW,\\n    H.GPRS_INTER_ROAM_UP_FLOW,\\n    H.GPRS_INTER_ROAM_DOWN_FLOW,\\n    H.gprs_total_num, -- 当日GPRS使用次数\\n    H.gprs_total_dur, -- 当日GPRS使用时长（分钟）\\n    H.SMS_INTER_P2P_NUM,\\n    d.plan_monthly_fee,\\n    a.chl_id1,\\n\\tj.IS_offer_user,\\n    j.county_id,\\n\\tk.ysj_flow_m , -- 云视界使用流量（MB)\\nk.aqy_flow_m, -- 爱奇艺使用流量（MB)                                                                                                  \\nk.yk_flow_m, -- 优酷视频类使用流量（MB)\\nk.tx_flow_m, -- 腾讯视频类使用流量（MB)\\nk.ks_flow_m, -- 快手使用流量（MB)\\nk.dy_flow_m, -- 抖音短视频使用流量（MB)\\nk.xg_flow_m, -- 西瓜视频使用流量（MB)\\nk.mgtv_flow_m, -- 芒果TV使用流量（MB)\\nk.ls_flow_m , -- 乐视视频类使用流量（MB)   \\nk.bst_flow_m, -- 百视通视频类使用流量（MB)    \\nk.sh_flow_m, -- 搜狐视频使用流量（MB)\\nk.bd_flow_m, -- 百度视频类使用流量（MB)\\nk.wy_flow_m, -- 网易视频类使用流量（MB)\\nk.mg_flow_m, -- 咪咕视频类使用流量（MB)\\nk.xl_flow_m , -- 新浪视频类使用流量（MB)\\nk.jrtt_flow_m , -- 今日头条使用流量（MB)\\nk.bfyy_flow_m,  -- 暴风影音使用流量（MB)\\nk.wzry_flow_m,  -- 王者荣耀使用流量（MB)\\nk.wyyyy_flow_m , -- 网易云音乐使用流量（MB)\\nk.pptv_flow_m, -- PPTV使用流量（MB)\\nl.is_chunnewadd_user, -- 是否为当日纯新增用户\\nl.is_offnet_user,  -- 是否为当日离网客户（不含物联网）\\nl.chl_id   , -- CO归属分公司    20190722 new add \\nl.group_cust_level  , -- CO重要程度\\nl.grp_name  ,       -- CO客户名称\\nl.grp_state_id  ,     -- CO在网状态\\nl.CO_CODE     -- CO编码\\nFROM ${TARGET_TMP_DM_PUB_INCREASE_DAY_04} A\\nLEFT JOIN ${TARGET_TMP_DM_PUB_INCREASE_DAY_01} B ON A.PHONE_NO=B.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_PUB_INCREASE_DAY_02} D ON A.PHONE_NO=D.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_PUB_INCREASE_DAY_03} C ON A.PHONE_NO=C.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_PUB_INCREASE_DAY_05} E ON A.PHONE_NO=E.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_PUB_INCREASE_DAY_06} F ON A.PHONE_NO=F.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_PUB_INCREASE_DAY_07} G ON A.PHONE_NO=G.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_PUB_INCREASE_DAY_08} H ON A.PHONE_NO=H.PHONE_NO\\nLEFT JOIN dm.tmp_DM_PUB_INCREASE_DAY_user_${dayid} J ON A.PHONE_NO=J.PHONE_NO\\nLEFT JOIN dm.tmp_increase_app_type_${dayid} K ON A.PHONE_NO=K.PHONE_NO\\nLEFT JOIN dm.TMP_DM_PUB_INCREASE_DAY_09_${dayid} L ON A.PHONE_NO=L.PHONE_NO"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [16]-[index:31]-[2014年日新增指标数据表]-[73]-['str' object has no attribute 'lfind']:{"name":"创建临时表8","nodeId":"73","dsName":"GbaseDM","sql":"create table ${TARGET_TMP_DM_PUB_INCREASE_DAY_08}\\n(\\n phone_no                      varchar(20),\\n hmt_out_net1                  bigint, \\n hmt_in_net1                   bigint,\\n inter_out_net1                bigint,\\n inter_in_net1                 bigint,\\n hmt_out_net2                  bigint,\\n hmt_in_net2                   bigint,\\n inter_out_net2                bigint,\\n inter_in_net2                 bigint,\\n loc_hmt_toll_num              bigint,\\n loc_inter_toll_num            bigint,\\n loc_hmt_toll_call_dur         bigint,\\n loc_inter_toll_call_dur       bigint,\\n loc_called_hmt_num            bigint,\\n loc_called_hmt_bill_dur       bigint,\\n loc_called_inter_bill_dur     bigint,\\n loc_called_inter_num          bigint,\\n hmt_roam_num                  bigint,\\n hmt_roam_in_num               bigint,\\n hmt_roam_in_bill_dur          bigint,\\n hmt_roam_out_num              bigint,\\n hmt_roam_out_bill_dur         bigint,\\n hmt_roam_bill_dur             bigint,\\n inter_roam_num                bigint,\\n inter_roam_in_num             bigint,\\n inter_roam_in_bill_dur        bigint,\\n inter_roam_out_num            bigint,\\n inter_roam_out_bill_dur       bigint,\\n inter_roam_bill_dur           bigint,\\n lroam_out_hmt_toll_num        bigint,\\n lroam_out_hmt_toll_bill_dur   bigint,\\n lroam_out_inter_toll_num      bigint,\\n lroam_out_inter_toll_bill_dur bigint,\\n hmt_toll_ip_12593_call_num    bigint,\\n hmt_toll_ip_12593_call_dur    bigint,\\n hmt_toll_ip_17950_call_num    bigint,\\n hmt_toll_ip_17950_call_dur    bigint,\\n hmt_toll_ip_17951_call_num    bigint,\\n hmt_toll_ip_17951_call_dur    bigint,\\n hmt_toll_ip_call_num          bigint,\\n hmt_toll_ip_call_dur          bigint,\\n hmt_toll_call_num             bigint,\\n hmt_toll_noip_call_num        bigint,\\n hmt_toll_noip_call_dur        bigint,\\n hmt_toll_call_dur             bigint,\\n inter_toll_ip_12593_call_num  bigint,\\n inter_toll_ip_12593_call_dur  bigint,\\n inter_toll_ip_17950_call_num  bigint,\\n inter_toll_ip_17950_call_dur  bigint,\\n inter_toll_ip_17951_call_num  bigint,\\n inter_toll_ip_17951_call_dur  bigint,\\n inter_toll_ip_call_num        bigint,\\n inter_toll_ip_call_dur        bigint,\\n inter_toll_call_num           bigint,\\n inter_toll_no_ip_call_num     bigint,\\n inter_toll_no_ip_call_dur     bigint,\\n inter_toll_call_dur           bigint,\\n gprs_hmt_roam_flow            decimal(20,2),\\n gprs_hmt_roam_up_flow         decimal(20,2),\\n gprs_hmt_roam_down_flow       decimal(20,2),\\n gprs_inter_roam_flow          decimal(20,2),\\n gprs_inter_roam_up_flow       decimal(20,2),\\n gprs_inter_roam_down_flow     decimal(20,2),\\n gprs_total_num                bigint,        -- 当日GPRS使用次数\\n gprs_total_dur                bigint,        -- 当日GPRS使用时长（分钟）\\n sms_inter_p2p_num             bigint\\n) distributed by('phone_no');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [17]-[index:32]-[2014年日新增指标数据表]-[33]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"33.插入数据3","nodeId":"33","sql":"INSERT INTO ${TARGET_TMP_DM_PUB_INCREASE_DAY_03}\\n (\\tPHONE_NO,LEAVE_NET_FLAG,IS_REAL_NAME,REAL_TIME,SIM_NO,\\n\\tIS_INTERNET_THINGS,IS_2016STOCK_USER,IS_2016ENTER_USER\\t)\\nSELECT\\tdistinct\\n        A.PHONE_NO,          \\n\\t\\tCASE WHEN B.USER_ID IS NULL  THEN 0 ELSE 1 END,\\n\\t\\tCASE WHEN C.CUST_ID IS NOT NULL THEN '1' ELSE '0' END,\\n\\t\\th.done_date as ACPT_DATE,\\n\\t\\tD.EMPTY_CRAD_SEQ_NO,\\n\\t\\tCASE WHEN E.USER_NO IS NOT NULL THEN '1' ELSE '0' END,\\n\\t\\tCASE WHEN F.USER_NO IS NULL THEN 0 ELSE 1 END ,\\n\\t\\tCASE WHEN G.PRODUCT_NO IS NULL THEN 0 ELSE 1 END\\nFROM ${SOURCE_DWI_USR_PESN_PARTINFO_DS_YYYYMMDD} A\\nLEFT JOIN (SELECT msisdn as USER_ID FROM ${SOURCE_INT_02004_DI_YYYYMMDD}\\n\\t\\t   WHERE USER_STATUS IN ('2010','2020','2030','9000') AND STS_UPDATE ='${dayid}') B ON A.PHONE_NO=B.USER_ID\\nLEFT JOIN (SELECT distinct CUST_ID,ACPT_DATE FROM ${SOURCE_DWD_PRTY_CUST_EXTEN_DS_YYYYMMDD}\\n           WHERE ATTRDEF_ID='10' AND CUST_ATTR_VAL='Y') C ON A.CUST_ID=C.CUST_ID\\nLEFT JOIN (SELECT PHONE_NO,EMPTY_CRAD_SEQ_NO\\n\\t\\t   FROM (SELECT ROW_NUMBER() OVER(PARTITION BY PHONE_NO ORDER BY ACPT_DATE DESC) AA,PHONE_NO,EMPTY_CRAD_SEQ_NO\\n\\t\\t\\t\\t FROM ${SOURCE_DWD_RES_SVC_SIM_DS_YYYYMMDD} A WHERE MANG_STATE='5' AND IS_USE='1') AA\\n\\t\\t   WHERE AA='1') D ON A.PHONE_NO=D.PHONE_NO\\nLEFT JOIN (SELECT USER_NO FROM ${SOURCE_DWI_USR_PESN_THINGINTER_DS_YYYYMMDD}) E ON A.PHONE_NO=E.USER_NO\\nLEFT JOIN GBASEDWI.DWI_USR_PESN_STOCKSHOT_2016 F ON A.PHONE_NO=F.USER_NO\\nLEFT JOIN  gbasedwi.dw_enterprise_snapshot_2016 G   /*GBASEDWI.DWI_USR_PESN_STOCKSHOT_2016 */   ON A.PHONE_NO=G.PRODUCT_NO\\nLEFT JOIN (select distinct bill_id,max(done_date) done_date \\n           from gbaseods.ods_d_f_crm_02611_user_contact_info_${dayid} group by 1) h ON A.PHONE_NO=h.bill_id\\nWHERE  (A.PROD_KIND_CODE='171000000001' and A.MONTH_ARRIVE_FLAG = 1) OR A.MONTH_OFF_FLAG = 1;\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [18]-[index:33]-[2014年日新增指标数据表]-[53]-['str' object has no attribute 'lfind']:{"name":"创建临时表5","nodeId":"53","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_05}\\n(\\tPHONE_NO\\t\\t\\tVARCHAR(20),\\n\\tIS_UNIFIED_PACKAGE              SMALLINT,\\n        IS_YIJING_ACCT_USER             SMALLINT)\\nDISTRIBUTED BY('PHONE_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [19]-[index:34]-[2014年日新增指标数据表]-[27]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"创建临时表1","nodeId":"27","sql":"CREATE TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_01}\\n (\\tPHONE_NO\\t\\t\\t\\tVARCHAR(20),\\n\\tIS_IMPORT_USER\\t\\t\\tCHAR(1),\\n\\tCUST_TYPE\\t\\t\\t\\tVARCHAR(20),\\n\\tDEPT_NAME\\t\\t\\t\\tVARCHAR(20),\\n\\tENTERPRISE_MARK\\t\\t\\tVARCHAR(20),\\n\\tCURRENT_HOLD_MARK\\t\\tCHAR(1),\\n\\tGPRS_TNET_TOTAL_FLOW\\tBIGINT(20),\\n\\tGRID_ID\\t\\t\\t\\t\\tINT(11)\\t)\\nDISTRIBUTED BY('PHONE_NO') nolock;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [20]-[index:35]-[2014年日新增指标数据表]-[23]-['str' object has no attribute 'lfind']:{"name":"清楚所有临时表","nodeId":"23","dsName":"GbaseDM","sql":"DROP TABLE ${TARGET_DM_PUB_INCREASE_DAY_YYYYMMDD};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_01};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_02};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_03};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_04};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_05};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_06};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_07};\\nDROP TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_08};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [21]-[index:36]-[2014年日新增指标数据表]-[59]-['str' object has no attribute 'lfind']:{"name":"59.插入临时表6","nodeId":"59","dsName":"GbaseDM","sql":"insert into ${TARGET_TMP_DM_PUB_INCREASE_DAY_06}\\n(\\tPHONE_NO\\t\\t            ,\\n\\tBEIXIANG_SCORE              ,\\n\\tXIAOFEI_SCORE               ,\\n\\tCONSUME_SCORE               ,\\n    SCORE_SHIELD_FLAG           ,\\n    CUR_SCORE_BALANCE\\t)\\n        \\t  select  a.phone_no,          \\n          b.beixiang_score,           /* --倍享积分余额*/\\n          b.xiaofei_score,            /*--消费积分余额*/\\n          b.consume_score,            /* --促销积分余额*/\\n          nvl(b.GRPSHIELD_FLAG,0),\\n          nvl(c.CUR_SCORE_BALANCE,0)   /*用户可用积分*/  \\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid}  a \\nleft join (select\\n               PHONE_NO as product_no,\\n               sum (case when SCORE_TYPE='1' then CUR_BALANCE else 0 end ) as beixiang_score,     /*倍享积分余额*/\\n               sum (case when SCORE_TYPE in ('0','2') then CUR_BALANCE else 0 end ) as xiaofei_score,        /*消费积分余额*/\\n               sum (case when SCORE_TYPE in ('3','4')  then CUR_BALANCE else 0 end ) as consume_score ,    /* 促销积分余额*/  \\n               GRPSHIELD_FLAG\\n          from gbasedwi.DWI_INCO_BILL_SCORE_BALANC_DS_${dayid} group by PHONE_NO,GRPSHIELD_FLAG) b  on  a.PHONE_NO=b.product_no\\nleft join (select phone_no,max(CUR_SCORE_BALANCE) CUR_SCORE_BALANCE /*用户可用积分*/\\n            from GBASEDWI.DWI_INCO_BILL_USER_SCORE_DT_${dayid} group by phone_no) c ON A.PHONE_NO=c.PHONE_NO      \\n  where   a.PROD_KIND_CODE='171000000001'  And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 Or a.MONTH_NEW_FLAG = 1)","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [22]-[index:38]-[2014年日新增指标数据表]-[68]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"68.创建临时表7","nodeId":"68","sql":"CREATE TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_07}\\n(\\tphone_no\\t\\t\\t        varchar(20),\\n\\tis_imei_abnormal      smallint,\\n\\tis_open_abnormal      smallint,\\n\\tis_real10_abnormal    smallint,\\n  is_real6_abnormal     smallint,\\n  is_cell_abnormal      smallint,\\n  is_active_abnormal    smallint,\\n\\tis_sale_abnormal      smallint,\\n\\tcredit_level          bigint\\n)\\nDISTRIBUTED BY('PHONE_NO') nolock;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [23]-[index:39]-[2014年日新增指标数据表]-[91]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"91.临时表09","nodeId":"91","sql":" drop table tmp_dm_pub_increase_day_09_${dayid};\\n CREATE TABLE tmp_dm_pub_increase_day_09_${dayid}\\n (\\n  phone_no varchar(30),\\n  user_id bigint(30) ,\\n  is_chunnewadd_user bigint(3), -- 是否为当日纯新增用户\\n  is_offnet_user bigint(3),  -- 是否为当日离网客户（不含物联网）\\n  chl_id varchar(20)  , -- CO归属分公司    20190722 new add \\n  group_cust_level varchar(2)  , -- CO重要程度\\n  grp_name varchar(300)  ,       -- CO客户名称\\n  grp_state_id bigint(21)  ,     -- CO在网状态\\n  CO_CODE varchar(30)        -- CO编码\\n)distributed by ('phone_no');\\ninsert into tmp_dm_pub_increase_day_09_${dayid}\\nselect a.phone_no,\\n       a.user_id,\\n       case when b.user_id is not null then 1 else 0 end is_chunnewadd_user,\\n\\t   case when c.phone_no is not null then 1 else 0 end  is_offnet_user,       -- 是否为当日离网客户（不含物联网）\\n\\t   nvl(d.chl_id,'99') chl_id,                                                /*CO归属分公司*/\\n\\t   nvl(d.group_cust_level,'00') group_cust_level,                             /*CO重要程度*/\\n\\t   nvl(d.grp_name,'') grp_name,                                               /*CO客户名称*/\\n\\t   nvl(d.grp_state_id,0) grp_state_id,                                        /*CO在网状态*/\\n\\t   e.CO_CODE                       \\t\\t\\t\\t\\t                          /*CO编码*/\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (\\n           select user_id from gbasemsm.msm_dw_basekpi_110728_newuser_dm_${monthid}\\n           where op_time ='${day_id}'\\n           group by user_Id\\n          ) b on a.user_id=b.user_id\\nleft join (\\n           SELECT A.msisdn phone_no \\n           FROM gbasedwi.dwi_int_02004_di_${dayid} A\\n           LEFT JOIN GBASEDWI.DWI_USR_PESN_THINGINTER_DS_${dayid}  B ON A.msisdn=B.USER_NO\\n           WHERE A.USER_TYPE<>'3' AND A.STS_UPDATE='${dayid}'\\n                 AND A.USER_STATUS IN ('2010','2020','2030','9000')\\n                 AND B.USER_NO IS NULL\\n           ) c on a.phone_no=c.phone_no\\nleft join ( select\\n               a.cust_id,b.chl_id,b.grp_name,\\n               case when b.grp_cust_state=2 then 1\\n                    else 3 end grp_state_id, -- 1在网 3断开 0不详\\n\\t\\t\\t\\t\\t      c.group_cust_level\\n             from gbasedwi.dwi_usr_pesn_allcust_ds_${dayid} a\\n             left join gbasedwi.dwi_usr_grp_custinfo_ds_${dayid} b on a.parnt_grp=b.parnt_grp\\n\\t\\t\\t left join gbaseods.ods_d_f_crm_01005_group_custext_${dayid} c on a.parnt_grp=c.cust_id\\n           ) d on a.cust_id=d.cust_id\\nleft join gbasedwi.DWI_USR_GRP_MEB_DS_${dayid} e on a.PHONE_NO=e.MEMB_NO\\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   "} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [24]-[index:40]-[2014年日新增指标数据表]-[78]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"78.创建临时表并插入数据","nodeId":"78","sql":"  ###删除临时表\\n drop table if exists dm.tmp_DM_PUB_INCREASE_DAY_user_${dayid};\\n ##创建临时表\\n create table dm.tmp_DM_PUB_INCREASE_DAY_user_${dayid}\\n ( \\n   PHONE_NO varchar(20),\\n   IS_offer_user int,\\n   county_id int\\n ) distributed by('phone_no');\\n##插入数据\\ninsert into dm.tmp_DM_PUB_INCREASE_DAY_user_${dayid}\\nselect a.PHONE_NO,\\n       case when c.PHONE_NO is not null then 1 else 0 end IS_offer_user,       -- 是否拍照老旧集团套餐客户\\n       c.county_id                                                             -- 拍照老旧集团套餐归属部门\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a \\nleft join (select distinct phone_no,county_id from gbasemsm.msm_dw_basekpi_110626_snapshot_yyyymmdd) c on a.phone_no=c.phone_no ##此表每年需更换数据日期\\n where a.PROD_KIND_CODE='171000000001' And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1); "} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [25]-[index:42]-[2014年日新增指标数据表]-[29]-['str' object has no attribute 'lfind']:{"name":"创建临时表4","nodeId":"29","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_04}\\n (\\tPHONE_NO\\t\\t\\t\\t\\t\\tVARCHAR(20),\\n\\tUSER_OFF_TIME                   DATE,\\n\\tSTEADY_DEPT_NAME                VARCHAR(60),\\n\\tACTIVE_MARK                     INT(11),\\n\\tHALL_REMAIN_30DAYS_MARK         INT(11),\\n\\tDISTRICT_NAME                   VARCHAR(60),\\n\\tVALID_ACTIVE_TIME               DATE,\\n\\tORG_ASSIGN_TIME                 DATE,\\n\\tACTIVE_MARK_10086               INT(11),\\n\\tUSER_OFF_MARK                   INT(11),\\n\\tACTIVE_REMAIN_30DAYS_MARK       INT(11),\\n\\tDISTRICT_ID                     VARCHAR(30),\\n\\tVALID_ACTIVE_MARK               INT(11),\\n\\tDEPOSIT_AMT                     DECIMAL(18,3),\\n\\tBRAND_NAME                      VARCHAR(300),\\n\\tCHANNEL_NAME                    VARCHAR(60),\\n\\tORG_CHANNEL_NAME                VARCHAR(60),\\n\\tACTIVE_TIME_10086               DATE,\\n\\tCARD_TYPE                       VARCHAR(60),\\n\\tCARD_WRITE_TYPE                 VARCHAR(60),\\n\\tCHANNEL_CATEGORY                INT(11),\\n\\tASSIGN_TIME                     DATE,\\n\\tACTIVE_TIME\\t\\t\\t\\t\\t\\tDATE,\\t\\n\\tchl_id1           varchar(50)    -- 渠道编码\\n\\t)\\nDISTRIBUTED BY('PHONE_NO') ;\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [26]-[index:43]-[2014年日新增指标数据表]-[82]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"82.创建临时表","nodeId":"82","sql":" ##删除表\\ndrop table dm.tmp_increase_app_type_${dayid};\\n##创建表\\ncreate table dm.tmp_increase_app_type_${dayid}\\n(\\nphone_no varchar(50),\\nysj_flow_m bigint, -- 云视界使用流量（MB)\\naqy_flow_m bigint, -- 爱奇艺使用流量（MB)\\nyk_flow_m bigint, -- 优酷视频类使用流量（MB)\\ntx_flow_m bigint, -- 腾讯视频类使用流量（MB)\\nks_flow_m bigint, -- 快手使用流量（MB)\\ndy_flow_m bigint, -- 抖音短视频使用流量（MB)\\nxg_flow_m bigint, -- 西瓜视频使用流量（MB)\\nmgtv_flow_m bigint, -- 芒果TV使用流量（MB)\\nls_flow_m bigint, -- 乐视视频类使用流量（MB)\\nbst_flow_m bigint, -- 百视通视频类使用流量（MB)\\nsh_flow_m bigint, -- 搜狐视频使用流量（MB)\\nbd_flow_m bigint, -- 百度视频类使用流量（MB)\\nwy_flow_m bigint, -- 网易视频类使用流量（MB)\\nmg_flow_m bigint, -- 咪咕视频类使用流量（MB)\\nxl_flow_m bigint, -- 新浪视频类使用流量（MB)\\njrtt_flow_m bigint, -- 今日头条使用流量（MB)\\nbfyy_flow_m bigint,  -- 暴风影音使用流量（MB)\\nwzry_flow_m bigint,  -- 王者荣耀使用流量（MB)\\nwyyyy_flow_m bigint, -- 网易云音乐使用流量（MB)\\npptv_flow_m bigint -- PPTV使用流量（MB)\\n) distributed by('phone_no');\\n##插入数据\\ninsert into dm.tmp_increase_app_type_${dayid}\\nselect \\na.phone_no,\\nsum(case when b.app_type_id=5 and b.app_name like'%云视界%' then up_flow+down_flow else 0 end)/1024/1024 ysj_flow_m, -- 云视界使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%爱奇艺%' then up_flow+down_flow else 0 end)/1024/1024 aqy_flow_m, -- 爱奇艺使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%优酷%' then up_flow+down_flow else 0 end)/1024/1024 yk_flow_m, -- 优酷视频类使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%腾讯%' then up_flow+down_flow else 0 end)/1024/1024 tx_flow_m, -- 腾讯视频类使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%快手%' then up_flow+down_flow else 0 end)/1024/1024 ks_flow_m, -- 快手使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%抖音%' then up_flow+down_flow else 0 end)/1024/1024 dy_flow_m, -- 抖音短视频使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%西瓜%' then up_flow+down_flow else 0 end)/1024/1024 xg_flow_m, -- 西瓜视频使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%芒果TV%' then up_flow+down_flow else 0 end)/1024/1024 mgtv_flow_m, -- 芒果TV使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%乐视%' then up_flow+down_flow else 0 end)/1024/1024 ls_flow_m, -- 乐视视频类使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%百视通%' then up_flow+down_flow else 0 end)/1024/1024 bst_flow_m, -- 百视通视频类使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%搜狐视频%' then up_flow+down_flow else 0 end)/1024/1024 sh_flow_m, -- 搜狐视频使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%百度%' then up_flow+down_flow else 0 end)/1024/1024 bd_flow_m, -- 百度视频类使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%网易%' then up_flow+down_flow else 0 end)/1024/1024 wy_flow_m, -- 网易视频类使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%咪咕%' then up_flow+down_flow else 0 end)/1024/1024 mg_flow_m, -- 咪咕视频类使用流量（MB)\\nsum(case when b.app_type_id=5 and b.app_name like'%新浪%' then up_flow+down_flow else 0 end)/1024/1024 xl_flow_m, -- 新浪视频类使用流量（MB)\\nsum(case when b.app_name='今日头条' then up_flow+down_flow else 0 end)/1024/1024 jrtt_flow_m, -- 今日头条使用流量（MB)\\nsum(case when b.app_name='暴风影音' then up_flow+down_flow else 0 end)/1024/1024 bfyy_flow_m,  -- 暴风影音使用流量（MB)\\nsum(case when b.app_name='王者荣耀' then up_flow+down_flow else 0 end)/1024/1024 wzry_flow_m,  -- 王者荣耀使用流量（MB)\\nsum(case when b.app_name='网易云音乐' then up_flow+down_flow else 0 end)/1024/1024 wyyyy_flow_m, -- 网易云音乐使用流量（MB)\\nsum(case when b.app_name='PPTV聚力' then up_flow+down_flow else 0 end)/1024/1024 pptv_flow_m -- PPTV使用流量（MB)\\nfrom (\\n  select distinct phone_no,app_id,app_type_id,up_flow,down_flow from \\n   gbasedwi.${table_name.name1}\\n   )a \\nleft join (select distinct app_id,app_type_id,app_name from \\ngbasedwd.dim_app_hive where status=1) b on a.app_id=b.app_id and a.app_type_id=b.app_type_id\\ngroup by a.phone_no\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [27]-[index:44]-[2014年日新增指标数据表]-[31]-['str' object has no attribute 'lfind']:{"name":"31.创建临时表2","nodeId":"31","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_02}\\n(\\tPHONE_NO\\t\\t\\t\\tVARCHAR(20),\\n\\tDAY_FEE\\t\\t\\t\\t\\tDECIMAL(16,2),\\n\\tDAY_LAST1_FEE\\t\\t\\tDECIMAL(16,2),\\n\\tDAY_LAST2_FEE\\t\\t\\tDECIMAL(16,2),\\n\\tDAY_LAST3_FEE\\t\\t\\tDECIMAL(16,2),\\n\\tGPRS_FEE\\t\\t\\t\\t      DECIMAL(16,2),\\n\\tGPRS_AMOUNT\\t\\t\\t\\t    DECIMAL(16,2),\\n\\tGPRS_WLAN_AMOUNT\\t\\t  DECIMAL(16,2),\\n\\tGPRS_LAST1_FEE\\t\\t\\t  DECIMAL(16,2),\\n\\tGPRS_LAST1_AMOUNT\\t\\t  DECIMAL(16,2),\\n\\tGPRS_WLANLAST1_AMOUNT\\tDECIMAL(16,2),\\n\\tIS_2016ENTER_USER_ACT\\tINT(11),\\n\\tIS_2016STOCK_USER_ACT\\tINT(11),\\n\\tPLAN_MONTHLY_FEE      DECIMAL(16,2)\\n) DISTRIBUTED BY('PHONE_NO');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [28]-[index:45]-[2014年日新增指标数据表]-[34]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"34.插入数据2","nodeId":"34","sql":"INSERT INTO ${TARGET_TMP_DM_PUB_INCREASE_DAY_02}\\n (PHONE_NO,DAY_FEE,DAY_LAST1_FEE,DAY_LAST2_FEE,DAY_LAST3_FEE,GPRS_FEE,GPRS_AMOUNT,GPRS_WLAN_AMOUNT,\\n\\tGPRS_LAST1_FEE,GPRS_LAST1_AMOUNT,GPRS_WLANLAST1_AMOUNT,IS_2016ENTER_USER_ACT,IS_2016STOCK_USER_ACT,\\n\\tPLAN_MONTHLY_FEE\\t)\\nSELECT\\tA.PHONE_NO,\\n\\t\\tB.DAY_FEE,\\n\\t\\tNVL(C.DAY_LAST1_FEE,0)              /*NVL(C.DAY_FEE,0)*/,\\n\\t\\tNVL(D.DAY_LAST2_FEE,0)              /*NVL(C.DAY_LAST1_FEE,0)*/,\\n\\t\\tNVL(t1.DAY_LAST2_FEE,0)                          /*NVL(E.DAY_LAST3_FEE,0) */           /*NVL(C.DAY_LAST2_FEE,0)*/,\\n\\t\\tNVL(F.GPRS_FEE,0),\\n\\t\\tNVL(F.GPRS_AMOUNT,0),\\n\\t\\tNVL(F.GPRS_WLAN_AMOUNT,0),\\n\\t\\tNVL(G.GPRS_LAST1_FEE,0)              /*NVL(C.GPRS_FEE,0)*/,\\n\\t\\tNVL(G.GPRS_LAST1_AMOUNT,0)          /*NVL(C.GPRS_AMOUNT,0)*/,\\n\\t\\tNVL(G.GPRS_WLANLAST1_AMOUNT,0)      /*NVL(C.GPRS_WLAN_AMOUNT,0)*/,\\n\\t\\tCASE WHEN I.USER_NO IS NULL  THEN 0 ELSE 1 END,\\n\\t\\tCASE WHEN H.USER_NO IS NULL  THEN 0 ELSE 1 END,\\n\\t\\tnvl(b.plan_monthly_fee,0)\\nFROM ${SOURCE_DWI_USR_PESN_PARTINFO_DS_YYYYMMDD} A  \\nLEFT JOIN (SELECT PHONE_NO,\\n              SUM(CASE WHEN a.ACCT_ITEM_ID IN ('3088','3091','3092','3093','687','3012','3047','1011',\\n                       '2050','191','400','3048','3045','3070','3046','1221','2004','2046','1288','1200','1220','195','199','351','38','420','661','922','923','3059','2063','2064','2065','1198','2096','3019','1530','1511','1248','1293','1296','2061','1521','1300','3075','1009','1080','1129','1161','1199','1241','1269','1272','1289','2053','1301','600','1321','3041','3044','1322','1325','1326','1196','1197','1260','1311','1254','1512','3099','3100','3107') THEN SHOULD_INCOME ELSE 0 END ) DAY_FEE,\\n\\t\\t\\t\\t\\t\\t\\tsum(case when b.acct_item_id is not null then mt_should_income else 0 end )  plan_monthly_fee\\n\\t\\t   FROM ${SOURCE_DWI_INCO_BILL_ITEM_TOT_DS_YYYYMMDD0} a\\n\\t\\t   left join dm.dim_plan_packfee b on a.acct_item_id=b.acct_item_id\\n\\t\\t   GROUP BY PHONE_NO) B ON A.PHONE_NO=B.PHONE_NO\\n/*LEFT JOIN (select PRODUCT_NO,max(DAY_FEE) DAY_FEE,max(DAY_LAST1_FEE) DAY_LAST1_FEE,\\n\\t\\t\\t\\t  max(GPRS_FEE) GPRS_FEE,max(GPRS_AMOUNT) GPRS_AMOUNT,\\n\\t\\t\\t\\t  max(GPRS_WLAN_AMOUNT) GPRS_WLAN_AMOUNT,max(DAY_LAST2_FEE) DAY_LAST2_FEE\\n\\t\\t   from DM.DM_PUB_INCREASE_DAY_${p1month} group by PRODUCT_NO) C ON A.PHONE_NO=C.PRODUCT_NO */\\nLEFT JOIN (SELECT PHONE_NO,SUM(CASE WHEN ACCT_ITEM_ID IN ('3088','3091','3092','3093','687','3012','3047',\\n\\t\\t\\t\\t\\t\\t\\t'1011','2050','191','400','3048','3045','3070','3046','1221','2004','2046','1288','1200','1220','195','199','351','38','420','661','922','923','3059','2063','2064','2065','1198','2096','3019','1530','1511','1248','1293','1296','2061','1521','1300','3075','1009','1080','1129','1161','1199','1241','1269','1272','1289','2053','1301','600','1321','3041','3044','1322','1325','1326','1196','1197','1260','1311','1254','1512','3099','3100','3107') THEN SHOULD_INCOME ELSE 0 END ) DAY_LAST1_FEE \\n\\t\\t   FROM ${SOURCE_DWI_INCO_BILL_ITEM_TOT_DS_YYYYMMDD1} GROUP BY PHONE_NO) C ON A.PHONE_NO=C.PHONE_NO\\nLEFT JOIN (SELECT PHONE_NO,SUM(CASE WHEN ACCT_ITEM_ID IN   ('3088','3091','3092','3093','687','3012',\\n\\t\\t\\t\\t\\t\\t\\t'3047','1011','2050','191','400','3048','3045','3070','3046','1221','2004','2046','1288','1200','1220','195','199','351','38','420','661','922','923','3059','2063','2064','2065','1198','2096','3019','1530','1511','1248','1293','1296','2061','1521','1300','3075','1009','1080','1129','1161','1199','1241','1269','1272','1289','2053','1301','600','1321','3041','3044','1322','1325','1326','1196','1197','1260','1311','1254','1512','3099','3100','3107') THEN SHOULD_INCOME ELSE 0 END ) DAY_LAST2_FEE \\n\\t\\t   FROM ${SOURCE_DWI_INCO_BILL_ITEM_TOT_DS_YYYYMMDD2} GROUP BY PHONE_NO) D ON A.PHONE_NO=D.PHONE_NO\\n\\t\\t   \\nLEFT JOIN \\t(select   product_no,DAY_LAST2_FEE\\tfrom  DM_PUB_INCREASE_DAY_${p1month}@dblink_dm) t1 ON A.PHONE_NO=t1.product_no\\n\\t\\t   \\n/*LEFT JOIN (SELECT PHONE_NO,SUM(CASE WHEN ACCT_ITEM_ID IN ('3088','3091','3092','3093','687','3012','3047',\\n\\t\\t\\t\\t\\t\\t\\t'1011','2050','191','400','3048','3045','3070','3046','1221','2004','2046','1288',\\n\\t\\t\\t\\t\\t\\t\\t'1200','1220','195','199','351','38','420','661','922','923','3059','2063','2064',\\n\\t\\t\\t\\t\\t\\t\\t'2065','1198','2096','3019','1530','1511','1248','1293','1296','2061','1521','1300',\\n\\t\\t\\t\\t\\t\\t\\t'3075','1009','1080','1129','1161','1199','1241','1269','1272','1289','2053','1301',\\n\\t\\t\\t\\t\\t\\t\\t'600','1321','3041','3044','1322','1325','1326','1196','1197','1260','1311','1254',\\n\\t\\t\\t\\t\\t\\t\\t'1512','3099','3100','3107') THEN SHOULD_INCOME ELSE 0 END ) DAY_LAST3_FEE \\n\\t\\t   FROM ${SOURCE_DWI_INCO_BILL_ITEM_TOT_DS_YYYYMMDD3} GROUP BY PHONE_NO) E ON A.PHONE_NO=E.PHONE_NO8*/\\n   \\nLEFT JOIN (SELECT PHONE_NO,SUM(CMC_DATA_FLOW_FUNC_FEE+WLAN_FEE) GPRS_FEE,\\n\\t\\t\\t\\t\\tSUM(CMC_DATA_FLOW_FUNC_FEE) GPRS_AMOUNT,SUM(WLAN_FEE) GPRS_WLAN_AMOUNT\\n\\t\\t\\tFROM ${SOURCE_DWI_INCO_BILL_SHARE_MON_DS_YYYYMMDD0} GROUP BY PHONE_NO) F ON A.PHONE_NO=trim(F.PHONE_NO)\\nLEFT JOIN (SELECT PHONE_NO,SUM(CMC_DATA_FLOW_FUNC_FEE+WLAN_FEE) GPRS_LAST1_FEE,\\n\\t\\t\\t\\t\\tSUM(CMC_DATA_FLOW_FUNC_FEE) GPRS_LAST1_AMOUNT,SUM(WLAN_FEE) GPRS_WLANLAST1_AMOUNT\\n\\t\\t\\t FROM ${SOURCE_DWI_INCO_BILL_SHARE_MON_DS_YYYYMMDD1} GROUP BY PHONE_NO) G ON A.PHONE_NO=trim(G.PHONE_NO)\\nLEFT JOIN (SELECT USER_NO FROM ${SOURCE_DWI_USR_PESN_STOCKSHOT_DS_YYYYMMDD}\\n            WHERE CUR_DAY_KEEP_FLAG=1 GROUP BY USER_NO) H ON A.PHONE_NO=H.USER_NO\\nLEFT JOIN (SELECT USER_NO FROM ${SOURCE_DWI_USR_PESN_ENTSHOT_DS_YYYYMMDD}\\n            WHERE CUR_DAY_KEEP_FLAG=1 GROUP BY USER_NO) I ON A.PHONE_NO=I.USER_NO     \\nWHERE  (A.PROD_KIND_CODE='171000000001' and A.MONTH_ARRIVE_FLAG = 1)  OR  A.MONTH_OFF_FLAG = 1;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [29]-[index:46]-[2014年日新增指标数据表]-[35]-['str' object has no attribute 'lfind']:{"name":"35.插入数据4","nodeId":"35","dsName":"GbaseDM","sql":"INSERT INTO ${TARGET_TMP_DM_PUB_INCREASE_DAY_04}\\n (\\tPHONE_NO,USER_OFF_TIME,STEADY_DEPT_NAME, ACTIVE_MARK,HALL_REMAIN_30DAYS_MARK,DISTRICT_NAME,VALID_ACTIVE_TIME,\\n\\tORG_ASSIGN_TIME,ACTIVE_MARK_10086,USER_OFF_MARK,ACTIVE_REMAIN_30DAYS_MARK,DISTRICT_ID,VALID_ACTIVE_MARK,\\n\\tDEPOSIT_AMT,BRAND_NAME,CHANNEL_NAME,ORG_CHANNEL_NAME,ACTIVE_TIME_10086,CARD_TYPE,CARD_WRITE_TYPE,\\n\\tCHANNEL_CATEGORY,ASSIGN_TIME, ACTIVE_TIME,\\n\\tchl_id1\\t)\\nSELECT\\tA.PHONE_NO,\\n\\t\\tB.LOST_TIME,\\n\\t\\tNULL,\\n\\t\\tB.ACTIVE_FLAG,\\n\\t\\tB.HALL_30_DAY_FLOW_TRUN_ID,\\n\\t\\tB.DEPT_COUNTY_NAME,\\n\\t\\tB.VALID_ACTIVE_TIME,\\n\\t\\tB.ORGN_SEND_CARD_TIME,\\n\\t\\tB.ACTIVE_10086_FLAG,\\n\\t\\tB.LOST_FLAG,\\n\\t\\tB.DAYS_30_ACTIVE_FLAG,\\n\\t\\tB.DEPT_COUNTY_ID,\\n\\t\\tB.VALID_ACTIVE_FLAG,\\n\\t\\tNULL,\\n\\t\\tB.SEND_CARD_BRAND,\\n\\t\\tB.CHL_NAME,\\n\\t\\tB.ORGN_SEND_CARD_CHL_NAME,\\n\\t\\tB.ACTIVE_10086_TIME,\\n\\t\\tB.CARD_KIND,\\n\\t\\tB.WRITE_WAY,\\n\\t\\tnull,\\n\\t\\tB.SEND_CARD_TIME,\\n\\t\\tB.ACTIVE_TIME,\\n\\t\\tb.chl_id\\nFROM ${SOURCE_DWI_USR_PESN_PARTINFO_DS_YYYYMMDD} A\\nLEFT JOIN GBASEDWI.DWI_RES_NAC_CODE_NUM_DT_${dayid} B ON A.PHONE_NO=B.PHONE_NO\\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001\\n-- (A.MONTH_ARRIVE_FLAG = 1 and A.PROD_KIND_CODE='171000000001' ) OR A.MONTH_OFF_FLAG = 1;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [30]-[index:47]-[2014年日新增指标数据表]-[55]-['str' object has no attribute 'lfind']:{"name":"55.插入临时表5","nodeId":"55","dsName":"GbaseDM","sql":"INSERT INTO ${TARGET_TMP_DM_PUB_INCREASE_DAY_05}\\n (\\tPHONE_NO,\\n IS_UNIFIED_PACKAGE,\\nIS_YIJING_ACCT_USER )\\n  select A.PHONE_NO,\\n    case when b.product_no is not null then 1 else 0 end   is_unified_package,\\n    case when c.product_no is not null then 1 else 0 end   IS_YIJING_ACCT_USER \\t\\t\\n        from gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a            /*用户资料小表日表 */\\n    left join (select distinct product_no from gbasemsm.msm_dw_basekpi_110491_detail_${dayid}) b on  a.phone_no=b.product_no \\n    left join (select distinct product_no from gbasemsm.msm_dw_basekpi_110492_detail_${dayid}) c on  a.phone_no=c.product_no  \\t\\nWHERE  (A.MONTH_ARRIVE_FLAG = 1 and A.PROD_KIND_CODE='171000000001' ) OR A.MONTH_OFF_FLAG = 1;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [31]-[index:48]-[2014年日新增指标数据表]-[58]-['str' object has no attribute 'lfind']:{"name":"创建临时表6","nodeId":"58","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_06}\\n(\\tPHONE_NO\\t\\t\\tVARCHAR(20),\\n\\tBEIXIANG_SCORE            INTEGER,\\n\\tXIAOFEI_SCORE               INTEGER,\\n\\tCONSUME_SCORE          INTEGER,\\n    SCORE_SHIELD_FLAG         VARCHAR(6),\\n\\tCUR_SCORE_BALANCE        INTEGER)\\nDISTRIBUTED BY('PHONE_NO') nolock;\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [32]-[index:49]-[2014年日新增指标数据表]-[30]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"30.创建临时表3","nodeId":"30","sql":"drop table ${TARGET_TMP_DM_PUB_INCREASE_DAY_03};\\nCREATE TABLE ${TARGET_TMP_DM_PUB_INCREASE_DAY_03}\\n (\\tPHONE_NO\\t\\t\\tVARCHAR(20),\\n\\tLEAVE_NET_FLAG\\t\\tVARCHAR(20),\\n\\tIS_REAL_NAME    \\tINT(11),\\n\\tREAL_TIME       \\tDATETIME, \\n\\tSIM_NO          \\tVARCHAR(30),\\n\\tIS_INTERNET_THINGS\\tINT(11),\\n\\tIS_2016STOCK_USER\\tBIGINT,\\n\\tIS_2016ENTER_USER\\tBIGINT\\t)\\nDISTRIBUTED BY('PHONE_NO') nolock;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [33]-[index:50]-[2014年日新增指标数据表]-[74]-['str' object has no attribute 'lfind']:{"name":"74.插入临时表8","nodeId":"74","dsName":"GbaseDM","sql":"insert into ${TARGET_TMP_DM_PUB_INCREASE_DAY_08}\\n(\\nphone_no                     ,\\nhmt_out_net1                 , -- 港澳台漫游-去话-网内时长\\nhmt_in_net1                  , -- 港澳台漫游-来话-网内时长\\ninter_out_net1               , -- 国际漫游-去话-网内时长\\ninter_in_net1                , -- 国际漫游-来话-网内时长\\nhmt_out_net2                 , -- 港澳台漫游-去话-网间时长\\nhmt_in_net2                  , -- 港澳台漫游-来话-网间时长\\ninter_out_net2               , -- 国际漫游-去话-网间时长\\ninter_in_net2                , -- 国际漫游-来话-网间时长\\nloc_hmt_toll_num             , -- 非漫游-港澳台长途-次数\\nloc_inter_toll_num           , -- 非漫游-国际长途-次数\\nloc_hmt_toll_call_dur        , -- 非漫游-港澳台长途-时长（分钟）\\nloc_inter_toll_call_dur      , -- 非漫游-国际长途-时长（分钟）\\nloc_called_hmt_num           , -- 非漫游-来话-港澳台-次数\\nloc_called_hmt_bill_dur      , -- 非漫游-来话-港澳台-时长（分钟）\\nloc_called_inter_bill_dur    , -- 非漫游-来话-国际-次数\\nloc_called_inter_num         , -- 非漫游-来话-国际-时长（分钟）\\nhmt_roam_num                 , -- 港澳台漫游-次数\\nhmt_roam_in_num              , -- 港澳台漫游-来话-次数\\nhmt_roam_in_bill_dur         , -- 港澳台漫游-来话-时长（分钟）\\nhmt_roam_out_num             , -- 港澳台漫游-去话-次数\\nhmt_roam_out_bill_dur        , -- 港澳台漫游-去话-时长（分钟）\\nhmt_roam_bill_dur            , -- 港澳台漫游-时长（分钟）\\ninter_roam_num               , -- 国际漫游-次数\\ninter_roam_in_num            , -- 国际漫游-来话-次数\\ninter_roam_in_bill_dur       , -- 国际漫游-来话-时长（分钟）\\ninter_roam_out_num           , -- 国际漫游-去话-次数\\ninter_roam_out_bill_dur      , -- 国际漫游-去话-时长（分钟）\\ninter_roam_bill_dur          , -- 国际漫游-时长（分钟）\\nlroam_out_hmt_toll_num       , -- 省级漫游-去话-港澳台长途-次数\\nlroam_out_hmt_toll_bill_dur  , -- 省级漫游-去话-港澳台长途-时长（分钟）\\nlroam_out_inter_toll_num     , -- 省级漫游-去话-国际长途-次数\\nlroam_out_inter_toll_bill_dur, -- 省级漫游-去话-国际长途-时长（分钟）\\nhmt_toll_ip_12593_call_num   , -- 港澳台长途-IP-12593-次数\\nhmt_toll_ip_12593_call_dur   , -- 港澳台长途-IP-12593-时长（分钟）\\nhmt_toll_ip_17950_call_num   , -- 港澳台长途-IP-17950-次数\\nhmt_toll_ip_17950_call_dur   , -- 港澳台长途-IP-17950-时长（分钟）\\nhmt_toll_ip_17951_call_num   , -- 港澳台长途-IP-17951-次数\\nhmt_toll_ip_17951_call_dur   , -- 港澳台长途-IP-17951-时长（分钟）\\nhmt_toll_ip_call_num         , -- 港澳台长途-IP-次数\\nhmt_toll_ip_call_dur         , -- 港澳台长途-IP-时长（分钟）\\nhmt_toll_call_num            , -- 港澳台长途-次数\\nhmt_toll_noip_call_num       , -- 港澳台长途-非IP-次数\\nhmt_toll_noip_call_dur       , -- 港澳台长途-非IP-时长（分钟）\\nhmt_toll_call_dur            , -- 港澳台长途-时长（分钟）\\ninter_toll_ip_12593_call_num , -- 国际长途-IP-12593-次数\\ninter_toll_ip_12593_call_dur , -- 国际长途-IP-12593-时长（分钟）\\ninter_toll_ip_17950_call_num , -- 国际长途-IP-17950-次数\\ninter_toll_ip_17950_call_dur , -- 国际长途-IP-17950-时长（分钟）\\ninter_toll_ip_17951_call_num , -- 国际长途-IP-17951-次数\\ninter_toll_ip_17951_call_dur , -- 国际长途-IP-17951-时长（分钟）\\ninter_toll_ip_call_num       , -- 国际长途-IP-次数\\ninter_toll_ip_call_dur       , -- 国际长途-IP-时长（分钟）\\ninter_toll_call_num          , -- 国际长途-次数\\ninter_toll_no_ip_call_num    , -- 国际长途-非IP-次数\\ninter_toll_no_ip_call_dur    , -- 国际长途-非IP-时长（分钟）\\ninter_toll_call_dur          , -- 国际长途-时长（分钟）\\ngprs_hmt_roam_flow           , -- GPRS-港澳台漫游-流量（KB)\\ngprs_hmt_roam_up_flow        , -- GPRS-港澳台漫游-上行-流量（KB)\\ngprs_hmt_roam_down_flow      , -- GPRS-港澳台漫游-下行-流量（KB)\\ngprs_inter_roam_flow         , -- GPRS-国际漫游-流量（KB)\\ngprs_inter_roam_up_flow      , -- GPRS-国际漫游-上行-流量（KB)\\ngprs_inter_roam_down_flow    , -- GPRS-国际漫游-下行-流量（KB)\\ngprs_total_num               , -- 当日GPRS使用次数\\ngprs_total_dur               , -- 当日GPRS使用时长（分钟）\\nsms_inter_p2p_num              -- 短信-国际点对点短信-条数\\n)\\nselect\\n    t1.phone_no,\\n    nvl(t2.hmt_out_net1                 ,0),\\n    nvl(t2.hmt_in_net1                  ,0),\\n    nvl(t2.inter_out_net1               ,0),\\n    nvl(t2.inter_in_net1                ,0),\\n    nvl(t2.hmt_out_net2                 ,0),\\n    nvl(t2.hmt_in_net2                  ,0),\\n    nvl(t2.inter_out_net2               ,0),\\n    nvl(t2.inter_in_net2                ,0),\\n    nvl(t3.loc_hmt_toll_num             ,0),\\n    nvl(t3.loc_inter_toll_num           ,0),\\n    nvl(t3.loc_hmt_toll_call_dur        ,0),\\n    nvl(t3.loc_inter_toll_call_dur      ,0),\\n    nvl(t3.loc_called_hmt_num           ,0),\\n    nvl(t3.loc_called_hmt_bill_dur      ,0),\\n    nvl(t3.loc_called_inter_bill_dur    ,0),\\n    nvl(t3.loc_called_inter_num         ,0),\\n    nvl(t3.hmt_roam_num                 ,0),\\n    nvl(t3.hmt_roam_in_num              ,0),\\n    nvl(t3.hmt_roam_in_bill_dur         ,0),\\n    nvl(t3.hmt_roam_out_num             ,0),\\n    nvl(t3.hmt_roam_out_bill_dur        ,0),\\n    nvl(t3.hmt_roam_bill_dur            ,0),\\n    nvl(t3.inter_roam_num               ,0),\\n    nvl(t3.inter_roam_in_num            ,0),\\n    nvl(t3.inter_roam_in_bill_dur       ,0),\\n    nvl(t3.inter_roam_out_num           ,0),\\n    nvl(t3.inter_roam_out_bill_dur      ,0),\\n    nvl(t3.inter_roam_bill_dur          ,0),\\n    nvl(t3.lroam_out_hmt_toll_num       ,0),\\n    nvl(t3.lroam_out_hmt_toll_bill_dur  ,0),\\n    nvl(t3.lroam_out_inter_toll_num     ,0),\\n    nvl(t3.lroam_out_inter_toll_bill_dur,0),\\n    nvl(t4.hmt_toll_ip_12593_call_num   ,0),\\n    nvl(t4.hmt_toll_ip_12593_call_dur   ,0),\\n    nvl(t4.hmt_toll_ip_17950_call_num   ,0),\\n    nvl(t4.hmt_toll_ip_17950_call_dur   ,0),\\n    nvl(t4.hmt_toll_ip_17951_call_num   ,0),\\n    nvl(t4.hmt_toll_ip_17951_call_dur   ,0),\\n    nvl(t4.hmt_toll_ip_call_num         ,0),\\n    nvl(t4.hmt_toll_ip_call_dur         ,0),\\n    nvl(t4.hmt_toll_call_num            ,0),\\n    nvl(t4.hmt_toll_noip_call_num       ,0),\\n    nvl(t4.hmt_toll_noip_call_dur       ,0),\\n    nvl(t4.hmt_toll_call_dur            ,0),\\n    nvl(t4.inter_toll_ip_12593_call_num ,0),\\n    nvl(t4.inter_toll_ip_12593_call_dur ,0),\\n    nvl(t4.inter_toll_ip_17950_call_num ,0),\\n    nvl(t4.inter_toll_ip_17950_call_dur ,0),\\n    nvl(t4.inter_toll_ip_17951_call_num ,0),\\n    nvl(t4.inter_toll_ip_17951_call_dur ,0),\\n    nvl(t4.inter_toll_ip_call_num       ,0),\\n    nvl(t4.inter_toll_ip_call_dur       ,0),\\n    nvl(t4.inter_toll_call_num          ,0),\\n    nvl(t4.inter_toll_no_ip_call_num    ,0),\\n    nvl(t4.inter_toll_no_ip_call_dur    ,0),\\n    nvl(t4.inter_toll_call_dur          ,0),\\n    nvl(t5.gprs_hmt_roam_flow           ,0),\\n    nvl(t5.gprs_hmt_roam_up_flow        ,0),\\n    nvl(t5.gprs_hmt_roam_down_flow      ,0),\\n    nvl(t5.gprs_inter_roam_flow         ,0),\\n    nvl(t5.gprs_inter_roam_up_flow      ,0),\\n    nvl(t5.gprs_inter_roam_down_flow    ,0),\\n    nvl(t5.gprs_total_num               ,0),  -- 当日GPRS使用次数\\n    nvl(t5.gprs_total_dur               ,0),  -- 当日GPRS使用时长（分钟）\\n    nvl(t6.sms_inter_p2p_num            ,0)   -- 短信-国际点对点短信-条数\\n  from gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} t1\\n  left join (select\\n                 phone_no,\\n                 nvl(sum(case when roam_type='9' and call_type = '1' and opp_carr_id = '01'  then call_num end),0) hmt_out_net1,                              -- 港澳台漫游-去话-网内时长\\n                 nvl(sum(case when roam_type='9' and call_type <> '1' and opp_carr_id = '01' then call_num end),0) hmt_in_net1,                               -- 港澳台漫游-来话-网内时长\\n                 nvl(sum(case when roam_type in ('11','13','15','17','41') and call_type = '1' and opp_carr_id = '01' then call_num end ),0) inter_out_net1,  -- 国际漫游-去话-网内时长\\n                 nvl(sum(case when roam_type in ('11','13','15','17','41') and call_type <> '1' and opp_carr_id = '01' then call_num end ),0) inter_in_net1,  -- 国际漫游-来话-网内时长\\n                 nvl(sum(case when roam_type='9' and call_type = '1' and opp_carr_id <> '01' then call_num end ),0) hmt_out_net2,                             -- 港澳台漫游-去话-网间时长\\n                 nvl(sum(case when roam_type='9' and call_type <>'1' and opp_carr_id <> '01' then call_num end ),0) hmt_in_net2,                              -- 港澳台漫游-来话-网间时长\\n                 nvl(sum(case when roam_type in ('11','13','15','17','41') and call_type = '1' and opp_carr_id <> '01' then call_num end ),0) inter_out_net2, -- 国际漫游-去话-网间时长\\n                 nvl(sum(case when roam_type in ('11','13','15','17','41') and call_type <> '1' and opp_carr_id <> '01' then call_num end ),0) inter_in_net2  -- 国际漫游-来话-网间时长\\n              from gbasedwd.dwd_evt_cdr_voc_basetot_ds_${dayid}\\n              group by phone_no\\n             ) t2 on t1.phone_no=t2.phone_no\\n  left join (select\\n                 phone_no\\n                 ,sum(loc_hmt_toll_num)              as loc_hmt_toll_num              -- 非漫游-港澳台长途-次数\\n                 ,sum(loc_inter_toll_num)            as loc_inter_toll_num            -- 非漫游-国际长途-次数\\n                 ,sum(loc_hmt_toll_call_dur)         as loc_hmt_toll_call_dur         -- 非漫游-港澳台长途-时长（分钟）\\n                 ,sum(loc_inter_toll_call_dur)       as loc_inter_toll_call_dur       -- 非漫游-国际长途-时长（分钟）\\n                 ,sum(loc_called_hmt_num)            as loc_called_hmt_num            -- 非漫游-来话-港澳台-次数\\n                 ,sum(loc_called_hmt_bill_dur)       as loc_called_hmt_bill_dur       -- 非漫游-来话-港澳台-时长（分钟）\\n                 ,sum(loc_called_inter_bill_dur)     as loc_called_inter_bill_dur     -- 非漫游-来话-国际-次数\\n                 ,sum(loc_called_inter_num)          as loc_called_inter_num          -- 非漫游-来话-国际-时长（分钟）\\n                 ,sum(hmt_roam_num)                  as hmt_roam_num                  -- 港澳台漫游-次数\\n                 ,sum(hmt_roam_in_num)               as hmt_roam_in_num               -- 港澳台漫游-来话-次数\\n                 ,sum(hmt_roam_in_bill_dur)          as hmt_roam_in_bill_dur          -- 港澳台漫游-来话-时长（分钟）\\n                 ,sum(hmt_roam_out_num)              as hmt_roam_out_num              -- 港澳台漫游-去话-次数\\n                 ,sum(hmt_roam_out_bill_dur)         as hmt_roam_out_bill_dur         -- 港澳台漫游-去话-时长（分钟）\\n                 ,sum(hmt_roam_bill_dur)             as hmt_roam_bill_dur             -- 港澳台漫游-时长（分钟）\\n                 ,sum(inter_roam_num)                as inter_roam_num                -- 国际漫游-次数\\n                 ,sum(inter_roam_in_num)             as inter_roam_in_num             -- 国际漫游-来话-次数\\n                 ,sum(inter_roam_in_bill_dur)        as inter_roam_in_bill_dur        -- 国际漫游-来话-时长（分钟）\\n                 ,sum(inter_roam_out_num)            as inter_roam_out_num            -- 国际漫游-去话-次数\\n                 ,sum(inter_roam_out_bill_dur)       as inter_roam_out_bill_dur       -- 国际漫游-去话-时长（分钟）\\n                 ,sum(inter_roam_bill_dur)           as inter_roam_bill_dur           -- 国际漫游-时长（分钟）\\n                 ,sum(lroam_out_hmt_toll_num)        as lroam_out_hmt_toll_num        -- 省级漫游-去话-港澳台长途-次数\\n                 ,sum(lroam_out_hmt_toll_bill_dur)   as lroam_out_hmt_toll_bill_dur   -- 省级漫游-去话-港澳台长途-时长（分钟）\\n                 ,sum(lroam_out_inter_toll_num)      as lroam_out_inter_toll_num      -- 省级漫游-去话-国际长途-次数\\n                 ,sum(lroam_out_inter_toll_bill_dur) as lroam_out_inter_toll_bill_dur -- 省级漫游-去话-国际长途-时长（分钟）\\n               from gbasedwi.dwi_beh_use_voc_roamtot_ds_${dayid}\\n              group by phone_no\\n             ) t3 on t1.phone_no=t3.phone_no\\n  left join (select\\n                 phone_no\\n                 ,sum(hmt_toll_ip_12593_call_num)   as hmt_toll_ip_12593_call_num   -- 港澳台长途-IP-12593-次数\\n                 ,sum(hmt_toll_ip_12593_call_dur)   as hmt_toll_ip_12593_call_dur   -- 港澳台长途-IP-12593-时长（分钟）\\n                 ,sum(hmt_toll_ip_17950_call_num)   as hmt_toll_ip_17950_call_num   -- 港澳台长途-IP-17950-次数\\n                 ,sum(hmt_toll_ip_17950_call_dur)   as hmt_toll_ip_17950_call_dur   -- 港澳台长途-IP-17950-时长（分钟）\\n                 ,sum(hmt_toll_ip_17951_call_num)   as hmt_toll_ip_17951_call_num   -- 港澳台长途-IP-17951-次数\\n                 ,sum(hmt_toll_ip_17951_call_dur)   as hmt_toll_ip_17951_call_dur   -- 港澳台长途-IP-17951-时长（分钟）\\n                 ,sum(hmt_toll_ip_call_num)         as hmt_toll_ip_call_num         -- 港澳台长途-IP-次数\\n                 ,sum(hmt_toll_ip_call_dur)         as hmt_toll_ip_call_dur         -- 港澳台长途-IP-时长（分钟）\\n                 ,sum(hmt_toll_call_num)            as hmt_toll_call_num            -- 港澳台长途-次数\\n                 ,sum(hmt_toll_noip_call_num)       as hmt_toll_noip_call_num       -- 港澳台长途-非IP-次数\\n                 ,sum(hmt_toll_noip_call_dur)       as hmt_toll_noip_call_dur       -- 港澳台长途-非IP-时长（分钟）\\n                 ,sum(hmt_toll_call_dur)            as hmt_toll_call_dur            -- 港澳台长途-时长（分钟）\\n                 ,sum(inter_toll_ip_12593_call_num) as inter_toll_ip_12593_call_num -- 国际长途-IP-12593-次数\\n                 ,sum(inter_toll_ip_12593_call_dur) as inter_toll_ip_12593_call_dur -- 国际长途-IP-12593-时长（分钟）\\n                 ,sum(inter_toll_ip_17950_call_num) as inter_toll_ip_17950_call_num -- 国际长途-IP-17950-次数\\n                 ,sum(inter_toll_ip_17950_call_dur) as inter_toll_ip_17950_call_dur -- 国际长途-IP-17950-时长（分钟）\\n                 ,sum(inter_toll_ip_17951_call_num) as inter_toll_ip_17951_call_num -- 国际长途-IP-17951-次数\\n                 ,sum(inter_toll_ip_17951_call_dur) as inter_toll_ip_17951_call_dur -- 国际长途-IP-17951-时长（分钟）\\n                 ,sum(inter_toll_ip_call_num)       as inter_toll_ip_call_num       -- 国际长途-IP-次数\\n                 ,sum(inter_toll_ip_call_dur)       as inter_toll_ip_call_dur       -- 国际长途-IP-时长（分钟）\\n                 ,sum(inter_toll_call_num)          as inter_toll_call_num          -- 国际长途-次数\\n                 ,sum(inter_toll_no_ip_call_num)    as inter_toll_no_ip_call_num    -- 国际长途-非IP-次数\\n                 ,sum(inter_toll_no_ip_call_dur)    as inter_toll_no_ip_call_dur    -- 国际长途-非IP-时长（分钟）\\n                 ,sum(inter_toll_call_dur)          as inter_toll_call_dur          -- 国际长途-时长（分钟）\\n               from gbasedwi.dwi_beh_use_voc_tolltot_ds_${dayid}\\n              group by phone_no\\n             ) t4 on t1.phone_no=t4.phone_no\\n  left join (select\\n                 phone_no\\n                 ,sum(gprs_hmt_roam_flow)        as gprs_hmt_roam_flow        -- GPRS-港澳台漫游-流量（KB)\\n                 ,sum(gprs_hmt_roam_up_flow)     as gprs_hmt_roam_up_flow     -- GPRS-港澳台漫游-上行-流量（KB)\\n                 ,sum(gprs_hmt_roam_down_flow)   as gprs_hmt_roam_down_flow   -- GPRS-港澳台漫游-下行-流量（KB)\\n                 ,sum(gprs_inter_roam_flow)      as gprs_inter_roam_flow      -- GPRS-国际漫游-流量（KB)\\n                 ,sum(gprs_inter_roam_up_flow)   as gprs_inter_roam_up_flow   -- GPRS-国际漫游-上行-流量（KB)\\n                 ,sum(gprs_inter_roam_down_flow) as gprs_inter_roam_down_flow -- GPRS-国际漫游-下行-流量（KB)\\n                 ,sum(gprs_total_num)            as gprs_total_num            -- 当日GPRS使用次数\\n                 ,sum(gprs_total_dur)            as gprs_total_dur            -- 当日GPRS使用时长（分钟）\\n               from gbasedwi.dwi_beh_use_gprs_usertot_ds_${dayid}\\n              group by phone_no\\n             ) t5 on t1.phone_no=t5.phone_no\\n  left join (select\\n                 phone_no\\n                 ,sum(sms_inter_p2p_num) as sms_inter_p2p_num -- 短信-国际点对点短信-条数\\n               from gbasedwi.dwi_beh_use_sms_usertot_dt_${dayid}\\n              group by phone_no\\n             ) t6 on t1.phone_no=t6.phone_no\\n  where t1.prod_kind_code='171000000001'  and (t1.month_arrive_flag = 1 or t1.month_off_flag = 1 or t1.month_new_flag = 1);","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [34]-[index:53]-[2014年日新增指标数据表]-[32]-['str' object has no attribute 'lfind']:{"name":"32.插入数据1","nodeId":"32","dsName":"GbaseDM","sql":"INSERT INTO ${TARGET_TMP_DM_PUB_INCREASE_DAY_01}\\n (\\tPHONE_NO,IS_IMPORT_USER,CUST_TYPE,DEPT_NAME,ENTERPRISE_MARK,\\n\\tCURRENT_HOLD_MARK,GPRS_TNET_TOTAL_FLOW,GRID_ID\\t)\\nSELECT\\tA.PHONE_NO,\\n\\t\\tB.IS_IMPORT_USER,\\n\\t\\tB.CUST_TYPE,\\n\\t\\tB.DEPT_NAME,\\n\\t\\tB.ENTERPRISE_MARK ,\\n\\t\\tB.CURRENT_HOLD_MARK,\\n\\t\\tNULL GPRS_TNET_TOTAL_FLOW,\\n\\t\\tE.GRID_ID\\nFROM ${SOURCE_DWI_USR_PESN_PARTINFO_DS_YYYYMMDD} A\\nLEFT JOIN (SELECT PRODUCT_NO,IS_IMPORT_USER,CUST_TYPE,DEPT_NAME,ENTERPRISE_MARK,CURRENT_HOLD_MARK \\n\\t\\t   FROM ${SOURCE_DM_PUB_INCREASE_DAY_20141231}) B ON  A.PHONE_NO=B.PRODUCT_NO\\n LEFT JOIN ${SOURCE_DWI_USR_PESN_PERSN_LOC_DS_YYYYMMDD} E ON A.PHONE_NO=E.PHONE_NO\\n WHERE (A.PROD_KIND_CODE='171000000001' and A.MONTH_ARRIVE_FLAG = 1) OR A.MONTH_OFF_FLAG = 1;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [35]-[index:55]-[业务差错表]-[4]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"4.SQL语句","nodeId":"4","sql":"drop table DM_BBC_BI_D2D_BUSI_ERR_DD;\\ncreate table DM_BBC_BI_D2D_BUSI_ERR_DD distributed by ('ticket_id')\\nselect * from DM_BBC_BI_D2D_BUSI_ERR_DD@dblink_dm;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [36]-[index:56]-[业务差错表]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"3.SQL语句","nodeId":"3","sql":"drop table DM_BBC_BI_D2D_BUSI_ERR_DD;\\ncreate table DM_BBC_BI_D2D_BUSI_ERR_DD distributed by ('ticket_id')\\nselect distinct '${day_id}' op_time,\\n       a.ticket_id,\\n       a.err_id,\\n       a.item,\\n       a.point,\\n       b.\\"name\\" as cx_name,\\n       b.err_level,\\n       b.err_type,\\n       d.department_name,\\n       d.organized_name,\\n       c.audit_tic_type,\\n       c.done_date,\\n       c.bill_id,\\n       e.\\"name\\" yw_name,\\n       c.business_name,\\n       e.risk_level,\\n       c.brand,\\n       c.done_code,\\n       c.case_no,\\n       c.op_name,\\n       c.op_code,\\n       c.file_id,\\n       c.order_code,\\n\\t   c.cust_id,\\n       g1.cust_service_id,\\n       c.customer_order_id,\\n       c.cust_name,\\n       c.special_num_name,\\n       c.opr_object_name,\\n       c.channel_type_name,\\n       c.pre_order_id,\\n       c.is_wzh,\\n       c.sys_auto,\\n       c.is_relation_receipt,\\n       case when f.attr_value='Y' then 1 else 0 end attr_value,\\n       nvl(g.real_name_flag,0)real_name_flag,\\n       e.is_import_business,\\n       c.order_state_name,\\n       c.is_channel_mid,\\n       c.audit_status,\\n       c.auditor_name,\\n       c.auditor_code,\\n       c.audit_time,\\n       c.audit_desc,\\n       c.audit_modify_counts,\\n       c.err_op_name,\\n       c.err_op_code,\\n       c.err_op_id,\\n       c.err_time,\\n       c.err_mdy_desc,\\n       c.rechecker_name,\\n       c.rechecker_code,\\n       c.recheck_time,\\n       c.recheck_desc,\\n       c.tck_cmp_time,\\n       c.deadline,\\n\\t   a.remark, -- 差错描述\\n       b.err_type_max  -- 差错分类\\nfrom sa_d_dm_bbc_bi_d2d_busi_err_dt_${dayid} a\\nleft join gbaseods.ODS_D_F_BBC_SYS_PERSONAL_AUDIT_POINT_ERR_${dayid} b on a.err_id=b.id\\nleft join sa_d_dm_bbc_bi_d2d_busi_dt_${dayid} c on a.ticket_id=c.audit_id\\nleft join gbaseods.ODS_D_F_BBC_SYS_EA_DEPT_ORG_${dayid} d on c.org_id=d.organize_id\\nleft join gbaseods.ODS_D_F_BBC_SYS_PERSONAL_BUSI_TYPE_${dayid} e on c.busi_type_id_by_d2d=e.id\\nleft join gbaseods.ods_d_f_crm_01563_indiv_cust_ext_${dayid} f on c.cust_id=f.cust_id and f.attr_define_id=10\\nleft join (select cust_id,real_name_flag,row_number()over(partition by cust_id order by done_date desc)rn \\n           from gbaseods.ods_d_f_crm_01001_cust_info_${dayid}) g on c.cust_id=g.cust_id and g.rn=1\\nleft join (select cust_id,cust_service_id,row_number()over(partition by cust_id order by done_date desc)rn \\n           from gbaseods.ods_d_f_crm_01001_cust_info_${dayid} where state='U') g1 on c.cust_id=g1.cust_id and g1.rn=1\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [37]-[index:60]-[出账信息月视图月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_ACCT_SHOULDITEM_${monthid};\\ncreate table DM_PUB_ACCT_SHOULDITEM_${monthid} distributed by('product_no') as select * from DM_PUB_ACCT_SHOULDITEM_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [38]-[index:61]-[出账信息月视图月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_ACCT_SHOULDITEM_${monthid} select * from DM_PUB_ACCT_SHOULDITEM_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [39]-[index:62]-[出账信息月视图月调度传输]-[13]-['str' object has no attribute 'lfind']:{"name":"更新前台维表","nodeId":"12","dsName":"Gbase_6_DM","sql":"truncate table dm.dim_rpt_general_sheet1;\\ninsert into dim_rpt_general_sheet1 (select * from  dim_rpt_general_sheet1@dblink_dm);\\ntruncate table dm.dim_ckpi_basekpi_feeitem;\\ninsert into dim_ckpi_basekpi_feeitem (select * from  dim_ckpi_basekpi_feeitem@dblink_dm);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [40]-[index:64]-[订单视图月表]-[43]-['str' object has no attribute 'lfind']:{"parentDsName":"gbasegrid","dsName":"gbasegrid","schema_union":"gbasegrid","schema_dev":"gbasegrid","schema_prod":"gbasegrid","queue_union":"","queue_dev":"","queue_prod":"","name":"43.SQL语句","nodeId":"43","sql":"drop table DM.tmp_PUB_PRODUCT_ORDER_DM_${dayid};\\ncreate table DM.tmp_PUB_PRODUCT_ORDER_DM_${dayid} distributed by ('phone_no')\\nselect distinct a.phone_no,\\n       nvl(a.dept_county_id,0) dept_county_id,  -- 分公司\\n       coalesce(a.oper_grid_name,b.regional_center_name,'不详') oper_grid_name,   -- 经营网格\\n       coalesce(a.grid_name,b.grid_name,'不详') grid_name,  -- 经分网格\\n       coalesce(a.micro_name,b.micro_name,'不详') micro_name,  -- 微格\\n       nvl(a.oper_chl_id,0)oper_chl_id  -- 操作渠道\\nfrom (\\n\\tselect a.phone_no,a.oper_chl_id\\n\\t,a.new_org_id dept_county_id,e.oper_grid_name,e.grid_name,e.micro_name\\n\\tfrom (\\n\\t\\t\\t\\tselect a.phone_no,nvl(b.mis_code,a.oper_chl_id) oper_chl_id,a.new_org_id\\n\\t\\t\\t\\t  from gbasedwi.dwi_inst_ord_list_dm_${monthid} a\\n\\t\\t\\t\\t  left join (select chl_id,nvl(case when chl_lvl2_cls='主厅' then mis_code else chl_id_new end,mis_code)mis_code \\n\\t\\t\\t\\t             from gbasedwd.dim_chl_departinfo_ds_${dayid}) b on a.oper_chl_id=b.chl_id \\n\\t\\t\\t\\twhere a.STAT_DATE='${day_id}'\\n\\t)a \\n\\tleft join dim_grid_chl_hall_relat e on a.oper_chl_id=e.oper_chl_id and a.new_org_id=e.county_id\\n)a\\nleft join dim_grid_chl_hall_union b on a.oper_chl_id=b.chl_id and a.dept_county_id=b.dept_county_id\\n;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [41]-[index:66]-[订单视图月表]-[37]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"37.订单维表更新","nodeId":"37","sql":"/*更新业务受理分公司维表*/\\ntruncate table dm.dim_order_chl_county;\\ninsert into dm.dim_order_chl_county select * from gbasedwd.dim_order_chl_county;\\n/*更新订单产品维表*/\\ninsert into   DIM_ORDER_OFFER   select  distinct  case when  a.offer_id is null then  987654321 \\n                                else a.offer_id end,a.order_name  from  dm.DM_PUB_PRODUCT_ORDER_DM_${monthid}  a \\n\\t\\t                                left join  \\n\\t\\t                               DIM_ORDER_OFFER  b   on   a.offer_id=b.offer_id  \\n\\t\\t                               where  b.offer_id is null;\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n \\t\\n/*增加订单类型维表*/\\ninsert into   DIM_ORDER_TYPE   select  distinct  a.ORDER_TYPE,a.ORDER_TYPE  from  dm.DM_PUB_PRODUCT_ORDER_DM_${monthid} a \\n\\t\\t                                left join  \\n\\t\\t                               DIM_ORDER_TYPE  b   on   a.ORDER_TYPE=b.ORDER_TYPE  \\n\\t\\t                                where  b.ORDER_TYPE is null;\\t\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n/*增加订单动作维表*/\\ninsert into   DIM_ORDER_ACTION   select  distinct  a.ORDER_ACTION,a.ORDER_ACTION  from  dm.DM_PUB_PRODUCT_ORDER_DM_${monthid} a \\n\\t\\t                                left join  \\n\\t\\t                               DIM_ORDER_ACTION  b   on   a.ORDER_ACTION=b.ORDER_ACTION  \\n\\t\\t                                where  b.ORDER_ACTION is null;\\t\\n/*增加订单状态维表*/\\ninsert into   DIM_ORDER_STATUS   select  distinct  a.STATUS,a.STATUS  from  dm.DM_PUB_PRODUCT_ORDER_DM_${monthid} a \\n\\t\\t                                left join  \\n\\t\\t                               DIM_ORDER_STATUS  b   on   a.STATUS=b.STATUS  \\n\\t\\t                                where  b.STATUS is null;\\n\\t\\n/*增加订单来源渠道维表*/\\ninsert into   DIM_ORDER_CHANNEL_TYPE   select  distinct  a.CHANNEL_TYPE,a.CHANNEL_TYPE  from  dm.DM_PUB_PRODUCT_ORDER_DM_${monthid} a \\n\\t\\t                                left join  \\n\\t\\t                               DIM_ORDER_CHANNEL_TYPE  b   on   a.CHANNEL_TYPE=b.CHANNEL_TYPE  \\n\\t\\t                                where  b.CHANNEL_TYPE is null;\\t\\t   "} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [42]-[index:67]-[订单视图月表]-[12]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"12.清空当日数据","nodeId":"12","sql":"delete from ${DM_PUB_PRODUCT_ORDER_DM_YYYYMM} where op_time='${day_id}'"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [43]-[index:70]-[订单视图月表]-[36]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"36.更新业务名称维表","nodeId":"36","sql":"/*增加归属营业厅维表*/\\n/*insert into  DIM_PUB_ORDER_ROOM  \\n   select   a.room_id, a.ROOM_NAME  , a.county_id from   (\\n       select * from ( \\n\\t   select  b.room_id,case when b.ROOM_NAME is null then  '未知' else b.ROOM_NAME end ROOM_NAME,\\n\\t   case when b.county_id is null then 987654321 else b.county_id  end  county_id  from (  \\n\\t   select     room_id,ROOM_NAME        from   \\n\\t     (  select    distinct ORG_ID room_id,chl_name ROOM_NAME,DEPT_COUNTY_ID county_id  from gbasedwd.DIM_CHL_DEPARTINFO_DS_${dayid} ) x group by  room_id,ROOM_NAME  having count(*)>1  \\t\\t\\t   \\n\\t\\t )   a    inner join   (select  distinct ORG_ID room_id,chl_name ROOM_NAME,DEPT_COUNTY_ID county_id  from    gbasedwd.DIM_CHL_DEPARTINFO_DS_${dayid})  b \\n\\t\\t on   a.room_id =b.room_id    where b.county_id  is not null \\n\\t\\t union  all \\n\\t\\t  select  b.room_id,case when b.ROOM_NAME is null then  '未知' else  b.ROOM_NAME end ROOM_NAME,\\n\\t\\t  case when b.county_id is null then 987654321  else b.county_id  end county_id from (  \\n\\t   select     room_id,ROOM_NAME        from   \\n\\t     (  select    distinct ORG_ID room_id,chl_name ROOM_NAME,DEPT_COUNTY_ID county_id  from gbasedwd.DIM_CHL_DEPARTINFO_DS_${dayid} ) x group by  room_id,ROOM_NAME  having count(*)=1  \\t\\t\\t   \\n\\t\\t )   a    inner join   (select  distinct ORG_ID room_id,chl_name ROOM_NAME, DEPT_COUNTY_ID county_id  from    gbasedwd.DIM_CHL_DEPARTINFO_DS_${dayid})  b \\n\\t\\t on   a.room_id =b.room_id    )x )  a  \\n         left join  DIM_PUB_ORDER_ROOM  b \\n        on  a.room_id=b.room_id\\n           where b.room_id is null*/\\n\\t\\t   \\t   \\t\\t   \\n/*增加归属分公司维表*/\\n/*insert into  DIM_PUB_ORDER_COUNTY\\nselect   a.room_id, a.county_id  , a.county_name from   (\\nselect room_id,county_id,county_name from ( \\n\\t   select  b.room_id,case when b.county_name is null then  '未知' else b.county_name end county_name,case when b.county_id is null then 987654321 else b.county_id  end  county_id  from (  \\n\\t   select     room_id,ROOM_NAME        from   \\n\\t     (  select    distinct ORG_ID room_id,chl_name ROOM_NAME,DEPT_COUNTY_ID county_id  from gbasedwd.DIM_CHL_OPERATOR_DS_${dayid} ) x group by  room_id,ROOM_NAME  having count(*)>1  \\t\\t\\t   \\n\\t\\t )   a    inner join   (select  distinct ORG_ID room_id,DEPT_COUNTY_NAME county_name,DEPT_COUNTY_ID county_id  from    gbasedwd.DIM_CHL_OPERATOR_DS_${dayid})  b \\n\\t\\t on   a.room_id =b.room_id    where b.county_id  is not null \\n\\t\\t union  all \\n\\t\\t  select  b.room_id,case when b.county_name is null then  '未知' else  b.county_name end county_name,case when b.county_id is null then 987654321  else b.county_id  end county_id from (  \\n\\t   select     room_id,ROOM_NAME        from   \\n\\t     (  select    distinct ORG_ID room_id,chl_name ROOM_NAME,DEPT_COUNTY_ID county_id  from gbasedwd.DIM_CHL_OPERATOR_DS_${dayid} ) x group by  room_id,ROOM_NAME  having count(*)=1  \\t\\t\\t   \\n\\t\\t )   a    inner join   (select  distinct ORG_ID room_id,DEPT_COUNTY_NAME county_name,DEPT_COUNTY_ID county_id  from    gbasedwd.DIM_CHL_OPERATOR_DS_${dayid})  b \\n\\t\\t on   a.room_id =b.room_id    )  )a\\n\\t\\t left join  DIM_PUB_ORDER_COUNTY  b \\n        on  a.room_id=b.room_id\\n           where b.room_id is null*/  \\n\\n/*增加业务名称维表*/\\n insert into  DIM_PUB_ORDER_BUSINESS  select   a.business_id, a.business_name \\n    from  (select distinct busi_op_id business_id,business_name from  dm.DM_PUB_PRODUCT_ORDER_DM_${monthid}  ) a\\n\\t\\t left join  DIM_PUB_ORDER_BUSINESS  b \\n        on  a.business_id=b.business_id\\n           where b.business_id is null;\\t"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [44]-[index:72]-[订单视图月表]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"8.插入当日数据","nodeId":"8","sql":"\\tinsert into ${DM_PUB_PRODUCT_ORDER_DM_YYYYMM}\\n\\t (\\tOP_TIME,\\n\\t\\tORDER_NO,\\n\\t\\tSTATUS,\\n\\t\\tUSER_ID,\\n\\t\\tPRODUCT_NO,\\n\\t\\tCREATE_TIME,\\n\\t\\tOBJ_BEGIN_TIME,\\n\\t\\tOBJ_END_TIME,\\n\\t\\tORDER_TYPE,\\n\\t\\tORDER_ACTION,\\n\\t\\tCHANNEL_TYPE,\\n\\t\\tCREATE_WORK_NO,\\n\\t\\tOFFER_ID,\\n\\t\\tORDER_NAME,\\n\\t\\tBUSINESS_NAME,\\n\\t\\tORIGINAL_CHANNEL_TYPE,\\n\\t\\tORIGINAL_STATE,\\n\\t\\tORIGINAL_ACTION_TYPE,\\n\\t\\tWORK_NAME,\\n\\t\\tROOM_NAME,\\n\\t\\tCOUNTY_NAME,\\n\\t\\tCLERK_NO    ,\\n    STAFF_ID,\\n    OPER_CHL_ID,\\n    CHL_LVL        ,\\n    CHL_LVL1_CLS   ,\\n    CHL_LVL2_CLS   ,\\n    CHL_LVL3_CLS   ,\\n    CHL_LVL4_CLS   ,\\n    ORGN_ORD_CHL_TYPE_NAME ,\\n    BUSI_OP_ID,\\n    CHL_CODE,\\n    MIS_CODE,\\n    ORG_CHL_SHORT_NAME,\\n    ORG_CHL_NAME,\\n    HALL_NAME,\\n    CHL_TYPE_NEW,\\n\\tplan_id,\\n\\tis_ywm_ord,\\n\\tis_ysm_ord,\\n\\thx_CHL_code,\\n\\toper_grid_name,       -- 经营网格编码\\n    grid_name,       -- 经分网格编码\\n    micro_name,  -- 微格名称\\n\\tdept_county_id,\\n\\tgrp_chl_code,\\n\\tplan_inst_id,\\n    cust_ord_id,\\n    qy_fx_chl,qy_chl_id,qy_z_chl_name,qy_z_chl_id,\\n    ysm_op_id,is_xinghuo_ord,UPDT_TIME_SFM,UPDT_TIME,shux_state,shux_chl_name,shux_chl_id,shux_fee,  -- 业务属性-金额\\n    attr_val,attr_plan_val,sxx_attr_val,sxx_attr_fee,attr_01,attr_02,attr_03,attr_04,attr_05,attr_06,attr_07,attr_08,attr_09,attr_10,\\n    chl_type_name\\n\\t)\\n\\tselect distinct date('${day_id}'),\\n           a.ORD_ID,\\n           a.ORD_STATUS,\\n           a.USER_ID,\\n           a.PHONE_NO,\\n           a.CREATE_BILL_TIME,\\n           a.BEGIN_TIME,\\n           a.END_TIME,\\n           a.ORD_TYPE,\\n           a.ACTION_TYPE,\\n           a.ORD_HANDL_CHL,\\n           a.STAFF_BUSI_ID,\\n           a.PLAN_ID, ####case when a.PLAN_ID is null then 987654321\\telse a.PLAN_ID end 20181210日调整\\n           a.ORD_NAME,\\n           a.BUSI_NAME,\\n           a.ORGN_ORD_CHL_SRC,\\n           a.ORGN_ORD_STATE,\\n           a.ORGN_ORD_ACTION,\\n           a.STAFF_NAME,\\n           a.OPER_CHEL_NAME  /*case when b.ORG_ID  is null then 987654321 else b.ORG_ID  end*/,\\n           a.NEW_ORG_ID   /*a.ORG_NAME*/  ,\\n           a.PERSN_SCORE_BUSN_EMP_CODE,\\n\\t\\t       a.STAFF_ID,\\n           a.OPER_CHL_ID,\\n           a.CHL_LVL         ,\\n           a.CHL_LVL1_CLS    ,\\n           a.CHL_LVL2_CLS    ,\\n           a.CHL_LVL3_CLS    ,\\n           a.CHL_LVL4_CLS    ,\\n           a.ORGN_ORD_CHL_TYPE_NAME  ,\\n           a.BUSI_OP_ID,\\n           a.CHL_CODE, -- 渠道编码\\n           a.MIS_CODE, -- MIS编码\\n           a.ORG_CHL_SHORT_NAME, -- 渠道简称     \\n           a.ORG_CHL_NAME,       -- 渠道全称  \\n           a.HALL_NAME,          -- 营业厅名称\\n           case when a.STAFF_BUSI_ID in ('BJCRMJT-JD','BJCRMJT-SUNING','BJCRMJT-ZJZX','BJCRMJT-ZYHLW','BJCRMJT-TENCENT')\\n\\t\\t             then '社会电子渠道'\\n                when a.STAFF_BUSI_ID in ('BJCRMUMMP','BJCRMSJYYT','BJCRMJT-WECHAT','BJCRMJT-MI','BJCRMCBOSS','BJCRMJTOAO',\\n\\t\\t\\t\\t     'WEB_0201802','WEB_0302302','WEB_0500101','OP_000246','BJCRMVGOP','BJCRMSC','BJCRMQYPT') then '自有电子渠道'\\n                when a.STAFF_BUSI_ID='BJCRMEC' and a.CHL_CODE in ('CP005','JT004','ST003','NT001','WT002')\\n                      then '自有电子渠道'\\n\\t\\t\\t\\twhen b.chl_level=2 then b.chl_type_new   \\n                when b.chl_level=3 and new_org_name='市场经营部' then '连锁渠道'\\n                when b.chl_level=3 and new_org_name like '%分公司' then '零售渠道'  \\n                else '其他' end as CHL_TYPE_NEW, -- 渠道新分类\\n\\t       a.PLAN_ID ,####case when a.PLAN_ID is null then 987654321\\telse a.PLAN_ID end 20181210日调整\\n\\t\\t   case when a.STAFF_BUSI_ID='BJCRMEC' and a.PERSN_SCORE_BUSN_EMP_CODE like'8%' \\n                then 1 else 0 end is_ywm_ord, -- 是否云微盟订单\\n           case when a.ORGN_ORD_CHL_SRC in (27,28) then 1 else 0 end  is_ysm_ord, -- 是否云商盟订\\n\\t\\t   nvl(case when c.ORG_CHL_CODE like 'QX%' and c.chl_second_kind_id=998 then 998\\n            when c.ORG_CHL_CODE like 'QX%' and c.chl_second_kind_id=997 then 997\\n            when c.ORG_CHL_CODE like 'QX%' and c.chl_second_kind_id=999 then 999\\n           else 0 end,0),\\n\\t\\t   nvl(e.oper_grid_name,'不详'),   -- 经营网格\\n           nvl(e.grid_name,'不详'),  -- 经分网格\\n           nvl(e.micro_name,'不详'),  -- 微格\\n\\t\\t   nvl(f.dept_county_id,0),\\n\\t\\t   grp_chl_code,\\n\\t\\t   a.plan_inst_id,\\n           a.cust_ord_id,\\n           g.distribution_channel,\\n           g.Channel_code,\\n           g.Sub_channel,\\n           g.Sub_channel_code,\\n           h.oper_code,\\n           case when a.PERSN_SCORE_BUSN_EMP_CODE like '%XH|%' then '1' else '0' end,\\n           a.UPDT_TIME UPDT_TIME_SFM, -- 更新时间(时分秒)\\n           date(a.UPDT_TIME) UPDT_TIME, -- 更新时间(年月日)\\n           i.shux_state, -- 业务属性-状态\\n           i.shux_chl_name,  -- 业务属性-订购渠道\\n           i.shux_chl_id, -- 业务属性-19位渠道编码\\n           i.shux_fee,  -- 业务属性-金额\\n           j.attr_val, -- 行业折扣率\\n           j.attr_plan_val,-- 下月捆绑套餐档位（新）\\n           k.sxx_attr_val,  -- 随心选-额度（GB）\\n           k.sxx_attr_fee,   -- 随心选-价格(元)\\n           k.attr_01, -- 补差款    \\n           k.attr_02, -- 成交价    \\n           k.attr_03, -- 补贴额    \\n           k.attr_04, -- 有效期（月） \\n           k.attr_05, -- 手机回收   \\n           k.attr_06, -- 手机IMEI \\n           k.attr_07, -- 终端机型   \\n           k.attr_08, -- 终端IMEI \\n           k.attr_09, -- 京东到家订单号\\n           k.attr_10,  -- 机型类型编码\\n           l.chl_type_name -- 网格渠道类型\\n     from gbasedwi.dwi_inst_ord_list_dm_${monthid} a\\n    left join dm.dim_chl4_chl b on a.chl_lvl4_cls=b.chl_lvl4_cls\\n   left join dm.dim_product_order_chl_oper b1 on a.OPER_CHL_ID=b1.OPER_CHL_ID\\n\\tleft join (select ORG_CHL_CODE,chl_second_kind_id\\n               from gbasedwd.dwd_prty_chl_orgchl_ds_${dayid}\\n               group by ORG_CHL_CODE,chl_second_kind_id\\n\\t\\t\\t   ) c on a.chl_code=c.ORG_CHL_CODE\\n    left join gbasedwd.dim_chl_departinfo_ds_${dayid} d on a.oper_chl_id=d.chl_id\\n\\tleft join tmp_PUB_PRODUCT_ORDER_DM_${dayid} e on nvl(d.mis_code,a.oper_chl_id)=e.oper_chl_id and a.phone_no=e.phone_no\\nleft join gbasedwi.DWI_USR_PESN_PERSN_LOC_DS_${dayid} f on a.phone_no=f.phone_no\\nleft join gbasedwd.dwd_res_svc_qyywpt_product_order_ds_${pdayid} g on a.phone_no=g.msisdn and a.plan_id=g.product_id\\nleft join gbaseods.ods_d_a_ysm_00010_dy_order_${dayid} h on a.phone_no=h.msisdn and a.cust_ord_id=h.crm_order_id\\nleft join (select distinct a.user_id,a.cust_ord_id,\\n                  max(case when b.state=1 then '订购' when b.state=2 then '激活' when b.state=3 then '退订' else '不详' end) shux_state, -- 业务属性-状态\\n                  max(case when b.attr_id=151000021310 then b.attr_value end) shux_chl_name, -- 业务属性-订购渠道\\n                  max(case when b.attr_id=151600002422 then b.attr_value end) shux_chl_id, -- 业务属性-19位渠道编码\\n                  max(case when b.attr_id=151000020905 then b.attr_value end) shux_fee -- 业务属性-金额\\n           from (select * from gbasedwi.dwi_inst_ord_list_dm_${monthid} where STAT_DATE='${day_id}'\\n                ) a\\n           left join gbaseods.ods_d_a_crm_230722_V_ord_Srv_aTTR_F_${dayid} b on a.user_id=b.user_id and a.cust_ord_id=b.customer_order_id \\n           GROUP BY 1,2\\n          ) i on a.user_id=i.user_id and a.cust_ord_id=i.cust_ord_id \\nleft join (select user_id,plan_inst_id,\\n                  max(case when attr_code='151000042122' then attr_val end) attr_val, -- 行业折扣率\\n                  max(case when attr_code='151600002964' then attr_val end) attr_plan_val -- 下月捆绑套餐档位（新）\\n            from gbasedwi.dwi_inst_product_srv_all_ds_${dayid}\\n            where date(ATTR_EXP_DATE)>='${day_id}' and attr_code in ('151000042122','151600002964') group by 1,2\\n           ) j on a.user_id=j.user_id and a.plan_inst_id=j.plan_inst_id\\nleft join (select user_id,plan_inst_id,\\n                  max(case when attr_code='151600004442' then attr_val end) sxx_attr_val, -- 随心选-额度（GB）\\n                  max(case when attr_code='151600004443' then attr_val end) sxx_attr_fee, -- 随心选-价格(元)\\n                  max(case when attr_code='151600003401' then attr_val end) attr_01, -- 补差款     \\n                  max(case when attr_code='151600003402' then attr_val end) attr_02, -- 成交价     \\n                  max(case when attr_code='151600003403' then attr_val end) attr_03, -- 补贴额     \\n                  max(case when attr_code='151000001733' then attr_val end) attr_04, -- 有效期（月）  \\n                  max(case when attr_code='151000002152' then attr_val end) attr_05, -- 手机回收    \\n                  max(case when attr_code='151000002443' then attr_val end) attr_06, -- 手机IMEI  \\n                  max(case when attr_code='151000002029' then attr_val end) attr_07, -- 终端机型    \\n                  max(case when attr_code='151000002277' then attr_val end) attr_08, -- 终端IMEI  \\n                  max(case when attr_code='151600004466' then attr_val end) attr_09, -- 京东到家订单号 \\n                  max(case when attr_code='151000002949' then attr_val end) attr_10  -- 机型类型编码\\n            from gbasedwi.dwi_inst_product_srv_all_ds_${dayid}\\n            where attr_code in ('151600004442','151600004443',\\n                                '151600003401','151600003402','151600003403','151000001733','151000002152',\\n                                '151000002443','151000002029','151000002277','151600004466','151000002949') \\n            group by 1,2\\n           ) k on a.user_id=k.user_id and a.plan_inst_id=k.plan_inst_id\\nleft join gbasegrid.dim_chl_grid_new_${dayid} l on substring_index(a.staff_busi_id,'WW',-1)=l.org_chl_id\\nwhere a.STAT_DATE='${day_id}';"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [45]-[index:75]-[渠道酬金020510月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CHANNEL_020510_${monthid};\\nCREATE TABLE  DM_PUB_CHANNEL_020510_${monthid} distributed by('channel_code')  as select * from DM_PUB_CHANNEL_020510_YYYYMM ;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [46]-[index:76]-[渠道酬金020510月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CHANNEL_020510_${monthid} \\n(select * from   \\n ODS_M_F_OTR_020510_ORDERBUSINESSSDETAIL_${monthid}@dblink_ods);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [47]-[index:81]-[服务使用表（语音）--AUTORPT]-[17]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据到目标表","nodeId":"17","sql":"insert into ${TARGET_DM_AUTORPT_CALL_YYYYMM}\\n (     OP_TIME\\n      ,STATIS_MONTH\\n      ,PRODUCT_NO\\n      ,V00000\\n      ,V00000_C\\n      ,V00100\\n      ,V00100_C\\n      ,V00110\\n      ,V00110_C\\n      ,V00200\\n      ,V00200_C\\n      ,V00210\\n      ,V00210_C\\n      ,V00211\\n      ,V00211_C\\n      ,V00212\\n      ,V00212_C\\n      ,V00213\\n      ,V00213_C\\n      ,V00220\\n      ,V00220_C\\n      ,V00300\\n      ,V00300_C\\n      ,V00310\\n      ,V00310_C\\n      ,V00311\\n      ,V00311_C\\n      ,V00312\\n      ,V00312_C\\n      ,V00313\\n      ,V00313_C\\n      ,V00320\\n      ,V00320_C\\n      ,V00400\\n      ,V00400_C\\n      ,V00410\\n      ,V00410_C\\n      ,V00411\\n      ,V00411_C\\n      ,V00412\\n      ,V00412_C\\n      ,V00413\\n      ,V00413_C\\n      ,V00420\\n      ,V00420_C\\n      ,V10000\\n      ,V10000_C\\n      ,V11000\\n      ,V11000_C\\n      ,V11100\\n      ,V11100_C\\n      ,V11200\\n      ,V11200_C\\n      ,V11300\\n      ,V11300_C\\n      ,V11400\\n      ,V11400_C\\n      ,V11510\\n      ,V11510_C\\n      ,V11520\\n      ,V11520_C\\n      ,V11530\\n      ,V11530_C\\n      ,V11540\\n      ,V11540_C\\n      ,V11550\\n      ,V11550_C\\n      ,V11560\\n      ,V11560_C\\n      ,V11570\\n      ,V11570_C\\n      ,V12000\\n      ,V12000_C\\n      ,V12100\\n      ,V12100_C\\n      ,V12200\\n      ,V12200_C\\n      ,V12300\\n      ,V12300_C\\n      ,V12400\\n      ,V12400_C\\n      ,V12501\\n      ,V12501_C\\n      ,V12502\\n      ,V12502_C\\n      ,V12503\\n      ,V12503_C\\n      ,V12504\\n      ,V12504_C\\n      ,V12505\\n      ,V12505_C\\n      ,V12506\\n      ,V12506_C\\n      ,V12507\\n      ,V12507_C\\n      ,V20000\\n      ,V20000_C\\n      ,V21000\\n      ,V21000_C\\n      ,V21100\\n      ,V21100_C\\n      ,V21200\\n      ,V21200_C\\n      ,V21300\\n      ,V21300_C\\n      ,V21400\\n      ,V21400_C\\n      ,V21510\\n      ,V21510_C\\n      ,V21520\\n      ,V21520_C\\n      ,V21530\\n      ,V21530_C\\n      ,V21540\\n      ,V21540_C\\n      ,V21550\\n      ,V21550_C\\n      ,V21560\\n      ,V21560_C\\n      ,V21570\\n      ,V21570_C\\n      ,V22000\\n      ,V22000_C\\n      ,V22501\\n      ,V22501_C\\n      ,V22502\\n      ,V22502_C\\n      ,V22503\\n      ,V22503_C\\n      ,V22504\\n      ,V22504_C\\n      ,V22505\\n      ,V22505_C\\n      ,V22506\\n      ,V22506_C\\n      ,V22507\\n      ,V22507_C\\n      ,V30000\\n      ,V30000_C\\n      ,V31000\\n      ,V31000_C\\n      ,V32000\\n      ,V32000_C\\n      ,V40000\\n      ,V40000_C\\n      ,V41000\\n      ,V41000_C\\n      ,V42000\\n      ,V42000_C\\n      ,VO0001\\n      ,VO0002\\n      ,VO0003\\n      ,VO0004\\n      ,VO0006\\n      ,VO0007\\n      ,VO0008\\n      ,VS0001\\n      ,VS0001_C\\n      ,VS0002\\n      ,VS0002_C\\n      ,VS0003\\n      ,VS0003_C\\n      ,VS0004\\n      ,VS0004_C\\n      ,VS0005\\n      ,VS0005_C\\n      ,VS0006\\n      ,VS0006_C\\n      ,VS0007\\n      ,VS0007_C\\n      ,VS0008\\n      ,VS0008_C\\n      ,VS0009\\n      ,VS0009_1\\n      ,VS0009_1_C\\n      ,VS0009_2\\n      ,VS0009_2_C\\n      ,VS0009_C\\n      ,VS0010\\n      ,VS0010_C\\n      ,VS0011\\n      ,VS0011_C\\n      ,VS0012\\n      ,VS0012_C\\n      ,VS0013\\n      ,VS0013_C\\n      ,VS0014\\n      ,VS0014_1\\n      ,VS0014_1_C\\n      ,VS0014_2\\n      ,VS0014_2_C\\n      ,VS0014_C\\n      ,VS0015\\n      ,VS0015_C\\n      ,VS0016\\n      ,VS0016_C\\n      ,VS0017\\n      ,VS0017_C\\n      ,VS0018\\n      ,VS0018_C\\n      ,VS0019\\n      ,VS0019_C\\n      ,VS0020\\n      ,VS0020_C\\n      ,VS0021\\n      ,VS0021_C\\n      ,VS0022\\n      ,VS0022_1\\n      ,VS0022_1_C\\n      ,VS0022_2\\n      ,VS0022_2_C\\n      ,VS0022_C\\n      ,VS0023\\n      ,VS0023_C\\n      ,VS0024\\n      ,VS0024_C\\n      ,VS0025\\n      ,VS0025_C\\n      ,VS0026\\n      ,VS0026_C\\n      ,VS0027\\n      ,VS0027_C\\n      ,VS0028\\n      ,VS0028_C\\n      ,VS0029\\n      ,VS0029_C\\n      ,VS0030\\n      ,VS0030_C\\n      ,VS0031\\n      ,VS0031_C\\n      ,VS0032\\n      ,VS0032_C\\n      ,VS0033\\n      ,VS0033_C\\n      ,VS0034\\n      ,VS0034_C\\n      ,VS0035\\n      ,VS0035_C\\t\\t)\\nselect '${month_id}-01'            \\t\\t\\t\\tOP_TIME\\n      ,${monthid}                  \\t\\t\\t\\tSTATIS_MONTH\\n      ,t1.PHONE_NO                 \\t\\t\\t\\tPRODUCT_NO\\n      ,nvl(a.CALL_DUR,0)\\t\\t\\t\\t\\t\\tV00000\\n      ,nvl(a.CALL_NUM,0)\\t\\t\\t\\t\\t\\tV00000_c\\n      ,nvl(e.V00100,0)\\t\\t\\t\\t\\t\\t    V00100\\n      ,nvl(e.V00100_c,0)\\t\\t\\t\\t\\t\\tV00100_c\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.V00110,0)\\t\\t\\t\\t\\t\\tV00110  */\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.V00110_c,0)\\t\\t\\t\\t\\t\\tV00110_c*/\\n      ,nvl(d.LAND_TOLL_CALL_DUR,0)\\t\\t\\t\\tV00200\\n      ,nvl(d.LAND_TOLL_CALL_NUM,0)\\t\\t\\t\\tV00200_c\\n      ,nvl(d.LAND_TOLL_IP_CALL_DUR,0)\\t\\t\\tV00210\\n      ,nvl(d.LAND_TOLL_IP_CALL_NUM,0)\\t\\t\\tV00210_c\\n      ,nvl(d.LAND_TOLL_17951_CALL_DUR,0)\\t\\tV00211\\n      ,nvl(d.LAND_TOLL_17951_CALL_NUM,0)\\t\\tV00211_c\\n      ,nvl(d.LAND_TOLL_17950_CALL_DUR,0)\\t\\tV00212\\n      ,nvl(d.LAND_TOLL_17950_CALL_NUM,0)\\t\\tV00212_c\\n      ,nvl(d.LAND_TOLL_12593_CALL_DUR,0)\\t\\tV00213\\n      ,nvl(d.LAND_TOLL_12593_CALL_NUM,0)\\t\\tV00213_c\\n      ,nvl(d.LAND_TOLL_NOIP_CALL_DUR,0)\\t\\t\\tV00220\\n      ,nvl(d.LAND_TOLL_NOIP_CALL_NUM,0)\\t\\t\\tV00220_c\\n      ,nvl(d.HMT_TOLL_CALL_DUR,0)\\t\\t\\t\\tV00300\\n      ,nvl(d.HMT_TOLL_CALL_NUM,0)\\t\\t\\t\\tV00300_c\\n      ,nvl(d.HMT_TOLL_IP_CALL_DUR,0)\\t\\t\\tV00310\\n      ,nvl(d.HMT_TOLL_IP_CALL_NUM,0)\\t\\t\\tV00310_c\\n      ,nvl(d.HMT_TOLL_IP_17951_CALL_DUR,0)\\t\\tV00311\\n      ,nvl(d.HMT_TOLL_IP_17951_CALL_NUM,0)\\t\\tV00311_c\\n      ,nvl(d.HMT_TOLL_IP_17950_CALL_DUR,0)\\t\\tV00312\\n      ,nvl(d.HMT_TOLL_IP_17950_CALL_NUM,0)\\t\\tV00312_c\\n      ,nvl(d.HMT_TOLL_IP_12593_CALL_DUR,0)\\t\\tV00313\\n      ,nvl(d.HMT_TOLL_IP_12593_CALL_NUM,0)\\t\\tV00313_c\\n      ,nvl(d.HMT_TOLL_NOIP_CALL_DUR,0)\\t\\t\\tV00320\\n      ,nvl(d.HMT_TOLL_NOIP_CALL_NUM,0)\\t\\t\\tV00320_c\\n      ,nvl(d.INTER_TOLL_CALL_DUR,0)\\t\\t\\t\\tV00400\\n      ,nvl(d.INTER_TOLL_CALL_NUM,0)\\t\\t\\t\\tV00400_c\\n      ,nvl(d.INTER_TOLL_IP_CALL_DUR,0)\\t\\t\\tV00410\\n      ,nvl(d.INTER_TOLL_IP_CALL_NUM,0)\\t\\t\\tV00410_c\\n      ,nvl(d.INTER_TOLL_IP_17951_CALL_DUR,0)\\tV00411\\n      ,nvl(d.INTER_TOLL_IP_17951_CALL_NUM,0)\\tV00411_c\\n      ,nvl(d.INTER_TOLL_IP_17950_CALL_DUR,0)\\tV00412\\n      ,nvl(d.INTER_TOLL_IP_17950_CALL_NUM,0)\\tV00412_c\\n      ,nvl(d.INTER_TOLL_IP_12593_CALL_DUR,0)\\tV00413\\n      ,nvl(d.INTER_TOLL_IP_12593_CALL_NUM,0)\\tV00413_c\\n      ,nvl(d.INTER_TOLL_NO_IP_CALL_DUR,0)\\t\\tV00420\\n      ,nvl(d.INTER_TOLL_NO_IP_CALL_NUM,0)\\t\\tV00420_c\\n      ,nvl(b.LOC_CALL_DUR,0)\\t\\t\\t\\t\\tV10000\\n      ,nvl(b.LOC_CALL_NUM,0)\\t\\t\\t\\t\\tV10000_c\\n      ,nvl(b.LOC_CALING_DUR,0)\\t\\t\\t\\t\\tV11000\\n      ,nvl(b.LOC_CALING_NUM,0)\\t\\t\\t\\t\\tV11000_c\\n      ,nvl(b.LOC_NO_TOLL_CALL_DUR,0)\\t\\t\\tV11100\\n      ,nvl(b.LOC_NO_TOLL_NUM,0)\\t\\t\\t\\t\\tV11100_c\\n\\t  ,nvl(b.LOC_LAND_TOLL_CALL_DUR,0)\\t\\t\\tV11200\\n      ,nvl(b.LOC_LAND_TOLL_NUM,0)\\t\\t\\t\\tV11200_c\\n      ,nvl(b.LOC_HMT_TOLL_CALL_DUR,0)\\t\\t\\tV11300\\n      ,nvl(b.LOC_HMT_TOLL_NUM,0)\\t\\t\\t\\tV11300_c\\n      ,nvl(b.LOC_INTER_TOLL_CALL_DUR,0)\\t\\t\\tV11400\\n      ,nvl(b.LOC_INTER_TOLL_NUM,0)\\t\\t\\t\\tV11400_c\\n      ,nvl(b.LOC_CALING_CMC_CALL_DUR,0)\\t\\t\\tV11510\\n      ,nvl(b.LOC_CALING_CMC_NUM,0)\\t\\t\\t\\tV11510_c\\n      ,nvl(b.LOC_CALING_CRCC_CALL_DUR,0)\\t\\tV11520\\n      ,nvl(b.LOC_CALING_CRCC_NUM,0)\\t\\t\\t\\tV11520_c\\n      ,nvl(b.LOC_CALING_CUC_CMC_CALL_DUR,0)\\t\\tV11530\\n      ,nvl(b.LOC_CALING_CUC_CMC_NUM,0)\\t\\t\\tV11530_c\\n      ,nvl(b.LOC_CALING_CUC_FIX_CALL_DUR,0)\\t\\tV11540\\n      ,nvl(b.LOC_CALING_CUC_FIX_NUM,0)\\t\\t\\tV11540_c\\n      ,nvl(b.LOC_CALING_CTC_CMC_CALL_DUR,0)\\t\\tV11550\\n      ,nvl(b.LOC_CALING_CTC_CMC_NUM,0)\\t\\t\\tV11550_c\\n\\t  ,nvl(b.LOC_CALING_CTC_FIX_CALL_DUR,0)\\t\\tV11560\\n\\t  ,nvl(b.LOC_CALING_CTC_FIX_NUM,0)\\t\\t\\tV11560_c\\n\\t  ,nvl(b.LOC_CALING_OCARR_CALL_DUR,0)\\t\\tV11570\\n\\t  ,nvl(b.LOC_CALING_OTHR_CARR_NUM,0)\\t\\tV11570_c\\n\\t  ,nvl(b.LOC_CALLED_BILL_DUR,0)\\t\\t\\t\\tV12000\\n\\t  ,nvl(b.LOC_CALLED_NUM,0)\\t\\t\\t\\t\\tV12000_c\\n\\t  ,nvl(b.LOC_CALLED_LOC_BILL_DUR,0)\\t\\t\\tV12100\\n\\t  ,nvl(b.LOC_CALLED_LOC_NUM,0)\\t\\t\\t\\tV12100_c\\n      ,nvl(b.LOC_CALLED_LAND_BILL_DUR,0)\\t\\tV12200\\n      ,nvl(b.LOC_CALLED_LAND_NUM,0)\\t\\t\\t\\tV12200_c\\n      ,nvl(b.LOC_CALLED_HMT_BILL_DUR,0)\\t\\t\\tV12300\\n      ,nvl(b.LOC_CALLED_HMT_NUM,0)\\t\\t\\t\\tV12300_c\\n      ,nvl(b.LOC_CALLED_INTER_BILL_DUR,0)\\t\\tV12400\\n      ,nvl(b.LOC_CALLED_INTER_NUM,0)\\t\\t\\tV12400_c\\n      ,nvl(b.LOC_CALLED_CMC_BILL_DUR,0)\\t\\t\\tV12501\\n      ,nvl(b.LOC_CALLED_CMC_NUM,0)\\t\\t\\t\\tV12501_c\\n      ,nvl(b.LOC_CALLED_CRCCFIX_BILL_DUR,0)\\t\\tV12502\\n      ,nvl(b.LOC_CALLED_CRCC_FIX_NUM,0)\\t\\t\\tV12502_c\\n      ,nvl(b.LOC_CALLED_CUC_CMC_BILL_DUR,0)\\t\\tV12503\\n      ,nvl(b.LOC_CALLED_CUC_CMC_NUM,0)\\t\\t\\tV12503_c\\n      ,nvl(b.LOC_CALLED_CUC_FIX_BILL_DUR,0)\\t\\tV12504\\n      ,nvl(b.LOC_CALLED_CUC_FIX_NUM,0)\\t\\t\\tV12504_c\\n      ,nvl(b.LOC_CALLED_CTC_CMC_BILL_DUR,0)\\t\\tV12505\\n      ,nvl(b.LOC_CALLED_CTC_CMC_NUM,0)\\t\\t\\tV12505_c\\n      ,nvl(b.LOC_CALLED_CTC_FIX_BILL_DUR,0)\\t\\tV12506\\n      ,nvl(b.LOC_CALLED_CTC_FIX_NUM,0)\\t\\t\\tV12506_c\\n      ,nvl(b.LOC_CALLED_OCARR_BILL_DUR,0)\\t\\tV12507\\n      ,nvl(b.LOC_CALLED_OTHR_CARR_NUM,0)\\t\\tV12507_c\\n      ,nvl(b.LROAM_BILL_DUR,0)\\t\\t\\t\\t\\tV20000\\n      ,nvl(b.LROAM_NUM,0)\\t\\t\\t\\t\\t\\tV20000_c\\n      ,nvl(b.LROAM_OUT_BILL_DUR,0)\\t\\t\\t\\tV21000\\n      ,nvl(b.LROAM_OUT_NUM,0)\\t\\t\\t\\t\\tV21000_c\\n      ,nvl(b.LROAM_OUT_NO_TOLL_BILL_DUR,0)\\t\\tV21100\\n      ,nvl(b.LROAM_OUT_ROAMADDR_NUM,0)\\t\\t\\tV21100_c\\n      ,nvl(b.LROAM_OUT_LAND_TOLL_BILL_DUR,0)\\tV21200\\n      ,nvl(b.LROAM_OUT_LAND_TOLL_NUM,0)\\t\\t\\tV21200_c\\n      ,nvl(b.LROAM_OUT_HMT_TOLL_BILL_DUR,0)\\t\\tV21300\\n      ,nvl(b.LROAM_OUT_HMT_TOLL_NUM,0)\\t\\t\\tV21300_c\\n      ,nvl(b.LROAM_OUT_INTER_TOLL_BILL_DUR,0)\\tV21400\\n      ,nvl(b.LROAM_OUT_INTER_TOLL_NUM,0)\\t\\tV21400_c\\n      ,nvl(b.LROAM_OUT_CMC_BILL_DUR,0)\\t\\t\\tV21510\\n      ,nvl(b.LROAM_OUT_CMC_NUM,0)\\t\\t\\t\\tV21510_c\\n      ,nvl(b.LROAM_OUT_CRCC_BILL_DUR,0)\\t\\t\\tV21520\\n      ,nvl(b.LROAM_OUT_CRCC_NUM,0)\\t\\t\\t\\tV21520_c\\n      ,nvl(b.LROAM_OUT_CUC_CMC_BILL_DUR,0)\\t\\tV21530\\n      ,nvl(b.LROAM_OUT_CUC_CMC_NUM,0)\\t\\t\\tV21530_c\\n      ,nvl(b.LROAM_OUT_CUC_FIX_BILL_DUR,0)\\t\\tV21540\\n      ,nvl(b.LROAM_OUT_CUC_FIX_NUM,0)\\t\\t\\tV21540_c\\n      ,nvl(b.LROAM_OUT_CTC_CMC_BILL_DUR,0)\\t\\tV21550\\n      ,nvl(b.LROAM_OUT_CTC_CMC_NUM,0)\\t\\t\\tV21550_c\\n      ,nvl(b.LROAM_OUT_CTC_FIX_BILL_DUR,0)\\t\\tV21560\\n      ,nvl(b.LROAM_OUT_CTC_FIX_NUM,0)\\t\\t\\tV21560_c\\n      ,nvl(b.LROAM_OUT_OTHR_CARR_BILL_DUR,0)\\tV21570\\n      ,nvl(b.LROAM_OUT_OTHR_CARR_NUM,0)\\t\\t\\tV21570_c\\n      ,nvl(b.LROAM_IN_BILL_DUR,0)\\t\\t\\t\\tV22000\\n      ,nvl(b.LROAM_IN_NUM,0)\\t\\t\\t\\t\\tV22000_c\\n      ,nvl(b.LROAM_IN_CMC_BILL_DUR,0)\\t\\t\\tV22501\\n      ,nvl(b.LROAM_IN_CMC_NUM,0)\\t\\t\\t\\tV22501_c\\n      ,nvl(b.LROAM_IN_CRCC_FIX_BILL_DUR,0)\\t\\tV22502\\n      ,nvl(b.LROAM_IN_CRCC_FIX_NUM,0)\\t\\t\\tV22502_c\\n      ,nvl(b.LROAM_IN_CUC_CMC_BILL_DUR,0)\\t\\tV22503\\n      ,nvl(b.LROAM_IN_CUC_CMC_NUM,0)\\t\\t\\tV22503_c\\n      ,nvl(b.LROAM_IN_CUC_FIX_BILL_DUR,0)\\t\\tV22504\\n      ,nvl(b.LROAM_IN_CUC_FIX_NUM,0)\\t\\t\\tV22504_c\\n      ,nvl(b.LROAM_IN_CTC_CMC_BILL_DUR,0)\\t\\tV22505\\n      ,nvl(b.LROAM_IN_CTC_CMC_NUM,0)\\t\\t\\tV22505_c\\n      ,nvl(b.LROAM_IN_CTC_FIX_BILL_DUR,0)\\t\\tV22506\\n      ,nvl(b.LROAM_IN_CTC_FIX_NUM,0)\\t\\t\\tV22506_c\\n      ,nvl(b.LROAM_IN_OTHR_CARR_BILL_DUR,0)\\t\\tV22507\\n      ,nvl(b.LROAM_IN_OTHR_CARR_NUM,0)\\t\\t\\tV22507_c\\n      ,nvl(b.HMT_ROAM_BILL_DUR,0)\\t\\t\\t\\tV30000\\n      ,nvl(b.HMT_ROAM_NUM,0)\\t\\t\\t\\t\\tV30000_c\\n      ,nvl(b.HMT_ROAM_OUT_BILL_DUR,0)\\t\\t\\tV31000\\n      ,nvl(b.HMT_ROAM_OUT_NUM,0)\\t\\t\\tV31000_c\\n      ,nvl(b.HMT_ROAM_IN_BILL_DUR,0)\\t\\tV32000\\n      ,nvl(b.HMT_ROAM_IN_NUM,0)\\t\\t\\t\\tV32000_c\\n      ,nvl(b.INTER_ROAM_BILL_DUR,0)\\t\\t\\tV40000\\n      ,nvl(b.INTER_ROAM_NUM,0)\\t\\t\\t\\tV40000_c\\n      ,nvl(b.INTER_ROAM_OUT_BILL_DUR,0)\\t\\tV41000\\n      ,nvl(b.INTER_ROAM_OUT_NUM,0)\\t\\t\\tV41000_c\\n      ,nvl(b.INTER_ROAM_IN_BILL_DUR,0)\\t\\tV42000\\n      ,nvl(b.INTER_ROAM_IN_NUM,0)\\t\\t\\tV42000_c\\n      ,nvl(a.FORW_CALL_DUR,0)\\t\\t\\t\\tVO0001\\n      ,nvl(a.BUSY_CALL_DUR,0)\\t\\t\\t\\tVO0002\\n      ,nvl(a.IDLE_CALL_DUR,0)\\t\\t\\t\\tVO0003\\n      ,nvl(a.BILL_CALL_DUR,0)\\t\\t\\t\\tVO0004\\n      ,nvl(a.CALING_BILL_DUR,0)\\t\\t\\t\\tVO0006\\n      ,nvl(a.CALLED_BILL_DUR,0)\\t\\t\\t\\tVO0007\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.VO0008,0)\\t\\t\\t\\t\\t\\tVO0008*/\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0001\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0001_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0002\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0002_c\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.VS0003,0)\\t\\t\\t\\t\\tVS0003\\t*/\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.VS0003_c,0)\\t\\t\\t\\t\\tVS0003_c*/\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0004\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0004_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0005\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0005_c\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.VS0006,0)\\t\\t\\t\\t\\tVS0006\\t*/\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.VS0006_c,0)\\t\\t\\t\\t\\tVS0006_c*/\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0007\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0007_c\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.VS0008,0)\\t\\t\\t\\t\\tVS0008\\t*/\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t/*nvl(c.VS0008_c,0)\\t\\t\\t\\t\\tVS0008_c*/\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0009\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0009_1\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0009_1_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0009_2\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0009_2_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0009_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0010\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0010_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0011\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0011_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0012\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0012_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0013\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0013_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0014\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0014_1\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0014_1_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0014_2\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0014_2_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0014_c\\n      ,NULL\\t\\t\\t\\t\\t/*nvl(c.VS0015,0)\\t\\t\\t\\t\\tVS0015\\t*/\\n      ,NULL\\t\\t\\t\\t\\t/*nvl(c.VS0015_c,0)\\t\\t\\t\\t\\tVS0015_c*/\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0016\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0016_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0017\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0017_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0018\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0018_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0019\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0019_c\\n      ,NULL\\t\\t\\t\\t\\t/*nvl(c.VS0020,0)\\t\\t\\t\\t\\tVS0020\\t*/\\n      ,NULL\\t\\t\\t\\t\\t/*nvl(c.VS0020_c,0)\\t\\t\\t\\t\\tVS0020_c*/\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0021\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0021_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0022\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0022_1\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0022_1_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0022_2\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0022_2_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0022_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0023\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0023_c\\n      ,NULL\\t\\t\\t\\t/*nvl(c.VS0024,0)\\t\\t\\t\\t\\tVS0024\\t*/\\n      ,NULL\\t\\t\\t\\t/*nvl(c.VS0024_c,0)\\t\\t\\t\\t\\tVS0024_c*/\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0025\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0025_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0026\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0026_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0027\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0027_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0028\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0028_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0029\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0029_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0030\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tvs0030_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0031\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tvs0031_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0032\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tvs0032_c\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tVS0033\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\t\\tvs0033_c\\n      ,nvl(a.T_CALL_DUR,0)\\t\\t\\t\\t\\tVS0034\\n      ,nvl(a.T_CALL_NUM,0)\\t\\t\\t\\t\\tVS0034_c\\n      ,nvl(a.G_CALL_DUR,0)\\t\\t\\t\\t\\tVS0035\\n      ,nvl(a.G_CALL_NUM,0)\\t\\t\\t\\t\\tVS0035_c\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} t1\\n left join (select \\tphone_no,sum(CALL_DUR) CALL_DUR,sum(CALL_NUM) CALL_NUM,\\n\\t\\t\\t\\t\\tsum(FORW_CALL_DUR) FORW_CALL_DUR,sum(BUSY_CALL_DUR) BUSY_CALL_DUR,\\n\\t\\t\\t\\t\\tsum(IDLE_CALL_DUR) IDLE_CALL_DUR,sum(BILL_CALL_DUR) BILL_CALL_DUR,\\n\\t\\t\\t\\t\\tsum(T_CALL_DUR) T_CALL_DUR,sum(T_CALL_NUM) T_CALL_NUM,\\n\\t\\t\\t\\t\\tsum(G_CALL_DUR) G_CALL_DUR,sum(G_CALL_NUM) G_CALL_NUM,\\n\\t\\t\\t\\t\\tsum(CALING_BILL_DUR) CALING_BILL_DUR,sum(CALLED_BILL_DUR) CALLED_BILL_DUR \\n\\t\\t\\tfrom ${SOURCE_DWI_BEH_USE_VOC_USERTOT_MS_YYYYMM} group by phone_no) a \\n\\tON T1.PHONE_NO = A.PHONE_NO\\n left join (select \\t phone_no,sum(LOC_CALL_DUR) LOC_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALL_NUM) LOC_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_DUR) LOC_CALING_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_NUM) LOC_CALING_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_NO_TOLL_CALL_DUR) LOC_NO_TOLL_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_NO_TOLL_NUM) LOC_NO_TOLL_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_LAND_TOLL_CALL_DUR) LOC_LAND_TOLL_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_LAND_TOLL_NUM) LOC_LAND_TOLL_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_HMT_TOLL_CALL_DUR) LOC_HMT_TOLL_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_HMT_TOLL_NUM) LOC_HMT_TOLL_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_INTER_TOLL_CALL_DUR) LOC_INTER_TOLL_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_INTER_TOLL_NUM) LOC_INTER_TOLL_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CMC_CALL_DUR) LOC_CALING_CMC_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CMC_NUM) LOC_CALING_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CRCC_CALL_DUR) LOC_CALING_CRCC_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CRCC_NUM) LOC_CALING_CRCC_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CUC_CMC_CALL_DUR) LOC_CALING_CUC_CMC_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CUC_CMC_NUM) LOC_CALING_CUC_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CUC_FIX_CALL_DUR) LOC_CALING_CUC_FIX_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CUC_FIX_NUM) LOC_CALING_CUC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CTC_CMC_CALL_DUR) LOC_CALING_CTC_CMC_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CTC_CMC_NUM) LOC_CALING_CTC_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CTC_FIX_CALL_DUR) LOC_CALING_CTC_FIX_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_CTC_FIX_NUM) LOC_CALING_CTC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_OCARR_CALL_DUR) LOC_CALING_OCARR_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALING_OTHR_CARR_NUM) LOC_CALING_OTHR_CARR_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_BILL_DUR) LOC_CALLED_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_NUM) LOC_CALLED_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_LOC_BILL_DUR) LOC_CALLED_LOC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_LOC_NUM) LOC_CALLED_LOC_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_LAND_BILL_DUR) LOC_CALLED_LAND_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_LAND_NUM) LOC_CALLED_LAND_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_HMT_BILL_DUR) LOC_CALLED_HMT_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_HMT_NUM) LOC_CALLED_HMT_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_INTER_BILL_DUR) LOC_CALLED_INTER_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_INTER_NUM) LOC_CALLED_INTER_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CMC_BILL_DUR) LOC_CALLED_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CMC_NUM) LOC_CALLED_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CRCCFIX_BILL_DUR) LOC_CALLED_CRCCFIX_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CRCC_FIX_NUM) LOC_CALLED_CRCC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CUC_CMC_BILL_DUR) LOC_CALLED_CUC_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CUC_CMC_NUM) LOC_CALLED_CUC_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CUC_FIX_BILL_DUR) LOC_CALLED_CUC_FIX_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CUC_FIX_NUM) LOC_CALLED_CUC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CTC_CMC_BILL_DUR) LOC_CALLED_CTC_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CTC_CMC_NUM) LOC_CALLED_CTC_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CTC_FIX_BILL_DUR) LOC_CALLED_CTC_FIX_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_CTC_FIX_NUM) LOC_CALLED_CTC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_OCARR_BILL_DUR) LOC_CALLED_OCARR_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LOC_CALLED_OTHR_CARR_NUM) LOC_CALLED_OTHR_CARR_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_BILL_DUR) LROAM_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_NUM) LROAM_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_BILL_DUR) LROAM_OUT_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_NUM) LROAM_OUT_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_NO_TOLL_BILL_DUR ) LROAM_OUT_NO_TOLL_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_ROAMADDR_NUM) LROAM_OUT_ROAMADDR_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_LAND_TOLL_BILL_DUR) LROAM_OUT_LAND_TOLL_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_LAND_TOLL_NUM) LROAM_OUT_LAND_TOLL_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_HMT_TOLL_BILL_DUR) LROAM_OUT_HMT_TOLL_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_HMT_TOLL_NUM ) LROAM_OUT_HMT_TOLL_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_INTER_TOLL_BILL_DUR) LROAM_OUT_INTER_TOLL_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_INTER_TOLL_NUM) LROAM_OUT_INTER_TOLL_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CMC_BILL_DUR) LROAM_OUT_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CMC_NUM) LROAM_OUT_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CRCC_BILL_DUR) LROAM_OUT_CRCC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CRCC_NUM) LROAM_OUT_CRCC_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CUC_CMC_BILL_DUR) LROAM_OUT_CUC_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CUC_CMC_NUM) LROAM_OUT_CUC_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CUC_FIX_BILL_DUR) LROAM_OUT_CUC_FIX_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CUC_FIX_NUM) LROAM_OUT_CUC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CTC_CMC_BILL_DUR) LROAM_OUT_CTC_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CTC_CMC_NUM) LROAM_OUT_CTC_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CTC_FIX_BILL_DUR) LROAM_OUT_CTC_FIX_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_CTC_FIX_NUM) LROAM_OUT_CTC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_OTHR_CARR_BILL_DUR) LROAM_OUT_OTHR_CARR_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_OUT_OTHR_CARR_NUM) LROAM_OUT_OTHR_CARR_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_BILL_DUR) LROAM_IN_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_NUM) LROAM_IN_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CMC_BILL_DUR) LROAM_IN_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CMC_NUM) LROAM_IN_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CRCC_FIX_BILL_DUR ) LROAM_IN_CRCC_FIX_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CRCC_FIX_NUM) LROAM_IN_CRCC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CUC_CMC_BILL_DUR) LROAM_IN_CUC_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CUC_CMC_NUM ) LROAM_IN_CUC_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CUC_FIX_BILL_DUR) LROAM_IN_CUC_FIX_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CUC_FIX_NUM ) LROAM_IN_CUC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CTC_CMC_BILL_DUR) LROAM_IN_CTC_CMC_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CTC_CMC_NUM ) LROAM_IN_CTC_CMC_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CTC_FIX_BILL_DUR) LROAM_IN_CTC_FIX_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_CTC_FIX_NUM ) LROAM_IN_CTC_FIX_NUM\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_OTHR_CARR_BILL_DUR) LROAM_IN_OTHR_CARR_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(LROAM_IN_OTHR_CARR_NUM ) LROAM_IN_OTHR_CARR_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_ROAM_BILL_DUR ) HMT_ROAM_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_ROAM_NUM) HMT_ROAM_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_ROAM_OUT_BILL_DUR) HMT_ROAM_OUT_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_ROAM_OUT_NUM) HMT_ROAM_OUT_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_ROAM_IN_BILL_DUR ) HMT_ROAM_IN_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_ROAM_IN_NUM ) HMT_ROAM_IN_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_ROAM_BILL_DUR) INTER_ROAM_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_ROAM_NUM) INTER_ROAM_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_ROAM_OUT_BILL_DUR) INTER_ROAM_OUT_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_ROAM_OUT_NUM) INTER_ROAM_OUT_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_ROAM_IN_BILL_DUR ) INTER_ROAM_IN_BILL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_ROAM_IN_NUM ) INTER_ROAM_IN_NUM \\n\\t\\tfrom ${SOURCE_DWI_BEH_USE_VOC_ROAMTOT_MS_YYYYMM} group by phone_no) b on T1.PHONE_NO = b.PHONE_NO\\n /*left join ${TARGET_TMP_DM_AUTORPT_CALL}  c on T1.PHONE_NO = c.PRODUCT_NO*/\\n left join (select   phone_no,sum(LAND_TOLL_CALL_DUR) LAND_TOLL_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_CALL_NUM)            LAND_TOLL_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_IP_CALL_DUR)         LAND_TOLL_IP_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_IP_CALL_NUM)         LAND_TOLL_IP_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_17951_CALL_DUR)      LAND_TOLL_17951_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_17951_CALL_NUM)      LAND_TOLL_17951_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_17950_CALL_DUR)      LAND_TOLL_17950_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_17950_CALL_NUM)      LAND_TOLL_17950_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_12593_CALL_DUR)      LAND_TOLL_12593_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_12593_CALL_NUM)      LAND_TOLL_12593_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_NOIP_CALL_DUR)       LAND_TOLL_NOIP_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(LAND_TOLL_NOIP_CALL_NUM)       LAND_TOLL_NOIP_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_CALL_DUR)             HMT_TOLL_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_CALL_NUM)             HMT_TOLL_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_IP_CALL_DUR)          HMT_TOLL_IP_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_IP_CALL_NUM)          HMT_TOLL_IP_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_IP_17951_CALL_DUR)    HMT_TOLL_IP_17951_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_IP_17951_CALL_NUM)    HMT_TOLL_IP_17951_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_IP_17950_CALL_DUR)    HMT_TOLL_IP_17950_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_IP_17950_CALL_NUM)    HMT_TOLL_IP_17950_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_IP_12593_CALL_DUR)    HMT_TOLL_IP_12593_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_IP_12593_CALL_NUM)    HMT_TOLL_IP_12593_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_NOIP_CALL_DUR)        HMT_TOLL_NOIP_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(HMT_TOLL_NOIP_CALL_NUM)        HMT_TOLL_NOIP_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_CALL_DUR)           INTER_TOLL_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_CALL_NUM)           INTER_TOLL_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_IP_CALL_DUR)        INTER_TOLL_IP_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_IP_CALL_NUM)        INTER_TOLL_IP_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_IP_17951_CALL_DUR)  INTER_TOLL_IP_17951_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_IP_17951_CALL_NUM)  INTER_TOLL_IP_17951_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_IP_17950_CALL_DUR)  INTER_TOLL_IP_17950_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_IP_17950_CALL_NUM)  INTER_TOLL_IP_17950_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_IP_12593_CALL_DUR)  INTER_TOLL_IP_12593_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_IP_12593_CALL_NUM)  INTER_TOLL_IP_12593_CALL_NUM\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_NO_IP_CALL_DUR)     INTER_TOLL_NO_IP_CALL_DUR\\n\\t\\t\\t\\t\\t,sum(INTER_TOLL_NO_IP_CALL_NUM)     INTER_TOLL_NO_IP_CALL_NUM \\n\\t\\tfrom ${SOURCE_DWI_BEH_USE_VOC_TOLLTOT_MS_YYYYMM} group by phone_no) d  on T1.PHONE_NO = d.PHONE_NO\\n\\tleft join (select phone_no,sum(case when toll_type in(0,1,7) and CALL_TYPE='1' then call_dur end) V00100, /*拨打本地时长*/\\n                      sum(case when toll_type in(0,1,7) and CALL_TYPE='1'  THEN CALL_NUM end) V00100_c    /*拨打本地次数*/\\n        from ${SOURCE_DWD_EVT_CDR_VOC_BASETOT_MS_YYYYMM} group by  phone_no) e on T1.PHONE_NO = e.PHONE_NO\\n WHERE (t1.MONTH_ARRIVE_FLAG=1 or t1.MONTH_OFF_FLAG  =1) And t1.PROD_KIND_CODE=171000000001\\n -- (t1.ONNET_USER_FLAG=1 AND t1.PROD_KIND_CODE='171000000001') or t1.MONTH_OFF_FLAG =1"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [48]-[index:84]-[自助分析平台日指标视图日调度传输]-[20]-['str' object has no attribute 'lfind']:{"name":"同步sql","nodeId":"20","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_DAY_VIEW_${dayid} select *\\n from DM_AUTORPT_DAY_VIEW_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [49]-[index:85]-[自助分析平台日指标视图日调度传输]-[23]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"23","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_DAY_VIEW_${dayid} ;\\ncreate table DM_AUTORPT_DAY_VIEW_${dayid} distributed by ('PRODUCT_NO') as select * from DM_AUTORPT_DAY_VIEW_YYYYMMDD;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [50]-[index:89]-[产品订购调度传输]-[9]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据","nodeId":"9","sql":"drop table DM_PRODUCT_OFFER_DS_${dayid};\\ncreate table DM_PRODUCT_OFFER_DS_${dayid} distributed by ('product_no') as select * from DM_PRODUCT_OFFER_DS_${dayid}@dblink_dm;\\n\\ninsert into DIM_OFFER_TYPE_INCREASE (select * from DIM_OFFER_TYPE_INCREASE@dblink_dm);\\ninsert into dim_offer_type  (select * from dim_offer_type@dblink_dm);\\ninsert into dim_offer_bigtype  (select * from dim_offer_bigtype@dblink_dm);\\ninsert into dim_res_room (select * from dim_res_room@dblink_dm);\\ninsert into dim_res_county (select * from dim_res_county@dblink_dm);\\ninsert into dim_product_dept (select * from dim_product_dept@dblink_dm);\\ninsert into dim_product_channel (select * from dim_product_channel@dblink_dm);\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [51]-[index:92]-[产品订购调度传输]-[15]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"产品订购月表","nodeId":"15","sql":"drop table dm_product_offer_${pmonthid};\\ncreate table dm_product_offer_${pmonthid} distributed by ('product_no') as select * from dm_product_offer_${pmonthid}@dblink_dm;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [52]-[index:93]-[产品订购调度传输]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"清空表","nodeId":"8","sql":"\\ntruncate table  DIM_OFFER_TYPE_INCREASE;\\ntruncate table  dim_offer_type;\\ntruncate table  dim_offer_bigtype;\\ntruncate table  dim_res_room;\\ntruncate table  dim_product_channel;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [53]-[index:95]-[2014年月新增指标数据表月调度传输]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据","nodeId":"8","sql":"insert into DM_PUB_INCREASE_${monthid} select * from DM_PUB_INCREASE_${monthid}@dblink_dm;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [54]-[index:99]-[2014年月新增指标数据表月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"7.创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_INCREASE_${monthid};\\ncreate table DM_PUB_INCREASE_${monthid} distributed by('product_no')  as select * from DM_PUB_INCREASE_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [55]-[index:104]-[客户表--AUTORPT]-[15]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"15.插入数据到目标表","nodeId":"15","sql":"INSERT INTO ${TARGET_DM_AUTORPT_CUST_YYYYMM}\\n(\\tOP_TIME,\\n\\tSTATIS_MONTH,\\n\\tPRODUCT_NO,\\n\\tI0793,\\n\\tI0794,\\n\\tI0795,\\n\\tI0796,\\n\\tI0797,\\n\\tI0798,\\n\\tI0799,\\n\\tI0800,\\n\\tI0868,\\n\\tI0869,\\n\\tI0870,\\n\\tI0871,\\n\\tI0872,\\n\\tI0874,\\n        I0875\\t)\\nselect\\t'${curm_first_day}',\\n\\t\\t'${monthid}',\\n\\t\\tA.PHONE_NO,\\n\\t\\tnvl(B.VIP_SEG,0)\\tI0793,\\n\\t\\tnvl(C.SEX,0)\\t\\tI0794,\\n\\t\\tnvl(nvl(l.age,C.AGE),0)\\t\\t\\tI0795,\\n\\t\\tnvl(G.DEPT_COUNTY_ID,0)\\tI0796,\\n\\t\\tnvl(D.CUST_CATAGORY,0)\\t\\tI0797,\\n\\t\\tdate('${curmfirstday}')\\tI0798,\\n\\t\\tCASE WHEN H.PHONE_NO IS NOT NULL THEN 1 ELSE 0 END\\tAS I0799,\\n\\t\\tnvl(C.HIGH_VAL_USER_FLAG,0)\\t\\tI0800,\\n\\t\\tCASE WHEN E.PHONE_NO IS NOT NULL THEN 1 ELSE 0 END\\tAS I0868,\\n\\t\\tc.phone_no\\t\\t\\tI0869,\\n\\t\\ttrim(d.cust_name)\\t\\t\\tI0870,\\n\\t\\tdate('${curmfirstday}')\\t\\t\\tI0871,\\n\\t\\t0 \\t\\t\\t\\t\\tI0872,\\n\\t\\tF.GRP_MGR_ID\\t\\tI0874,\\n                 D.PARNT_GRP                    I0875\\t\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} A\\nleft join ${SOURCE_DWA_UV_USER_BASEINFO_MS_YYYYMM} B ON A.PHONE_NO=B.PHONE_NO\\nleft join ${SOURCE_DWI_USR_PESN_MS_YYYYMM} C ON A.PHONE_NO=C.PHONE_NO\\nLEFT JOIN ${SOURCE_DWI_USR_PESN_ALLCUST_MS_YYYYMM} D ON A.CUST_ID=D.CUST_ID\\nLEFT JOIN ${SOURCE_DWI_USR_PESN_HIGH_MS_YYYYMM} E ON A.PHONE_NO=trim(E.PHONE_NO)\\nLEFT JOIN ${SOURCE_DWI_USR_GRP_CUSTINFO_MS_YYYYMM} F ON A.CUST_ID=F.GRP_CUST_ID\\nleft join ${SOURCE_DWI_USR_PESN_PERSN_LOC_MS_YYYYMM} G ON A.PHONE_NO=G.PHONE_NO\\nleft join (select PHONE_NO from gbasedwi.DWI_USR_PESN_FREE_DISTURB_MM group by PHONE_NO) H ON A.PHONE_NO=H.PHONE_NO\\nleft join (select phone_no,\\n       case when length(use_no)=18 and substr(use_no,7,1) in ('1','2') \\n              and substr(use_no,8,1) in ('0','1','2','3','4','5','6','7','8','9') \\n              and substr(use_no,9,1) in ('0','1','2','3','4','5','6','7','8','9') \\n              and substr(use_no,10,1) in ('0','1','2','3','4','5','6','7','8','9') \\n             -- and substr(use_no,7,4) between '1910' and '2010' \\n              then timestampdiff(year,date(substr(use_no,7,8)),'${curm_last_day}')\\n          when length(use_no)=15 \\n              and substr(use_no,7,1) in ('0','1','2','3','4','5','6','7','8','9') \\n              and substr(use_no,8,1) in ('0','1','2','3','4','5','6','7','8','9') \\n              and substr(use_no,7,2) between '00' and '99' \\n              then timestampdiff(year,date('19'||substr(use_no,7,6)),'${curm_last_day}')\\n             else 0 end age\\nfrom (select phone_no,case when user_type='个人客户' then cust_no when user_type='单位客户' then use_no end use_no,\\n             case when user_type='个人客户' then cust_type when user_type='单位客户' then use_type end use_type \\n      from gbasedwi.dwi_usr_pesn_realname_base_ds_${curmlastday}\\nwhere user_type in ('个人客户','单位客户') and on_line_mark=1 and length(use_no) in (15,18))a\\nwhere use_no is not null and use_type='身份证'\\n)l on a.phone_no=l.phone_no\\n WHERE (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001\\n -- (A.ONNET_USER_FLAG=1 AND A.PROD_KIND_CODE='171000000001') or A.MONTH_OFF_FLAG =1;\\n \\n\\n\\n\\n\\n\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [56]-[index:106]-[竞争对手日视图调度传输]-[6]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"6.SQL语句","nodeId":"6","sql":"insert into DM_PUB_COMPETITOR_${dayid}\\nselect *\\nfrom DM_PUB_COMPETITOR_${dayid}@dblink_dm;\\n\\ndrop table dm.dim_COMPETITOR_grid;\\ncreate table dm.dim_COMPETITOR_grid\\nselect distinct grid_id,grid_name\\nfrom dim_pub_cell@dblink_dwd;\\n\\ndrop table dm.dim_COMPETITOR_REGIONAL;\\ncreate table dm.dim_COMPETITOR_REGIONAL\\nselect distinct REGIONAL_CENTER_ID,REGIONAL_CENTER_name\\nfrom dim_pub_cell@dblink_dwd;\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [57]-[index:109]-[竞争对手日视图调度传输]-[12]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"12.创建表","nodeId":"12","sql":"drop table DM_PUB_COMPETITOR_${dayid};\\ncreate table DM_PUB_COMPETITOR_${dayid} distributed by ('COMP_PRODUCT_NO') \\nas select * from DM_PUB_COMPETITOR_YYYYMMDD;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [58]-[index:113]-[位置智能区域维表]-[34]-['str' object has no attribute 'lfind']:{"name":"删除智能区域维表临时表(1)","nodeId":"34","dsName":"BIGDB","sql":"drop table if exists lop.dim_intelligent_area_tmp_1;\\ndrop table if exists lop.dim_intelligent_area_tmp_2;\\ndrop table if exists lop.dim_intelligent_area_tmp_3;\\ndrop table if exists lop.dim_intelligent_area_tmp_4;","parentDsName":"BIGDB"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [59]-[index:114]-[位置智能区域维表]-[35]-['str' object has no attribute 'lfind']:{"name":"创建智能区域维表临时表(3)","nodeId":"35","dsName":"BIGDB","sql":"create table if not exists  lop.dim_intelligent_area_tmp_1  ( \\n  \\"phone_no\\" varchar(20) default null, \\n  \\"imsi\\" varchar(30) default null,  \\n  \\"md5_imsi\\" varchar(50) default null,  \\n  \\"is_local\\" varchar(2) default null  \\n) compress(5, 5)  engine=express distributed by('phone_no') default charset=utf8 tablespace='sys_tablespace';\\n\\n\\ncreate table if not exists  lop.dim_intelligent_area_tmp_2 ( \\n  \\"phone_no\\" varchar(20) default null, \\n  \\"imsi\\" varchar(30) default null,  \\n  \\"md5_imsi\\" varchar(50) default null,  \\n  \\"is_local\\" varchar(2) default null  \\n) compress(5, 5)  engine=express distributed by('phone_no') default charset=utf8 tablespace='sys_tablespace';\\n\\n\\ncreate table if not exists  lop.dim_intelligent_area_tmp_3 ( \\n  \\"phone_no\\" varchar(20) default null, \\n  \\"imsi\\" varchar(30) default null,  \\n  \\"md5_imsi\\" varchar(50) default null,  \\n  \\"is_local\\" varchar(2) default null  \\n) compress(5, 5)  engine=express distributed by('phone_no') default charset=utf8 tablespace='sys_tablespace';\\n\\ncreate table if not exists lop.dim_intelligent_area_tmp_4 ( \\n  \\"phone_no\\" varchar(20) default null, \\n  \\"imsi\\" varchar(30) default null,  \\n  \\"md5_imsi\\" varchar(50) default null,  \\n  \\"is_local\\" varchar(2) default null  \\n) compress(5, 5)  engine=express distributed by('phone_no') default charset=utf8 tablespace='sys_tablespace';\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [60]-[index:115]-[位置智能区域维表]-[36]-['str' object has no attribute 'lfind']:{"name":"向智能区域维表临时表中插入当前智能区域维表数据(5)","nodeId":"36","dsName":"BIGDB","sql":"insert into lop.dim_intelligent_area_tmp_1 \\nselect * from lop.dim_intelligent_area;","parentDsName":"BIGDB"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [61]-[index:116]-[位置智能区域维表]-[37]-['str' object has no attribute 'lfind']:{"name":"向今日智能区域维表临时表中插入北京本地用户数据(7)","nodeId":"37","dsName":"BIGDB","sql":"insert into lop.dim_intelligent_area_tmp_2\\n select t1.phone_no \\n       ,t1.imsi \\n\\t   ,md5(t1.imsi) as md5_imsi   \\n\\t   ,'1' as is_local\\n\\t from \\n   (select imsi, \\n\\t\\t   right(phone_no,11) phone_no,\\n\\t\\t   row_number() over (partition by left(imsi,15) order by acpt_date desc) rn\\n\\t\\tfrom gbasedwd.dwd_res_svc_sim_ds_${dayid} \\n\\t   where phone_no is not null\\n\\t\\t and phone_no <> ''\\n\\t\\t and imsi is not null\\n\\t\\t and imsi <> ''\\n\\t\\t and length(phone_no)=11 and mang_state=5 and is_use=1 ) t1 \\n where t1.rn =1 \\n group by t1.phone_no,t1.imsi,md5(t1.imsi);","parentDsName":"BIGDB"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [62]-[index:117]-[位置智能区域维表]-[38]-['str' object has no attribute 'lfind']:{"name":"向智能区域维表中插入累计用户数据(15)","nodeId":"38","dsName":"BIGDB","sql":"drop table lop.dim_intelligent_area;\\nrename table lop.dim_intelligent_area_01 to lop.dim_intelligent_area;","parentDsName":"BIGDB"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [63]-[index:118]-[位置智能区域维表]-[39]-['str' object has no attribute 'lfind']:{"name":"向临时表中插入数据(13)","nodeId":"39","dsName":"BIGDB","sql":"create table if not exists lop.dim_intelligent_area_01 ( \\n  \\"phone_no\\" varchar(20) default null, \\n  \\"imsi\\" varchar(30) default null,  \\n  \\"md5_imsi\\" varchar(50) default null,  \\n  \\"is_local\\" varchar(2) default null  \\n) compress(5, 5)  engine=express distributed by('phone_no') default charset=utf8 tablespace='sys_tablespace';\\n\\ninsert into lop.dim_intelligent_area_01 \\nselect a.phone_no,a.imsi,a.md5_imsi,a.is_local \\nfrom \\n(select * from lop.dim_intelligent_area_tmp_1 \\nunion \\nselect * from lop.dim_intelligent_area_tmp_2\\nunion \\nselect * from lop.dim_intelligent_area_tmp_4) a\\ngroup by  a.phone_no,a.imsi,a.md5_imsi,a.is_local ; ","parentDsName":"BIGDB"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [64]-[index:119]-[位置智能区域维表]-[40]-['str' object has no attribute 'lfind']:{"name":"剔除部分号段(11)","nodeId":"40","dsName":"BIGDB","sql":"insert into lop.dim_intelligent_area_tmp_4 \\nselect a.phone_no,a.imsi,a.md5_imsi,a.is_local \\nfrom lop.dim_intelligent_area_tmp_3 a \\ninner join \\n(select distinct left(segment,3) as phone_3 from gbasedwd.dim_pub_call_msisdn_prefix ) b \\non left(a.phone_no,3) = b.phone_3 \\nwhere b.phone_3 not in (106,147,010)\\ngroup by  a.phone_no,a.imsi,a.md5_imsi,a.is_local ;\\n ","parentDsName":"BIGDB"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [65]-[index:120]-[位置智能区域维表]-[41]-['str' object has no attribute 'lfind']:{"name":"向智能区域维表临时表中插入当月来访的旅游、途径北京用户的数据(9)","nodeId":"41","dsName":"BIGDB","sql":"insert into lop.dim_intelligent_area_tmp_3\\nselect phone_no, \\n       imsi, \\n\\t   md5(imsi) as md5_imsi, \\n\\t   '0' as is_local \\n\\tfrom gbasedwd.dwd_evt_sttl_gprs_iroam_dm_${monthid}\\nwhere length(phone_no)=11 \\n      and srctype_id = 322\\n\\tgroup by phone_no,imsi,md5_imsi,is_local;\\n\\n\\ninsert into lop.dim_intelligent_area_tmp_3\\n select t1.phone_no \\n       ,t1.imsi \\n\\t   ,md5(t1.imsi) as md5_imsi   \\n\\t   ,'0' as is_local\\n\\t from \\n   (select imsi, \\n\\t\\t   right(phone_no,11) phone_no,\\n\\t\\t   row_number() over (partition by left(imsi,15) order by stat_date desc) rn\\n\\t\\tfrom gbasedwd.dwd_evt_sttl_voc_roamin_dm_${monthid}\\n\\t   where phone_no is not null\\n\\t\\t and phone_no <> ''\\n\\t\\t and imsi is not null\\n\\t\\t and imsi <> ''\\n\\t\\t and length(phone_no)=11 \\n\\t\\t and left(imei,15) REGEXP '^[0-9]+$' \\n\\t\\t and srctype_id in (301,303) ) t1 \\n where t1.rn =1 \\n group by t1.phone_no,t1.imsi,md5(t1.imsi);","parentDsName":"BIGDB"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [66]-[index:125]-[账务数据（日指标）]-[91]-['str' object has no attribute 'lfind']:{"name":"临时表1的插入","nodeId":"91","dsName":"GbaseDM","sql":" insert into TMP1_DM_PUB_ACCT\\n\\t(\\n\\t\\tOP_TIME            ,\\n\\t\\tSTATIS_DATE        ,\\n\\t\\tPRODUCT_NO         ,\\n\\t\\tD_AC_001            ,\\n\\t\\tD_AC_002            ,\\n\\t\\tD_AC_003            ,\\n\\t\\tD_AC_004            ,\\n\\t\\tD_AC_005            ,\\n\\t\\tD_AC_006            ,\\n\\t\\tD_AC_007            ,\\n\\t\\tD_AC_008            ,\\n\\t\\tD_AC_009            ,\\n\\t\\tD_AC_010            ,\\n\\t\\tD_AC_011            ,\\n\\t\\tD_AC_012            ,\\n\\t\\tD_AC_013            ,\\n\\t\\tD_AC_014            ,\\n\\t\\tD_AC_015            ,\\n\\t\\tD_AC_016            ,\\n\\t\\tD_AC_017            ,\\n\\t\\tD_AC_018                 \\n\\t)\\n\\t\\n\\tselect to_date('${dayid}','YYYYMMDD') as op_time,        \\n         ${dayid}  as STAT_DATE,\\n         PHONE_NO ,  \\n          Sum(a.MT_SHOULD_INCOME),\\n\\t\\tSum(Case When b.TYPE_NAME = '本地通话费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '漫游通话费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '普通国内长途费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '普通港澳台长途费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '普通国际长途费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = 'IP国内长途费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = 'IP港澳台长途费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = 'IP国际长途费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '话音增值业务收入' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '短信数据业务收入' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '非短信数据业务收入' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = 'CMNET业务收入' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '其他数据业务收入' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '月租费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '套餐月租费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '信息费' Then a.MT_SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME is Null Then a.MT_SHOULD_INCOME Else 0 End)\\n\\tFrom gbasedwi.DWI_INCO_BILL_ITEM_TOT_DS_${dayid}   a \\n        Left Outer Join gbasedwd.dim_rpt_general_sheet1 b On a.ACCT_ITEM_ID = b.Charge_Code\\n\\tGroup By phone_no\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [67]-[index:126]-[账务数据（日指标）]-[93]-['str' object has no attribute 'lfind']:{"name":"93.目标表数据的插入","nodeId":"93","dsName":"GbaseDM","sql":" insert into ${DM_PUB_ACCT_YYYYMMDD}\\n\\t(\\n\\t\\tOP_TIME            ,\\n\\t\\tSTATIS_DATE        ,\\n\\t\\tPRODUCT_NO         ,\\n\\t\\tD_AC_001           ,\\n\\t\\tD_AC_002           ,\\n\\t\\tD_AC_003           ,\\n\\t\\tD_AC_004           ,\\n\\t\\tD_AC_005           ,\\n\\t\\tD_AC_006           ,\\n\\t\\tD_AC_007           ,\\n\\t\\tD_AC_008           ,\\n\\t\\tD_AC_009           ,\\n\\t\\tD_AC_010           ,\\n\\t\\tD_AC_011           ,\\n\\t\\tD_AC_012           ,\\n\\t\\tD_AC_013           ,\\n\\t\\tD_AC_014           ,\\n\\t\\tD_AC_015           ,\\n\\t\\tD_AC_016           ,\\n\\t\\tD_AC_017           ,\\n\\t\\tD_AC_018           ,\\n\\t\\tD_AC_019           ,\\n\\t\\tD_AC_020           ,\\n\\t\\tD_AC_021           ,\\n\\t\\tD_AC_022           ,\\n\\t\\tD_AC_023           ,\\n\\t\\tD_AC_024           ,\\n\\t\\tD_AC_025           ,\\n\\t\\tD_AC_026           ,\\n\\t\\tD_AC_027           ,\\n\\t\\tD_AC_028           ,\\n\\t\\tD_AC_029           ,\\n\\t\\tD_AC_030           ,\\n\\t\\tD_AC_031           ,\\n\\t\\tD_AC_032           ,\\n\\t\\tD_AC_033           ,\\n\\t\\tD_AC_034           ,\\n\\t\\tD_AC_035           ,\\n\\t\\tD_AC_036           ,\\n\\t\\tD_AC_037           ,\\n\\t\\tD_AC_038           ,\\n\\t\\tD_AC_039           ,\\n\\t\\tD_AC_040           ,\\n\\t\\tD_AC_041           ,\\n\\t\\tD_AC_042           ,\\n\\t\\tD_AC_043           ,\\n\\t\\tD_AC_044           ,\\n\\t\\tD_AC_045           ,\\n\\t\\tD_AC_046           ,\\n\\t\\tD_AC_047           ,\\n\\t\\tD_AC_048           ,\\n\\t\\tD_AC_049           ,\\n\\t\\tD_AC_050\\n\\t)\\n\\nselect\\n    a.STAT_DATE,\\n    ${dayid} as STAT_DATE,\\n    a.PHONE_NO ,\\n    nvl(cast(b.D_AC_001 as decimal(12,2)),0)  as D_AC_001      ,\\n    nvl(b.D_AC_002,0)  as D_AC_002      ,\\n    nvl(b.D_AC_003,0)  as D_AC_003      ,\\n    nvl(b.D_AC_004,0)  as D_AC_004      ,\\n    nvl(b.D_AC_005,0)  as D_AC_005      ,\\n    nvl(b.D_AC_006,0)  as D_AC_006      ,\\n    nvl(b.D_AC_007,0)  as D_AC_007      ,\\n    nvl(b.D_AC_008,0)  as D_AC_008      ,\\n    nvl(b.D_AC_009,0)  as D_AC_009      ,\\n    nvl(b.D_AC_010,0)  as D_AC_010      ,\\n    nvl(b.D_AC_011,0)  as D_AC_011      ,\\n    nvl(b.D_AC_012,0)  as D_AC_012      ,\\n    nvl(b.D_AC_013,0)  as D_AC_013      ,\\n    nvl(b.D_AC_014,0)  as D_AC_014      ,\\n    nvl(b.D_AC_015,0)  as D_AC_015      ,\\n    nvl(b.D_AC_016,0)  as D_AC_016      ,\\n    nvl(b.D_AC_017,0)  as D_AC_017      ,\\n    nvl(b.D_AC_018,0)  as D_AC_018      ,\\n    0,#nvl(d.D_AC_019,0)  as D_AC_019      ,\\n    0,#nvl(d.D_AC_020,0)  as D_AC_020      ,\\n    nvl(t2.TOTAL_RCHRG_FUND    ,0) as D_AC_021   ,\\n    nvl(c.SELF_RCHRG_FUND     ,0) as D_AC_022   ,\\n    nvl(c.SYS_RCHRG_FUND      ,0) as D_AC_023   ,\\n    nvl(c.PAY_CARD_RCHRG_AMT  ,0) as D_AC_024   ,\\n    nvl(c.BANK_REPLE_CHARGE   ,0) as D_AC_025   ,\\n    nvl(c.BANK_INSTD_AMT      ,0) as D_AC_026   ,\\n    nvl(c.HALL_PAY_AMT        ,0) as D_AC_027   ,\\n    nvl(c.AIR_RCHRG_AMT       ,0) as D_AC_028   ,\\n    nvl(c.OWG_GATW_RCHRG      ,0) as D_AC_029   ,\\n    nvl(c.NET_RCHRG_PAY_AMT   ,0) as D_AC_030   ,\\n    nvl(c.SSTM_PAY_AMT        ,0) as D_AC_031   ,\\n    nvl(c.CBOSS_PAY           ,0) as D_AC_032   ,\\n    nvl(c.MOBPAY_PAY_AMT      ,0) as D_AC_033   ,\\n    nvl(c.SMALL_AMT_RCHRG     ,0) as D_AC_034   ,\\n    nvl(c.ACTV_PRISE_RCHRG    ,0) as D_AC_035   ,\\n    nvl(t2.TOTAL_RCHRG_NUM     ,0) as D_AC_036   ,\\n    nvl(c.SELF_RCHRG_NUM      ,0) as D_AC_037   ,\\n    nvl(c.SYS_RCHRG_NUM       ,0) as D_AC_038   ,\\n    nvl(c.PAY_CARD_RCHRG_NUM  ,0) as D_AC_039   ,\\n    nvl(c.AIR_RCHRG_NUM       ,0) as D_AC_040   ,\\n    nvl(c.HALL_PAY_NUM        ,0) as D_AC_041   ,\\n    nvl(c.NET_RCHRG_PAY_NUM   ,0) as D_AC_042   ,\\n    nvl(c.SSTM_PAY_NUM        ,0) as D_AC_043   ,\\n    NULL /*nvl(d.TOTAL_OWE_AMT,0)           as D_AC_044 */   ,\\n    null  as D_AC_045           ,\\n    null  as D_AC_046           ,\\n    null  as D_AC_047           ,\\n    null  as D_AC_048           ,\\n    null  as D_AC_049           ,\\n    null  as D_AC_050\\n from gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid}    a\\n left join (select phone_no,count(distinct pay_recd_id)TOTAL_RCHRG_NUM,sum(pay_amt)*0.01 as TOTAL_RCHRG_FUND\\n            from gbasedwd.dwd_acc_rchrg_flag_new_ds_${dayid} where stat_date<='${day_id}' \\n\\t\\t\\tgroup by phone_no) t2 on a.PHONE_NO=t2.PHONE_NO\\n left join TMP1_DM_PUB_ACCT  b\\n         on a.PHONE_NO = b.PRODUCT_NO\\n/* left join TMP2_DM_PUB_ACCT  d\\n         on a.phone_no=d.product_no*/\\n left join ( select PHONE_NO          ,\\n                    sum(TOTAL_RCHRG_FUND    )  as  TOTAL_RCHRG_FUND    ,\\n                    sum(SELF_RCHRG_FUND     )  as  SELF_RCHRG_FUND     ,\\n                    sum(SYS_RCHRG_FUND      )  as  SYS_RCHRG_FUND      ,\\n                    sum(PAY_CARD_RCHRG_AMT  )  as  PAY_CARD_RCHRG_AMT  ,\\n                    sum(BANK_REPLE_CHARGE   )  as  BANK_REPLE_CHARGE   ,\\n                    sum(BANK_INSTD_AMT      )  as  BANK_INSTD_AMT      ,\\n                    sum(HALL_PAY_AMT        )  as  HALL_PAY_AMT        ,\\n                    sum(AIR_RCHRG_AMT       )  as  AIR_RCHRG_AMT       ,\\n                    sum(OWG_GATW_RCHRG      )  as  OWG_GATW_RCHRG      ,\\n                    sum(NET_RCHRG_PAY_AMT   )  as  NET_RCHRG_PAY_AMT   ,\\n                    sum(SSTM_PAY_AMT        )  as  SSTM_PAY_AMT        ,\\n                    sum(CBOSS_PAY           )  as  CBOSS_PAY           ,\\n                    sum(MOBPAY_PAY_AMT      )  as  MOBPAY_PAY_AMT      ,\\n                    sum(SMALL_AMT_RCHRG     )  as  SMALL_AMT_RCHRG     ,\\n                    sum(ACTV_PRISE_RCHRG    )  as  ACTV_PRISE_RCHRG    ,\\n                    sum(TOTAL_RCHRG_NUM     )  as  TOTAL_RCHRG_NUM     ,\\n                    sum(SELF_RCHRG_NUM      )  as  SELF_RCHRG_NUM      ,\\n                    sum(SYS_RCHRG_NUM       )  as  SYS_RCHRG_NUM       ,\\n                    sum(PAY_CARD_RCHRG_NUM  )  as  PAY_CARD_RCHRG_NUM  ,\\n                    sum(AIR_RCHRG_NUM       )  as  AIR_RCHRG_NUM       ,\\n                    sum(HALL_PAY_NUM        )  as  HALL_PAY_NUM        ,\\n                    sum(NET_RCHRG_PAY_NUM   )  as  NET_RCHRG_PAY_NUM   ,\\n                    sum(SSTM_PAY_NUM        )  as  SSTM_PAY_NUM\\n          from   gbasedwi.DWI_INCO_USERPAY_INDI_DT_${monthid}\\n          where stat_date between '${curm_first_day}' and '${day_id}'\\n          group by phone_no ) c\\n          on a.PHONE_NO =trim( c.PHONE_NO)\\n/* left join gbasedwi.DWI_INCO_OWE_ITEM_TOT_DS_${dayid}  d\\n         on a.PHONE_NO = d.PHONE_NO */\\n   where PROD_KIND_CODE= 171000000001 And (MONTH_ARRIVE_FLAG = 1 or MONTH_OFF_FLAG = 1 or MONTH_NEW_FLAG = 1)","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [68]-[index:127]-[账务数据（日指标）]-[88]-['str' object has no attribute 'lfind']:{"name":"临时表1的创建","nodeId":"88","dsName":"GbaseDM","sql":"drop table TMP1_DM_PUB_ACCT;\\ncreate table  TMP1_DM_PUB_ACCT\\n( OP_TIME       date             ,    \\n  STATIS_DATE   varchar(10)      ,    \\n  PRODUCT_NO    varchar(20)      ,    \\n  D_AC_001      decimal(12,2)    ,   \\n  D_AC_002      decimal(12,2)      ,   \\n  D_AC_003      decimal(12,2)      ,   \\n  D_AC_004      decimal(12,2)      ,   \\n  D_AC_005      decimal(12,2)      ,   \\n  D_AC_006      decimal(12,2)      ,   \\n  D_AC_007      decimal(12,2)      ,   \\n  D_AC_008      decimal(12,2)      ,   \\n  D_AC_009      decimal(12,2)      ,   \\n  D_AC_010      decimal(12,2)      ,   \\n  D_AC_011      decimal(12,2)      ,   \\n  D_AC_012      decimal(12,2)      ,   \\n  D_AC_013      decimal(12,2)      ,   \\n  D_AC_014      decimal(12,2)      ,   \\n  D_AC_015      decimal(12,2)      ,   \\n  D_AC_016      decimal(12,2)      ,   \\n  D_AC_017      decimal(12,2)      ,   \\n  D_AC_018       decimal(12,2)        )  distributed by ('PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [69]-[index:128]-[2015年5月新增日累计指标日累计调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_20150512_${dayid}\\nselect * from DM_PUB_20150512_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [70]-[index:133]-[2015年5月新增日累计指标日累计调度传输]-[7]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"7.创建表","nodeId":"7","sql":"drop table DM_PUB_20150512_${dayid};\\ncreate table DM_PUB_20150512_${dayid} distributed by ('product_no') \\nas select * from DM_PUB_20150512_YYYYMMDD;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [71]-[index:134]-[客服表--DM_AUTORPT_CS_YYYYMM]-[58]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"58.13","nodeId":"58","sql":"drop table dm.tmp_DM_AUTORPT_CS_13_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_13_${monthid}\\n(product_no varchar(20),\\n user_id    varchar(20),\\njif_bt_fee   decimal(13,2),   -- 积分保拓出账收入\\nmy_no_jif_bt_fee   decimal(13,2),   -- 当月折后应收收入（不含积分保拓）\\nms_no_jif_bt_fee   decimal(13,2),   -- 当月折后实收收入（不含积分保拓）\\nmigu_fee   decimal(13,2)   -- 咪咕视频包出账收入\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_13_${monthid}\\nselect distinct a.phone_no,\\n       a.user_id,\\n       nvl(b.jif_bt_fee,0),\\n\\t   nvl(c.MINUS_FEE,0)-nvl(b.jif_bt_fee,0),\\n\\t   nvl(c.fee014,0)-nvl(b.jif_bt_fee,0),\\n\\t   nvl(b.migu_fee,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select phone_no,sum(SHOULD_INCOME) should_income,\\n                  sum(case when ACCT_ITEM_ID in ('20029','20004','20005','20034','20038','20098','20149','20170','20383','20427','20535','20570') then SHOULD_INCOME end) jif_bt_fee,\\n                  sum(case when ACCT_ITEM_ID in ('20029') then SHOULD_INCOME end) migu_fee\\n           from gbasedwi.dwi_inco_bill_item_tot_ms_${monthid}\\n           group by phone_no)b on a.phone_no=b.phone_no\\nleft join dm.DM_AUTORPT_HIS_INDEX_${monthid} c on a.phone_no=c.product_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [72]-[index:137]-[客服表--DM_AUTORPT_CS_YYYYMM]-[62]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"62.15","nodeId":"62","sql":"drop table dm.tmp_DM_AUTORPT_CS_15_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_15_${monthid}\\n(product_no varchar(20),\\nmsm_should_fee  decimal(20,4),  -- 新增个人市场收入\\nmsm_this_fee    decimal(20,4),   -- 预付费欠费（含收回）\\nmsm_zhk_fee     decimal(20,4),  -- 新增折扣折让2020\\nmsm_settle_FEE   decimal(20,4)  -- 新增网内结算支出\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_15_${monthid}\\nselect distinct a.phone_no,\\n       nvl(b.should_fee,0),\\n\\t   nvl(b.owe_fee,0),\\n\\t   nvl(b.disc_fee,0),\\n\\t   nvl(b.settle_fee,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select phone_no,should_fee,owe_fee,disc_fee,settle_fee \\n           from gbasemsm.msm_dw_basekpi_pesn_disc_${monthid}\\n           where left(innet_date,4)='${year}'\\n          )b on a.phone_no=b.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [73]-[index:138]-[客服表--DM_AUTORPT_CS_YYYYMM]-[8]-['str' object has no attribute 'lfind']:{"name":"8.删除目标表","nodeId":"8","dsName":"GbaseDM","sql":"DROP TABLE ${SOURCE_TMP_DM_AUTORPT_CS_01};\\nDROP TABLE ${SOURCE_TMP_DM_AUTORPT_CS_02};\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [74]-[index:140]-[客服表--DM_AUTORPT_CS_YYYYMM]-[19]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"19.插入数据到临时表2","nodeId":"19","sql":"insert into ${SOURCE_TMP_DM_AUTORPT_CS_02}\\n(\\tphone_no \\t           \\n    ,I0622\\t               \\n    ,total_score_0\\t       \\n    ,pay_self_service_count \\n    ,pay_web_count          \\n    ,LOGINWEB_COUNTS        \\n    ,contact_mtoivr_count_1 \\n    ,CONTACT_WEB_LOGIN_COUNT_1     \\n\\t,CONTACT_SMS_CONTACT_COUNT_1   \\n\\t,contact_manual_service_count_1\\n\\t,contact_ivr_contact_count_1   \\n\\t,contact_mtoivr_count          \\n\\t,contact_web_login_count       \\n\\t,contact_web_register_status_id\\n\\t,CONTACT_SMS_CONTACT_COUNT     \\n    ,CONTACT_MANUAL_SERVICE_COUNT  \\n    ,CONTACT_IVR_CONTACT_COUNT     \\n    ,use_10086ivr_query_charge_cnt \\n    ,use_sms_query_charge_count    \\n    ,use_wap_query_charge_count    \\n    ,USE_SELF_SERV_QUERY_CHARGE_CNT\\n    ,use_web_query_charge_count   )\\nselect PHONE_NO,\\n  sum(I0622)  I0622,\\n  sum(TOTAL_SCORE_0) TOTAL_SCORE_0,\\n  sum(pay_self_service_count)  pay_self_service_count,     \\n  sum(pay_web_count)     pay_web_count,       \\n  sum(LOGINWEB_COUNTS)   LOGINWEB_COUNTS,               \\n  sum(contact_mtoivr_count_1)    contact_mtoivr_count_1,         \\n  sum(CONTACT_WEB_LOGIN_COUNT_1) CONTACT_WEB_LOGIN_COUNT_1,      \\n  sum(CONTACT_SMS_CONTACT_COUNT_1) CONTACT_SMS_CONTACT_COUNT_1,    \\n  sum(contact_manual_service_count_1)  contact_manual_service_count_1,\\n  sum(contact_ivr_contact_count_1)    contact_ivr_contact_count_1,\\n  sum(contact_mtoivr_count) contact_mtoivr_count,    \\n  sum(contact_web_login_count)        contact_web_login_count,         \\n  max(contact_web_register_status_id) contact_web_register_status_id,\\n  sum(CONTACT_SMS_CONTACT_COUNT)      CONTACT_SMS_CONTACT_COUNT,    \\n  sum(CONTACT_MANUAL_SERVICE_COUNT) CONTACT_MANUAL_SERVICE_COUNT,\\n  sum(CONTACT_IVR_CONTACT_COUNT)   CONTACT_IVR_CONTACT_COUNT,\\n  sum(use_10086ivr_query_charge_cnt) use_10086ivr_query_charge_cnt,   \\n  sum(use_sms_query_charge_count)   use_sms_query_charge_count,    \\n  sum(use_wap_query_charge_count)   use_wap_query_charge_count,    \\n  sum(USE_SELF_SERV_QUERY_CHARGE_CNT) USE_SELF_SERV_QUERY_CHARGE_CNT,\\n  sum(use_web_query_charge_count)   use_web_query_charge_count  \\n from ${SOURCE_TMP_DM_AUTORPT_CS_01} group by PHONE_NO;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [75]-[index:141]-[客服表--DM_AUTORPT_CS_YYYYMM]-[69]-['str' object has no attribute 'lfind']:{"name":"69.17","nodeId":"69","dsName":"GbaseDM","sql":"drop table dm.tmp_DM_AUTORPT_CS_17_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_17_${monthid}\\n(product_no varchar(20),\\nIS_ROLL_TOTUSE_RES_NUM    int,   -- 是否有结转流量\\nGN_ROLL_TOTUSE_RES_NUM   decimal(20,2),  -- 结转流量中国内通用流量（M）\\nGN_ROLL_USE_RES_NUM  decimal(20,2),  -- 结转流量中国内通用流量使用量（M）\\nvotel_total_flow   decimal(20,2) -- volte流量\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_17_${monthid}\\nselect distinct a.phone_no,\\n       case when nvl(b.ROLL_TOTUSE_RES_NUM,0)>0 then 1 else 0 end,\\n\\t   round(nvl(b.GN_ROLL_TOTUSE_RES_NUM,0),2),\\n\\t   round(nvl(b.GN_ROLL_USE_RES_NUM,0),2),\\n\\t   nvl(c.total_flow,0) votel_total_flow\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select phone_no,\\n                  sum(ROLL_TOTUSE_RES_NUM)/1024/1024 as ROLL_TOTUSE_RES_NUM,\\n\\t\\t\\t\\t  sum(case when use_type='国内通用流量' then ROLL_USE_RES_NUM else 0 end)/1024/1024 as GN_ROLL_USE_RES_NUM,\\n\\t\\t\\t\\t  sum(case when use_type='国内通用流量' then ROLL_TOTUSE_RES_NUM else 0 end)/1024/1024 as GN_ROLL_TOTUSE_RES_NUM\\n           from gbasedwi.dwi_inco_bill_freeres_ms_${monthid}\\n           where res_unit=1024 group by phone_no)b on a.phone_no=b.phone_no\\nleft join (select phone_no,round(sum(total_flow)/1024/1024,2) total_flow\\n           from gbasedwd.dwd_evt_cdr_gprs_busitypetot_ms_${monthid}\\n           where nvl(apn_net_id,'')='IMS' and content_bill_id in ('1050000003','1050000004','1050000005','999999') \\n           and net_type=6\\n\\t\\t   group by phone_no)c on a.phone_no=c.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [76]-[index:142]-[客服表--DM_AUTORPT_CS_YYYYMM]-[81]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"81.21","nodeId":"81","sql":"drop table dm.tmp_DM_AUTORPT_CS_21_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_21_${monthid}\\n(product_no varchar(20),\\nis_tongxin_yj  int,   -- 是否通信客户（一经通报口径）\\nis_tongxin_mnyj  int,   -- 是否通信客户（模拟一经口径）\\nis_chuzhang_mnyj  int,    -- 是否出账客户（模拟一经口径）\\nis_5g_jtwpp_county  int,  -- 是否是5G机套网匹配客户（分公司）\\nis_2021pz_jz_user  int,  -- 2021年价值拍照客户\\narpu_2021pz_jz    decimal(20,2),  -- 2021年价值拍照客户拍照期ARPU\\nis_wlw_yj  int,     -- 是否为物联网卡用户（一经口径）\\ndou_yj     decimal(20,8)    -- 是否DOU（一经口径）\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_21_${monthid} \\nselect distinct a.phone_no,\\n\\t   case when e.msisdn is not null then 1 else 0 end,\\n\\t   case when f.msisdn is not null then 1 else 0 end,\\n\\t   case when b.user_id is not null then 1 else 0 end,\\n\\t   case when c.phone_no is not null then 1 else 0 end,\\n\\t   case when d.phone_no is not null then 1 else 0 end,\\n\\t   nvl(d.snapshot_income,0)/100*1.0,\\n       case when e1.msisdn is not null then 1 else 0 end,\\n       nvl(f1.dou,0) \\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select distinct msisdn from gbasemsm.msm_dw_basekpi_110852_detail_${curmlastday})e on a.phone_no=e.msisdn\\nleft join (select distinct msisdn from gbasemsm.msm_dw_basekpi_110810_detail_${curmlastday})f on a.phone_no=f.msisdn\\nleft join (select distinct  a.user_id  \\n\\t from(\\n            select distinct  user_id \\n\\t\\t\\tfrom gbasebas.int_03004_ms_${monthid}\\n            where statis_month='${monthid}'\\n            union all\\n            select distinct SUBCARD_USERID user_id \\n\\t\\t\\tfrom  gbasebas.tb_stat_02141\\n            where eff_dt<='${curm_last_day}' and end_dt>'${curm_last_day}'  and  unbind_date>'${curmlastday}'\\n)a\\nleft join gbasebas.int_22012_internetthing_${curmlastday}  b on a.user_id=b.user_id\\nwhere b.user_id is null) b on a.user_id=b.user_id\\nleft join (select distinct phone_no from gbasemsm.msm_dw_basekpi_111098_detail_${monthid})c on a.phone_no=c.phone_no\\nleft join (select distinct phone_no,snapshot_income from gbasemsm.msm_dw_basekpi_111189_snapshot_2020 where flag=1)d on a.phone_no=d.phone_no\\nleft join (select distinct msisdn,user_id from gbasebas.int_22012_internetthing_${curmlastday}) e1 on a.phone_no=e1.msisdn\\nleft join (select  msisdn ,sum(flow_up+flow_down)/1024/1024  dou \\n           from (select  msisdn ,flow_up,flow_down  from gbasebas.int_04002_DT_${monthid}  -- 此处为当天，则为日累计DOU，此为为月末，为月累计DOU， 原单位为byte，\\n                 union all\\n                 select   msisdn ,flow_up,flow_down from gbasebas.int_04024_DT_${monthid}\\n                 union all\\n                 select   msisdn ,flow_up,flow_down from gbasebas.int_04038_DT_${monthid}\\n                )a \\n            group by 1) f1 on a.phone_no=f1.msisdn\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [77]-[index:143]-[客服表--DM_AUTORPT_CS_YYYYMM]-[56]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"56.12","nodeId":"56","sql":"drop table dm.tmp_DM_AUTORPT_CS_12_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_12_${monthid}\\n(product_no varchar(20),\\nis_5g_wl_user   int, -- 是否5G网络客户\\npaz_zhe_arpu   decimal(35,2), -- 拍照期折后ARPU\\npaz_zhe10_arpu   decimal(35,2), -- 拍照期折后ARPU（10月）\\npaz_zhe11_arpu   decimal(35,2), -- 拍照期折后ARPU（11月）\\npaz_zhe12_arpu   decimal(35,2), -- 拍照期折后ARPU（12月）\\nis_zb_25   int, -- 重点客户保拓（TOP25%流失客户高于最低ARPU且高于拍照期ARPU70低于80）\\nis_zb_40   int,  -- 重点客户保拓（TOP40%流失客户高于最低ARPU且高于拍照期ARPU70低于80\\narpu_txzh           decimal(35,2),  -- 当月ARPU（剔除通信账户支付）\\navg3_arpu_txzh      decimal(35,2)   -- 近3个月平均消费（剔除通信账户支付）\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_12_${monthid}\\nselect distinct a.phone_no,\\n       case when b.phone_no is not null then 1 else 0 end,\\n\\t   nvl(c1.snapshot_income,0),\\n\\t   e.paz_zhe10_arpu,\\n\\t   e.paz_zhe11_arpu,\\n\\t   e.paz_zhe12_arpu,\\n\\t   case when c.phone_no is not null then 1 else 0 end,\\n\\t   case when d.phone_no is not null then 1 else 0 end,\\n\\t   f.HF0004-nvl(g1.fee_txzh,0) as arpu_txzh, \\n\\t   f.HF0003-round((nvl(g1.fee_txzh,0)+nvl(g2.fee_txzh,0)+nvl(g3.fee_txzh,0))/3,2) as avg3_arpu_txzh\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join gbasemsm.msm_dw_basekpi_110946_detail_dm_${monthid} b on a.phone_no=b.phone_no\\nleft join gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday} c1 on a.user_id=c1.user_id\\nleft join (select user_id,phone_no,snapshot_income from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\nwhere hold_flag = 1 and flag = 0 and lost_reason = 1 and avg_income >= min_snapshot_income and avg_income >= 0.7*snapshot_income and avg_income < 0.8*snapshot_income\\n)c on a.phone_no=c.phone_no\\nleft join (select user_id,phone_no,snapshot_income from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday}\\nwhere hold_flag = 1 and flag = 0 and lost_reason = 1 and avg_income >= min_snapshot_income and avg_income >= 0.7*snapshot_income and avg_income < 0.8*snapshot_income\\n)d on a.phone_no=d.phone_no\\nleft join dm.dm_20191202_15_mm e on a.phone_no=e.phone_no\\nleft join dm.tmp_DM_AUTORPT_CS_05_${monthid} f on a.phone_no=f.phone_no\\nleft join (select product_no,sum(case when fee_item_id in (356) then should_fee else 0 end) fee_txzh\\n           from dm.dm_Pub_acct_shoulditem_${monthid} group by product_no)g1 on a.phone_no=g1.product_no\\nleft join (select product_no,sum(case when fee_item_id in (356) then should_fee else 0 end) fee_txzh\\n           from dm.dm_Pub_acct_shoulditem_${pmonthid} group by product_no)g2 on a.phone_no=g2.product_no\\nleft join (select product_no,sum(case when fee_item_id in (356) then should_fee else 0 end) fee_txzh\\n           from dm_Pub_acct_shoulditem_${p2monthid}@dblink_dm group by product_no)g3 on a.phone_no=g3.product_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [78]-[index:144]-[客服表--DM_AUTORPT_CS_YYYYMM]-[54]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"54.11","nodeId":"54","sql":"drop table dm.tmp_DM_AUTORPT_CS_11_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_11_${monthid}\\n(product_no    varchar(20),\\nzcall_user        bigint,  -- 主叫通话对端号码个数\\nzcall_opp_user    bigint,  -- 主叫异网对端号码个数\\nzcall_opp_dur     bigint,  -- 主叫异网通话分钟数\\nzcall_opp_num     bigint  -- 主叫异网通话次数\\n)distributed by ('PRODUCT_NO');\\ninsert into dm.tmp_DM_AUTORPT_CS_11_${monthid}\\nselect distinct a.phone_no,\\n       zcall_user,\\n\\t   zcall_opp_user,\\n\\t   zcall_opp_dur,\\n\\t   zcall_opp_num\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select phone_no,\\n                  count(distinct OPP_RULE_NO) zcall_user,\\n                  count(distinct case when OPP_CARR_ID<>1 then OPP_RULE_NO end) zcall_opp_user,\\n                  sum(case when OPP_CARR_ID<>1 then call_dur else 0 end) zcall_opp_dur,\\n                  sum(case when OPP_CARR_ID<>1 then call_num else 0 end) zcall_opp_num\\n           from gbasedwd.dwd_evt_cdr_voc_basetot_ms_${monthid}\\n           where call_type=1\\n           group by phone_no)b on a.phone_no=b.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [79]-[index:145]-[客服表--DM_AUTORPT_CS_YYYYMM]-[33]-['str' object has no attribute 'lfind']:{"name":"33.临时表4","nodeId":"33","dsName":"GbaseDM","sql":"drop table dm.tmp_DM_AUTORPT_CS_04_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_04_${monthid}\\n(phone_no    varchar(20),\\ntop40_01   int,  -- TOP40%拍照客户\\ntop40_02   int,  -- TOP40%拍照客户保有客户\\ntop40_03   int,  -- 其他60%拍照客户\\ntop40_04   int,  -- 其他60%拍照客户拓展客户\\ntop40_05   int,  -- TOP40%流失客户\\ntop40_06   int,  -- 流失TOP40%客户ARPU同时低于最低拍照ARPU值和拍照期80%客户\\ntop40_07   int,  -- 流失TOP40%客户ARPU高于最低拍照ARPU值但低于80%客户\\ntop40_08   int,  -- 流失TOP40%客户ARPU高于80%但低于最低拍照ARPU值客户\\ntop40_09   int,\\nis_top25_lius5    int\\n)distributed by ('phone_no');\\ninsert into dm.tmp_DM_AUTORPT_CS_04_${monthid}\\nselect a.phone_no,\\n        case when b1.phone_no is not null then 1 else 0 end,\\n        case when b2.phone_no is not null then 1 else 0 end,\\n        case when b3.phone_no is not null then 1 else 0 end,\\n        case when b4.phone_no is not null then 1 else 0 end,\\n        case when b5.phone_no is not null then 1 else 0 end,\\n        case when b6.phone_no is not null then 1 else 0 end,\\n        case when b7.phone_no is not null then 1 else 0 end,\\n        case when b8.phone_no is not null then 1 else 0 end,\\n\\t\\tcase when b9.phone_no is not null then 1 else 0 end,\\n\\t\\tis_top25_lius5\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} a\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} where hold_flag = 1\\n)b1 on a.phone_no=b1.phone_no\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} where hold_flag = 1 and flag = 1\\n)b2 on a.phone_no=b2.phone_no\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} where hold_flag = 2\\n)b3 on a.phone_no=b3.phone_no\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} where hold_flag = 2 and flag = 1\\n)b4 on a.phone_no=b4.phone_no\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} where hold_flag = 1 and flag = 0\\n)b5 on a.phone_no=b5.phone_no\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} \\n           where hold_flag = 1 and lost_reason = 1 and avg_income < min_snapshot_income and avg_income < snapshot_income * 0.8\\n)b6 on a.phone_no=b6.phone_no\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} where hold_flag = 1 and lost_reason = 1 \\n           and avg_income >= min_snapshot_income and avg_income < snapshot_income * 0.8\\n)b7 on a.phone_no=b7.phone_no\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} where hold_flag = 1 and lost_reason = 1 \\n           and avg_income < min_snapshot_income and avg_income >= snapshot_income * 0.8\\n)b8 on a.phone_no=b8.phone_no\\nleft join (select user_id,phone_no from gbasemsm.msm_dw_basekpi_111004_detail_${curmlastday} where hold_flag = 1 and lost_reason = 1 \\n           and avg_income > min_snapshot_income and avg_income >= snapshot_income * 0.7 and avg_income < snapshot_income * 0.8\\n)b9 on a.phone_no=b9.phone_no\\nleft join (select user_id,phone_no,\\n           if(flag = 0 and avg_income > min_snapshot_income and avg_income >= snapshot_income * 0.7 and avg_income < snapshot_income * 0.8,1,0)is_top25_lius5\\nfrom gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\nwhere hold_flag = 1 ) b10 on a.phone_no=b10.phone_no\\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [80]-[index:146]-[客服表--DM_AUTORPT_CS_YYYYMM]-[37]-['str' object has no attribute 'lfind']:{"name":"37.临时表6","nodeId":"37","dsName":"GbaseDM","sql":"drop table dm.tmp_DM_AUTORPT_CS_06_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_06_${monthid}\\n(product_no    varchar(20),\\nis_5g_zd_yj   int,  -- 是否5G终端客户（一经）\\nis_jt_yt   int,  -- 是否机套一体客户\\nis_5g_new_add   int  -- 是否新增5G客户\\n)distributed by ('PRODUCT_NO');\\ninsert into dm.tmp_DM_AUTORPT_CS_06_${monthid}\\nselect a.phone_no,\\n       case when b.msisdn is not null then 1 else 0 end,\\n\\t   case when c.phone_no is not null then 1 else 0 end,\\n\\t   case when d.phone_no is not null then 1 else 0 end\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select distinct msisdn from gbasemsm.msm_dw_basekpi_110993_detail_${monthid})b on a.phone_no=b.msisdn\\nleft join (select distinct phone_no from gbasemsm.msm_dw_basekpi_110978_detail_${curmlastday})c on a.phone_no=c.phone_no\\nleft join (select distinct phone_no from gbasemsm.msm_dw_basekpi_111001_detail_${year} \\n           where stat_date>='${curm_first_day}' and stat_date<='${curm_last_day}')d  on a.phone_no=d.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [81]-[index:147]-[客服表--DM_AUTORPT_CS_YYYYMM]-[75]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"75.2","nodeId":"75","sql":"drop table dm.tmp_DM_AUTORPT_CS_20_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_20_${monthid}\\n(product_no varchar(20),\\nis_5g_open   int,    -- 是否当月打开5G开关\\ndx_plan_fee4       decimal(15,2),   -- 全网普惠续惊喜升级会员低消金额\\ndx_plan_id4        bigint,          -- 全网普惠续惊喜升级会员策划id\\ndx_plan_name4      varchar(200),    -- 全网普惠续惊喜升级会员策划名称\\ndx_plan_fee5       decimal(15,2),  -- 普惠续惊喜加语音低消金额\\ndx_plan_id5        bigint,         -- 普惠续惊喜加语音策划id\\ndx_plan_name5      varchar(200),   -- 普惠续惊喜加语音策划名称\\ndx_plan_fee6       decimal(15,2),  -- 全网超惠尊享会员低消金额\\ndx_plan_id6        bigint,         -- 全网超惠尊享会员策划id\\ndx_plan_name6      varchar(200),   -- 全网超惠尊享会员策划名称\\ndx_attr_value         decimal(20,2)    -- 实际低消金额\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_20_${monthid} \\nselect distinct a.phone_no,\\n       nvl(is_5g_open,-9),\\n\\t   c.plan_fee as dx_plan_fee4,\\n\\t   c.plan_id as dx_plan_id4,\\n\\t   c.plan_name as dx_plan_name4,\\n       d.plan_fee as dx_plan_fee5,\\n\\t   d.plan_id as dx_plan_id5,\\n\\t   d.plan_name as dx_plan_name5,\\n       e.plan_fee as dx_plan_fee6,\\n\\t   e.plan_id as dx_plan_id6,\\n\\t   e.plan_name as dx_plan_name6,\\n\\t   nvl(f.attr_value,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select msisdn as phone_no,max(is_5g_open)is_5g_open\\n           from dm.dm_pub_gbase_s11_dm_${monthid}\\n\\t\\t   group by msisdn) b on a.phone_no=b.phone_no\\nleft join(\\nselect phone_no,arpu_avg,arpu_max,plan_fee,plan_id,plan_name,\\n       row_number()over(partition by phone_no order by plan_fee) rn\\nfrom gbaserpt.rpt_nq201912676_result_ms_${monthid}\\nwhere plan_id in (111603008867,111603008866,111603008865,111603008864)\\n)c on a.phone_no=c.phone_no and c.rn=1\\nleft join(\\nselect phone_no,arpu_avg,arpu_max,plan_fee,plan_id,plan_name,\\n       row_number()over(partition by phone_no order by plan_fee) rn\\nfrom gbaserpt.rpt_nq201912676_result_ms_${monthid}\\nwhere plan_id in (111603008863,111603008862,111603008861,111603008843)\\n)d on a.phone_no=d.phone_no and d.rn=1\\nleft join(\\nselect phone_no,arpu_avg,arpu_max,plan_fee,plan_id,plan_name,\\n       row_number()over(partition by phone_no order by plan_fee) rn\\nfrom gbaserpt.rpt_nq201912676_result_ms_${monthid}\\nwhere plan_id in (111603008868,111603011160)\\n)e on a.phone_no=e.phone_no and e.rn=1\\nleft join (select user_id,max(attr_value)attr_value\\nfrom gbasedwd.${table_name.name1}\\nwhere attr_id=151000000169 and date(EXPIRE_DATE)>='${curm_last_day}'\\ngroup by user_id\\n)f on a.user_id=f.user_id\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n "} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [82]-[index:148]-[客服表--DM_AUTORPT_CS_YYYYMM]-[64]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"64.16","nodeId":"64","sql":"drop table dm.tmp_DM_AUTORPT_CS_16_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_16_${monthid}\\n(product_no varchar(20),\\ncoc_market_flag_name   varchar(300),  -- COC固话方案分类\\nis_5g_dengw      int,\\nflow_5g     decimal(20,2),\\ntotal_flow  decimal(20,2),\\nis_5g_dengw_bend   int,\\ng5_dengw_num varchar(50)  -- 5G登网天数（一经口径）\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_16_${monthid}\\nselect distinct a.phone_no,\\n       b.coc_market_flag_name,\\n\\t   case when c.phone_no is not null then 1 else 0 end,\\n       nvl(c.flow_5g,0),\\n\\t   nvl(c.total_flow,0),\\n\\t   case when d.phone_no is not null then 1 else 0 end,\\n       nvl(e.5g_dengw_num,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select a.product_no,b.coc_market_flag_name \\n           from gbasemcd.mcd_cocnew_label_market_ms_${monthid} a\\n           left join gbasemcd.dim_cocnew_label_coc_market_flag b on a.coc_market_flag=b.coc_market_flag\\n\\t\\t   )b on a.phone_no=b.product_no\\nleft join (select phone_no,\\n                  sum(flow_5g)  flow_5g,\\n                  sum(total_flow)  total_flow\\n        from dm_pub_20191202_5g_dm_${monthid}\\n        group by phone_no)c on a.phone_no=c.phone_no\\nleft join (select distinct phone_no from dm_pub_20191202_5g_02_dm_${monthid})d on a.phone_no=d.phone_no\\nleft join (select phone_no,count(distinct op_time) 5g_dengw_num  from dm.dm_pub_20191202_5g_dm_${monthid} group by phone_no) e on a.phone_no=e.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [83]-[index:149]-[客服表--DM_AUTORPT_CS_YYYYMM]-[87]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_DM_AUTORPT_CS_05_22_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_05_22_${monthid}\\n(phone_no    varchar(20),\\n user_id     varchar(20),\\n fee035       decimal(18,2),   -- ARPU国内通信消费（折前）趸付产品分摊\\n msm_should_fee_ft decimal(20,4)  -- 新增个人市场收入(含趸付分摊)\\n )distributed by ('phone_no');\\n \\ninsert into dm.tmp_DM_AUTORPT_CS_05_22_${monthid}\\nselect a.phone_no,\\n       a.user_id,\\n       nvl(a1.fee035_old,0)-nvl(b.should_income,0)+nvl(c.des_cur_mon,0)-nvl(d.should_income,0), -- ARPU国内通信消费（折前）-趸付产品总收入+趸付产品分摊收入-冬日暖心包\\n       case when f.user_id is not null then f.des_cur_mon else nvl(e.should_fee_ft,0) end  -- 新增个人市场收入(含趸付分摊)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a  \\nleft join dm.tmp_DM_AUTORPT_CS_05_${monthid} a1 on a.user_id=a1.user_id\\nleft join (select phone_no,user_id,sum(should_income) should_income from dm.dm_pub_basekpi_over_detail_mm\\n           where op_time='${curm_first_day}' and fee_type_id in (1,3) and fee_item_id not in ('20658','21056','21116','2111601','21260','21110') group by 1,2 -- fee_type_id in (1,3) 趸付产品分摊\\n           ) b on a.user_id=b.user_id\\nleft join (select phone_no,user_id,sum(des_cur_mon) des_cur_mon from dm.dm_pub_basekpi_over_detail_mm\\n           where create_time<='${curm_first_day}' and end_time>'${curm_first_day}' and fee_type_id in (1,3) \\n           and fee_item_id not in ('20658','21056','21116','2111601','21260','21110')\\n           group by 1,2  -- fee_type_id in (1,3) 趸付产品分摊\\n           ) c on a.user_id=c.user_id\\nleft join (select phone_no,user_id,sum(should_income) should_income from dm.dm_pub_basekpi_over_detail_mm\\n           where op_time='${curm_first_day}' and fee_item_id in ('20666','20864') group by 1,2   -- 需要剔除的费项（冬日暖心半年包/新NBA联盟半年包）\\n           ) d on a.user_id=d.user_id\\nleft join (select a.phone_no,\\n                  a.user_id,\\n                  sum(nvl(a.should_fee,0))-sum(nvl(b.should_income,0))+sum(nvl(c.des_cur_mon,0)) should_fee_ft -- 总收入-趸付产品总收入+趸付产品分摊收入\\n           from (select a.*,b.user_id from gbasemsm.msm_dw_basekpi_pesn_disc_${monthid} a\\n                 left join gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} b on a.phone_no=b.phone_no\\n                 ) a\\n           left join (select phone_no,user_id,sum(should_income) should_income from dm.dm_pub_basekpi_over_detail_mm\\n                      where op_time='${curm_first_day}' and fee_type_id in (1,2) and fee_item_id not in ('20885','21056','21116','2111601','21260','21110','21111','21319') group by 1,2 -- fee_type_id=1 趸付产品分摊\\n                      ) b on a.user_id=b.user_id\\n           left join (select phone_no,user_id,sum(des_cur_mon) des_cur_mon from dm.dm_pub_basekpi_over_detail_mm\\n                      where create_time<='${curm_first_day}' and end_time>'${curm_first_day}' and fee_type_id in (1,2) \\n                      and fee_item_id not in ('20885','21056','21116','2111601','21260','21110','21111','21319') \\n                      group by 1,2 -- fee_type_id=1 趸付产品分摊\\n                      ) c on a.user_id=c.user_id\\n           where left(innet_date,4)='${year}'\\n           group by 1,2\\n          ) e on a.user_id=e.user_id\\nleft join (select * from dm.dm_pub_basekpi_over_detail_mm \\n           where (create_time<='${curm_first_day}' and end_time>'${curm_first_day}') and fee_item_id='21116'\\n           ) f on a.user_id=f.user_id\\nWHERE (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [84]-[index:150]-[客服表--DM_AUTORPT_CS_YYYYMM]-[49]-['str' object has no attribute 'lfind']:{"name":"49.09","nodeId":"49","dsName":"GbaseDM","sql":"drop table dm.tmp_DM_AUTORPT_CS_09_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_09_${monthid}\\n(product_no varchar(20),\\nis_5g_plan_jt int,  -- 是否5G套餐（集团口径）\\nis_5g_plan_bd int   -- 是否5G套餐（本地口径）\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_09_${monthid}\\nselect distinct a.phone_no,\\n       case when b.phone_no is not null then 1 else 0 end,\\n\\t   case when c.phone_no is not null then 1 else 0 end\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join gbasemsm.msm_dw_basekpi_110999_detail_${curmlastday} b on a.phone_no=b.phone_no\\nleft join gbasemsm.msm_dw_basekpi_110935_detail_${curmlastday} c on a.phone_no=c.phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [85]-[index:151]-[客服表--DM_AUTORPT_CS_YYYYMM]-[60]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"60.14","nodeId":"60","sql":"drop table dm.tmp_DM_AUTORPT_CS_14_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_14_${monthid}\\n(product_no varchar(20),\\nroam_dingx_dou  decimal(23,2),\\nroam_wangk_dou  decimal(23,2),\\nroam_tongy_dou  decimal(23,2)\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_14_${monthid}\\nselect distinct a.phone_no,\\n       0, -- nvl(roam_dingx_dou,0),\\n\\t   0, -- nvl(roam_wangk_dou,0),\\n\\t   nvl(ty_FLOWDOWN,0) -- -nvl(roam_dingx_dou,0)-nvl(roam_wangk_dou,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select  a.PHONE_NO,sum(nvl(a.DATA_FLOWUP1,0)+ nvl(a.DATA_FLOWDOWN1,0)+nvl(a.DATA_FLOWUP2,0) \\n                              + nvl(a.DATA_FLOWDOWN2,0) )/1024/1024/1024 ty_FLOWDOWN    --  总流量\\n           from gbasedwd.dwd_evt_sttl_lte_lroam_dm_${monthid} a\\n           where not( a.APNNI  in ('CMLAP','CMTDS' ,'CMNET')\\n                   and substr(a.PHONE_NO,1,6)   in ('147440','147441' ,'147442' ,'147443' ,'147444' \\n                                                   ,'147445' ,'147446' ,'147447' ,'147448' ,'147449' \\n                                                   ,'147165','147166','147167','147168','147169' ))\\n                   and   a.APNNI not   in ('IMS' ,'CMREAD')\\n                   and  substr(a.PHONE_NO,1,6)not in('147345','147346','147347','147348','147349'\\n                                          ,'147660','178940','178941','178942','178943','178944','178945','148020' )\\n                    and srctype_id = 336   -- 出访                                                       \\n            group by a.PHONE_NO )b on a.phone_no=b.phone_no\\n/*left join (select a.PHONE_NO,sum(nvl(a.DATA_FLOWUP1,0)+ nvl(a.DATA_FLOWDOWN1,0)+nvl(a.DATA_FLOWUP2,0) \\n                             +nvl(a.DATA_FLOWDOWN2,0) )/1024/1024/1024  roam_wangk_dou\\n           from GbaseDWD.DWD_EVT_STTL_LTE_RWXROAM_DM_${monthid} a\\n           inner join gbasedwd.DIM_STTL_SERVICE_PACK  b on   a.user_type = b.pack_type\\n                  and  a.rattype = b.service_code\\n                  and b.busi_type in ('0004','0005')\\n                  and a.SRCTYPE_ID ='364'    --  出访\\n           where not (a.APNNI in ('CMLAP','CMTDS' ,'CMNET')\\n                 and substr(a.PHONE_NO,1,6)  in ('147440','147441' ,'147442' ,'147443' ,'147444' ,\\n                                                         '147445' ,'147446' ,'147447' ,'147448' ,'147449' \\n                                                           ,'147165','147166','147167','147168','147169' ))\\n                 and   a.APNNI not   in ('IMS' ,'CMREAD')\\n                 and  substr(a.PHONE_NO,1,6)not in('147345','147346','147347','147348','147349'\\n                       ,'147660','178940','178941','178942','178943','178944','178945','148020') \\n           group by a.PHONE_NO)c on a.phone_no=c.phone_no\\nleft join (select a.PHONE_NO , \\n                  sum(nvl(a.DATA_FLOWUP1,0)+ nvl(a.DATA_FLOWDOWN1,0)+nvl(a.DATA_FLOWUP2,0) \\n                      + nvl(a.DATA_FLOWDOWN2,0) )/1024/1024/1024  roam_dingx_dou \\n           from GbaseDWD.DWD_EVT_STTL_LTE_RWXROAM_DM_${monthid} a\\n           inner join gbasedwd.DIM_STTL_SERVICE_PACK  b on   a.user_type = b.pack_type\\n                 and  a.rattype = b.service_code\\n                 and b.busi_type in ('0001','0006')\\n                 and a.SRCTYPE_ID ='364'    --  出访\\n           where not (a.APNNI  in ('CMLAP','CMTDS' ,'CMNET')\\n                  and substr(a.PHONE_NO,1,6)  in ('147440','147441' ,'147442' ,'147443' ,'147444' ,\\n                                             '147445' ,'147446' ,'147447' ,'147448' ,'147449' \\n                                               ,'147165','147166','147167','147168','147169' ))\\n                  and   a.APNNI not   in ('IMS' ,'CMREAD')\\n                  and  substr(a.PHONE_NO,1,6)not in('147345','147346','147347','147348','147349'\\n                       ,'147660','178940','178941','178942','178943','178944','178945','148020')\\n           group by a.PHONE_NO)d on a.phone_no=d.phone_no*/\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [86]-[index:152]-[客服表--DM_AUTORPT_CS_YYYYMM]-[16]-['str' object has no attribute 'lfind']:{"name":"16.创建临时表1","nodeId":"16","dsName":"GbaseDM","sql":"create table ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n (\\tphone_no \\t            varchar(30),\\n    I0622\\t                INTEGER,\\n\\ttotal_score_0\\t        INTEGER ,\\n\\tpay_self_service_count  BIGINT,\\n\\tpay_web_count           BIGINT,\\n\\tLOGINWEB_COUNTS         BIGINT,\\n\\tcontact_mtoivr_count_1  BIGINT,\\n    CONTACT_WEB_LOGIN_COUNT_1      BIGINT,\\n    CONTACT_SMS_CONTACT_COUNT_1    BIGINT,\\n    contact_manual_service_count_1 BIGINT,\\n\\tcontact_ivr_contact_count_1    BIGINT,\\n\\tcontact_mtoivr_count           BIGINT,\\n\\tcontact_web_login_count        BIGINT,\\n\\tcontact_web_register_status_id VARCHAR(16),\\n\\tCONTACT_SMS_CONTACT_COUNT      BIGINT,\\n\\tCONTACT_MANUAL_SERVICE_COUNT   BIGINT,\\n\\tCONTACT_IVR_CONTACT_COUNT      BIGINT,\\n\\tuse_10086ivr_query_charge_cnt  BIGINT,\\n\\tuse_sms_query_charge_count     BIGINT,\\n\\tuse_wap_query_charge_count     BIGINT,\\n\\tUSE_SELF_SERV_QUERY_CHARGE_CNT BIGINT,\\n\\tuse_web_query_charge_count     BIGINT)\\nDISTRIBUTED BY('phone_no');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [87]-[index:153]-[客服表--DM_AUTORPT_CS_YYYYMM]-[31]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"31.SQL语句","nodeId":"31","sql":"drop table dm.tmp_DM_AUTORPT_CS_03_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_03_${monthid}\\n(phone_no    varchar(20),\\narpu_3avg       decimal(15,2),\\narpu_3max       decimal(15,2),\\ndx_plan_fee       decimal(15,2),   -- 全网普惠得流量低消金额\\ndx_plan_id        bigint,          -- 全网普惠得流量策划id\\ndx_plan_name      varchar(200),    -- 全网普惠得流量策划名称\\ndx_plan_fee2       decimal(15,2),  -- 全网优惠享特权低消金额\\ndx_plan_id2        bigint,         -- 全网优惠享特权策划id\\ndx_plan_name2      varchar(200),   -- 全网优惠享特权策划名称\\ndx_plan_fee3       decimal(15,2),  -- 全网优惠新年礼低消金额\\ndx_plan_id3        bigint,         -- 全网优惠新年礼策划id\\ndx_plan_name3      varchar(200) ,  -- 全网优惠新年礼策划名称\\narpu_3             varchar(100)    -- 近3个月消费明细 \\n)distributed by ('phone_no');\\ninsert into dm.tmp_DM_AUTORPT_CS_03_${monthid}\\nselect a.phone_no,\\n       nvl(e.arpu_avg,0) as arpu_3avg,\\n\\t   nvl(e.arpu_max,0) as arpu_3max,\\n       b.plan_fee as dx_plan_fee,\\n\\t   b.plan_id as dx_plan_id,\\n\\t   b.plan_name as dx_plan_name,\\n       c.plan_fee as dx_plan_fee2,\\n\\t   c.plan_id as dx_plan_id2,\\n\\t   c.plan_name as dx_plan_name2,\\n       d.plan_fee as dx_plan_fee3,\\n\\t   d.plan_id as dx_plan_id3,\\n\\t   d.plan_name as dx_plan_name3,\\n       nvl(e.arpu_3_z,0) as arpu_3\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a  \\nleft join(\\nselect phone_no,arpu_avg,arpu_max,plan_fee,plan_id,plan_name,\\n       row_number()over(partition by phone_no order by plan_fee) rn\\nfrom gbaserpt.rpt_nq201912676_result_ms_${monthid}\\nwhere plan_id in (111603002553,111603002554,111603002556,111603002557,111603002558)\\n)b on a.phone_no=b.phone_no and b.rn=1\\nleft join(\\nselect phone_no,arpu_avg,arpu_max,plan_fee,plan_id,plan_name,\\n       row_number()over(partition by phone_no order by plan_fee) rn\\nfrom gbaserpt.rpt_nq201912676_result_ms_${monthid}\\nwhere plan_id in (111603007141,111603002924,111603002925,111603002926,\\n                  111603003847,111603003848,111603004041,111603004042)\\n)c on a.phone_no=c.phone_no and c.rn=1\\nleft join(\\nselect phone_no,arpu_avg,arpu_max,plan_fee,plan_id,plan_name,\\n       row_number()over(partition by phone_no order by plan_fee) rn\\nfrom gbaserpt.rpt_nq201912676_result_ms_${monthid}\\nwhere plan_id in (111603008392,111603008391,111603008390,111603008389,111603008388,\\n                  111603008387,111603008386,111603008385)\\n)d on a.phone_no=d.phone_no and d.rn=1\\nleft join (select distinct phone_no,arpu_3,arpu_2,arpu_1,arpu_avg,arpu_max,concat(arpu_3,'-',arpu_2,'-',arpu_1) arpu_3_z\\n           from gbaserpt.rpt_nq201912676_result_ms_${monthid}) e on a.phone_no=e.phone_no\\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001;\\n\\n\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [88]-[index:155]-[客服表--DM_AUTORPT_CS_YYYYMM]-[42]-['str' object has no attribute 'lfind']:{"name":"42.08","nodeId":"42","dsName":"gbasegrid","sql":"drop table dm.tmp_DM_AUTORPT_CS_08_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_08_${monthid}\\n(product_no varchar(20),\\nco_regional  varchar(200),  -- CO归属经营网格\\ngjg_roam_day  bigint -- 当月境外漫游天数\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_08_${monthid}\\nselect distinct a.phone_no,b.regional_center_name,c.gjg_roam_day\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (select a.memb_no,a.co_code,b.regional_center_name\\n           from gbasedwi.dwi_usr_grp_meb_ms_${monthid} a\\n           left join gbasegrid.dim_grid_10144_colist_${monthid} b on a.co_code=b.co_code\\n)b on a.phone_no=b.memb_no\\nleft join (\\n      select phone_no,count(distinct stat_date) gjg_roam_day\\n      from (\\n      select distinct stat_date,phone_no from gbasedwd.dwd_evt_cdr_voc_basetot_dm_${monthid}\\n      where roam_type in (9,11)\\n      union all\\n      select distinct stat_date,phone_no from gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${monthid}\\n      where roam_type in (9,11)\\n      union all\\n      select distinct stat_date,USER_NO as phone_no from gbasedwd.DWD_EVT_CDR_SMMS_BASETOT_DM_${monthid}\\n      where roam_type in (9,11)\\n      )a\\n      group by phone_no\\n)c on a.phone_no=c.phone_no","parentDsName":"gbasegrid"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [89]-[index:156]-[客服表--DM_AUTORPT_CS_YYYYMM]-[10]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"10.插入数据","nodeId":"10","sql":"INSERT INTO ${TARGET_DM_AUTORPT_CS_YYYYMM}\\n (\\tOP_TIME,\\n\\tSTATIS_MONTH,\\n\\tPRODUCT_NO,\\n\\tI0621,\\n\\tI0622,\\n\\tI0623,\\n\\tI0627,\\n\\tI0628,\\n\\tI0629,\\n\\tI0630,\\n\\tI0631,\\n\\tI0632,\\n\\tI0633,\\n\\tI0634,\\n\\tI0635,\\n\\tI0636,\\n\\tI0637,\\n\\tI0638,\\n\\tI0639,\\n\\tI0640,\\n\\tI0641,\\n\\tI0642,\\n\\tI0643,\\n\\tI0644,\\n\\tI0645,\\n\\tI0646,\\n\\tI0647,\\n\\tI0648,\\n\\tI0649,\\n\\tI0650,\\n\\tI0651,\\n\\tI0652,\\n\\tI0653,\\n\\tarpu_3avg,\\n    arpu_3max,\\n    dx_plan_fee,\\n    dx_plan_id,\\n    dx_plan_name,\\n\\tdx_plan_fee2,\\n    dx_plan_id2,\\n    dx_plan_name2,\\n    top40_01,\\ntop40_02, \\ntop40_03,\\ntop40_04,\\ntop40_05,\\ntop40_06,\\ntop40_07,\\ntop40_08,\\ntop40_09,\\nis_top25_lius5,\\n\\t\\tfee030,\\n\\t\\tfee031,\\n\\t\\tfee032,\\n\\t\\tfee033,\\n\\t    fee034,\\n\\t\\tlast_fee034,   -- 上月折后实收收入\\nlast2_fee034,   -- 上上月折后实收收入\\nlast3_fee034,   -- 上上上月折后实收收入\\nfee0342,   -- 折后实收收入(近3个月平均)\\nlast_MINUS_FEE,   -- 上月折后应收收入\\nlast2_MINUS_FEE,   -- 上月折后应收收入\\nlast3_MINUS_FEE,   -- 上月折后应收收入\\n\\t    fee035, -- ARPU国内通信消费（折前）趸付产品分摊\\n\\t\\tfee036,\\n\\t\\tis_5g_zd_yj,  -- 是否5G终端客户（一经）\\nis_jt_yt   ,  -- 是否机套一体客户\\nis_5g_new_add   ,  -- 是否新增5G客户\\ngjg_roam_day  ,   -- 当月境外漫游天数\\ngjg_roam_county  ,  -- 国际/港澳台漫游方向\\ngjg_roam_ll_fee  ,  -- 国际港澳台漫游流量费\\ngjg_roam_yy_fee  ,  -- 国际港澳台漫游语音费\\t \\ngjg_roam_dx_fee  ,  -- 国际港澳台漫游短信费 \\nco_regional,\\nis_5g_plan_jt,  -- 是否5G套餐（集团口径）\\nis_5g_plan_bd,   -- 是否5G套餐（本地口径）\\nis_zh_sjd       ,  -- 折后升降档\\nplan_fee_zh_jj  ,  -- 即将生效折后套餐费\\nlingqu_score    ,  -- 倍享积分已领取分值\\nno_score        ,  -- 倍享积分未领取分值\\ntrun_time,        -- 末次领取积分日期\\nzcall_user,\\nzcall_opp_user,\\nzcall_opp_dur,\\nzcall_opp_num,\\nis_5g_wl_user, -- 是否5G网络客户\\npaz_zhe_arpu, -- 拍照期折后ARPU\\npaz_zhe10_arpu, -- 拍照期折后ARPU（10月）\\npaz_zhe11_arpu, -- 拍照期折后ARPU（11月）\\npaz_zhe12_arpu, -- 拍照期折后ARPU（12月）\\nis_zb_25, -- 重点客户保拓（TOP25%流失客户高于最低ARPU且高于拍照期ARPU70低于80）\\nis_zb_40,  -- 重点客户保拓（TOP40%流失客户高于最低ARPU且高于拍照期ARPU70低于80）\\narpu_txzh,  -- 当月ARPU（剔除通信账户支付）\\navg3_arpu_txzh, -- 近3个月平均消费（剔除通信账户支付）\\njif_bt_fee ,   -- 积分保拓出账收入\\nmy_no_jif_bt_fee,   -- 当月折后应收收入（不含积分保拓）\\nms_no_jif_bt_fee,   -- 当月折后实收收入（不含积分保拓）\\nmigu_fee,    -- 咪咕视频包出账收入\\nroam_dingx_dou,\\nroam_wangk_dou,\\nroam_tongy_dou,\\nmsm_should_fee,\\nmsm_this_fee,\\nmsm_zhk_fee,\\nmsm_settle_FEE,\\ncoc_market_flag_name,\\ndx_plan_fee3,\\ndx_plan_id3,\\ndx_plan_name3,\\nis_5g_dengw  ,\\nflow_5g ,\\ntotal_flow,\\nis_roll_totuse_res_num,\\ngn_roll_totuse_res_num,\\ngn_roll_use_res_num,\\nvotel_total_flow,\\ncur_mon_stop_days,\\nacct1_arpu,\\nacct2_arpu,\\nacct3_arpu,\\nwx_zhangd_sel,\\nst_zhangd_sel,\\nivr_zhangd_sel,\\nst_xiangd_sel,\\nis_5g_open,\\ndx_plan_fee4,\\ndx_plan_id4,\\ndx_plan_name4,\\ndx_plan_fee5,\\ndx_plan_id5,\\ndx_plan_name5,\\ndx_plan_fee6,\\ndx_plan_id6,\\ndx_plan_name6,dx_attr_value,\\nis_tongxin_yj ,   -- 是否通信客户（一经通报口径）\\nis_tongxin_mnyj,    -- 是否通信客户（模拟一经口径）\\nis_chuzhang_mnyj,\\nis_5g_jtwpp_county,\\nis_2021pz_jz_user,\\narpu_2021pz_jz,\\nis_5g_dengw_bend,\\ng5_dengw_num,\\nis_wlw_yj,\\ndou_yj,\\nms_no_jif_bt_fee_ft, \\nmsm_should_fee_ft,\\nmy_no_jif_bt_fee_ft ,  \\np_my_no_jif_bt_fee_ft ,\\np2_my_no_jif_bt_fee_ft,\\npy_my_no_jif_bt_fee_ft,\\narpu_3\\n\\n)\\nSELECT distinct\\t'${curm_first_day}'\\t\\t\\t\\t\\tOP_TIME,\\n\\t\\tA.STAT_MON\\t\\t\\t\\t\\t\\t\\tSTATIS_MONTH,\\n\\t\\tA.PHONE_NO\\t\\t\\t\\t\\t\\t\\tPRODUCT_NO,\\n\\t\\tNVL(B.CUR_SCORE_BALANCE,0)\\t\\t\\tI0621,\\t\\t/*NVL(D.TOTAL_SCORE,0)  口径变更*/ /*用户总积分*/\\n\\t\\tnvl(e.I0622,0)\\t\\t\\t\\t\\t\\tI0622,\\t\\t/*取的替代口径，有差异*/ /*积分查询/M值查询*/\\n\\t\\tNVL(e.TOTAL_SCORE_0,0)\\t\\t\\t\\tI0623,      /*本年度积分值*/\\n\\t\\tNVL(B.CUR_SCORE_BALANCE,0)\\t\\t\\tI0627,      /*总剩余积分值*/\\n\\t\\tNVL(B.SCORE_SHIELD_FLAG,0)\\t\\t\\tI0628,      /*积分屏蔽标识*/\\n\\t\\tNVL(B.CUR_SCORE_BALANCE,0)\\t\\t\\tI0629,\\t\\t/*用户可用积分*/\\n\\t\\tNVL(B.cur_mon_cut_consm_score,0)\\tI0630, \\t\\t/*当月已兑换消费积分*/\\n\\t\\tNVL(B.cur_mon_cut_dou_enjoy_score,0) I0631, \\t/*当月已兑换倍享积分*/\\n\\t\\tNVL(B.cur_mon_cut_sale_score,0)\\t\\tI0632, \\t\\t/*当月已兑换促销积分*/\\n\\t\\tNVL(B.LOST_CLEAR_SCORE,0)\\t\\t    I0633, \\t\\t/*当月离网积分*/\\n\\t\\tNVL(B.I0634,0)\\t\\t\\t\\t\\t\\tI0634,\\t\\t/*促销清零积分+倍享清零积分=当月清零积分*/\\t\\t\\n\\t\\tNVL(e.pay_self_service_count,0)           I0635,  /*自助终端交费次数*/\\n\\t\\tNVL(e.pay_web_count,0)                    I0636,  /*网站交费次数*/\\n\\t\\tNVL(e.LOGINWEB_COUNTS,0)                  I0637,  /*登录网上营业厅次数*/\\n\\t\\tNVL(e.contact_mtoivr_count_1,0)           I0638,  /*人工转自助次数（1个月）*/\\n\\t\\tNVL(e.CONTACT_WEB_LOGIN_COUNT_1,0)        I0639,  /*网站登录次数（1个月）*/\\n\\t\\tNVL(e.CONTACT_SMS_CONTACT_COUNT_1,0)      I0640,  /*短信渠道接触次数（1个月）*/\\n\\t\\tNVL(e.contact_manual_service_count_1,0)  I0641,  /*人工呼入次数（1个月）*/\\n\\t\\tNVL(e.contact_ivr_contact_count_1,0)      I0642,  /*IVR渠道接触次数（1个月）*/\\n\\t\\tNVL(e.contact_mtoivr_count,0)             I0643,  /*人工转自助次数（3个月）*/\\n\\t\\tNVL(e.contact_web_login_count,0)          I0644,  /*网站登录次数（3个月）*/\\n\\t\\tNVL(e.contact_web_register_status_id,'N') I0645,  /*网站注册（3个月内注册）*/\\n\\t\\tNVL(e.CONTACT_SMS_CONTACT_COUNT,0)        I0646,  /*短信渠道接触次数（3个月）*/\\n\\t\\tNVL(e.CONTACT_MANUAL_SERVICE_COUNT,0)     I0647,  /*人工呼入次数（3个月）*/\\n\\t\\tNVL(e.CONTACT_IVR_CONTACT_COUNT,0)        I0648,  /*IVR渠道接触次数（3个月）*/\\n\\t\\tNVL(e.use_10086ivr_query_charge_cnt,0)    I0649,  /*10086IVR话费查询次数（6个月）*/\\n\\t\\tNVL(e.use_sms_query_charge_count,0)       I0650,  /*短信话费查询次数（6个月）*/\\n\\t\\tNVL(e.use_wap_query_charge_count,0)       I0651,  /*WAP话费查询次数（6个月）*/\\n\\t\\tNVL(e.USE_SELF_SERV_QUERY_CHARGE_CNT,0)   I0652,  /*自助终端话费查询次数（6个月）*/\\n\\t\\tNVL(e.use_web_query_charge_count,0)       I0653,  /* 网站话费查询次数（6个月）*/\\n\\t\\tnvl(c.arpu_3avg,0),\\n        nvl(c.arpu_3max,0),\\n        nvl(c.dx_plan_fee,0),\\n        dx_plan_id,\\n        dx_plan_name,\\n\\t\\tnvl(c.dx_plan_fee2,0),\\n        dx_plan_id2,\\n        dx_plan_name2,\\n\\t\\ttop40_01,\\n\\t\\ttop40_02,\\n\\t\\ttop40_03,\\n\\t\\ttop40_04,\\n\\t\\ttop40_05,\\n\\t\\ttop40_06,\\n\\t\\ttop40_07,\\n\\t\\ttop40_08,\\n\\t\\ttop40_09,\\nis_top25_lius5,\\n\\t\\tfee030,\\n\\t\\tfee031,\\n\\t\\tfee032,\\n\\t\\tfee033,\\n\\t    fee034,\\n\\t\\tlast_fee034,   -- 上月折后实收收入\\nlast2_fee034,   -- 上上月折后实收收入\\nlast3_fee034,   -- 上上上月折后实收收入\\nfee0342,   -- 折后实收收入(近3个月平均)\\nlast_MINUS_FEE,   -- 上月折后应收收入\\nlast2_MINUS_FEE,   -- 上月折后应收收入\\nlast3_MINUS_FEE,   -- 上月折后应收收入\\ncase when t.fee035<0 then 0 else t.fee035 end fee035, -- ARPU国内通信消费（折前）趸付产品分摊\\n\\t\\tfee036,\\n\\t\\t\\t\\tis_5g_zd_yj,  -- 是否5G终端客户（一经）\\nis_jt_yt   ,  -- 是否机套一体客户\\nis_5g_new_add   ,  -- 是否新增5G客户\\ngjg_roam_day  ,   -- 当月境外漫游天数\\ngjg_roam_county  ,  -- 国际/港澳台漫游方向\\ngjg_roam_ll_fee  ,  -- 国际港澳台漫游流量费\\ngjg_roam_yy_fee  ,  -- 国际港澳台漫游语音费\\t \\ngjg_roam_dx_fee  ,  -- 国际港澳台漫游短信费 \\nco_regional,\\ng.is_5g_plan_jt,  -- 是否5G套餐（集团口径）\\ng.is_5g_plan_bd,   -- 是否5G套餐（本地口径）\\nis_zh_sjd       ,  -- 折后升降档\\nplan_fee_zh_jj  ,  -- 即将生效折后套餐费\\nlingqu_score    ,  -- 倍享积分已领取分值\\nno_score        ,  -- 倍享积分未领取分值\\ntrun_time,        -- 末次领取积分日期\\nzcall_user,\\nzcall_opp_user,\\nzcall_opp_dur,\\nzcall_opp_num,\\nis_5g_wl_user, -- 是否5G网络客户\\npaz_zhe_arpu, -- 拍照期折后ARPU\\npaz_zhe10_arpu, -- 拍照期折后ARPU（10月）\\npaz_zhe11_arpu, -- 拍照期折后ARPU（11月）\\npaz_zhe12_arpu, -- 拍照期折后ARPU（12月）\\nis_zb_25, -- 重点客户保拓（TOP25%流失客户高于最低ARPU且高于拍照期ARPU70低于80）\\nis_zb_40,  -- 重点客户保拓（TOP40%流失客户高于最低ARPU且高于拍照期ARPU70低于80）\\narpu_txzh,  -- 当月ARPU（剔除通信账户支付）\\navg3_arpu_txzh, -- 近3个月平均消费（剔除通信账户支付）\\njif_bt_fee ,   -- 积分保拓出账收入\\nmy_no_jif_bt_fee,   -- 当月折后应收收入（不含积分保拓）\\nms_no_jif_bt_fee,   -- 当月折后实收收入（不含积分保拓）\\nmigu_fee,    -- 咪咕视频包出账收入\\nroam_dingx_dou,\\nroam_wangk_dou,\\nroam_tongy_dou,\\nmsm_should_fee,\\nmsm_this_fee,\\nmsm_zhk_fee,\\nmsm_settle_FEE,\\nn.coc_market_flag_name,\\ndx_plan_fee3,\\ndx_plan_id3,\\ndx_plan_name3,\\nnvl(is_5g_dengw,0),\\nnvl(flow_5g,0),\\nnvl(total_flow,0),\\nis_roll_totuse_res_num,\\ngn_roll_totuse_res_num,\\ngn_roll_use_res_num,\\nvotel_total_flow,\\ncur_mon_stop_days,\\nacct1_arpu,\\nacct2_arpu,\\nacct3_arpu,\\nwx_zhangd_sel,\\nst_zhangd_sel,\\nivr_zhangd_sel,\\nst_xiangd_sel,\\nis_5g_open,\\ndx_plan_fee4,\\ndx_plan_id4,\\ndx_plan_name4,\\ndx_plan_fee5,\\ndx_plan_id5,\\ndx_plan_name5,\\ndx_plan_fee6,\\ndx_plan_id6,\\ndx_plan_name6,\\ndx_attr_value,\\nis_tongxin_yj ,   -- 是否通信客户（一经通报口径）\\nis_tongxin_mnyj,    -- 是否通信客户（模拟一经口径）\\nnvl(is_chuzhang_mnyj,0),\\nnvl(is_5g_jtwpp_county,0),\\nnvl(is_2021pz_jz_user,0),\\nnvl(arpu_2021pz_jz,0),\\nnvl(is_5g_dengw_bend,0),\\nnvl(n.g5_dengw_num,0),\\ns.is_wlw_yj,\\ns.dou_yj,\\ncase when u.ms_no_jif_bt_fee_ft<0 then 0 else u.ms_no_jif_bt_fee_ft end ms_no_jif_bt_fee_ft,  -- 当月折后实收收入（不含积分保拓）趸付产品分摊\\nt.msm_should_fee_ft, -- 新增个人市场收入(含趸付分摊)\\ncase when u.my_no_jif_bt_fee_ft<0 then 0 else u.my_no_jif_bt_fee_ft end my_no_jif_bt_fee_ft,         -- 当月折后应收收入（不含积分保拓）趸付产品分摊         \\ncase when u.p_my_no_jif_bt_fee_ft<0 then 0 else u.p_my_no_jif_bt_fee_ft end p_my_no_jif_bt_fee_ft,     -- 当月折后应收收入（不含积分保拓）趸付产品分摊-前1个月  \\ncase when u.p2_my_no_jif_bt_fee_ft<0 then 0 else u.p2_my_no_jif_bt_fee_ft end p2_my_no_jif_bt_fee_ft,   -- 当月折后应收收入（不含积分保拓）趸付产品分摊-前2个月 \\ncase when u.py_my_no_jif_bt_fee_ft<0 then 0 else u.py_my_no_jif_bt_fee_ft end py_my_no_jif_bt_fee_ft,  -- 当月折后应收收入（不含积分保拓）趸付产品分摊-上年末\\nc.arpu_3   -- 近3个月消费明细 \\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} A \\nleft join (select phone_no,max(CUR_SCORE_BALANCE) CUR_SCORE_BALANCE /*用户可用积分*/,max(SCORE_SHIELD_FLAG) SCORE_SHIELD_FLAG,\\n\\t\\t\\tsum(cur_mon_cut_consm_score) cur_mon_cut_consm_score, /*当月已兑换消费积分*/\\n\\t\\t\\tsum(cur_mon_cut_dou_enjoy_score) cur_mon_cut_dou_enjoy_score, /*当月已兑换倍享积分*/\\n\\t\\t\\tsum(cur_mon_cut_sale_score) cur_mon_cut_sale_score, /*当月已兑换促销积分*/\\n\\t\\t\\tsum(LOST_CLEAR_SCORE) LOST_CLEAR_SCORE,/*当月离网积分*/\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n\\t\\t\\tsum(SALE_CLEAR_SCORE+DOU_ENJOY_CLEAR_SCORE) I0634  /*促销清零积分+倍享清零积分=当月清零积分*/\\n            from ${SOURCE_DWI_INCO_BILL_USER_SCORE_DT_YYYYMMDD} group by phone_no) B ON A.PHONE_NO=B.PHONE_NO\\nleft join dm.tmp_DM_AUTORPT_CS_03_${monthid} c on a.PHONE_NO = c.PHONE_NO\\nleft join dm.tmp_DM_AUTORPT_CS_04_${monthid} d on a.PHONE_NO = d.PHONE_NO\\nleft join dm.tmp_DM_AUTORPT_CS_05_${monthid} f on a.PHONE_NO = f.PHONE_NO\\nleft join ${SOURCE_TMP_DM_AUTORPT_CS_02} e on a.PHONE_NO = e.PHONE_NO\\nleft join dm.tmp_DM_AUTORPT_CS_06_${monthid} f1 on a.PHONE_NO = f1.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_07_${monthid} f2 on a.PHONE_NO = f2.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_08_${monthid} f3 on a.PHONE_NO = f3.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_09_${monthid} g on a.PHONE_NO = g.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_10_${monthid} h on a.PHONE_NO = h.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_11_${monthid} i on a.PHONE_NO = i.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_12_${monthid} j on a.PHONE_NO = j.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_13_${monthid} k on a.PHONE_NO = k.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_14_${monthid} l on a.PHONE_NO = l.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_15_${monthid} m on a.PHONE_NO = m.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_16_${monthid} n on a.PHONE_NO = n.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_17_${monthid} o on a.PHONE_NO = o.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_18_${monthid} p on a.PHONE_NO = p.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_19_${monthid} q on a.PHONE_NO = q.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_20_${monthid} r on a.PHONE_NO = r.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_21_${monthid} s on a.PHONE_NO = s.product_no\\nleft join dm.tmp_DM_AUTORPT_CS_05_22_${monthid} t on a.user_id = t.user_id\\nleft join dm.tmp_DM_AUTORPT_CS_05_23_${monthid} u on a.user_id = u.user_id\\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001\\n;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [90]-[index:157]-[客服表--DM_AUTORPT_CS_YYYYMM]-[73]-['str' object has no attribute 'lfind']:{"name":"73.19","nodeId":"73","dsName":"GbaseDM","sql":"drop table dm.tmp_DM_AUTORPT_CS_19_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_19_${monthid}\\n(product_no varchar(20),\\nwx_zhangd_sel     bigint,  -- 微信帐单查询量\\nst_zhangd_sel     bigint,  --  手厅帐单查询量\\nivr_zhangd_sel     bigint,  --  其他(ivr)帐单查询量\\nst_xiangd_sel     bigint  --  手厅详单查询量\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_19_${monthid}\\nselect distinct a.phone_no,\\n       nvl(b.num,0),\\n\\t   nvl(c.num,0),\\n\\t   nvl(d.num,0),\\n\\t   nvl(e.num,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select phone_no,sum(1) num\\n           from gbasedwd.dwd_svc_usr_weixin_request_dm_${monthid} a \\n           left join gbasedwd.dim_evt_weixin_event b on a.evt_key=b.event_key\\n           where menu_path ='查询-账单详情'\\n           group by phone_no)b on a.phone_no=b.phone_no\\nleft join (select wt_mobile,sum(1) num\\n           from (select wt_mobile,lower(wt_event) wt_event from gbasedwd.dwd_chl_app_hand_office_ios_dm_${monthid}\\n                 where lower(wt_event) ='sy_syicon_wdzd'\\n                 union all\\n                 select wt_mobile,lower(wt_event) wt_event from gbasedwd.dwd_chl_app_hand_office_android_dm_${monthid}\\n                 where  lower(wt_event) ='sy_syicon_wdzd')a \\n\\t       group by wt_mobile)c on a.phone_no=c.wt_mobile\\nleft join (select phone_no,count(distinct call_sn)num\\n           from gbasedwd.dwd_cs_ivr_callin_track_dm_${monthid} a \\n           left join gbaseods.ods_d_f_ivr_02905_menu_${curmlastday} b on a.KEY_PRESS_TRACK=b.key_value and a.cust_lvl=b.cust_level\\n           where buzi_type_desc ='账单查询' and op_result =100\\n           group by phone_no)d on a.phone_no=d.phone_no\\nleft join (select wt_mobile,sum(1) num\\n           from (select wt_mobile,lower(wt_event) wt_event from gbasedwd.dwd_chl_app_hand_office_ios_dm_${monthid}\\n                 where lower(wt_event) ='xdcx_fwmmsr'\\n                 union all\\n                 select wt_mobile,lower(wt_event) wt_event from gbasedwd.dwd_chl_app_hand_office_android_dm_${monthid}\\n                 where  lower(wt_event) ='xdcx_fwmmsr')a \\n\\t       group by wt_mobile)e on a.phone_no=e.wt_mobile\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [91]-[index:158]-[客服表--DM_AUTORPT_CS_YYYYMM]-[35]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"35.临时表5","nodeId":"35","sql":"drop table dm.tmp_DM_AUTORPT_CS_05_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_05_${monthid}\\n(phone_no    varchar(20),\\n user_id     varchar(20),\\nfee030       decimal(18,2),   -- ARPU（主套餐月租费） 指定费项\\nfee031       decimal(18,2),   -- ARPU（流量）\\nfee032       decimal(18,2),   -- ARPU（短彩信）\\nfee033       decimal(18,2),   -- ARPU（信息化）\\nfee034       decimal(18,2),   -- 折后实收收入\\nlast_fee034      decimal(18,2),   -- 上月折后实收收入\\nlast2_fee034      decimal(18,2),   -- 上上月折后实收收入\\nlast3_fee034      decimal(18,2),   -- 上上上月折后实收收入\\nfee0342      decimal(18,2),   -- 折后实收收入(近3个月平均)\\nlast_MINUS_FEE    decimal(18,2),   -- 上月折后应收收入\\nlast2_MINUS_FEE    decimal(18,2),   -- 上月折后应收收入\\nlast3_MINUS_FEE    decimal(18,2),   -- 上月折后应收收入\\nfee035_old       decimal(18,2),   -- ARPU国内通信消费（折前）\\nfee036       decimal(18,2),    -- ARPU国内通信消费\\nHF0004       decimal(18,2), \\nHF0003       decimal(18,2)\\n)distributed by ('phone_no');\\ninsert into dm.tmp_DM_AUTORPT_CS_05_${monthid} \\nselect a.phone_no,\\n       a.user_id,\\n       fee030,\\n       fee031,\\n       fee032,\\n       fee033,\\n\\t   c.fee014 as fee034,\\n\\t   c1.fee014 as last_fee034,\\n\\t   c2.fee014 as last2_fee034,\\n\\t   c3.fee014 as last3_fee034,\\n\\t   (c.fee014+c1.fee014+c2.fee014)/3,\\n\\t   c1.MINUS_FEE as last_MINUS_FEE, \\n\\t   c2.MINUS_FEE as last2_MINUS_FEE,\\n\\t   c3.MINUS_FEE as last3_MINUS_FEE,\\n\\t   c.HF0004-d.IC0500-d.IC0400-d.IC0800-d.IC0700-e.ROAMOUT_FEE-b.fee030-c.FEE002-c.FEE004-c.FEE005-c.FEE006-c.FEE007-c.FEE008-c.FEE009-c.FEE010-fee_jifen as fee035_old,\\n\\t   c.HF0004-c.trans_amt-d.IC0500-d.IC0400-d.IC0800-d.IC0700-e.ROAMOUT_FEE-b.fee030-c.FEE002-c.FEE004-c.FEE005-c.FEE006-c.FEE007-c.FEE008-c.FEE009-c.FEE010-fee_jifen as fee036,\\n\\t   c.HF0004,c.HF0003\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a  \\nleft join \\n(select product_no,\\nsum(case when a.fee_item_id in ('1059','1503') then should_fee else 0 end) fee030,\\nsum(case when fee_type_name='流量' then should_fee else 0 end) fee031,\\nsum(case when fee_type_name='短彩信' then should_fee else 0 end) fee032,\\nsum(case when fee_type_name='信息化' then should_fee else 0 end) fee033,\\nsum(case when a.fee_item_id in ('20029','20004','20005','20034','20038','20098',\\n             '20149','20170') then should_fee else 0 end) fee_jifen\\nfrom dm.dm_Pub_acct_shoulditem_${monthid} a\\nleft join dm.dim_ckpi_basekpi_feeitem b on a.fee_item_id2=b.fee_item_id\\ngroup by product_no) b on a.phone_no=b.product_no\\nleft join dm.DM_AUTORPT_HIS_INDEX_${monthid} c on a.phone_no=c.product_no\\nleft join dm.DM_AUTORPT_ACCT_${monthid} d on a.phone_no=d.product_no\\nleft join DM.DM_PUB_INCREASE_${monthid} e on a.phone_no=e.product_no\\nleft join dm.DM_AUTORPT_HIS_INDEX_${pmonthid} c1 on a.phone_no=c1.product_no\\nleft join dm.DM_AUTORPT_HIS_INDEX_${p2monthid} c2 on a.phone_no=c2.product_no\\nleft join (select * from DM_AUTORPT_HIS_INDEX_${p3monthid}@dblink_dm) c3 on a.phone_no=c3.product_no\\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001;\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [92]-[index:159]-[客服表--DM_AUTORPT_CS_YYYYMM]-[18]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"18.创建临时表2","nodeId":"18","sql":"create table ${SOURCE_TMP_DM_AUTORPT_CS_02}\\n (\\tphone_no \\t            varchar(30),\\n    I0622\\t                INTEGER,\\n\\ttotal_score_0\\t        INTEGER ,\\n\\tpay_self_service_count  BIGINT,\\n\\tpay_web_count           BIGINT,\\n\\tLOGINWEB_COUNTS         BIGINT,\\n\\tcontact_mtoivr_count_1  BIGINT,\\n    CONTACT_WEB_LOGIN_COUNT_1      BIGINT,\\n    CONTACT_SMS_CONTACT_COUNT_1    BIGINT,\\n    contact_manual_service_count_1 BIGINT,\\n\\tcontact_ivr_contact_count_1    BIGINT,\\n\\tcontact_mtoivr_count           BIGINT,\\n\\tcontact_web_login_count        BIGINT,\\n\\tcontact_web_register_status_id VARCHAR(16),\\n\\tCONTACT_SMS_CONTACT_COUNT      BIGINT,\\n\\tCONTACT_MANUAL_SERVICE_COUNT   BIGINT,\\n\\tCONTACT_IVR_CONTACT_COUNT      BIGINT,\\n\\tuse_10086ivr_query_charge_cnt  BIGINT,\\n\\tuse_sms_query_charge_count     BIGINT,\\n\\tuse_wap_query_charge_count     BIGINT,\\n\\tUSE_SELF_SERV_QUERY_CHARGE_CNT BIGINT,\\n\\tuse_web_query_charge_count     BIGINT)\\nDISTRIBUTED BY('phone_no');\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [93]-[index:160]-[客服表--DM_AUTORPT_CS_YYYYMM]-[39]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"39.07","nodeId":"39","sql":"drop table dm.tmp_DM_AUTORPT_CS_07_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_07_${monthid} \\n(product_no    varchar(20),\\ngjg_roam_county   varchar(20),  -- 国际/港澳台漫游方向\\ngjg_roam_ll_fee   decimal(34,2),  -- 国际港澳台漫游流量费\\ngjg_roam_yy_fee   decimal(34,2),  -- 国际港澳台漫游语音费\\t \\ngjg_roam_dx_fee   decimal(34,2)  -- 国际港澳台漫游短信费 \\n)distributed by ('PRODUCT_NO');\\ninsert into dm.tmp_DM_AUTORPT_CS_07_${monthid}\\nselect a.phone_no,\\n       null,\\n\\t   c.gjg_roam_ll_fee,\\n\\t   c.gjg_roam_yy_fee,\\n\\t   c.gjg_roam_dx_fee\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\n-- left join (select phone_no,max(county_name)county_name from gbaserpt.rpt_nq202004060_reslut_ds_${curmlastday}\\n--            group by phone_no\\n-- )b on a.phone_no=b.phone_no\\nleft join (select a.phone_no,\\n                  sum(case when b.ll_fee is not null then a.should_income else 0 end)gjg_roam_ll_fee,\\n\\t\\t\\t\\t  sum(case when a.acct_item_id in (3496,249,43,108,131,132,2787,2788) then a.should_income else 0 end)gjg_roam_yy_fee,\\n\\t\\t\\t\\t  sum(case when a.acct_item_id in (915,916,226) then a.should_income else 0 end)gjg_roam_dx_fee\\n           from gbasedwi.dwi_inco_bill_item_tot_ms_${monthid} a\\n\\t\\t   left join dm.dim_my_ll_fee b on a.acct_item_id=b.ll_fee\\n\\t\\t   group by a.phone_no) c on a.phone_no=c.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1)\\n;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [94]-[index:161]-[客服表--DM_AUTORPT_CS_YYYYMM]-[17]-['str' object has no attribute 'lfind']:{"name":"17.插入数据到临时表1","nodeId":"17","dsName":"GbaseDM","sql":"insert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\ttotal_score_0\\t)\\nselect \\tPHONE_NO as PHONE_NO,\\n\\t\\tsum(case when SCOREYEAR = 2016 then CUR_BALANCE else 0 end) as total_score_0\\nfrom gbasedwi.DWI_INCO_BILL_SCORE_BALANC_DS_${curmlastday} group by PHONE_NO;\\n\\ninsert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\tI0622\\t)\\nselect phone_no,\\n       count(*) I0622\\n  from ${SOURCE_DWI_CSV_HOTL_CHL_DEALBUSI_DM_YYYYMM}\\n  where LVL1_BUSI_TYPE_KIND = '积分查询' \\n  GROUP BY phone_no;\\n\\ninsert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\tpay_self_service_count,\\n\\tpay_web_count)\\nselect a1.PHONE_NO,\\nsum(case when a1.PAY_CHL_ID = 'SELF_SERVICE' then 1 else 0 end)  pay_self_service_count, /*自助终端交费次数*/\\nsum(case when a1.PAY_CHL_ID = 'WEB' then 1 else 0 end)  pay_web_count   /*网站交费次数*/\\nfrom (\\n select a11.PHONE_NO, a11.PAY_CHL_ID, a11.PAY_AMT from gbasedwi.DWI_RES_CHL_RECHARGE_MS_${monthid}   a11 where a11.PAYMENT_STATUS = 'OK' union all\\n select a11.PHONE_NO, a11.PAY_CHL_ID, a11.PAY_AMT from gbasedwi.DWI_RES_CHL_RECHARGE_MS_${pmonthid}  a11 where a11.PAYMENT_STATUS = 'OK' union all\\n select a11.PHONE_NO, a11.PAY_CHL_ID, a11.PAY_AMT from gbasedwi.DWI_RES_CHL_RECHARGE_MS_${p2monthid} a11 where a11.PAYMENT_STATUS = 'OK' union all\\n select a11.PHONE_NO, a11.PAY_CHL_ID, a11.PAY_AMT from gbasedwi.DWI_RES_CHL_RECHARGE_MS_${p3monthid} a11 where a11.PAYMENT_STATUS = 'OK' union all\\n select a11.PHONE_NO, a11.PAY_CHL_ID, a11.PAY_AMT from gbasedwi.DWI_RES_CHL_RECHARGE_MS_${p4monthid} a11 where a11.PAYMENT_STATUS = 'OK'  union all\\n select a11.PHONE_NO, a11.PAY_CHL_ID, a11.PAY_AMT from gbasedwi.DWI_RES_CHL_RECHARGE_MS_${p5monthid} a11 where a11.PAYMENT_STATUS = 'OK'\\n) a1 group by a1.PHONE_NO;\\n\\n\\n\\ninsert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\tLOGINWEB_COUNTS)\\nselect SERV_NO, \\ncount(SERV_NO) LOGINWEB_COUNTS /*登录网上营业厅次数*/\\nfrom GbaseDWD.DWD_EVT_LOG_WEB_REG_DM_${monthid}  group by SERV_NO;\\n\\n\\ninsert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\tcontact_mtoivr_count_1,\\n\\tCONTACT_WEB_LOGIN_COUNT_1,\\n\\tCONTACT_SMS_CONTACT_COUNT_1)\\nselect\\na.PHONE_NO,\\nsum(case when a.TOUCH_CHL = '10086_M_TO_IVR' then 1 else 0 end) contact_mtoivr_count_1,  /*人工转自助次数（1个月）*/\\nsum(case when a.TOUCH_CHL = 'WEB' then 1 else 0 end) CONTACT_WEB_LOGIN_COUNT_1, /*网站登录次数（1个月）*/\\nsum(case when a.TOUCH_CHL = 'SMS' then 1 else 0 end)  CONTACT_SMS_CONTACT_COUNT_1 /*短信渠道接触次数（1个月）*/\\nfrom (select a1.* from gbasedwi.DWI_CSV_CAMP_E_CHL_CONTACT_DM_${monthid} a1 where a1.STATE = 'OK') a \\ngroup by a.PHONE_NO;\\n\\n\\n\\ninsert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\tcontact_manual_service_count_1,\\n\\tcontact_ivr_contact_count_1)\\nselect\\na.PHONE_NO,\\nsum(case when a.ACES_WAY in (2) then 1 else 0 end)  contact_manual_service_count_1,  #人工呼入次数（1个月）\\nsum(case when a.ACES_WAY in (3) then 1 else 0 end)  contact_ivr_contact_count_1       #IVR渠道接触次数（1个月）\\nfrom gbasedwd.DWD_EVT_HCI_CALLED_RECORD_DM_${monthid} a\\ngroup by a.PHONE_NO;\\n\\n\\ninsert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\tcontact_mtoivr_count,\\n\\tcontact_web_login_count,\\n\\tcontact_web_register_status_id,\\n\\tCONTACT_SMS_CONTACT_COUNT)\\nselect\\na.PHONE_NO,\\nsum(case when a.TOUCH_CHL = '10086_M_TO_IVR' then 1 else 0 end)  contact_mtoivr_count,  /*人工转自助次数（3个月）*/\\nsum(case when a.TOUCH_CHL = 'WEB' then 1 else 0 end)  contact_web_login_count, /*网站登录次数（3个月）*/\\nmax(case when a.TOUCH_CHL = 'WEB_REGISTER' then 'Y' end)  contact_web_register_status_id, /*网站注册（3个月内注册）*/\\nsum(case when a.TOUCH_CHL = 'SMS' then 1 else 0 end) CONTACT_SMS_CONTACT_COUNT /*短信渠道接触次数（3个月）*/\\nfrom (\\nselect a1.TOUCH_CHL,a1.PHONE_NO from gbasedwi.DWI_CSV_CAMP_E_CHL_CONTACT_DM_${monthid}  a1 where a1.STATE = 'OK' union all\\nselect a1.TOUCH_CHL,a1.PHONE_NO from gbasedwi.DWI_CSV_CAMP_E_CHL_CONTACT_DM_${pmonthid} a1 where a1.STATE = 'OK' union all\\nselect a1.TOUCH_CHL,a1.PHONE_NO from gbasedwi.DWI_CSV_CAMP_E_CHL_CONTACT_DM_${p2monthid} a1 where a1.STATE = 'OK'\\n) a group by a.PHONE_NO;\\n\\n\\n\\ninsert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\tCONTACT_MANUAL_SERVICE_COUNT,\\n\\tCONTACT_IVR_CONTACT_COUNT)\\nselect\\na.PHONE_NO,\\nsum(case when a.ACES_WAY in (2) then 1 else 0 end) CONTACT_MANUAL_SERVICE_COUNT, #人工呼入次数（3个月）\\nsum(case when a.ACES_WAY in (3) then 1 else 0 end) CONTACT_IVR_CONTACT_COUNT #IVR渠道接触次数（3个月)\\nfrom(\\nselect a1.ACES_WAY,a1.PHONE_NO from gbasedwd.DWD_EVT_HCI_CALLED_RECORD_DM_${monthid} a1 union all\\nselect a1.ACES_WAY,a1.PHONE_NO from gbasedwd.DWD_EVT_HCI_CALLED_RECORD_DM_${pmonthid} a1 union all\\nselect a1.ACES_WAY,a1.PHONE_NO from gbasedwd.DWD_EVT_HCI_CALLED_RECORD_DM_${p2monthid} a1 \\n)a group by a.PHONE_NO;\\n\\n\\ninsert into ${SOURCE_TMP_DM_AUTORPT_CS_01}\\n(\\tphone_no,\\n\\tuse_10086ivr_query_charge_cnt,\\n\\tuse_sms_query_charge_count,\\n\\tuse_wap_query_charge_count,\\n\\tUSE_SELF_SERV_QUERY_CHARGE_CNT,\\n\\tuse_web_query_charge_count)\\nselect\\na.PHONE_NO,\\nsum(case when a.ELEC_CHL_ID = '10086IVR' then 1 else 0 end)    use_10086ivr_query_charge_cnt,  /*10086IVR话费查询次数（6个月）*/\\nsum(case when a.ELEC_CHL_ID = 'SMS' then 1 else 0 end)  use_sms_query_charge_count, /*短信话费查询次数（6个月）*/\\nsum(case when a.ELEC_CHL_ID = 'WAP' then 1 else 0 end)\\tuse_wap_query_charge_count, /*WAP话费查询次数（6个月）*/\\nsum(case when a.ELEC_CHL_ID = 'SELF_SERVICE'  then 1 else 0 end) USE_SELF_SERV_QUERY_CHARGE_CNT,  /*自助终端话费查询次数（6个月）*/\\nsum(case when a.ELEC_CHL_ID = 'WEB' then 1 else 0 end)  use_web_query_charge_count  /* 网站话费查询次数（6个月）*/\\nfrom (select a1.PHONE_NO, a1.ELEC_CHL_ID from gbasedwi.DWI_RES_CAMP_E_CHL_QUERY_CALL_CHARGE_DM_${monthid}   a1 where a1.STATE = 'OK' union all\\n      select a1.PHONE_NO, a1.ELEC_CHL_ID from gbasedwi.DWI_RES_CAMP_E_CHL_QUERY_CALL_CHARGE_DM_${pmonthid}  a1 where a1.STATE = 'OK' union all\\n      select a1.PHONE_NO, a1.ELEC_CHL_ID from gbasedwi.DWI_RES_CAMP_E_CHL_QUERY_CALL_CHARGE_DM_${p2monthid} a1 where a1.STATE = 'OK' union all\\n      select a1.PHONE_NO, a1.ELEC_CHL_ID from gbasedwi.DWI_RES_CAMP_E_CHL_QUERY_CALL_CHARGE_DM_${p3monthid} a1 where a1.STATE = 'OK' union all\\n      select a1.PHONE_NO, a1.ELEC_CHL_ID from gbasedwi.DWI_RES_CAMP_E_CHL_QUERY_CALL_CHARGE_DM_${p4monthid} a1 where a1.STATE = 'OK'  union all\\n      select a1.PHONE_NO, a1.ELEC_CHL_ID from gbasedwi.DWI_RES_CAMP_E_CHL_QUERY_CALL_CHARGE_DM_${p5monthid} a1 where a1.STATE = 'OK'\\n) a group by a.PHONE_NO;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [95]-[index:163]-[客服表--DM_AUTORPT_CS_YYYYMM]-[71]-['str' object has no attribute 'lfind']:{"name":"71.18","nodeId":"71","dsName":"GbaseDWA","sql":"drop table dm.tmp_DM_AUTORPT_CS_18_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_18_${monthid}\\n(product_no varchar(20),\\nCUR_MON_STOP_DAYS  bigint,\\nacct1_arpu     decimal(20,2),\\nacct2_arpu     decimal(20,2),\\nacct3_arpu     decimal(20,2)\\n)distributed by ('PRODUCT_NO'); \\ninsert into dm.tmp_DM_AUTORPT_CS_18_${monthid}\\nselect distinct a.phone_no,\\n       nvl(b.CUR_MON_STOP_DAYS,0),\\n\\t   nvl(c.acct_book_balance,0),\\n\\t   nvl(d.acct2_arpu,0),\\n\\t   nvl(d.acct3_arpu,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select phone_no,max(CUR_MON_STOP_DAYS) CUR_MON_STOP_DAYS\\n           from gbasedwi.DWI_USR_PESN_STOPINDEX_MS_${monthid}\\n\\t\\t   group by phone_no\\n\\t\\t   )b on a.phone_no=b.phone_no\\nleft join (select acct_id,sum(acct_book_balance) as acct_book_balance\\n           from gbasedwd.dwd_acc_book_balanc_ds_${curmlastday} a\\n           left join gbasedwd.Dwd_Acc_Book_Code_Flag_ds_${curmlastday} b on a.acct_book_item_id = b.acct_book_type\\n           where b.acct_book_attr = '20' and wrtof_way = '0' \\n           group by acct_id\\n\\t\\t   )c on a.acct_id=c.acct_id\\nleft join (select acct_id,\\n                  sum(case when acct_book_item_id='82950' then ACCT_BOOK_BALANCE else 0 end) acct2_arpu,\\n                  sum(case when acct_book_item_id='82951' then ACCT_BOOK_BALANCE else 0 end) acct3_arpu\\n           from gbasedwd.dwd_acc_book_balanc_ds_${curmlastday}\\n           where acct_book_state='1' group by acct_id\\n\\t\\t   )d on a.acct_id=d.acct_id\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n","parentDsName":"GbaseDWA"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [96]-[index:164]-[客服表--DM_AUTORPT_CS_YYYYMM]-[105]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_DM_AUTORPT_CS_05_23_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_05_23_${monthid}\\n(phone_no    varchar(20),\\n user_id     varchar(20),\\n ms_no_jif_bt_fee_ft  decimal(18,2),   -- 当月折后实收收入（不含积分保拓）趸付产品分摊\\n my_no_jif_bt_fee_ft  decimal(18,2),   -- 当月折后应收收入（不含积分保拓）趸付产品分摊\\n p_my_no_jif_bt_fee_ft  decimal(18,2),   -- 当月折后应收收入（不含积分保拓）趸付产品分摊-前1个月\\n p2_my_no_jif_bt_fee_ft  decimal(18,2),   -- 当月折后应收收入（不含积分保拓）趸付产品分摊-前2个月\\n py_my_no_jif_bt_fee_ft  decimal(18,2)   -- 当月折后应收收入（不含积分保拓）趸付产品分摊-上年末\\n )distributed by ('phone_no');\\n \\ninsert into dm.tmp_DM_AUTORPT_CS_05_23_${monthid}\\nselect a.phone_no,\\n       a.user_id,\\n       case when i.user_id is not null then i.des_cur_mon\\n       else nvl(a2.ms_no_jif_bt_fee,0)-nvl(b.should_income,0)+nvl(c.des_cur_mon,0)-nvl(d.should_income,0) end ,  -- 当月折后实收收入（不含积分保拓）-趸付产品总收入+趸付产品分摊收入-冬日暖\\n       case when i.user_id is not null then i.des_cur_mon\\n       else nvl(a2.my_no_jif_bt_fee,0)-nvl(b.should_income,0)+nvl(c.des_cur_mon,0)-nvl(d.should_income,0) end ,   -- 当月折后应收收入（不含积分保拓）-趸付产品总收入+趸付产品分摊收入-冬日暖\\n       nvl(f.my_no_jif_bt_fee_ft,0),\\n       nvl(g.my_no_jif_bt_fee_ft,0),\\n       nvl(h.my_no_jif_bt_fee_ft,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a  \\nleft join dm.tmp_DM_AUTORPT_CS_13_${monthid} a2 on a.user_id=a2.user_id\\nleft join (select phone_no,user_id,sum(should_income) should_income from dm.dm_pub_basekpi_over_detail_mm\\n           where op_time='${curm_first_day}' and fee_type_id in (1,3,4) and fee_item_id not in ('20658','21116','2111601') group by 1,2 -- fee_type_id in (1,3) 趸付产品分摊\\n           ) b on a.user_id=b.user_id\\nleft join (select phone_no,user_id,sum(des_cur_mon) des_cur_mon from dm.dm_pub_basekpi_over_detail_mm\\n           where create_time<='${curm_first_day}' and end_time>'${curm_first_day}' and fee_type_id in (1,3,4) \\n           and fee_item_id not in ('20658','21116','2111601')\\n           group by 1,2  -- fee_type_id in (1,3) 趸付产品分摊\\n           ) c on a.user_id=c.user_id\\nleft join (select phone_no,user_id,sum(should_income) should_income from dm.dm_pub_basekpi_over_detail_mm\\n           where op_time='${curm_first_day}' and fee_item_id in ('20666','20864','21111','21319','20667') group by 1,2   -- 需要剔除的费项（冬日暖心半年包/新NBA联盟半年包/流量半年/数字生活）\\n           ) d on a.user_id=d.user_id\\nleft join (select PRODUCT_NO,my_no_jif_bt_fee_ft from dm.DM_AUTORPT_CS_${pmonthid}) f on a.phone_no=f.product_no\\nleft join (select PRODUCT_NO,my_no_jif_bt_fee_ft from dm.DM_AUTORPT_CS_${p2monthid}) g on a.phone_no=g.product_no\\nleft join (select PRODUCT_NO,my_no_jif_bt_fee_ft from DM_AUTORPT_CS_${preylastmonth}@dblink_dm) h on a.phone_no=h.product_no\\nleft join (select phone_no,user_id,sum(des_cur_mon) des_cur_mon from dm.dm_pub_basekpi_over_detail_mm\\n           where create_time<='${curm_first_day}' and end_time>'${curm_first_day}' and fee_item_id in ('2111601') group by 1,2 -- 新增费项\\n           ) i on a.user_id=i.user_id\\nWHERE (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [97]-[index:165]-[客服表--DM_AUTORPT_CS_YYYYMM]-[51]-['str' object has no attribute 'lfind']:{"name":"51.1","nodeId":"51","dsName":"GbaseDM","sql":"drop table dm.tmp_DM_AUTORPT_CS_10_${monthid};\\ncreate table dm.tmp_DM_AUTORPT_CS_10_${monthid}\\n(product_no varchar(20),\\nis_zh_sjd       int,  -- 折后升降档\\nplan_fee_zh_jj  decimal(35,2),  -- 即将生效折后套餐费\\nlingqu_score    bigint,  -- 倍享积分已领取分值\\nno_score        bigint,  -- 倍享积分未领取分值\\ntrun_time       date    -- 末次领取积分日期\\n)distributed by ('PRODUCT_NO');\\ninsert into dm.tmp_DM_AUTORPT_CS_10_${monthid}\\nselect distinct a.phone_no,\\n       b.is_sjd,\\n\\t   b.plan_fee_1,\\n\\t   nvl(lingqu_score,0),\\n\\t   nvl(no_score,0),\\n\\t   trun_time\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select phone_no,is_sjd,plan_fee_1,row_number()over(partition by phone_no order by is_sjd,op_time desc)rn\\n           from gbaserpt.rpt_nq201911001_zh_sjd_info_${curmlastday}) b on a.phone_no=b.phone_no and b.rn=1\\nleft Join (select phone_no,\\n                  sum(case when state=2 then data_busi_score else 0 end) lingqu_score,\\n\\t\\t\\t\\t  sum(case when state=4 then data_busi_score else 0 end) no_score\\n           from gbaserpt.rpt_new_list_${monthid} group by phone_no\\n\\t\\t   )c on a.phone_no=c.phone_no\\nleft join (select phone_no,date(max(trun_time))trun_time \\n           from gbasedwi.dwi_inco_bill_score_tradesn_dt_${monthid} where trun_type=88 group by phone_no\\n)d on a.phone_no=d.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [98]-[index:166]-[IMEI信息视图]-[26]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp02_dm_pub_imei_info_ds_${dayid};\\ncreate table dm.tmp02_dm_pub_imei_info_ds_${dayid} distributed by ('IMEI')\\nselect -- A.INST_PROD_ID, \\n       B.IS_ECOMMERCE  B_IS_ECOMMERCE, \\n       A.CREATE_DATE,\\n       A.SUPPLY_ID,\\n       A.SALE_DATE,\\n       A.IMEI,\\n       A.BUSSINESS_TYPE,\\n       A.CHANNEL_ATTR,\\n       A.BILL_ID,\\n       A.FLOWNUM,\\n       A.WORK_NUM,\\n       A.SALER_NAME,\\n       A.SALER_ID,\\n       A.BSNAME A_BSNAME,\\n       A.BS_PACKGE_NAME A_BS_PACKGE_NAME,\\n       BA.SEC_COMPANY BA_SEC_COMPANY,\\n       B.MODE_TYPE B_MODE_TYPE,\\n       B.brand_id ED_brand_id,\\n       B.PROD_CODE_ID B_PROD_CODE_ID,\\n       B.PROD_NAME B_PROD_NAME,\\n       B.RSRV_STR2 B_RSRV_STR2,\\n       B.IS_PUBLIC B_IS_PUBLIC,\\n       B.PROD_LEVEL_SECOND B_PROD_LEVEL_SECOND,\\n       BA.ORG_CODE BA_ORG_CODE,\\n       BA.ORG_NAME BA_ORG_NAME,\\n       b.prod_spec_id b_prod_spec_id,\\n       BA.ORG_TYPE BA_ORG_TYPE,\\n       BA.ORG_TYPE_L3 BA_ORG_TYPE_L3,\\n       '' e_bill_id,\\n       B.Prod_Level B_Prod_Level,\\n       ed.res_sku_id ED_RES_SKU_ID,\\n       ed.in_type,\\n       ed.instore_date\\nFROM gbasedwd.DWD_RES_SVC_TM_PROD_SPEC_DS_${dayid} B -- TM_PROD_SPEC B\\ninner JOIN gbasedwd.DWD_RES_SVC_SALE_INST_DS_${dayid} A  ON A.PROD_SPEC_ID = B.PROD_SPEC_ID -- TM_SALE_INST_2023 A\\ninner JOIN gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} BA ON A.SEC_ORG_ID = BA.ORG_ID -- TM_ORGANIZATION BA\\ninner JOIN gbasedwd.DWD_RES_SVC_USED_MBL_DS_${dayid} ED  ON A.IMEI = ED.IMEI-- TM_USED_MBL ED\\nWHERE A.ISOUT = 1 AND A.STATE = 'U' AND A.BUSSINESS_TYPE = 4\\n \\nunion all \\n   \\nselect -- A.INST_PROD_ID,\\n       B.IS_ECOMMERCE  B_IS_ECOMMERCE, \\n       A.CREATE_DATE,\\n       A.SUPPLY_ID,\\n       A.SALE_DATE,\\n       A.IMEI,\\n       A.BUSSINESS_TYPE,\\n       A.CHANNEL_ATTR,\\n       A.BILL_ID,\\n       A.FLOWNUM,\\n       A.WORK_NUM,\\n       A.SALER_NAME,\\n       A.SALER_ID,\\n       A.BSNAME            A_BSNAME,\\n       A.BS_PACKGE_NAME    A_BS_PACKGE_NAME,\\n       BA.SEC_COMPANY      BA_SEC_COMPANY,\\n       B.MODE_TYPE         B_MODE_TYPE,\\n       B.brand_id          ED_brand_id,\\n       B.PROD_CODE_ID      B_PROD_CODE_ID,\\n       B.PROD_NAME         B_PROD_NAME,\\n       B.RSRV_STR2         B_RSRV_STR2,\\n       B.IS_PUBLIC         B_IS_PUBLIC,\\n       B.PROD_LEVEL_SECOND B_PROD_LEVEL_SECOND,\\n       BA.ORG_CODE         BA_ORG_CODE,\\n       BA.ORG_NAME         BA_ORG_NAME,\\n       b.prod_spec_id      b_prod_spec_id,\\n       BA.ORG_TYPE         BA_ORG_TYPE,\\n       BA.ORG_TYPE_L3      BA_ORG_TYPE_L3,\\n       e.bill_id           e_bill_id,\\n       B.Prod_Level        B_Prod_Level,\\n       ed.res_sku_id       ED_RES_SKU_ID,\\n       ed.in_type,\\n       ed.instore_date\\nFROM gbasedwd.DWD_RES_SVC_TM_PROD_SPEC_DS_${dayid} B -- TM_PROD_SPEC B\\ninner JOIN gbasedwd.DWD_RES_SVC_SALE_INST_DS_${dayid} A  ON A.PROD_SPEC_ID = B.PROD_SPEC_ID -- TM_SALE_INST_2023 A\\ninner JOIN gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} BA ON A.SEC_ORG_ID = BA.ORG_ID  -- TM_ORGANIZATION BA\\ninner JOIN gbasedwd.DWD_RES_SVC_USED_MBL_DS_${dayid} ED ON A.IMEI = ED.IMEI  -- TM_USED_MBL ED\\nLEFT JOIN gbasedwd.DWD_RES_SVC_SALE_INST_DS_${dayid} E ON A.IMEI = E.IMEI AND E.STATE = 'U' AND E.ISOUT = 1 AND E.BUSSINESS_TYPE = 1 -- TM_SALE_INST_2023 E\\nWHERE A.ISOUT IS NULL AND A.STATE = 'U' AND A.BUSSINESS_TYPE = 7\\n\\nunion all\\n        \\nselect -- A.INST_PROD_ID,\\n       B.IS_ECOMMERCE  B_IS_ECOMMERCE, \\n       A.CREATE_DATE,\\n       A.SUPPLY_ID,\\n       A.SALE_DATE,\\n       A.IMEI,\\n       A.BUSSINESS_TYPE,\\n       A.CHANNEL_ATTR,\\n       A.BILL_ID,\\n       A.FLOWNUM,\\n       A.WORK_NUM,\\n       A.SALER_NAME,\\n       A.SALER_ID,\\n       A.T1_BSNAME A_BSNAME,\\n       A.T1_BS_PACKGE_NAME A_BS_PACKGE_NAME,\\n       BA.SEC_COMPANY BA_SEC_COMPANY,\\n       B.MODE_TYPE B_MODE_TYPE,\\n       B.brand_id ED_brand_id,\\n       B.PROD_CODE_ID B_PROD_CODE_ID,\\n       B.PROD_NAME B_PROD_NAME,\\n       B.RSRV_STR2 B_RSRV_STR2,\\n       B.IS_PUBLIC B_IS_PUBLIC,\\n       B.PROD_LEVEL_SECOND B_PROD_LEVEL_SECOND,\\n       BA.ORG_CODE BA_ORG_CODE,\\n       BA.ORG_NAME BA_ORG_NAME,\\n       b.prod_spec_id b_prod_spec_id,\\n       BA.ORG_TYPE BA_ORG_TYPE,\\n       BA.ORG_TYPE_L3 BA_ORG_TYPE_L3,\\n       '' e_bill_id,\\n       B.Prod_Level B_Prod_Level,\\n       ed.res_sku_id ED_RES_SKU_ID,\\n       ed.in_type,\\n       ed.instore_date\\nFROM gbasedwd.DWD_RES_SVC_TM_PROD_SPEC_DS_${dayid} B -- TM_PROD_SPEC B\\ninner JOIN (select t1.*,'裸机销售' T1_BSNAME,'裸机销售' T1_BS_PACKGE_NAME\\n            from gbasedwd.DWD_RES_SVC_SALE_INST_DS_${dayid} T1 -- TM_SALE_INST_2023 t1\\n            LEFT JOIN gbasedwd.DWD_RES_SVC_SALE_INST_DS_${dayid} E ON t1.IMEI = E.IMEI AND E.STATE = 'U' AND E.BUSSINESS_TYPE = 7 -- TM_SALE_INST_2023 e\\n            WHERE t1.ISOUT = 1 AND t1.STATE = 'U' AND t1.BUSSINESS_TYPE = 1 and e.imei is null\\n            ) A ON A.PROD_SPEC_ID = B.PROD_SPEC_ID\\ninner JOIN gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} BA ON A.SEC_ORG_ID = BA.ORG_ID -- TM_ORGANIZATION BA\\ninner JOIN gbasedwd.DWD_RES_SVC_USED_MBL_DS_${dayid} ED ON A.IMEI = ED.IMEI -- TM_USED_MBL ED\\nWHERE 1 = 1\\n\\nunion all\\n\\nselect -- A.INST_PROD_ID,\\n       B.IS_ECOMMERCE  B_IS_ECOMMERCE, \\n       A.CREATE_DATE,\\n       A.SUPPLY_ID,\\n       A.SALE_DATE,\\n       A.IMEI,\\n       A.BUSSINESS_TYPE,\\n       A.CHANNEL_ATTR,\\n       A.BILL_ID,\\n       A.FLOWNUM,\\n       A.WORK_NUM,\\n       A.SALER_NAME,\\n       A.SALER_ID,\\n       A.BSNAME A_BSNAME,\\n       A.BS_PACKGE_NAME A_BS_PACKGE_NAME,\\n       BA.SEC_COMPANY BA_SEC_COMPANY,\\n       B.MODE_TYPE B_MODE_TYPE,\\n       B.brand_id ED_brand_id,\\n       B.PROD_CODE_ID B_PROD_CODE_ID,\\n       B.PROD_NAME B_PROD_NAME,\\n       B.RSRV_STR2 B_RSRV_STR2,\\n       B.IS_PUBLIC B_IS_PUBLIC,\\n       B.PROD_LEVEL_SECOND B_PROD_LEVEL_SECOND,\\n       BA.ORG_CODE BA_ORG_CODE,\\n       BA.ORG_NAME BA_ORG_NAME,\\n       b.prod_spec_id b_prod_spec_id,\\n       BA.ORG_TYPE BA_ORG_TYPE,\\n       BA.ORG_TYPE_L3 BA_ORG_TYPE_L3,\\n       e.bill_id e_bill_id,\\n       B.Prod_Level B_Prod_Level,\\n       ed.res_sku_id ED_RES_SKU_ID,\\n       ed.in_type,\\n       ed.instore_date\\nfrom gbasedwd.DWD_RES_SVC_TM_PROD_SPEC_DS_${dayid} B -- TM_PROD_SPEC B\\ninner join gbasedwd.DWD_RES_SVC_SALE_INST_DS_${dayid} A on A.PROD_SPEC_ID = B.PROD_SPEC_ID -- TM_SALE_INST_2023 A\\ninner join gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} BA on A.SEC_ORG_ID = BA.ORG_ID -- TM_ORGANIZATION BA\\nleft JOIN gbasedwd.DWD_RES_SVC_USED_MBL_DS_${dayid} ED ON A.IMEI = ED.IMEI -- TM_USED_MBL ED\\nleft join gbasedwd.DWD_RES_SVC_SALE_INST_DS_${dayid} e on a.imei = e.imei and e.state = 'U' and e.bussiness_type = 1 -- TM_SALE_INST_2023 e\\nWHERE A.ISOUT = 1 AND A.STATE = 'U' AND A.BUSSINESS_TYPE = 7 and e.imei is null\\n;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [99]-[index:169]-[IMEI信息视图]-[32]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp05_dm_pub_imei_info_ds_${dayid};\\ncreate table dm.tmp05_dm_pub_imei_info_ds_${dayid}\\nselect '${day_id}' as op_time,a.* from dm.tmp03_dm_pub_imei_info_ds_${dayid} a\\nunion \\nselect '${day_id}' as op_time,b.* from dm.tmp04_dm_pub_imei_info_ds_${dayid} b\\n;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [100]-[index:170]-[IMEI信息视图]-[14]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"14.create_table","nodeId":"14","sql":"drop table dm.tmp01_dm_pub_imei_info_ds_${dayid};\\ncreate table dm.tmp01_dm_pub_imei_info_ds_${dayid}\\n  (\\n OP_TIME                 DATE,                 -- 数据日期                \\n IMEI                    VARCHAR(20),          -- 14位imei             \\n IMEI8                   VARCHAR(8),           -- TAC码                \\n TERM_BRAND              VARCHAR(50),          -- 终端品牌                \\n TERM_MODEL              VARCHAR(50),          -- 终端型号                \\n REMAIN_TYPE             VARCHAR(60),          -- 终端类型                \\n SALE_STUS               VARCHAR(10),          -- 销售状态                \\n SALE_TIME               datetime,             -- 销售日期                \\n chl_class               int(11),              -- 销售渠道                \\n COUNTY_ID               SMALLINT,             -- 销售分公司               \\n SP_NAME                 VARCHAR(100),         -- 销售SP                \\n SALE_DEPT_NAME          VARCHAR(100),         -- 销售部门                \\n SVC_NAME                VARCHAR(100),         -- 销售方案                \\n SALE_PLAN               VARCHAR(100),         -- 销售方案类型              \\n SPECIAL_LOAD_FLAG       CHARACTER(10),        -- 是否特殊货源              \\n PRODUCT_NO_PLAN         VARCHAR(50),          -- 合约机号码               \\n IS_CELL                 CHARACTER(10),        -- 是否SCM销售             \\n FIRST_TIME              DATE,                 -- imei首次通信日期          \\n LAST_TIME               DATE,                 -- imei末次通信日期          \\n FIRST_BILL_PRODUCT_NO   VARCHAR(20),          -- imei首次计费号码          \\n FIRST_BILL_TIME         DATE,                 -- imei首次计费号码时间        \\n IS_PLAN_IMEI           SMALLINT,              -- 合约机号码是否与使用号码一致      \\n IMEI_CELL_COUNT         BIGINT,               -- imei当月对应基站数         \\n IMEI_PRODUCT_COUNT      BIGINT,               -- imei当月通信手机号码个数      \\n IMEI_MAX_PRODUCT        VARCHAR(20),          -- 当月使用最多手机号           \\n IMEI_MAX_PRODUCT_STATUS BIGINT,               -- 当月使用最多手机号的状态        \\n IMEI_MAX_PRODUCT_COUNTY BIGINT,               -- 前台不展示               \\n  IS_IMEI                 SMALLINT,            -- 是否稳定终端              \\n CALL_MARK               INTEGER,              -- 当月通信天数              \\n CALL_COUNTS             BIGINT,               -- 当月通话次数              \\n CALL_DURATION_M             BIGINT,           -- 当月T网通话时长（分钟）        \\n G2_FLOWS                BIGINT,               -- 当月使用2G流量            \\n G3_FLOWS                BIGINT,               -- 当月使用3G流量            \\n G4_FLOWS                BIGINT,               -- 当月使用4G流量            \\n G3_FLOWS_YEAR       BIGINT,                   -- 当年累计3G流量            \\nG3_FLOWS_YEAR_COUNT  BIGINT,                   -- 当年累计3G使用次数          \\nG4_FLOWS_YEAR        BIGINT,                   -- 当年累计4G流量            \\nG4_FLOWS_YEAR_COUNT  BIGINT ,                  -- 当年累计4G使用次数          \\nIMEI_THREEFOUR_PRODUCT VARCHAR(20)  ,          -- 3/4G稳定手机号码          \\nIMEI_THREEFOUR_PRODUCT_COUNTY  SMALLINT  ,     -- 3/4G稳定手机号码的归属分公司    \\nLAST_PRODUCT_NO   VARCHAR(20) ,                -- imei当月末次通信手机号码      \\nPROD_LEVEL varchar(50),                        -- 产品等级                \\ncall_dur   BIGINT,                             -- 当月通话时长（分钟）          \\nis_5g_imei   int,                              -- 是否5Gimei            \\nstandard   varchar(10),                        -- 制式                  \\nterminal_type   varchar(10),                   -- 是否手机                \\nrj_SA  varchar(10),                            -- 软件是否支持SA            \\nYJ_SA  varchar(10),                            -- 硬件是否支持SA            \\nrj_700 varchar(10),                            -- 软件是否支持700M          \\nyj_700 varchar(10)                             -- 硬件是否支持700M          \\n)distributed by ('IMEI')"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [101]-[index:172]-[IMEI信息视图]-[28]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp03_dm_pub_imei_info_ds_${dayid};\\ncreate table dm.tmp03_dm_pub_imei_info_ds_${dayid} distributed by ('IMEI')\\nselect distinct\\n       a.IMEI,\\n       case when a1.tac_no is not null then 1 else 0 end is_5G_imei,  -- 是否5Gimei\\n       case when a2.standard=1 then '5G' when a2.standard=2 then '4G' when a2.standard=3 then '3G' when a2.standard=4 then '2G' end standard, -- 制式 \\n       substr(a.IMEI,1,8) as IMEI8,-- TAC码\\n       case when a2.terminal_type=1 then '手机' else '非手机' end terminal_type,    -- 是否手机   \\n       a2.terminal_brand,      -- 终端品牌\\n       a2.terminal_model,      -- 终端型号    \\n       a3.TERM_TYPE,   -- 终端类型   \\n       a4.ITEM_VAL_VALUE, -- 设备类别\\n       a.B_PROD_CODE_ID,  -- 机型编码\\n       a.B_PROD_NAME, -- 机型名称\\n       a.B_RSRV_STR2, -- 通俗名称\\n       a5.ITEM_VAL_VALUE yanse,  -- 颜色\\n       a6.SUPPLY_PRICE/100 SUPPLY_PRICE, -- 供货价\\n       a6.price/100 as price, -- 零售价\\n       case when a.B_IS_PUBLIC='0' then '否' else '是' end IS_PUBLIC, -- 是否公开版,\\n       a7.code_name prod_lvl,  -- 产品等级\\n       a8.ITEM_VAL_VALUE as prod_lvl2, -- 产品等级二级\\n       a9.order_id, -- 要货订单编号\\n       a11.ORGANIZE_NAME as ORGANIZE_dept_NAME, -- 要货归属分公司\\n       a10.org_code as org_chl_code, -- 要货渠道商编码\\n       a10.org_name as org_chl_name, -- 要货渠道商名称\\n       a.B_PROD_NAME as prod_name, -- 订单商品\\n       a12.CODE_NAME ord_status, -- 订购状态\\n       a13.ORGANIZE_NAME as ORGANIZE_NAME, -- 仓库归属分公司\\n       a.BA_ORG_NAME as ORG_CODE, -- 仓库编码\\n       a.BA_ORG_CODE as ORG_NAME, -- 仓库组织名称\\n       a14.CODE_NAME as code_chl_name, -- 仓库渠道类型\\n       case when a.BA_ORG_TYPE='10000001' then '自有渠道' \\n            when a.BA_ORG_TYPE='10000002' then '社会渠道' \\n            when a.BA_ORG_TYPE='10000003' then '供货商' end as ORG_TYPE_sx,  -- 仓库渠道属性\\n       a17.ORG_NAME as gh_name,  -- 供货商\\n       '已售' as kucun_status,  -- 库存状态    \\n       a.instore_date, -- 入库时间\\n       case when a.in_type=1 then '自带机登记' when a.in_type=2 then '公开版入库' else '正常入库' end instore_type, -- 入库类型\\n       '已售' SALE_type,   -- 销售状态\\n       A.SALE_DATE,      -- 销售日期\\n       a13.ORGANIZE_NAME SALE_dept_name,   -- 销售归属分公司\\n       case when a13.ORGANIZE_ID='4850' then 4\\n            when a13.ORGANIZE_ID='4852' then 14\\n            when a13.ORGANIZE_ID='4851' then 1\\n            when a13.ORGANIZE_ID='4858' then 9\\n            when a13.ORGANIZE_ID='4855' then 12\\n            when a13.ORGANIZE_ID='4856' then 10\\n            when a13.ORGANIZE_ID='4853' then 11\\n            when a13.ORGANIZE_ID='4854' then 13\\n            when a13.ORGANIZE_ID='4860' then 8\\n            when a13.ORGANIZE_ID='4857' then 5\\n            when a13.ORGANIZE_ID='203199' then 15\\n            when a13.ORGANIZE_ID='4861' then 7\\n            when a13.ORGANIZE_ID='4859' then 6 else 999 end SALE_dept_id,\\n       a.BA_ORG_NAME ,    -- 销售组织名称\\n       a.BA_ORG_CODE,     -- 销售组织编码\\n       a14.CODE_NAME,     -- 销售渠道类型\\n       case when a.BA_ORG_TYPE='10000001' then '自有渠道' \\n            when a.BA_ORG_TYPE='10000002' then '社会渠道' \\n            when a.BA_ORG_TYPE='10000003' then '供货商' end BA_ORG_sx, -- 销售渠道属性\\n       a.A_BSNAME ,  -- 销售方案\\n       a.A_BS_PACKGE_NAME, -- 销售方案类型\\n       a15.OFFER_ID,   -- 策划ID\\n       CASE WHEN A.BUSSINESS_TYPE = 1 AND A.CHANNEL_ATTR = '10000002' THEN '社会渠道裸机方案'\\n            WHEN A.BUSSINESS_TYPE = 7 AND A.CHANNEL_ATTR = '10000002' THEN '社会渠道裸机方案'\\n            WHEN A.BUSSINESS_TYPE = 1 AND A.CHANNEL_ATTR = '10000001' THEN '营业厅裸机方案'\\n            WHEN A.BUSSINESS_TYPE = 7 AND A.CHANNEL_ATTR = '10000001' THEN '营业厅裸机方案'\\n            WHEN A.BUSSINESS_TYPE = 10 THEN '社会渠道二码方案'\\n            WHEN A.BUSSINESS_TYPE = 4 THEN '营业厅合约机方案' END plan_name,  -- 业务方案\\n       case when a16.STATUS=2 then '已结算'  else '未结算' end STATUS, -- 结算状态\\n       CASE WHEN a16.STATUS=2 then a16.oper_date END oper_date, -- 结算日期\\n       A.FLOWNUM, -- CRM交易号\\n       A.WORK_NUM, -- CRM工号\\n       A.SALER_NAME, -- 促销员名称\\n       A.SALER_ID, -- 促销员编码\\n       B_IS_ECOMMERCE -- 是否电商     \\nfrom (select distinct * from dm.tmp02_dm_pub_imei_info_ds_${dayid}) a\\nleft join (select distinct tac_no from gbasedwd.dwd_res_svc_term_brand_obass_ms_${pmonthid}\\n           where g5_flag=1\\n           ) a1 on substr(a.IMEI,1,8)=a1.tac_no\\nleft join gbaseods.ods_d_f_cmiot_91052_5g_terminal_tac_${pdayid} a2 on substr(a.IMEI,1,8)=a2.tac\\nleft join gbasedwi.DWI_TMT_TERM_IMEIUSER_DS_${dayid} a3 on substr(a.IMEI,1,14)=substr(a3.term_imei,1,14)\\nleft join (select * from gbasedwd.DWD_RES_SVC_ITEM_VAL_DS_${dayid} where ITEM_VAL_CODE = '2') a4 on a.B_MODE_TYPE=a4.ITEM_VAL_ID  -- RES_ITEM_VAL\\nleft join (SELECT distinct CH.ITEM_VAL_VALUE,CH1.RES_SKU_ID\\n           FROM gbasedwd.DWD_RES_SVC_ITEM_VAL_DS_${dayid} CH  -- RES_ITEM_VAL\\n           left join gbasedwd.DWD_RES_SVC_SKU_ITEMVAL_DS_${dayid} CH1 on CH1.ITEM_VAL_CODE = CH.ITEM_VAL_ID -- RES_SKU_ITEMVAL CH1 \\n           WHERE CH1.item_code='PROD_COLOR'\\n           ) a5 on a.ED_RES_SKU_ID=a5.RES_SKU_ID\\nleft join (select g.prod_spec_id,r.SUPPLY_PRICE,r.valid_date_begin,r.valid_date_end,r.price \\n           from gbasedwd.DWD_RES_SVC_PROD_OFFER_SPEC_REL_DS_${dayid} g -- tm_prod_offer_spec_rel g,\\n           left join gbasedwd.DWD_RES_SVC_PROD_OFFER_DS_${dayid} f on g.prod_offer_id = f.tm_prod_offer_id -- tm_prod_offer f,\\n           left join gbasedwd.DWD_RES_SVC_PROD_OFFER_PRICE_DS_${dayid} r on g.prod_offer_id = r.prod_offer_id -- tm_prod_offer_price\\n           where f.offer_type = '3' and r.state = 'U'\\n           ) a6 on a.b_prod_spec_id=a6.prod_spec_id and a.create_date between a6.valid_date_begin and a6.valid_date_end\\nleft join (select code_name,code_value\\n           from gbasedwd.DWD_RES_SVC_TM_STATIC_DATA_DS_${dayid} -- TM_STATIC_DATA_${dayid}\\n           where code_type = 'PROD_LEVEL' AND state = 'U'\\n           ) a7 on a.B_Prod_Level=a7.code_value\\nleft join (select ITEM_VAL_VALUE,ITEM_VAL_ID \\n           from gbasedwd.DWD_RES_SVC_ITEM_VAL_DS_${dayid} -- RES_ITEM_VAL\\n           where ITEM_VAL_CODE = '6'\\n           ) a8 on a.B_PROD_LEVEL_SECOND=a8.ITEM_VAL_ID\\nleft join (select rrt.imei,\\n                 tsp.order_id, -- 要货订单编号\\n                 tsp.dest_org_id,\\n                 tsp.order_status,\\n                 ROW_NUMBER() OVER(PARTITION BY rrt.imei ORDER BY rrt.done_time DESC) rn\\n            from gbasedwd.DWD_RES_SVC_SP_ORDER_DS_${dayid} tsp -- TM_SP_ORDER tsp, \\n            left join gbasedwd.DWD_RES_SVC_RECORD_TERM_DS_${dayid} rrt on tsp.rela_out_order = rrt.record_id -- res_record_term_2023\\n            where tsp.buss_id in (1012, 1014)  \\n            and tsp.order_type = 80 \\n            and rrt.busi_type_id in ('81','82','71','72')\\n            and tsp.supp_id in ('48100072843','4825165','4825180')\\n           ) a9 on a.imei=a9.imei and a9.rn=1\\nleft join gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} a10 on a9.dest_org_id=a10.org_id -- tm_organization\\nleft join gbasedwd.DWD_RES_SVC_TM_AREA_DS_${dayid} a11 on a10.sec_company=a11.ORGANIZE_ID -- TM_AREA\\nleft join (select * from gbasedwd.DWD_RES_SVC_TM_STATIC_DATA_DS_${dayid}\\n           where code_type in ('ORDER_STUTAS','PURCHASE_ORDER_STATUS') \\n           )a12 on a9.order_status=a12.CODE_VALUE  -- TM_STATIC_DATA\\nleft join gbasedwd.DWD_RES_SVC_TM_AREA_DS_${dayid} a13 on a.BA_SEC_COMPANY=a13.ORGANIZE_ID -- TM_AREA\\nleft join (select * from gbasedwd.DWD_RES_SVC_TM_STATIC_DATA_DS_${dayid}  -- TM_STATIC_DATA\\n           where CODE_TYPE = 'REPORT_CHANNEL_TYPE'\\n           )a14 on a.BA_ORG_TYPE_L3=a14.CODE_VALUE  \\nleft join (select * from (select distinct BP_NAME,BUSINESS_NAME,OFFER_ID,\\n                                ROW_NUMBER() OVER(PARTITION BY bp_name,business_name ORDER BY done_date DESC) rn \\n                          from gbasedwd.DWD_RES_SVC_BUSINESS_PACKAGE_TYPE_DS_${dayid}   -- TM_MKT_BUSINESS_PACKAGE_TYPE\\n                          ) a where rn=1\\n          ) a15 on a.A_BS_PACKGE_NAME = a15.BP_NAME AND a.A_BSNAME = a15.BUSINESS_NAME          \\nleft join (select * from (select IMEI,STATUS,ISCOME,oper_date,ROW_NUMBER() OVER(PARTITION BY imei ORDER BY oper_date DESC) rn\\n                          from gbasedwd.DWD_RES_SVC_SETTLE_INSTANCE_DS_${dayid}) a -- tm_settle_instance\\n           where rn=1 and ISCOME = '1'\\n           ) a16 on a.Imei=a16.imei\\nleft join gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} a17 on a.SUPPLY_ID=a17.org_id -- tm_organization\\n;\\n\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [102]-[index:173]-[IMEI信息视图]-[30]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp04_dm_pub_imei_info_ds_${dayid};\\ncreate table dm.tmp04_dm_pub_imei_info_ds_${dayid} distributed by ('IMEI')\\nselect distinct \\n       A.IMEI,  -- IMEI15位\\n       case when a1.tac_no is not null then 1 else 0 end as is_5G_imei,  -- 是否5Gimei\\n       case when a2.standard=1 then '5G' when a2.standard=2 then '4G' when a2.standard=3 then '3G' when a2.standard=4 then '2G' end as standard, -- 制式 \\n       substr(a.IMEI,1,8) as IMEI8,-- TAC码\\n       case when a2.terminal_type=1 then '手机' else '非手机' end as terminal_type,    -- 是否手机   \\n       a2.terminal_brand,      -- 终端品牌\\n       a2.terminal_model,      -- 终端型号    \\n       a3.TERM_TYPE,   -- 终端类型\\n       a4.ITEM_VAL_VALUE, -- 设备类别\\n       B.PROD_CODE_ID ,  -- 机型编码, \\n       B.PROD_NAME as jix_PROD_NAME ,  -- 机型名称, \\n       B.RSRV_STR2 ,  -- 通俗名称,\\n       a5.ITEM_VAL_VALUE as yanse,  -- 颜色\\n       a6.SUPPLY_PRICE/100 as SUPPLY_PRICE, -- 供货价\\n       a6.price/100 as price, -- 零售价\\n       case when B.IS_PUBLIC='0' then '否' else '是' end as IS_PUBLIC, -- 是否公开版\\n       a7.code_name as prod_lvl,  -- 产品等级\\n       a8.ITEM_VAL_VALUE as prod_lvl2, -- 产品等级二级\\n       a9.order_id, -- 要货订单编号\\n       a11.ORGANIZE_NAME as ORGANIZE_dept_NAME, -- 要货归属分公司\\n       a10.org_code as org_chl_code, -- 要货渠道商编码\\n       a10.org_name as org_chl_name, -- 要货渠道商名称\\n       B.prod_name , -- 订单商品\\n       a12.CODE_NAME as ord_status, -- 订购状态\\n       T.ORGANIZE_NAME, -- 仓库归属分公司\\n       BA.ORG_CODE, -- 仓库编码\\n       BA.ORG_NAME, -- 仓库组织名称\\n       a13.CODE_NAME as code_chl_name, -- 仓库渠道类型\\n       case when BA.ORG_TYPE='10000001' then '自有渠道' \\n            when BA.ORG_TYPE='10000002' then '社会渠道'\\n            when BA.ORG_TYPE='10000003' then '供货商' end as  ORG_TYPE_sx,  -- 仓库渠道属性\\n       a13.ORG_NAME as gh_name,  -- 供货商\\n       a14.CODE_NAME kucun_status,  -- 库存状态    \\n       a.instore_date ,   -- 入库时间\\n       case when a.in_type=1 then '自带机登记' when a.in_type=2 then '公开版入库' else '正常入库' end as instore_type, -- 入库类型\\n       '未销售' as SALE_type,  -- 销售状态\\n       '' SALE_DATE,  -- 销售日期\\n       T.ORGANIZE_NAME as SALE_dept_name,   -- 销售归属分公司\\n       case when T.ORGANIZE_ID='4850' then 4\\n            when T.ORGANIZE_ID='4852' then 14\\n            when T.ORGANIZE_ID='4851' then 1\\n            when T.ORGANIZE_ID='4858' then 9\\n            when T.ORGANIZE_ID='4855' then 12\\n            when T.ORGANIZE_ID='4856' then 10\\n            when T.ORGANIZE_ID='4853' then 11\\n            when T.ORGANIZE_ID='4854' then 13\\n            when T.ORGANIZE_ID='4860' then 8\\n            when T.ORGANIZE_ID='4857' then 5\\n            when T.ORGANIZE_ID='203199' then 15\\n            when T.ORGANIZE_ID='4861' then 7\\n            when T.ORGANIZE_ID='4859' then 6 else 999 end SALE_dept_id,\\n       BA.ORG_NAME SALE_ORG_NAME,      -- 销售组织名称\\n       BA.ORG_CODE SALE_ORG_CODE,     -- 销售组织编码\\n       a15.CODE_NAME SALE_CODE_NAME,   -- 销售渠道类型\\n       case when BA.ORG_TYPE='10000001' then '自有渠道' \\n            when BA.ORG_TYPE='10000002' then '社会渠道' \\n            when BA.ORG_TYPE='10000003' then '供货商' end BA_ORG_sx, -- 销售渠道属性\\n       '' as A_BSNAME,  -- 销售方案\\n       '' as A_BS_PACKGE_NAME,  -- 销售方案类型\\n       '' as OFFER_ID,  -- 策划ID \\n       '' as plan_name,  -- 业务方案\\n       '' as STATUS,  -- 结算状态\\n       '' as OPER_TIME,  -- 结算日期 \\n       '' as FLOWNUM,   -- CRM交易号\\n       '' as WORK_NUM,   -- CRM工号\\n       '' as SALER_NAME,   -- 促销员名称\\n       '' as  SALER_ID,  -- 促销员编码\\n       B.IS_ECOMMERCE -- 是否电商\\nfrom (select distinct * \\n      from (select *,ROW_NUMBER() OVER(PARTITION BY imei ORDER BY instore_date DESC) rn\\n            from gbasedwd.DWD_RES_SVC_ORIGIN_MBL_DS_${dayid}) a \\n      where a.rn=1\\n     ) a -- TM_ORIGIN_MBL\\nleft join gbasedwd.DWD_RES_SVC_TM_PROD_SPEC_DS_${dayid} b on a.RES_SPU_ID=b.PROD_SPEC_ID  -- TM_PROD_SPEC\\nleft join gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} BA on A.MGMT_ORG_ID = BA.ORG_ID   -- TM_ORGANIZATION\\nleft join gbasedwd.DWD_RES_SVC_TM_BRAND_DS_${dayid} bn on A.BRAND_CODE = bn.brand_id  -- tm_brand\\nleft join gbasedwd.DWD_RES_SVC_TM_AREA_DS_${dayid} T on BA.SEC_COMPANY=T.ORGANIZE_ID  -- TM_AREA\\nleft join (select distinct tac_no from gbasedwd.dwd_res_svc_term_brand_obass_ms_${pmonthid}\\n           where g5_flag=1\\n           ) a1 on substr(a.IMEI,1,8)=a1.tac_no\\nleft join gbaseods.ods_d_f_cmiot_91052_5g_terminal_tac_${pdayid} a2 on substr(a.IMEI,1,8)=a2.tac\\nleft join gbasedwi.DWI_TMT_TERM_IMEIUSER_DS_${dayid} a3 on substr(a.IMEI,1,14)=substr(a3.term_imei,1,14)\\nleft join (select * from gbasedwd.DWD_RES_SVC_ITEM_VAL_DS_${dayid} where ITEM_VAL_CODE = '2'\\n           ) a4 on B.MODE_TYPE=a4.ITEM_VAL_ID  -- RES_ITEM_VAL\\nleft join (SELECT distinct CH.ITEM_VAL_VALUE,CH1.RES_SKU_ID\\n           FROM gbasedwd.DWD_RES_SVC_ITEM_VAL_DS_${dayid} CH  -- RES_ITEM_VAL\\n           left join gbasedwd.DWD_RES_SVC_SKU_ITEMVAL_DS_${dayid} CH1 on CH.ITEM_VAL_ID=CH1.ITEM_VAL_CODE -- RES_SKU_ITEMVAL CH1 \\n           WHERE CH1.item_code='PROD_COLOR'\\n           ) a5 on a.RES_SKU_ID=a5.RES_SKU_ID\\nleft join (select g.prod_spec_id,r.SUPPLY_PRICE,r.valid_date_begin,r.valid_date_end,r.price\\n           from gbasedwd.DWD_RES_SVC_PROD_OFFER_SPEC_REL_DS_${dayid} g -- tm_prod_offer_spec_rel g,\\n           left join gbasedwd.DWD_RES_SVC_PROD_OFFER_DS_${dayid} f on g.prod_offer_id = f.tm_prod_offer_id -- tm_prod_offer f,\\n           left join gbasedwd.DWD_RES_SVC_PROD_OFFER_PRICE_DS_${dayid} r on g.prod_offer_id = r.prod_offer_id -- tm_prod_offer_price\\n           where f.offer_type = '3' and r.state = 'U'\\n           ) a6 on b.prod_spec_id=a6.prod_spec_id and a.instore_date between a6.valid_date_begin and a6.valid_date_end\\nleft join (select code_name,code_value\\n           from gbasedwd.DWD_RES_SVC_TM_STATIC_DATA_DS_${dayid} -- TM_STATIC_DATA\\n           where code_type = 'PROD_LEVEL' AND state = 'U'\\n           ) a7 on B.Prod_Level=a7.code_value\\nleft join (select ITEM_VAL_VALUE,ITEM_VAL_ID \\n           from gbasedwd.DWD_RES_SVC_ITEM_VAL_DS_${dayid} -- RES_ITEM_VAL\\n           where ITEM_VAL_CODE = '6'\\n           ) a8 on B.PROD_LEVEL_SECOND=a8.ITEM_VAL_ID\\nleft join (select rrt.imei,\\n                 tsp.order_id, -- 要货订单编号\\n                 tsp.dest_org_id,\\n                 tsp.order_status,\\n                 ROW_NUMBER() OVER(PARTITION BY rrt.imei ORDER BY rrt.done_time DESC) rn\\n            from gbasedwd.DWD_RES_SVC_SP_ORDER_DS_${dayid} tsp -- TM_SP_ORDER_2023 tsp, \\n            left join gbasedwd.DWD_RES_SVC_RECORD_TERM_DS_${dayid} rrt on tsp.rela_out_order = rrt.record_id -- res_record_term_2023\\n            where tsp.buss_id in (1012, 1014)  \\n            and tsp.order_type = 80 \\n            and rrt.busi_type_id in ('81','82','71','72')\\n            and tsp.supp_id in ('48100072843','4825165','4825180')\\n           ) a9 on a.imei=a9.imei and a9.rn=1\\nleft join gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} a10 on a9.dest_org_id=a10.org_id -- tm_organization\\nleft join gbasedwd.DWD_RES_SVC_TM_AREA_DS_${dayid} a11 on a10.sec_company=a11.ORGANIZE_ID -- TM_AREA\\nleft join (select * from gbasedwd.DWD_RES_SVC_TM_STATIC_DATA_DS_${dayid}\\n           where code_type in ('ORDER_STUTAS','PURCHASE_ORDER_STATUS') \\n           )a12 on a9.order_status=a12.CODE_VALUE  -- TM_STATIC_DATA\\nleft join (select * from gbasedwd.DWD_RES_SVC_TM_STATIC_DATA_DS_${dayid}\\n           where CODE_TYPE = 'REPORT_CHANNEL_TYPE'\\n           ) a13 on BA.ORG_TYPE_L3=a13.CODE_VALUE  -- TM_STATIC_DATA\\nleft join gbasedwd.DWD_RES_SVC_TM_ORGANIZATION_ds_${dayid} a13 on A.SUPPLIER_ID=a13.ORG_ID -- tm_organization \\nleft join (select * from gbasedwd.DWD_RES_SVC_TM_STATIC_DATA_DS_${dayid}\\n           where CODE_TYPE = 'STOCK_STATE') a14 on a.RES_STATE=a14.CODE_VALUE  -- TM_STATIC_DATA\\nleft join (select * from gbasedwd.DWD_RES_SVC_TM_STATIC_DATA_DS_${dayid}  -- TM_STATIC_DATA\\n           where CODE_TYPE = 'REPORT_CHANNEL_TYPE'\\n           )a15 on BA.ORG_TYPE_L3=a15.CODE_VALUE  \\n;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [103]-[index:174]-[IMEI信息视图]-[20]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"20.处理脚本","nodeId":"20","sql":"insert into dm.tmp01_dm_pub_imei_info_ds_${dayid}\\n(op_time                                 , -- 数据日期\\n imei                                    , -- 14位imei\\n imei8                                   , -- TAC码\\n term_brand                              , -- 终端品牌\\n term_model                              , -- 终端型号\\n remain_type                             , -- 终端类型\\n sale_stus                               , -- 销售状态\\n sale_time                               , -- 销售日期\\n chl_class                               , -- 销售渠道\\n county_id                               , -- 销售分公司\\n sp_name                                 , -- 销售SP\\n sale_dept_name                          , -- 销售部门\\n svc_name                                , -- 销售方案\\n sale_plan                               , -- 销售方案类型\\n special_load_flag                       , -- 是否特殊货源\\n product_no_plan                         , -- 合约机号码\\n is_cell                                 , -- 是否SCM销售\\n first_time                              , -- imei首次通信日期\\n last_time                               , -- imei末次通信日期\\n first_bill_product_no                   , -- imei首次计费号码\\n first_bill_time                         , -- imei首次计费号码时间\\n is_plan_imei                            , -- 合约机号码是否与使用号码一致\\n imei_cell_count                         , -- imei当月对应基站数\\n imei_product_count                      , -- imei当月通信手机号码个数\\n imei_max_product                        , -- 当月使用最多手机号\\n imei_max_product_status                 , -- 当月使用最多手机号的状态\\n imei_max_product_county                 , -- 前台不展示\\n is_imei                                 , -- 是否稳定终端\\n call_mark                               , -- 当月通信天数\\n call_counts                             , -- 当月通话次数\\n call_duration_m                         , -- 当月T网通话时长（分钟）\\n g2_flows                                , -- 当月使用2G流量\\n g3_flows                                , -- 当月使用3G流量\\n g4_flows                                , -- 当月使用4G流量\\n g3_flows_year                           , -- 当年累计3G流量\\n g3_flows_year_count                     , -- 当年累计3G使用次数\\n g4_flows_year                           , -- 当年累计4G流量\\n g4_flows_year_count                     , -- 当年累计4G使用次数\\n imei_threefour_product                  , -- 3/4G稳定手机号码\\n imei_threefour_product_county           , -- 3/4G稳定手机号码的归属分公司\\n last_product_no                         , -- imei当月末次通信手机号码\\n prod_level                              , -- 产品等级\\n call_dur                                , -- 当月通话时长（分钟）\\n is_5g_imei                              , -- 是否5Gimei\\n standard                                , -- 制式\\n terminal_type                           , -- 是否手机\\n rj_SA                                   , -- 软件是否支持SA\\n YJ_SA                                   , -- 硬件是否支持SA\\n rj_700                                  , -- 软件是否支持700M\\n yj_700                                    -- 硬件是否支持700M\\n)\\nselect\\n'${day_id}',   -- 数据日期\\na.TERM_IMEI,   -- 14位imei \\nsubstr(a.TERM_IMEI,1,8) as IMEI8,-- TAC码    \\nbb.terminal_brand,      -- 终端品牌    \\nbb.terminal_model,      -- 终端型号    \\na.TERM_TYPE,   -- 终端类型    \\na.SALE_STATE,  -- 销售状态    \\na.SALE_DATE ,  -- 销售日期    \\nto_number(b.chl_class), -- 销售渠道    \\nnvl(e.county_id,a.SALE_FILIALE), -- 销售分公司   \\na.SALE_SP,     -- 销售SP    \\na.SALE_DEPT,   -- 销售部门    \\na.SALE_SOLU,   -- 销售方案    \\na.SALE_SOLU_TYPE,       -- 销售方案类型  \\na.IS_SPECSUP_OF_GOODS,  -- 是否特殊货源  \\na.CONTRACT_NO, -- 合约机号码   \\na.SCM_SALE_FLAG,        -- 是否SCM销售 \\ncast(a.IMEI_FIRST_COMM_DATE as date),     -- imei首次通信日期       \\ncast(a.IMEI_LAST_COMM_DATE as date),  /*cast(c.LAST6M_IMEI_LAST_VOC_DATE as date)*/    -- imei末次通信日期       \\na.IMEI_FIRST_BILL_NO,   -- imei首次计费号码       \\na.IMEI_FIRST_BILL_TIME, -- imei首次计费号码时间     \\ncase when a.CONTRACT_NO=a.G3G4_STAB_PHONE_NO then 1 else 0 end as IS_PLAN_IMEI,        -- 合约机号码是否与使用号码一致   \\na.IMEI_PRLL_BTS_NUM,    -- imei当月对应基站数      \\na.IMEI_COMM_PHONE_NO_NUM,        -- imei当月通信手机号码个数   \\na.CUR_MON_USE_MOST_PHONE_NO,     -- 当月使用最多手机号        \\na.USE_MOST_PHONE_NO_STATE,       -- 当月使用最多手机号的状态     \\na.USE_MOST_PHONE_NO_BELNG_FILIALE,        -- 前台不展示   \\na.STAB_TERM_FLAG,       -- 是否稳定终端  \\na.CUR_MON_COMM_DAYS,    -- 当月通信天数  \\na.CALL_NUM,    -- 当月通话次数  \\na.CALL_MIN_NUM,-- 当月T网通话时长（分钟）     \\na.G2_FLOW,     -- 当月使用2G流量\\na.G3_FLOW,     -- 当月使用3G流量\\na.G4_FLOW,     -- 当月使用4G流量\\na.G3_YT_FLOW,  -- 当年累计3G流量\\na.G3_YT_NUM,   -- 当年累计3G使用次数       \\na.G4_YT_FLOW,  -- 当年累计4G流量\\na.G4_YT_NUM,   -- 当年累计4G使用次数       \\na.G3G4_STAB_PHONE_NO,   -- 3/4G稳定手机号码       \\na.G3G4_STAB_BELNG_COUNTY_ID,     -- 3/4G稳定手机号码的归属分公司 \\na.LAST_COMM_NO,-- imei当月末次通信手机号码   \\nnvl(e.PROD_LEVEL,b.PROD_LEVEL),  -- 产品等级    \\nc.call_dur,    -- 当月通话时长（分钟）       \\ncase when d.tac_no is not null then 1 else 0 end,  -- 是否5Gimei\\ncase when standard=1 then '5G' when standard=2 then '4G' when standard=3 then '3G' when standard=4 then '2G' end, -- 制式      \\ncase when terminal_type=1 then '手机' else '非手机' end,    -- 是否手机    \\ncase when f.software=0 then '不支持' when f.software=1 then '支持' else '未识别' end rj_SA,     -- 软件是否支持SA\\ncase when f.hardware=0 then '不支持' when f.software=1 then '支持' else '未识别' end YJ_SA,     -- 硬件是否支持SA\\ncase when f1.software=0 then '不支持' when f1.software=1 then '支持' else '未识别' end rj_700,  -- 软件是否支持700M       \\ncase when f1.hardware=0 then '不支持' when f1.software=1 then '支持' else '未识别' end yj_700   -- 硬件是否支持700M       \\nfrom ${DWI_TMT_TERM_IMEIUSER_DS} a\\nleft join gbasedwi.dwi_res_term_sal_ds_${taskid} b on a.term_imei=substr(b.mob_imei,1,14)\\nleft join (select substr(imei,1,14) as imei,sum(call_dur) as call_dur \\n  from gbasedwi.dwi_beh_use_voc_imeitot_dt_${taskid} group by substr(imei,1,14)) c on a.term_imei=c.imei\\nleft join (select distinct tac_no from gbasedwd.dwd_res_svc_term_brand_obass_ms_${pmonthid}\\n  where g5_flag=1) d on substr(a.TERM_IMEI,1,8)=d.tac_no\\nleft join (select imei_14,nvl(b.county_id,0)county_id,dept_county_name,PROD_LEVEL \\n  from gbasedwd.dwd_res_svc_term_sale_sold_dt_${year} a\\n  left join dm.dim_chl_county_name b on a.dept_county_name=b.county_name\\n )e on a.term_imei=e.imei_14\\nleft join gbaseods.ods_d_f_cmiot_91052_5g_terminal_tac_${pdayid} bb on substr(a.TERM_IMEI,1,8)=bb.tac\\nleft join (select distinct * from DM.DIM_sa_700_beijing where type='SA') f on a.term_imei=substr(f.imei,1,14)\\nleft join (select distinct * from DM.DIM_sa_700_beijing where type='700M') f1 on a.term_imei=substr(f1.imei,1,14)\\n"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [104]-[index:175]-[IMEI信息视图]-[36]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into dm.dm_pub_imei_info_${dayid}\\nselect distinct \\n       a.OP_TIME                       ,  -- 数据日期                \\n       a.IMEI                          ,  -- 14位imei             \\n       a.IMEI8                         ,  -- TAC码                \\n       a.TERM_BRAND                    ,  -- 终端品牌                \\n       a.TERM_MODEL                    ,  -- 终端型号                \\n       a.REMAIN_TYPE                   ,  -- 终端类型                \\n       nvl(b.SALE_type,a.SALE_STUS) as SALE_STUS        ,  -- 销售状态_新                \\n       b.SALE_DATE as SALE_TIME        ,  -- 销售日期_新                \\n       a.chl_class                     ,  -- 销售渠道                \\n       b.SALE_dept_id COUNTY_ID      ,  -- 销售分公司_新 \\n       b.SALE_dept_name dept_COUNTY_ID   ,  -- 销售分公司id_新 \\n       a.SP_NAME                       ,  -- 销售SP   (前台下线)             \\n       a.SALE_DEPT_NAME                ,  -- 销售部门                \\n       b.A_BSNAME as SVC_NAME          ,  -- 销售方案_新                \\n       b.A_BS_PACKGE_NAME as SALE_PLAN ,  -- 销售方案类型_新              \\n       a.SPECIAL_LOAD_FLAG             ,  -- 是否特殊货源              \\n       a.PRODUCT_NO_PLAN               ,  -- 合约机号码               \\n       a.IS_CELL                       ,  -- 是否SCM销售    (前台下线)               \\n       a.FIRST_TIME                    ,  -- imei首次通信日期          \\n       a.LAST_TIME                     ,  -- imei末次通信日期          \\n       a.FIRST_BILL_PRODUCT_NO         ,  -- imei首次计费号码          \\n       a.FIRST_BILL_TIME               ,  -- imei首次计费号码时间        \\n       a.IS_PLAN_IMEI                  ,  -- 合约机号码是否与使用号码一致      \\n       a.IMEI_CELL_COUNT               ,  -- imei当月对应基站数         \\n       a.IMEI_PRODUCT_COUNT            ,  -- imei当月通信手机号码个数      \\n       a.IMEI_MAX_PRODUCT              ,  -- 当月使用最多手机号           \\n       a.IMEI_MAX_PRODUCT_STATUS       ,  -- 当月使用最多手机号的状态        \\n       a.IMEI_MAX_PRODUCT_COUNTY       ,  -- 前台不展示               \\n       a.IS_IMEI                       ,  -- 是否稳定终端              \\n       a.CALL_MARK                     ,  -- 当月通信天数              \\n       a.CALL_COUNTS                   ,  -- 当月通话次数              \\n       a.CALL_DURATION_M               ,  -- 当月T网通话时长（分钟）        \\n       a.G2_FLOWS                      ,  -- 当月使用2G流量            \\n       a.G3_FLOWS                      ,  -- 当月使用3G流量            \\n       a.G4_FLOWS                      ,  -- 当月使用4G流量            \\n       a.G3_FLOWS_YEAR                 ,  -- 当年累计3G流量            \\n       a.G3_FLOWS_YEAR_COUNT           ,  -- 当年累计3G使用次数          \\n       a.G4_FLOWS_YEAR                 ,  -- 当年累计4G流量            \\n       a.G4_FLOWS_YEAR_COUNT           ,  -- 当年累计4G使用次数          \\n       a.IMEI_THREEFOUR_PRODUCT        ,  -- 3/4G稳定手机号码          \\n       a.IMEI_THREEFOUR_PRODUCT_COUNTY ,  -- 3/4G稳定手机号码的归属分公司    \\n       a.LAST_PRODUCT_NO               ,  -- imei当月末次通信手机号码      \\n       b.prod_lvl as PROD_LEVEL        ,  -- 产品等级_新                \\n       a.call_dur                      ,  -- 当月通话时长（分钟）          \\n       a.is_5g_imei                    ,  -- 是否5Gimei            \\n       a.standard                      ,  -- 制式                  \\n       a.terminal_type                 ,  -- 是否手机                \\n       a.rj_SA                         ,  -- 软件是否支持SA            \\n       a.YJ_SA                         ,  -- 硬件是否支持SA            \\n       a.rj_700                        ,  -- 软件是否支持700M          \\n       a.yj_700                        ,  -- 硬件是否支持700M\\n       b.imei as imei_15               ,  -- IMEI（15位）_新\\n       b.ITEM_VAL_VALUE\\t               ,  -- 设备类别_新\\t\\n       b.B_PROD_CODE_ID\\t               ,  -- 机型编码_新\\n       b.B_PROD_NAME\\t               ,  -- 机型名称_新\\n       b.B_RSRV_STR2\\t               ,  -- 通俗名称_新\\n       b.YANSE\\t                       ,  -- 颜色_新\\n       b.SUPPLY_PRICE\\t               ,  -- 供货价_新\\n       b.IS_PUBLIC\\t                   ,  -- 是否公开版_新\\n       b.PROD_LVL2\\t                   ,  -- 产品等级二级_新\\n       b.BA_ORG_NAME\\t               ,  -- 销售组织名称_新\\n       b.BA_ORG_CODE\\t               ,  -- 销售组织编码_新\\n       b.BA_ORG_SX\\t                   ,  -- 销售渠道属性_新\\n       b.OFFER_ID\\t                   ,  -- 策划ID_新\\n       b.PLAN_NAME\\t                   ,  -- 业务方案_新\\n       b.STATUS\\t                       ,  -- 结算状态_新\\n       b.OPER_date as OPER_TIME\\t       ,  -- 结算日期_新\\n       b.FLOWNUM\\t                   ,  -- CRM交易号_新\\n       b.WORK_NUM\\t                   ,  -- CRM工号_新\\n       b.SALER_NAME\\t                   ,  -- 促销员名称_新\\n       b.SALER_ID\\t                   ,  -- 促销员编码_新\\n       b.B_IS_ECOMMERCE                   -- 是否电商_新 \\nfrom (select distinct * from dm.tmp01_dm_pub_imei_info_ds_${dayid}) a\\nleft join \\n(select distinct * from dm.tmp05_dm_pub_imei_info_ds_${dayid}) b on a.IMEI=substr(b.IMEI,1,14)\\n;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [105]-[index:177]-[日用户资料表导入应用库]-[13]-['str' object has no attribute 'lfind']:{"name":"13.插入数据2","nodeId":"13","dsName":"GbaseDM","sql":"insert into ${DM_PUB_USER_TMP03_DAYID}\\n (  USER_ID\\n   ,REPAY_SCORE\\n   ,EXPIRE_SCORE\\n   ,IS_SCROE_THREE\\n   ,IS_SCROE_SIX\\t\\n   ,IS_YIJING_ZEROCALL\\n   ,ZEROCALL_CUR_FLAG) \\nselect \\t t1.USER_ID\\t\\tUSER_ID\\n        ,NULL  /*t2.USER_EXCHG_SCORE*/         REPAY_SCORE\\n        ,t2.EXPIRE_SCORE   EXPIRE_SCORE\\n        ,null /*case when (t3.CUR_MON_CUT_CONSM_SCORE+t4.CUR_MON_CUT_CONSM_SCORE+t5.CUR_MON_CUT_CONSM_SCORE)<=0 then 1 else 0 end*/\\t\\tIS_SCROE_THREE\\n        ,null /*case when (t3.CUR_MON_CUT_CONSM_SCORE+t4.CUR_MON_CUT_CONSM_SCORE+t5.CUR_MON_CUT_CONSM_SCORE+t6.CUR_MON_CUT_CONSM_SCORE+t7.CUR_MON_CUT_CONSM_SCORE+t8.CUR_MON_CUT_CONSM_SCORE)<=0\\n              then 1 else 0 end*/\\t  IS_SCROE_SIX\\n\\t\\t,case when e.product_no is not null then 1 else 0 end  as IS_YIJING_ZEROCALL\\n\\t\\t,null   /*case when b.product_no is null then 1 else 0 end as ZEROCALL_CUR_FLAG*/\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} t1\\nleft join (select PHONE_NO,sum(TRUN_NUM) EXPIRE_SCORE from gbasedwi.DWI_INCO_BILL_SCORE_TRADESN_DS_${dayid}\\n\\t\\t   where TRUN_TYPE in ('60','61') group by phone_no) t2 on t1.phone_no=t2.phone_no\\n/*left join gbasedwi.DWI_INCO_BILL_USER_SCORE_DT_${premlastday} t3 on t1.user_id=t3.user_id\\nleft join gbasedwi.DWI_INCO_BILL_USER_SCORE_DT_${chk.p2lastday} t4 on t1.user_id=t4.user_id\\nleft join gbasedwi.DWI_INCO_BILL_USER_SCORE_DT_${chk.p3lastday} t5 on t1.user_id=t5.user_id\\nleft join gbasedwi.DWI_INCO_BILL_USER_SCORE_DT_${chk.p4lastday} t6 on t1.user_id=t6.user_id\\nleft join gbasedwi.DWI_INCO_BILL_USER_SCORE_DT_${chk.p5lastday} t7 on t1.user_id=t7.user_id\\nleft join gbasedwi.DWI_INCO_BILL_USER_SCORE_DT_${chk.p6lastday} t8 on t1.user_id=t8.user_id*/\\n/*left outer join Dwrun.Dw_Mpm_Active_Ds b \\n          on a.product_no=b.product_no*/\\nleft join (Select b.msisdn product_no\\n                  from gbasedwi.dwi_int_02004_di_${dayid} a \\n             left join gbasebas.int_22038_comm_ms_${monthid} b \\n                  on a.user_id=b.MSISDN \\n           where a.user_status not in ('2010','2020','2030')   and a.user_type <> '3' and b.MSISDN is null ) e \\n\\t\\t\\t\\t  on t1.phone_no = e.product_no\\nWHERE t1.PROD_KIND_CODE='171000000001' And (t1.Month_Arrive_FLAG = 1 Or t1.Month_Off_FLAG = 1 Or t1.Month_New_FLAG = 1);","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [106]-[index:179]-[日用户资料表导入应用库]-[28]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.dm_pub_user_${dayid};\\nCREATE TABLE dm.dm_pub_user_${dayid} (\\n  OP_TIME date ,\\n  USER_ID bigint(20) ,\\n  CUST_ID bigint(20) ,\\n  ACCT_ID bigint(20) ,\\n  PRODUCT_NO varchar(50) ,\\n  PROD_CATALOG_ID bigint(20) ,\\n  AGE smallint(6) ,\\n  SEX_ID smallint(6) ,\\n  INDUSTRY_ID int(11) ,\\n  EDUCATION_ID bigint(20) ,\\n  OCCUPATION_ID int(11) ,\\n  CUSTSTATUS_ID int(11) ,\\n  CUSTTYPE_ID int(11) ,\\n  CUST_CLASS_ID int(11) ,\\n  VIP_MARK int(11) ,\\n  VIP_SCALE_ID varchar(10) ,\\n  ENTERPRISE_ID varchar(30) ,\\n  CITY_ID int(11) ,\\n  COUNTY_ID varchar(20) ,\\n  DEPT_ID varchar(10) ,\\n  CHANNEL_ID varchar(50) ,\\n  CHANNELTYPE_ID varchar(10) ,\\n  USER_OPEN_ID int(11) ,\\n  USER_INNET_ID int(11) ,\\n  BRAND_ID int(11) ,\\n  USERSTATUS_ID int(11) ,\\n  LAST_USERSTATUS_ID int(11) ,\\n  USER_OPENTIME date ,\\n  USER_OFFTIME date ,\\n  USERTYPE_ID smallint(6) ,\\n  PLAN_ID bigint(20) ,\\n  OFF_REASON_ID smallint(6) ,\\n  ENTERPRISE_MARK varchar(255) ,\\n  MONTH_ARRIVE_MARK int(11) ,\\n  MONTH_NEW_MARK int(11) ,\\n  MONTH_OFF_MARK int(11) ,\\n  VPMN_MARK int(11) ,\\n  SUB_USERSTATUS_ID int(11) ,\\n  LASTSUB_USERSTATUS_ID int(11) ,\\n  DEAL_OPERATOR varchar(60) ,\\n  USER_NAME varchar(256) ,\\n  CUST_NAME varchar(256) ,\\n  SUB_BRAND_ID int(11) ,\\n  ENTERPRISE_SCALE_ID int(11) ,\\n  CUST_ADDRESS varchar(256) ,\\n  CUST_SVC_NO varchar(256) ,\\n  BA_SVC_NO varchar(30) ,\\n  IDEN_ID int(11) ,\\n  IDEN_NO varchar(50) ,\\n  USER_GRADE int(11) ,\\n  PASS_GRADE int(11) ,\\n  WATCH_FLAG int(11) ,\\n  POST_BILL_FLAG int(11) ,\\n  ROAM_TYPE int(11) ,\\n  PAYBILL_FLAG int(11) ,\\n  BILL_TYPE int(11) ,\\n  STOP_CALL_FLAG int(11) ,\\n  IMSI_NO varchar(50) ,\\n  SIM_NO varchar(50) ,\\n  VALID_NEW_MARK int(11) ,\\n  FIRST_VALID_CALLTIME datetime ,\\n  FIRST_UNVALID_CALLTIME datetime ,\\n  FIRST_CHARGETIME datetime ,\\n  POST_CODE varchar(50) ,\\n  SUB_BILL_ID varchar(50) ,\\n  INNET_TIME datetime ,\\n  ACTIVE_DATE datetime ,\\n  PRE_DESTORY_TIME datetime ,\\n  LAST_TRANS_DATE datetime ,\\n  CREDIT_LEVEL int(11) ,\\n  CREDIT_AMOUNT bigint(20) ,\\n  ADDRESS_ID int(11) ,\\n  EXCHANGE_ID varchar(20) ,\\n  IS_OUT_NET int(11) ,\\n  BAL_ORG_ID int(11) ,\\n  CONT_ID bigint(20) ,\\n  RISK_FLAG int(11) ,\\n  CREATOR_NO bigint(20) ,\\n  CREATE_ORGID bigint(20) ,\\n  DONE_CODE bigint(20) ,\\n  CREATE_DATE date ,\\n  DONE_DATE date ,\\n  DAY_NEW_MARK int(11) ,\\n  DAY_OFF_MARK int(11) ,\\n  STOP_LEVEL int(11) ,\\n  F_CHANNEL_ID varchar(20) ,\\n  F_DEPT_ID varchar(100) ,\\n  BIND_MARK int(11) ,\\n  BINDSTART_DATE date ,\\n  BINDEND_DATE date ,\\n  TD_MARK int(11) ,\\n  CS_ZGD_MARK int(11) ,\\n  IS_CHANGE_USIM smallint(6) ,\\n  IS_HANDLE_4G smallint(6) ,\\n  IS_TERMINAL_4G smallint(6) ,\\n  IS_MIFI_4G smallint(6) ,\\n  TERMINAL_4G varchar(800) ,\\n  IS_TEST_4G smallint(6) ,\\n  IS_YIJINGPHONE_USER smallint(6) ,\\n  ZEROCALL_CUR_FLAG smallint(6) ,\\n  ZEROCALL_H_FLAG smallint(6) ,\\n  REPAY_SCORE bigint(20) ,\\n  EXPIRE_SCORE bigint(20) ,\\n  BALANCE_AMOUNT decimal(15,2) ,\\n  IS_YIJING_ZEROCALL smallint(6) ,\\n  VIP_SCALE_ID1 smallint(6) ,\\n  IS_SCROE_THREE smallint(6) ,\\n  IS_SCROE_SIX smallint(6) ,\\n  SUB_BRAND_ID1 smallint(6) ,\\n  IMEI varchar(14) ,\\n  GRID_ID int(11) \\n) ENGINE=EXPRESS DEFAULT CHARSET=utf8 TABLESPACE='sys_tablespace'"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [107]-[index:180]-[日用户资料表导入应用库]-[12]-['str' object has no attribute 'lfind']:{"name":"创建临时表2","nodeId":"12","dsName":"GbaseDM","sql":"create table  ${DM_PUB_USER_TMP03_DAYID}\\n (    USER_ID                     BIGINT\\n     ,REPAY_SCORE                 BIGINT\\n     ,EXPIRE_SCORE                BIGINT\\n     ,BALANCE_AMOUNT              DECIMAL(15, 2)\\n     ,IS_SCROE_THREE              SMALLINT\\n     ,IS_SCROE_SIX                SMALLINT\\n     ,IS_YIJING_ZEROCALL     SMALLINT\\n     ,ZEROCALL_CUR_FLAG   SMALLINT\\n) DISTRIBUTED BY ('user_id') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [108]-[index:183]-[日用户资料表导入应用库]-[9]-['str' object has no attribute 'lfind']:{"name":"删除所有表","nodeId":"9","dsName":"GbaseDM","sql":"drop table ${DM_PUB_USER_TMP02_DAYID};\\ndrop table ${DM_PUB_USER_TMP03_DAYID};\\ndrop table DM_PUB_USER_${dayid};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [109]-[index:184]-[日用户资料表导入应用库]-[11]-['str' object has no attribute 'lfind']:{"name":"插入数据1","nodeId":"11","dsName":"GbaseDM","sql":"insert into ${DM_PUB_USER_TMP02_DAYID}(\\n    USER_ID\\n   ,OFF_REASON_ID\\n   ,SIM_NO\\n   ,BIND_MARK\\n   ,BINDSTART_DATE\\n   ,BINDEND_DATE\\n   ,IS_CHANGE_USIM\\n   ,IS_HANDLE_4G\\n   ,IS_TERMINAL_4G\\n   ,IS_MIFI_4G\\n   ,TERMINAL_4G\\n   ,IS_TEST_4G\\n   ,IS_YIJINGPHONE_USER\\n) select t1.USER_ID                           USER_ID\\n        ,t1.LOST_REASON                 OFF_REASON_ID\\n        ,t1.SIM_NO                      SIM_NO\\n        ,case when t3.phone_no IS NOT NULL THEN 1 ELSE 0 END\\tBIND_MARK\\n        ,t3.HARD_BIND_BUSI_EFF_DATE     BINDSTART_DATE\\n        ,t3.HARD_BIND_BUSI_EXP_DATE     BINDEND_DATE\\n        ,case  when t2.phone_no is null then  0 else  1 end as IS_CHANGE_USIM                 \\n\\t\\t,case when c.phone_no is null then 0 else 1 end as IS_HANDLE_4G\\n\\t\\t,case when c.phone_no is not null and d.user_id is not null then 1 else 0 end as IS_TERMINAL_4G\\n\\t\\t,case when e.phone_no is null then 0 else 1 end as  IS_MIFI_4G\\n\\t\\t,d.ATTR_VAL  TERMINAL_4G\\n\\t\\t,case when f.phone_no is not null then 1 else 0 end as IS_TEST_4G\\n\\t\\t,case when g.product_no is null then 0 else 1 end as IS_YIJINGPHONE_USER\\nfrom ${DWI_USR_PESN_PARTINFO_DS_DAYID} t1\\nleft join (\\n    select distinct a.phone_no\\n  from gbasedwd.DWD_RES_SVC_SIM_DS_${dayid}  a \\n  left join  gbasedwd.DWD_RES_SVC_MKT_SPEC_DS_${dayid} b \\n   on a.RES_SPEC_ID=b.RES_SPEC_ID\\n  where b.RES_NAME like '%USIM%' and MANG_STATE=5 ) t2 on t1.phone_no=t2.phone_no\\nleft join (select  PHONE_NO, min(HARD_BIND_USER_FLAG) HARD_BIND_USER_FLAG,min(HARD_BIND_BUSI_EFF_DATE) HARD_BIND_BUSI_EFF_DATE,max(HARD_BIND_BUSI_EXP_DATE) \\n  HARD_BIND_BUSI_EXP_DATE from ${DWI_USR_PESN_HARDBUNDLE_BUSI_DS_DAYID} where HARD_BIND_type='硬捆绑' group by PHONE_NO) t3 on t1.PHONE_NO=t3.PHONE_NO\\nleft join (select distinct phone_no from gbasedwi.DWI_INST_OFFER_ADDBUSI_DS_${dayid}\\n\\t\\t   where plan_id in (111002002175) and CUR_CYCLE_STATE=1) c on t1.phone_no=c.phone_no\\nleft join  (select distinct a.user_id,ATTR_VAL from GBASEDWI.DWI_INST_ATTR_PLOY_SERV_DS_${dayid} a   \\n\\t\\t\\tinner join (select user_id,max(UPDT_TIME) UPDT_TIME  from  GBASEDWI.DWI_INST_ATTR_PLOY_SERV_DS_${dayid}\\n\\t\\t\\t\\t\\t\\twhere CUR_CYCLE_SERV_STATE in (1,104) and ATTR_NAME='终端机型' group by user_id ) b\\n\\t\\t\\t\\ton a.UPDT_TIME=b.UPDT_TIME and a.user_id=b.user_id\\n\\t\\t\\twhere (a.CUR_CYCLE_SERV_STATE in (1,104) and ATTR_NAME='终端机型' and upper(a.ATTR_VAL) like '%LTE%' \\n\\t\\t\\t  and  a.plan_id in (select offer_id from  gbasedwd.dim_lte_bindphone_offer where offer_type='LTE'))\\n\\t\\t\\t   or (a.CUR_CYCLE_SERV_STATE in (1,104) and ATTR_NAME='终端机型' and upper(a.ATTR_VAL) like '%IPHONE%' \\n\\t\\t\\t  and a.plan_id in (select offer_id from gbasedwd.dim_lte_bindphone_offer where offer_type='IPHONE'))) d \\n\\ton t1.user_id=d.user_id\\nleft join (select phone_no from GBASEDWI.DWI_INST_OFFER_PLAN_DS_${dayid} \\n\\t\\t   where plan_id in ('111001000713','111001000714') and CUR_CYCLE_STATE =1 group by phone_no ) e \\n\\ton t1.phone_no=e.phone_no\\nleft join (select phone_no from GBASEDWI.DWI_INST_OFFER_PLAN_DS_${dayid}\\n\\t\\t   where plan_id in ('111001000523','111001000525') and CUR_CYCLE_STATE =1 group by phone_no ) f \\n\\ton t1.phone_no=f.phone_no\\nleft join (select distinct product_no from gbasemsm.msm_dw_basekpi_bass1_tx_user_${dayid}) g on t1.phone_no=g.product_no\\nWHERE t1.PROD_KIND_CODE='171000000001' And (t1.Month_Arrive_FLAG = 1 Or t1.Month_Off_FLAG = 1 Or t1.Month_New_FLAG = 1);","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [110]-[index:185]-[日用户资料表导入应用库]-[14]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"14.插入最终表","nodeId":"14","sql":"insert into DM_PUB_USER_${dayid}\\n (\\t\\t USER_ID\\n\\t\\t,CUST_ID\\n\\t\\t,ACCT_ID\\n\\t\\t,OP_TIME     \\n\\t\\t,PRODUCT_NO\\n\\t\\t,AGE\\n\\t\\t,SEX_ID\\n\\t\\t,CUST_CLASS_ID\\n\\t\\t,PROD_CATALOG_ID\\n\\t\\t,VIP_MARK\\n\\t\\t,VIP_SCALE_ID\\n\\t\\t,CUSTTYPE_ID\\n\\t\\t,ENTERPRISE_ID\\n\\t\\t,COUNTY_ID\\n\\t\\t,DEPT_ID\\n\\t\\t,CHANNEL_ID\\n\\t\\t,GRID_ID\\n\\t\\t,BRAND_ID\\n\\t\\t,USERSTATUS_ID\\n\\t\\t,USER_OPENTIME\\n\\t\\t,USER_OFFTIME\\n\\t\\t,USERTYPE_ID\\n\\t\\t,PLAN_ID\\n\\t\\t,OFF_REASON_ID\\n\\t\\t,ENTERPRISE_MARK\\n\\t\\t,MONTH_ARRIVE_MARK\\n\\t\\t,MONTH_NEW_MARK\\n\\t\\t,MONTH_OFF_MARK\\n\\t\\t,VPMN_MARK\\n\\t\\t,DEAL_OPERATOR\\n\\t\\t,CUST_NAME\\n\\t\\t,SUB_BRAND_ID\\n\\t\\t,IDEN_ID\\n\\t\\t,IDEN_NO\\n\\t\\t,IMSI_NO\\n\\t\\t,SIM_NO\\n\\t\\t,ACTIVE_DATE\\n\\t\\t,DAY_NEW_MARK\\n\\t\\t,DAY_OFF_MARK\\n\\t\\t,STOP_LEVEL\\n\\t\\t,BIND_MARK\\n\\t\\t,BINDSTART_DATE\\n\\t\\t,BINDEND_DATE\\n\\t\\t,TD_MARK\\n\\t\\t,CS_ZGD_MARK\\n\\t\\t,IS_HANDLE_4G\\n\\t\\t,IS_TERMINAL_4G\\n\\t\\t,IS_MIFI_4G\\n\\t\\t,TERMINAL_4G\\n\\t\\t,IS_YIJINGPHONE_USER\\n\\t\\t,REPAY_SCORE\\n\\t\\t,EXPIRE_SCORE\\n\\t\\t,IS_SCROE_THREE\\n\\t\\t,IS_SCROE_SIX\\n\\t\\t,SUB_BRAND_ID1\\n\\t\\t,IS_CHANGE_USIM\\n\\t\\t,IS_TEST_4G\\n\\t\\t,CREATE_DATE\\n\\t\\t,CREATE_ORGID\\n\\t\\t,CREATOR_NO\\n\\t\\t,CREDIT_LEVEL\\n\\t\\t,CREDIT_AMOUNT\\n\\t\\t,DONE_CODE\\n\\t\\t,DONE_DATE\\n\\t\\t,F_DEPT_ID\\n\\t\\t,ADDRESS_ID\\n\\t\\t,BA_SVC_NO\\n\\t\\t,BAL_ORG_ID\\n\\t\\t,CHANNELTYPE_ID\\n\\t\\t,CUST_SVC_NO\\n\\t\\t,CUSTSTATUS_ID\\n\\t\\t,OCCUPATION_ID\\n\\t\\t,IS_YIJING_ZEROCALL\\n\\t\\t,ZEROCALL_CUR_FLAG) \\nselect \\t t1.USER_ID\\n\\t\\t,t1.CUST_ID\\n\\t\\t,t1.ACCT_ID\\n\\t\\t,'${day_id}'\\t\\t\\t\\t\\tOP_TIME\\n        ,t1.phone_no                    PRODUCT_NO\\n\\t\\t,nvl(ff.age,f.AGE)\\t\\t\\t\\tAGE\\n\\t\\t,f.SEX\\t\\t\\t\\t\\t \\t\\tSEX_ID\\n\\t\\t,t1.CUST_CATAGORY\\t\\t\\t \\tCUST_CLASS_ID\\n\\t\\t,t1.PROD_KIND_CODE\\t\\t\\t\\tPROD_CATALOG_ID\\n\\t\\t,t10.vip_cust\\t\\t\\t \\t\\tVIP_MARK\\n\\t\\t,null\\t\\t\\t             \\tVIP_SCALE_ID\\n\\t\\t,k.CUST_TYPE\\t\\t\\t\\t\\t\\tCUSTTYPE_ID\\n\\t\\t,t7.GRP_CUST_ID            \\t\\tENTERPRISE_ID\\n\\t\\t,nvl(c.DEPT_COUNTY_ID,0)\\t\\t\\t\\tCOUNTY_ID\\n        ,c.DEPT_AREA_ID\\t\\t\\t\\t\\tDEPT_ID\\n        ,c.DEPT_SUBAREA_ID             \\tCHANNEL_ID\\n\\t\\t,c.GRID_ID\\t\\t\\t\\t\\t\\tGRID_ID\\n        ,t1.BRAND_ID                    BRAND_ID\\n        ,t1.BASS_USER_STATE\\t\\t\\t\\tUSERSTATUS_ID\\n\\t\\t,date(t1.innet_date)  /*a.innet_date*/\\t\\t\\tUSER_OPENTIME\\n        ,date(t1.OFF_DATE)\\t\\t\\t\\tUSER_OFFTIME\\n\\t\\t,'-1'\\t\\t\\t\\t\\t\\t\\tUSERTYPE_ID\\n\\t\\t,t1.MAIN_PLAN_ID\\t\\t\\t\\tPLAN_ID\\n\\t\\t,t1.LOST_REASON\\t\\t\\t\\t\\tOFF_REASON_ID\\n        ,case when t7.MEMB_NO is null then 0 else 1 end\\tENTERPRISE_MARK\\n\\t\\t,t1.MONTH_ARRIVE_FLAG      \\t\\tMONTH_ARRIVE_MARK\\n\\t\\t,t1.MONTH_NEW_FLAG         \\t\\tMONTH_NEW_MARK\\n\\t\\t,t1.MONTH_OFF_FLAG         \\t\\tMONTH_OFF_MARK\\n\\t\\t,0\\t\\t\\t\\t\\t\\t\\t\\tVPMN_MARK\\n\\t\\t,t1.CREATE_OPER_ID\\t\\t\\t\\tDEAL_OPERATOR\\n        ,trim(f.CUST_NAME)\\t\\t\\t\\tCUST_NAME\\n        ,t1.SUB_BRAND_ID                SUB_BRAND_ID\\n        ,f.CERT_CATAGORY                    IDEN_ID\\n\\t\\t,f.CERT_NO\\t\\t\\t\\t\\t\\tIDEN_NO\\n        ,t1.IMSI                     \\tIMSI_NO\\n        ,b.SIM_NO                       SIM_NO\\n        ,m.ACTIVE_TIME  /*cast(t1.ACTIVE_DATE as date)*/\\tACTIVE_DATE\\n\\t\\t,t1.DAY_NEW_FLAG           \\t\\tDAY_NEW_MARK\\n\\t\\t,t1.DAY_OFF_FLAG           \\t\\tDAY_OFF_MARK\\n        ,nvl(t4.STOP_LVL,1)            \\tSTOP_LEVEL\\n        ,b.BIND_MARK                   \\tBIND_MARK\\n        ,b.BINDSTART_DATE              \\tBINDSTART_DATE\\n        ,b.BINDEND_DATE                \\tBINDEND_DATE\\n        ,CASE WHEN i.SUBS_ID IS NOT NULL THEN 1 ELSE 0 END\\t\\tTD_MARK\\n        ,CASE WHEN t5.phone_no IS NOT NULL THEN 1 ELSE 0 END\\tCS_ZGD_MARK\\n        ,b.IS_HANDLE_4G                \\tIS_HANDLE_4G\\n        ,b.IS_TERMINAL_4G      \\t\\t\\tIS_TERMINAL_4G\\n        ,b.IS_MIFI_4G                  \\tIS_MIFI_4G\\n        ,b.TERMINAL_4G                 \\tTERMINAL_4G\\n        ,b.IS_YIJINGPHONE_USER        \\tIS_YIJINGPHONE_USER\\n        ,t3.REPAY_SCORE\\t\\t\\t\\t\\tREPAY_SCORE\\n        ,t3.EXPIRE_SCORE\\t\\t\\t\\tEXPIRE_SCORE\\n        ,t3.IS_SCROE_THREE\\t\\t\\t\\tIS_SCROE_THREE\\n        ,t3.IS_SCROE_SIX\\t\\t\\t\\tIS_SCROE_SIX\\n        ,t6.SUB_BRAND_ID1               SUB_BRAND_ID1\\n\\t\\t,b.IS_CHANGE_USIM\\t\\t\\t\\tIS_CHANGE_USIM\\n\\t\\t,b.IS_TEST_4G\\t\\t\\t\\t\\tIS_TEST_4G\\n\\t\\t,to_date(t1.CREATE_DATE,'yyyymmdd')\\t\\t\\tCREATE_DATE\\n\\t\\t,t1.OPER_ORG_ID \\t\\t\\t\\tCREATE_ORGID\\n\\t\\t,t1.CREATE_OPER_ID\\t\\t\\t\\tCREATOR_NO\\n\\t\\t,t1.CRDT_LVL\\t\\t\\t\\t\\tCREDIT_LEVEL\\n\\t\\t,t1.CRDT\\t\\t\\t\\t\\t\\tCREDIT_AMOUNT\\n\\t\\t,t1.ACPT_CODE\\t\\t\\t\\t\\tDONE_CODE\\n\\t\\t,to_date(t1.ACPT_DATE,'yyyymmdd')\\t\\tDONE_DATE\\n\\t\\t,trim(e.DEPT_COUNTY_NAME)\\t\\t\\tDEPT_COUNTY_NAME #20180917 由DEPT_COUNTY_ID修改为DEPT_COUNTY_NAME\\n\\t\\t,NULL /*f.CUST_ADDR */\\t\\t\\t\\tADDRESS_ID\\n\\t\\t,k.BA_ACCT_ID                   BA_SVC_NO\\n\\t\\t,f.INNET_CHL                    BAL_ORG_ID\\n\\t\\t,f.CHL_TYPE\\t\\t\\t\\t\\t\\tCHANNELTYPE_ID\\n\\t\\t,f.CA_CUST_ID\\t\\t\\t\\t\\tCUST_SVC_NO\\t\\n\\t\\t,f.CUST_STATE               \\tCUSTSTATUS_ID\\n\\t\\t,f.job\\t\\t\\t\\t\\t\\t\\tOCCUPATION_ID\\n\\t\\t,t3.IS_YIJING_ZEROCALL\\t\\t\\tIS_YIJING_ZEROCALL\\n\\t\\t,t3.ZEROCALL_CUR_FLAG\\t\\t\\tZEROCALL_CUR_FLAG\\nfrom ${DWI_USR_PESN_PARTINFO_DS_DAYID} t1\\nleft join gbasedwd.dwd_svc_usr_info_ds_${dayid} t4 on t4.phone_no=t1.phone_no\\nleft join ${DWI_USR_PESN_HIGH_MS_PMONTHID} t5 on t1.phone_no=trim(t5.phone_no)\\nleft join ${DWI_USR_GRP_MEB_DS_DAYID} t7 on t1.phone_no=t7.MEMB_NO\\nleft join ${DIM_PRODUCT_SUBBRAND} t6 \\non t1.BRAND_ID=t6.BRAND_ID and t1.SUB_BRAND_ID=t6.SUB_BRAND_ID\\nleft join ${DM_PUB_USER_TMP02_DAYID} b on t1.user_id=b.user_id\\nleft join ${DM_PUB_USER_TMP03_DAYID} t3 on t1.user_id=t3.user_id\\n/*left join (select phone_no,date(innet_date) innet_date from GBASEDWI.DWI_USR_PESN_PARTINFO_DS_${dayid} \\n\\t\\t   where innet_date<=20141130) a on t1.phone_no=a.phone_no*/\\nleft join (select distinct DEPT_COUNTY_ID,DEPT_AREA_ID,DEPT_SUBAREA_ID,phone_no,GRID_ID from  gbasedwi.DWI_USR_PESN_PERSN_LOC_DS_${dayid} ) c on t1.phone_no=c.phone_no\\nleft join (select distinct SUBS_ID from gbasebas.DW_TD_PRODUCT_MSG_CYCLE03_${dayid}) i on t1.phone_no=i.SUBS_ID\\nleft join gbasedwi.DWI_RES_NAC_CODE_NUM_DT_${dayid} e on t1.phone_no=e.phone_no\\nleft join gbasedwi.DWI_USR_PESN_ALLCUST_DS_${dayid} f on t1.CUST_ID=f.CUST_ID\\nleft join (select phone_no,\\n       case when length(use_no)=18 and substr(use_no,7,1) in ('1','2') \\n              and substr(use_no,8,1) in ('0','1','2','3','4','5','6','7','8','9') \\n              and substr(use_no,9,1) in ('0','1','2','3','4','5','6','7','8','9') \\n              and substr(use_no,10,1) in ('0','1','2','3','4','5','6','7','8','9') \\n             -- and substr(use_no,7,4) between '1910' and '2010' \\n              then timestampdiff(year,date(substr(use_no,7,8)),'${day_id}')\\n          when length(use_no)=15 \\n              and substr(use_no,7,1) in ('0','1','2','3','4','5','6','7','8','9') \\n              and substr(use_no,8,1) in ('0','1','2','3','4','5','6','7','8','9') \\n              and substr(use_no,7,2) between '00' and '99' \\n              then timestampdiff(year,date('19'||substr(use_no,7,6)),'${day_id}')\\n             else 0 end age\\nfrom (select phone_no,case when user_type='个人客户' then cust_no when user_type='单位客户' then use_no end use_no,\\n             case when user_type='个人客户' then cust_type when user_type='单位客户' then use_type end use_type \\n      from gbasedwi.dwi_usr_pesn_realname_base_ds_${dayid}\\nwhere user_type in ('个人客户','单位客户') and on_line_mark=1 and length(use_no) in (15,18))a\\nwhere use_no is not null and use_type='身份证'\\n)ff on t1.phone_no=ff.phone_no\\nleft join (select CUST_ID CUST_ID, CUST_TYPE, max(BA_ACCT_ID) BA_ACCT_ID,max(acct_id) acct_id from gbasedwi.DWI_INCO_ACCB_ACCTCUST_DS_${dayid} group by CUST_ID,CUST_TYPE) k\\ton t1.CUST_ID=k.CUST_ID\\nleft join (select a.phone_no,a.ACTIVE_TIME,b.room_id,a.DEPT_COUNTY_ID\\n  from  gbasedwi.DWI_RES_NAC_CODE_NUM_DT_${dayid} a\\n  left join dm.DIM_RES_DEPART b  on a.CHL_ID=b.room_cd ) m on t1.phone_no=m.phone_no\\nleft join (select phone_no,case when vip_cust='是' then 1 \\n                     when vip_cust='否' then 0 else 0 end vip_cust -- 是否VIP客户\\n           from gbasedwi.dwi_usr_pesn_realname_ent_ds_${dayid}) t10 on t1.phone_no=t10.phone_no\\nWHERE t1.PROD_KIND_CODE='171000000001' And (t1.Month_Arrive_FLAG = 1 Or t1.Month_Off_FLAG = 1 Or t1.Month_New_FLAG = 1);"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [111]-[index:186]-[日用户资料表导入应用库]-[10]-['str' object has no attribute 'lfind']:{"name":"创建临时表1","nodeId":"10","dsName":"GbaseDM","sql":"create table  ${DM_PUB_USER_TMP02_DAYID}\\n (     USER_ID                     BIGINT\\n     ,OFF_REASON_ID               SMALLINT\\n     ,SIM_NO                      VARCHAR(50)\\n     ,BIND_MARK                   INTEGER\\n     ,BINDSTART_DATE              DATE\\n     ,BINDEND_DATE                DATE\\n     ,IS_CHANGE_USIM              SMALLINT\\n      ,IS_TERMINAL_4G\\t\\t\\t  SMALLINT\\n     ,IS_HANDLE_4G                SMALLINT\\n     ,IS_MIFI_4G                  SMALLINT\\n     ,TERMINAL_4G                 VARCHAR(800)\\n   ,IS_TEST_4G                        SMALLINT\\n   ,IS_YIJINGPHONE_USER       SMALLINT\\n ) DISTRIBUTED BY ('user_id') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [112]-[index:187]-[日用户资料表导入应用库]-[15]-['str' object has no attribute 'lfind']:{"name":"删除临时表","nodeId":"15","dsName":"GbaseDM","sql":"drop table ${DM_PUB_USER_TMP02_DAYID};\\ndrop table ${DM_PUB_USER_TMP03_DAYID};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [113]-[index:190]-[竞争对手日视图]-[9]-['str' object has no attribute 'lfind']:{"name":"9.插入表","nodeId":"9","dsName":"GbaseDM","sql":"  insert into  dm_pub_competitor_${dayid}   \\n  (       \\n                       OP_TIME                     ,          \\n                       ADVERSARY_ID                ,          \\n                       IS_CALLUSER                 ,          \\n                       DEPT_COUNTY_ID              ,          \\n                       DAY_ARRIVE_MARK             ,          \\n                       DAY_NEW_MARK                ,          \\n                       CALL_COUNTS                 ,          \\n                       SMS_MO_COUNT                ,          \\n                       MMS_MO_COUNT                ,          \\n                       COMP_PRODUCT_NO             ,          \\n                       CALL_PRODUCT_NUMBER         ,          \\n                       OPEN_DATE                   ,          \\n                       OUT_CALL_DURATION           ,          \\n                       IN_CALL_DURATION            ,          \\n                       IS_VNO                     ,\\n\\t\\t\\t\\t\\t   is_call_user                ,             \\n                       is_new_add_user            ,\\n\\t\\t\\t\\t\\t    is_call_user_yj           ,             \\n                       is_new_add_user_yj            ,\\n\\t\\t\\t\\t\\t   grid_id,\\n\\t\\t\\t\\t\\t   regional_center_id   -- 经营网格\\n\\t\\t\\t\\t\\t   )\\n         select distinct '${day_id}'                                                                            ,\\n                case when a.CMPT_CARR='03' then 1                                                            \\n                     when a.CMPT_CARR='02' then 2  end                                                       ,\\n                0,-- case when b.CALL_NUM>0 or b.SMS_NUM >0 or b.MMS_NUM >0 then 1 else  0  end          ,\\n                e.BELNG_DEPT_COUNTY_ID                                                                         ,\\n                b.CUR_DAY_ARRV_FLAG                                                                            ,\\n                b.CUR_DAY_NEW_FLAG                                                                             ,\\n                b.CALL_NUM                                                                                     ,\\n                b.UP_SMS_NUM                                                                                      ,\\n                b.MO_MMS_NUM                                                                                      ,\\n                a.CMPT_PHONE_NO                                                                                ,\\n                nvl(c.COUNT ,0)                                                                                ,\\n                b.FIR_COMM_DATE                                                                                ,\\n                b.CALING_CALL_DUR                                                                              ,\\n                b.CALLED_DUR,\\n                b.virt_carr_flag as is_vno , /*--是否虚拟运营商号码 1 是 0 否*/                        \\n\\t\\t\\t\\td.is_call_user,          -- 是否互通客户\\n                d.is_new_add_user ,       -- 是否当日互通新增客户 \\n\\t\\t\\t\\td.is_call_user_yj  ,     -- 是否互通客户（一经）\\n                d.is_new_add_user_yj,     -- 是否当日互通新增客户（一经）\\n\\t\\t\\t\\te.grid_id,\\n\\t\\t\\t\\tn.regional_center_id\\n        from (  select cmpt_phone_no,CMPT_CARR \\n\\t\\t        from  -- 联通 03  电信 02 \\n\\t\\t            ( \\n                      select  cmpt_msisdn_nbr cmpt_phone_no,    \\n                              case when cmpt_prvd_typ = 31000 then '02' when cmpt_prvd_typ = 21000 then '03' end  CMPT_CARR\\n                      from gbasebas.dm_sum_cmpt_user_daily_${dayid}\\n\\t\\t\\t\\t\\t  where cmpt_prvd_typ in ('31000','21000')\\n\\t\\t\\t          group by cmpt_msisdn_nbr,\\n\\t\\t\\t\\t\\t           case when cmpt_prvd_typ =31000 then '02' when cmpt_prvd_typ = 21000 then '03' end \\n                      union all\\n                      select cmpt_phone_no,CMPT_CARR from gbasedwi.DWI_BEH_USE_INTERCONNECTION_DS_${dayid} a\\n\\t\\t\\t\\t\\t  left join gbasebas.dm_sum_cmpt_user_daily_${dayid} b on a.cmpt_phone_no=b.cmpt_msisdn_nbr\\n\\t\\t\\t\\t\\t  where CMPT_CARR in ('02','03') and b.cmpt_msisdn_nbr is null\\n\\t\\t\\t\\t\\t  group by cmpt_phone_no,CMPT_CARR  \\n                     ) a \\n\\t           ) a\\n\\t\\tleft join gbasedwi.DWI_BEH_USE_INTERCONNECTION_DS_${dayid} b on a.CMPT_PHONE_NO = b.CMPT_PHONE_NO\\n\\t\\tleft join gbasedwi.DWI_BEH_USE_OPP_TOT_DS_${dayid} e on a.CMPT_PHONE_NO = e.CMPT_PHONE_NO\\n\\t\\tleft join (select distinct grid_id,grid_name,regional_center_id,regional_center_name from gbasedwd.dim_pub_cell) n on e.grid_id=n.grid_id\\n        left join ( select CMPT_PHONE_NO,count(distinct CMC_PHONE_NO) count \\n\\t\\t\\t\\t    from gbasedwi.DWI_BEH_USE_OPP_BASETOT_DS_${dayid} \\n                    where CMPT_CARR in ('02','03') group by CMPT_PHONE_NO \\n\\t\\t\\t\\t\\t) c on a.CMPT_PHONE_NO = c.CMPT_PHONE_NO\\n\\t\\tleft join gbaserpt.tmp_dm_pub_competitor_${dayid} d on a.CMPT_PHONE_NO=d.CMPT_PHONE_NO\\n        -- where b.CMPT_CARR in ('02','03')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [114]-[index:193]-[竞争对手日视图]-[18]-['str' object has no attribute 'lfind']:{"name":"18.创建临时表","nodeId":"18","dsName":"GbaseRPT","sql":"drop table if exists gbaserpt.tmp_dm_pub_competitor_${dayid};\\nCREATE TABLE gbaserpt.tmp_dm_pub_competitor_${dayid}\\n(\\n  CMPT_PHONE_NO varchar(15),\\n  is_call_user int ,     -- 是否互通客户\\n  is_new_add_user int ,  -- 是否当日互通新增客户\\n  is_call_user_yj int ,  -- 是否互通客户（一经）\\n  is_new_add_user_yj int -- 是否当日互通新增客户（一经）\\n)distributed by ('CMPT_PHONE_NO') ;\\ninsert into  gbaserpt.tmp_dm_pub_competitor_${dayid}\\nselect a.CMPT_PHONE_NO,\\n       case when b.CMPT_PHONE_NO is not null then 1 else 0 end is_call_user ,     -- 是否互通客户\\n       case when c.cmpt_phone_no is not null then 1 else 0 end is_new_add_user,   -- 是否当日互通新增客户\\n\\t   case when d.cmpt_phone_no is not null then 1 else 0 end is_call_user_yj,   -- 是否互通客户（一经）\\n\\t   case when e.cmpt_phone_No is not null then 1 else 0 end is_new_add_user_yj -- 是否当日互通新增客户（一经）\\nfrom  ( select cmpt_phone_no from \\n        ( \\n          select  cmpt_msisdn_nbr cmpt_phone_no from gbasebas.dm_sum_cmpt_user_daily_${dayid} group by cmpt_msisdn_nbr\\n          union        \\n          select cmpt_phone_no from gbasedwi.DWI_BEH_USE_INTERCONNECTION_DS_${dayid} group by cmpt_phone_no   \\n         ) a  \\n\\t  ) a\\nleft join ( \\n           select CMPT_PHONE_NO from gbasemsm.msm_dw_basekpi_110040_detail_${dayid}  group by CMPT_PHONE_NO -- 电信互通客户\\n           union all \\n           select CMPT_PHONE_NO from gbasemsm.msm_dw_basekpi_110041_detail_${dayid}  group by CMPT_PHONE_NO  -- 联通互通客户\\n           ) b on a.CMPT_PHONE_NO=b.CMPT_PHONE_NO \\nleft join (      \\n   \\t\\t   select cmpt_phone_no from gbasemsm.msm_st_basekpi_110046_detail_dm where op_time = '${day_id}' group by CMPT_PHONE_NO -- 电信互通新增客户\\n           union all\\n           select cmpt_phone_no from gbasemsm.msm_st_basekpi_110047_detail_dm where op_time = '${day_id}' group by CMPT_PHONE_NO -- 联通互通新增客户\\n           ) c on a.CMPT_PHONE_NO=c.CMPT_PHONE_NO \\nleft join (\\n\\t\\t  select cmpt_phone_no from gbasemsm.msm_dw_basekpi_110677_detail_${dayid} group by cmpt_phone_no -- 电信互通客户（一经）\\n          union all\\n          select cmpt_phone_no from gbasemsm.msm_dw_basekpi_110678_detail_${dayid} group by cmpt_phone_no -- 联通互通客户（一经）          \\n          ) d  on a.CMPT_PHONE_NO=d.CMPT_PHONE_NO \\nleft join (\\n\\t\\t  select phone_no cmpt_phone_No from gbasemsm.msm_dw_grid_110679_detail_${dayid} group by phone_no -- 电信互通新增客户（一经）\\n          union all\\n          select phone_no cmpt_phone_No from gbasemsm.msm_dw_grid_110680_detail_${dayid} group by phone_no -- 联通互通新增客户（一经）\\n          ) e on a.cmpt_phone_no=e.cmpt_phone_no\\n\\n           \\n           \\n","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [115]-[index:194]-[竞争对手日视图]-[26]-['str' object has no attribute 'lfind']:{"name":"26.创建结果表","nodeId":"26","dsName":"GbaseDM","sql":"drop table dm_pub_competitor_${dayid} ;\\nCREATE TABLE dm_pub_competitor_${dayid}    \\n(\\n  OP_TIME date ,\\n  ADVERSARY_ID varchar(20) ,\\n  IS_CALLUSER smallint(6) ,\\n  DEPT_COUNTY_ID smallint(6) ,\\n  DAY_ARRIVE_MARK smallint(6) ,\\n  DAY_NEW_MARK smallint(6) ,\\n  CALL_COUNTS bigint(20) ,\\n  SMS_MO_COUNT bigint(20) ,\\n  MMS_MO_COUNT bigint(20) ,\\n  COMP_PRODUCT_NO varchar(20) ,\\n  CALL_PRODUCT_NUMBER bigint(20) ,\\n  OPEN_DATE date ,\\n  OUT_CALL_DURATION bigint(20) ,\\n  IN_CALL_DURATION bigint(20) ,\\n  IS_VNO smallint(6) ,\\n  is_call_user int ,     -- 是否互通客户\\n  is_new_add_user int ,  -- 是否当日互通新增客户\\n  is_call_user_yj int ,  -- 是否互通客户（一经）\\n  is_new_add_user_yj int,  -- 是否当日互通新增客户（一经）\\n  grid_id    bigint,   -- 经分网格\\n  regional_center_id   bigint  -- 经营网格\\n  ) distributed by ('COMP_PRODUCT_NO');\\n\\n\\n\\n    \\n\\t   \\n\\t   \\n\\t   \\n\\t   ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [116]-[index:197]-[res个人客户月视图自动生成程序月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_RES_${monthid};\\ncreate table DM_AUTORPT_RES_${monthid} distributed by ('PRODUCT_NO') as select * from DM_AUTORPT_RES_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [117]-[index:198]-[res个人客户月视图自动生成程序月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_RES_${monthid} select * from DM_AUTORPT_RES_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [118]-[index:202]-[2015年5月新增月指标数据表]-[201]-['str' object has no attribute 'lfind']:{"name":"201.创建畅想套餐临时表并插入数据","nodeId":"201","dsName":"GbaseRPT","sql":"drop table if exists  gbaserpt.tmp_dm_pub_increase_01_cx_${monthid};\\n CREATE TABLE gbaserpt.tmp_dm_pub_increase_01_cx_${monthid} (\\n   phone_no varchar(50),\\n   cx_offer_name varchar(50),\\n   cx_offer_level bigint(20)\\n) distributed by ('phone_no');\\ninsert into gbaserpt.tmp_dm_pub_increase_01_cx_${monthid}\\nselect d.phone_no phone_no,\\n       e.cx_offer_name cx_offer_name, -- 畅享套餐名称\\n       e.cx_offer_level cx_offer_level-- 畅享套餐档位\\n       from (select\\n        a.phone_no phone_no,max(b.offer_id) call_offer_id, max(c.offer_id) gprs_offer_id\\n  from gbasedwi.dwi_inst_offer_list_all_ms_${monthid} a\\n  left join dm.dim_offer_call_list b on a.plan_id=b.offer_id\\n  left join dm.dim_offer_gprs_list c on a.plan_id=c.offer_id where date(a.exp_time)>='${curm_last_day}' group by phone_no) d \\n  left join dm.dim_cx_offer_type_list e on d.call_offer_id=e.call_id and d.gprs_offer_id=e.gprs_id","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [119]-[index:203]-[2015年5月新增月指标数据表]-[198]-['str' object has no attribute 'lfind']:{"name":"198.创建视屏类流量临时表，并插入数据","nodeId":"198","dsName":"GbaseRPT","sql":"drop table if exists gbaserpt.tmp_dm_pub_increase_01_video_${monthid};\\nCREATE TABLE gbaserpt.tmp_dm_pub_increase_01_video_${monthid} (\\n   phone_no varchar(100),\\n   txsp_use_flow decimal(47,4),\\n   yksp_use_flow decimal(47,4),\\n   pptv_use_flow decimal(47,4),\\n   mgzb_use_flow decimal(47,4),\\n   mgsp_use_flow decimal(47,4),\\n   aqy_use_flow decimal(47,4),\\n   bibi_use_flow decimal(47,4),\\n   ks_use_flow decimal(47,4),\\n   jrtt_use_flow decimal(47,4),\\n   bd_use_flow decimal(47,4),\\n   ysj_use_flow decimal(47,4)\\n)distributed by ('phone_no');\\ninsert into gbaserpt.tmp_dm_pub_increase_01_video_${monthid}\\nselect phone_no,\\n round(sum(case when b.app_id=6 and b.app_type_id=5 then up_flow+down_flow else 0 end)/1024,4) txsp_use_flow, -- 腾讯视频使用流量\\n round(sum(case when b.app_id=3 and b.app_type_id=5 then up_flow+down_flow else 0 end)/1024,4) yksp_use_flow, -- 优酷视频使用流量\\n round(sum(case when b.app_id=6 and b.app_type_id=12 then up_flow+down_flow else 0 end)/1024,4) pptv_use_flow,  -- PPTV使用流量    \\n round(sum(case when b.app_id=1 and b.app_type_id=23 then up_flow+down_flow else 0 end)/1024,4) mgzb_use_flow,  -- 咪咕直播使用流量\\n round(sum(case when b.app_id=16 and b.app_type_id=5 then up_flow+down_flow else 0 end)/1024,4) mgsp_use_flow,     -- 芒果TV使用流量\\n round(sum(case when b.app_id=17 and b.app_type_id=5 then up_flow+down_flow else 0 end)/1024,4) aqy_use_flow,      -- 爱奇艺使用流量\\n round(sum(case when b.app_id=71 and b.app_type_id=5 then up_flow+down_flow else 0 end)/1024,4) bibi_use_flow,   -- 哔哩哔哩使用流量\\n round(sum(case when b.app_id=65 and b.app_type_id=5 then up_flow+down_flow else 0 end)/1024,4) ks_use_flow,      -- 快手使用流量 \\n round(sum(case when b.app_id=170 and b.app_type_id=15 then up_flow+down_flow else 0 end)/1024,4) jrtt_use_flow,    -- 今日头条使用流量\\n round(sum(case when b.app_name like'%百度%' then up_flow+down_flow else 0 end)/1024,4) bd_use_flow,  -- 百度使用流量\\n round(sum(case when b.app_id=70200 and b.app_type_id=5 then up_flow+down_flow else 0 end)/1024,4)  ysj_use_flow -- 云视界使用流量\\nfrom gbasedwi.dwi_beh_log_app_depttot_ms_${monthid} a \\nleft join (select distinct app_id,app_type_id,app_name from \\ngbasedwd.dim_app_hive where status=1) b on a.app_id=b.app_id and a.app_type_id=b.app_type_id\\ngroup by phone_no","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [120]-[index:204]-[2015年5月新增月指标数据表]-[137]-['str' object has no attribute 'lfind']:{"name":"插入语句10","nodeId":"137","dsName":"GbaseDM","sql":"insert into ${TARGET_TMP_DM_WEITING_YYYYMM}\\n(\\tPHONE_NO )\\nselect distinct product_no from ${SOURCE_DWI_WEIXIN_FOLLOW_BIND_DT}\\nwhere follow_status=1  and binding_status=1;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [121]-[index:205]-[2015年5月新增月指标数据表]-[71]-['str' object has no attribute 'lfind']:{"name":"71.创建TMP_DM_ACCT_INFO表","nodeId":"71","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_ACCT_INFO_YYYYMM}\\n(\\tACCT_NAME             VARCHAR(255),\\n\\tBA_SVC_NO             VARCHAR(255),\\n\\tCUST_SVC_NO           VARCHAR(255),\\n\\tBANK_NO               VARCHAR(30),\\n\\tMICRO_PAYMENT_NO_OLD  VARCHAR(30),\\n\\tWORK_NAME             VARCHAR(100),\\n\\tWORK_NO               VARCHAR(100),\\n\\tMAIN_PHONE            VARCHAR(50),\\n\\tACCT_ID               VARCHAR(30)\\t)\\nDISTRIBUTED BY ('ACCT_ID')  nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [122]-[index:206]-[2015年5月新增月指标数据表]-[190]-['str' object has no attribute 'lfind']:{"name":"190.创建app明细临时表","nodeId":"190","dsName":"GbaseRPT","sql":"drop table if exists gbaserpt.tmp_20180808_app_${monthid};\\n CREATE TABLE  gbaserpt.tmp_20180808_app_${monthid}  (\\n   phone_no  varchar(100),\\n   hejiaqin_day_num  bigint,\\n   hejiaqin_ACCESS_DUR  bigint,\\n   hejiaqin_use_flow  bigint,\\n   hefeixin_day_num  bigint,\\n   hefeixin_access_dur  bigint,\\n   hefeixin_use_flow  bigint,\\n   hebao_day_num  bigint,\\n   hebao_access_dur  bigint,\\n   hebao_use_flow  bigint,\\n   hecaiyun_day_num  bigint,\\n   hecaiyun_access_dur  bigint,\\n   hecaiyun_use_flow  bigint,\\n   youxiang_day_num  bigint,\\n   youxiang_access_dur  bigint,\\n   youxiang_use_flow  bigint,\\n   game_access_cnt  bigint,\\n   game_use_flow  bigint,\\n   game_day_num  bigint,\\n   kinghonor_day_num  bigint,\\n   kinghonor_access_cny  bigint,\\n   xiaoxiaole_day_num  bigint,\\n   xiaoxiaole_access_cnt  bigint,\\n   doudizhu_day_num  bigint,\\n   doudizhu_access_cnt  bigint,\\n   qiuqiu_day_num  bigint,\\n   qiuqiu_access_cnt  bigint,\\n   taichishe_day_num  bigint,\\n   taichishe_access_cnt  bigint,\\n   JJdoudizhu_day_num  bigint,\\n   JJdoudizhu_access_cnt  bigint,\\n   buluochongtu_day_num  bigint,\\n   buluochongtu_access_cnt  bigint,\\n   myworld_day_num  bigint,\\n   myworld_access_cnt  bigint,\\n   myworld_use_flow  bigint,\\n   aixiaochu_day_num  bigint,\\n   aixiaochu_access_cnt  bigint,\\n   majiangquanji_day_num  bigint,\\n   majiangquanji_access_cnt  bigint,\\n   QQdoudizhu_day_num  bigint,\\n   QQdoudizhu_access_cnt  bigint,\\n   QQdoudizhu_use_flow  bigint,\\n   tencentmajiang_day_num  bigint,\\n   tencentmajiang_access_cnt  bigint,\\n   miguread_day_num bigint,\\n   miread_access_dur bigint,\\n   miguvideo_day_num bigint,\\n   miguvideo_access_dur bigint,\\n   migugame_day_num bigint,\\n   migugame_access_cnt bigint,\\n   migugame_use_flow bigint\\n) distributed by ('phone_no');","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [123]-[index:207]-[2015年5月新增月指标数据表]-[69]-['str' object has no attribute 'lfind']:{"name":"插入语句1","nodeId":"69","dsName":"GbaseDM","sql":"INSERT INTO ${TARGET_TMP_DW_CALL_YYYYMM}\\n(\\tPHONE_NO,\\n\\tGOT_OUT_NET1,\\n\\tGOT_IN_NET1,\\n\\tINTER_OUT_NET1,\\n\\tINTER_IN_NET1,\\n\\tGOT_OUT_NET2,\\n\\tGOT_IN_NET2,\\n\\tINTER_OUT_NET2,\\n\\tINTER_IN_NET2\\t\\t)\\nSELECT PHONE_NO,\\n   NVL(SUM(CASE WHEN ROAM_TYPE= '9' AND CALL_TYPE = '1' AND OPP_CARR_ID = '01'  THEN CALL_NUM END),0) ,\\n   NVL(SUM(CASE WHEN ROAM_TYPE='9' AND CALL_TYPE <> '1' AND OPP_CARR_ID = '01' THEN CALL_NUM END),0),\\n   NVL(SUM(CASE WHEN ROAM_TYPE IN ('11','13','15','17','41') AND CALL_TYPE = '1' AND OPP_CARR_ID = '01' THEN CALL_NUM END ),0),\\n   NVL(SUM(CASE WHEN ROAM_TYPE IN ('11','13','15','17','41') AND CALL_TYPE <> '1' AND OPP_CARR_ID = '01' THEN CALL_NUM END ),0),\\n   NVL(SUM(CASE WHEN ROAM_TYPE IN ('9') AND CALL_TYPE = '1' AND OPP_CARR_ID <> '01' THEN CALL_NUM END ),0),\\n   NVL(SUM(CASE WHEN ROAM_TYPE IN ('9') AND CALL_TYPE <>'1' AND OPP_CARR_ID <> '01' THEN CALL_NUM END ),0),\\n   NVL(SUM(CASE WHEN ROAM_TYPE IN ('11','13','15','17','41') AND CALL_TYPE = '1' AND OPP_CARR_ID <> '01' THEN CALL_NUM END ),0),\\n   NVL(SUM(CASE WHEN ROAM_TYPE IN ('11','13','15','17','41') AND CALL_TYPE <> '1' AND OPP_CARR_ID <> '01' THEN CALL_NUM END ),0)\\nFROM ${SOURCE_DWD_EVT_CDR_VOC_BASETOT_MS_YYYYMM}\\nGROUP BY PHONE_NO;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [124]-[index:208]-[2015年5月新增月指标数据表]-[203]-['str' object has no attribute 'lfind']:{"name":"203.创建结果临时表","nodeId":"203","dsName":"GbaseRPT","sql":" drop table if exists gbaserpt.tmp_dm_pub_increase_01_result_${monthid};\\n CREATE TABLE gbaserpt.tmp_dm_pub_increase_01_result_${monthid} (\\n  phone_no varchar(20),\\n  txsp_use_flow decimal(47,4),\\n  yksp_use_flow decimal(47,4),\\n  pptv_use_flow decimal(47,4),\\n  mgzb_use_flow decimal(47,4),\\n  mgsp_use_flow decimal(47,4),\\n  aqy_use_flow decimal(47,4),\\n  bibi_use_flow decimal(47,4),\\n  ks_use_flow decimal(47,4),\\n  jrtt_use_flow decimal(47,4),\\n  bd_use_flow decimal(47,4),\\n  ysj_use_flow decimal(47,4),\\n  cx_offer_name varchar(50),\\n  cx_offer_level bigint(21),\\n  bxl_offer_bhd decimal(46,4),\\n  should_income decimal(34,3)\\n)distributed by ('phone_no');\\n","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [125]-[index:209]-[2015年5月新增月指标数据表]-[110]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"110.创建TMP_TOTAL_VALUE表","nodeId":"110","sql":"CREATE TABLE ${TARGET_TMP_DM_TOTAL_VALUE_YYYYMM}\\n(\\tPHONE_NO\\t\\t\\tVARCHAR(50),\\n\\tTOTAL_VALUE\\t\\t\\tbigint,\\n\\tLOCAL_TOTAL_VALUE\\tbigint,\\n\\tCALL_TOTAL_VALUE\\tbigint\\t)\\nDISTRIBUTED BY ('PHONE_NO') nolock;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [126]-[index:210]-[2015年5月新增月指标数据表]-[173]-['str' object has no attribute 'lfind']:{"name":"插入语句13","nodeId":"173","dsName":"GbaseDM","sql":"INSERT INTO dm.tmp_DM_PUB_INCREASE_01_13\\n (PHONE_NO)\\nselect phone_no from gbasedwi.dwi_inst_offer_list_all_ms_${monthid} a\\n inner join dm.dim_binding_offer_list b on a.plan_id=b.offer_id\\n group by phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [127]-[index:211]-[2015年5月新增月指标数据表]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"8.插入最终结果表","nodeId":"8","sql":"insert into ${TARGET_DM_PUB_INCREASE_01_YYYYMM}\\n (\\tOP_TIME,\\n\\tSTATIS_DATE,\\n\\tPRODUCT_NO,\\n\\tACCT_NAME,\\n\\tBA_SVC_NO,\\n\\tCUST_SVC_NO,\\n\\tBANK_NO,\\n\\tMICRO_PAYMENT_NO_OLD,\\n\\tWORK_NAME ,\\n\\tWORK_NO ,\\n\\tMAIN_PHONE,\\n\\tGPRS_DAYS,\\n\\tTOTAL_VALUE,\\n\\tLOCAL_TOTAL_VALUE,\\n\\tCALL_TOTAL_VALUE,\\n\\tGOT_OUT_NET1,\\n\\tGOT_IN_NET1,\\n\\tINTER_OUT_NET1,\\n\\tINTER_IN_NET1,\\n\\tGOT_OUT_NET2,\\n\\tGOT_IN_NET2,\\n\\tINTER_OUT_NET2,\\n\\tINTER_IN_NET2,\\n\\tONEPAPER_MANYNO_FLAG1 ,\\n\\tONEPAPER_MANYNO_FLAG2 ,\\n\\tFIELD1,\\n\\tFLOW_MSM_TYPE,\\n\\tCARD_FLAG1,\\n\\tLOCAL_OUT_VALUE,\\n        IS_SHOUTING,\\n        IS_WEITING,\\n        LIULIANG_COUNTS,\\n        XINYEWU_COUNTS,\\n        HAOMA_ZHUANQU,\\n        KUANDAI_ZHUANQU,\\n        SHOUJI_ZHUANQU,\\n        LIULIANG_ZHUANQU,\\n        XINYEWU_ZHUANQU,\\n        LIULIANG_YUE,\\n        TAOCAN_YULIANG,\\n        WODE_ZHANGDAN,\\n        IS_HARDBIND,    -- 以下20180808 添加\\n\\t\\thejiaqin_day_num ,\\n   hejiaqin_ACCESS_DUR ,\\n   hejiaqin_use_flow ,\\n   hefeixin_day_num ,\\n   hefeixin_access_dur ,\\n   hefeixin_use_flow ,\\n   hebao_day_num ,\\n   hebao_access_dur ,\\n   hebao_use_flow ,\\n   hecaiyun_day_num ,\\n   hecaiyun_access_dur ,\\n   hecaiyun_use_flow ,\\n   youxiang_day_num ,\\n   youxiang_access_dur ,\\n   youxiang_use_flow ,\\n   game_access_cnt ,\\n   game_use_flow ,\\n   game_day_num ,\\n   kinghonor_day_num ,\\n   kinghonor_access_cny ,\\n   xiaoxiaole_day_num ,\\n   xiaoxiaole_access_cnt ,\\n   doudizhu_day_num ,\\n   doudizhu_access_cnt ,\\n   qiuqiu_day_num ,\\n   qiuqiu_access_cnt ,\\n   taichishe_day_num ,\\n   taichishe_access_cnt ,\\n   JJdoudizhu_day_num ,\\n   JJdoudizhu_access_cnt ,\\n   buluochongtu_day_num ,\\n   buluochongtu_access_cnt ,\\n   myworld_day_num ,\\n   myworld_access_cnt ,\\n   myworld_use_flow ,\\n   aixiaochu_day_num ,\\n   aixiaochu_access_cnt ,\\n   majiangquanji_day_num ,\\n   majiangquanji_access_cnt ,\\n   QQdoudizhu_day_num ,\\n   QQdoudizhu_access_cnt ,\\n   QQdoudizhu_use_flow ,\\n   tencentmajiang_day_num ,\\n   tencentmajiang_access_cnt ,\\n   SHOULD_INCOME ,\\n   miguread_day_num,\\n   miguread_access_dur,\\n   miguvideo_day_num,\\n   miguvideo_access_dur,\\n   migugame_day_num,\\n   migugame_access_cnt,\\n   migugame_use_flow,\\ntxstxsp_use_flowp_use_flow ,\\nyksp_use_flow  ,   \\npptv_use_flow  ,   \\nmgzb_use_flow  ,   \\nmgsp_use_flow  ,   \\naqy_use_flow  ,    \\nbibi_use_flow  ,   \\nks_use_flow  ,     \\njrtt_use_flow  ,   \\nbd_use_flow  ,     \\nysj_use_flow ,     \\ncx_offer_name ,    \\ncx_offer_level,    \\nbxl_offer_bhd ,    \\nshould_income_curm,\\nCREDIT_SCORE,             -- 信用分数\\nCHARACTERISTICS,          -- 身份特征分数\\nCONSUMPTION_CAPACITY ,    -- 消费能力分数\\nCONNECTION,               -- 人脉关系分数\\nBEHAVIORAL_PREFERENCE,    -- 行为偏好分数\\nCREDIT_HISTORY ,           -- 信用历史分数\\nflag_1   ,-- 限速sum                     \\nflag_2     ,-- 主套餐降档sum（降5元以上）           \\nflag_3     ,-- 宝藏卡sum                    \\nflag_4     ,-- 停机                        \\nflag_5     ,-- 异网双卡保号                    \\nflag_6     ,-- 语音低饱和流量超套                 \\nflag_7     ,-- 流量持续超套（连续3个月）             \\nflag_8     ,-- 语音低饱和且流量低饱和               \\nflag_9     ,-- 语音超套且流量超套                 \\nflag_10    ,-- 订购流量包且流量超套                \\nflag_11    ,-- 有携转倾向                     \\nflag_num    -- 隐患数量 \\n)\\nselect\\t${curmfirstday},\\n\\t\\t${monthid},\\n\\t\\tA.PHONE_NO,\\n\\t\\ttrim(B.ACCT_NAME),\\n\\t\\tB.BA_SVC_NO,\\n\\t\\tB.CUST_SVC_NO,\\n\\t\\tB.BANK_NO,\\n\\t\\tB.MICRO_PAYMENT_NO_OLD,\\n\\t\\tB.WORK_NAME,\\n\\t\\tB.WORK_NO,\\n\\t\\tB.MAIN_PHONE,\\n\\t\\tC.GPRS_DAYS,\\n\\t\\tI.TOTAL_VALUE,\\n\\t\\tI.LOCAL_TOTAL_VALUE,\\n\\t\\tI.CALL_TOTAL_VALUE,\\n\\t\\tD.GOT_OUT_NET1,\\n\\t\\tD.GOT_IN_NET1,\\n\\t\\tD.INTER_OUT_NET1,\\n\\t\\tD.INTER_IN_NET1,\\n\\t\\tD.GOT_OUT_NET2,\\n\\t\\tD.GOT_IN_NET2,\\n\\t\\tD.INTER_OUT_NET2,\\n\\t\\tD.INTER_IN_NET2,\\n\\t\\tNULL  ONEPAPER_MANYNO_FLAG1,\\n\\t\\tnull/*case when e.IS_ONETOFIVE>1 then 1 else 0 end*/ ONEPAPER_MANYNO_FLAG2,\\n\\t    /*case when E.count>5 and E.IDEN_NO is not null then 1 else 0 end ONEPAPER_MANYNO_FLAG1,*/\\n\\t\\t/*case when F.count>5 and F.IDEN_NO is not null then 1 else 0 end ONEPAPER_MANYNO_FLAG2,*/\\n\\t\\tnull FIELD1,\\n\\t\\tG.SMS_TYPE,\\n\\t\\tcase when H.USER_ID is not null then 1 else 0 end,\\n\\t\\tt.CALL_DURATION_M  LOCAL_OUT_VALUE,\\n    case when j.phone_no is not null then 1 else 0 end ,\\n    case when k.phone_no is not null then 1 else 0 end,\\n    NVL(L.LIULIANG_COUNTS,0),\\n    NVL(L.XINYEWU_COUNTS,0),\\n    m.HAOMA_ZHUANQU,\\n    m.KUANDAI_ZHUANQU,\\n    m.SHOUJI_ZHUANQU,\\n    m.LIULIANG_ZHUANQU,\\n    m.XINYEWU_ZHUANQU,\\n    m.LIULIANG_YUE,\\n    m.TAOCAN_YULIANG,\\n    m.WODE_ZHANGDAN,\\n   case when t13.phone_no is not null then 1 else 0 end is_hardbind,\\n    t14.hejiaqin_day_num ,\\n   t14.hejiaqin_ACCESS_DUR ,\\n   t14.hejiaqin_use_flow ,\\n   t14.hefeixin_day_num ,\\n   t14.hefeixin_access_dur ,\\n   t14.hefeixin_use_flow ,\\n   t14.hebao_day_num ,\\n   t14.hebao_access_dur ,\\n   t14.hebao_use_flow ,\\n   t14.hecaiyun_day_num ,\\n   t14.hecaiyun_access_dur ,\\n   t14.hecaiyun_use_flow ,\\n   t14.youxiang_day_num ,\\n   t14.youxiang_access_dur ,\\n   t14.youxiang_use_flow ,\\n   t14.game_access_cnt ,\\n   t14.game_use_flow ,\\n   t14.game_day_num ,\\n   t14.kinghonor_day_num ,\\n   t14.kinghonor_access_cny ,\\n   t14.xiaoxiaole_day_num ,\\n   t14.xiaoxiaole_access_cnt ,\\n   t14.doudizhu_day_num ,\\n   t14.doudizhu_access_cnt ,\\n   t14.qiuqiu_day_num ,\\n   t14.qiuqiu_access_cnt ,\\n   t14.taichishe_day_num ,\\n   t14.taichishe_access_cnt ,\\n   t14.JJdoudizhu_day_num ,\\n   t14.JJdoudizhu_access_cnt ,\\n   t14.buluochongtu_day_num ,\\n   t14.buluochongtu_access_cnt ,\\n   t14.myworld_day_num ,\\n   t14.myworld_access_cnt ,\\n   t14.myworld_use_flow ,\\n   t14.aixiaochu_day_num ,\\n   t14.aixiaochu_access_cnt ,\\n   t14.majiangquanji_day_num ,\\n   t14.majiangquanji_access_cnt ,\\n   t14.QQdoudizhu_day_num ,\\n   t14.QQdoudizhu_access_cnt ,\\n   t14.QQdoudizhu_use_flow ,\\n   t14.tencentmajiang_day_num ,\\n   t14.tencentmajiang_access_cnt ,\\n   t14.SHOULD_INCOME ,\\n   t14.miguread_day_num,\\n   t14.miread_access_dur,\\n   t14.miguvideo_day_num,\\n   t14.miguvideo_access_dur,\\n   t14.migugame_day_num,\\n   t14.migugame_access_cnt,\\n   t14.migugame_use_flow,\\n   T15.txsp_use_flow  ,              \\nT15.yksp_use_flow  ,              \\nT15.pptv_use_flow  ,               \\nT15.mgzb_use_flow  ,           \\nT15.mgsp_use_flow  ,             \\nT15.aqy_use_flow  ,                    \\nT15.bibi_use_flow  ,              \\nT15.ks_use_flow  ,                    \\nT15.jrtt_use_flow  ,            \\nT15.bd_use_flow  ,                   \\nT15.ysj_use_flow ,               \\nT15.cx_offer_name ,               \\nT15.cx_offer_level,             \\nT15.bxl_offer_bhd ,  \\nT15.should_income ,\\nT16.CREDIT_SCORE,             -- 信用分数\\nT16.CHARACTERISTICS,          -- 身份特征分数\\nT16.CONSUMPTION_CAPACITY ,    -- 消费能力分数\\nT16.CONNECTION,               -- 人脉关系分数\\nT16.BEHAVIORAL_PREFERENCE,    -- 行为偏好分数\\nT16.CREDIT_HISTORY  ,          -- 信用历史分数\\ncase when T17.flag_1=1 then 1 else 0 end flag_1   ,-- 限速sum                     \\ncase when T17.flag_2=1 then 1 else 0 end flag_2     ,-- 主套餐降档sum（降5元以上）           \\ncase when T17.flag_3=1 then 1 else 0 end flag_3     ,-- 宝藏卡sum                    \\ncase when T17.flag_4=1 then 1 else 0 end flag_4     ,-- 停机                        \\ncase when T17.flag_5=1 then 1 else 0 end flag_5     ,-- 异网双卡保号                    \\ncase when T17.flag_6=1 then 1 else 0 end flag_6     ,-- 语音低饱和流量超套                 \\ncase when T17.flag_7=1 then 1 else 0 end flag_7     ,-- 流量持续超套（连续3个月）             \\ncase when T17.flag_8=1 then 1 else 0 end flag_8     ,-- 语音低饱和且流量低饱和               \\ncase when T17.flag_9=1 then 1 else 0 end flag_9     ,-- 语音超套且流量超套                 \\ncase when T17.flag_10=1 then 1 else 0 end flag_10    ,-- 订购流量包且流量超套                \\ncase when T17.flag_11=1 then 1 else 0 end flag_11    ,-- 有携转倾向                     \\nT17.flag_num    -- 隐患数量\\nfrom (select A.PHONE_NO,A.USER_ID,B.CERT_NO IDEN_NO,c.ACCT_ID\\n\\t  from ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM1} a \\n      left join gbasedwd.dwd_zg_crm_user_ds_${curmlastday} c on a.phone_no=c.phone_id -- 原接口gbaseods.ods_d_f_bos_50040_crm_user_${curmlastday}\\n\\t  LEFT JOIN ${SOURCE_DWI_USR_PESN_ALLCUST_MS_YYYYMM} B ON c.CUST_ID=B.CUST_ID\\n\\t  where (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001\\n\\t  ) a\\nLEFT JOIN ${TARGET_TMP_DM_ACCT_INFO_YYYYMM} B ON A.ACCT_ID = B.ACCT_ID\\nLEFT JOIN (select PHONE_NO,count(STAT_DATE) GPRS_DAYS\\n\\t\\t   from (select PHONE_NO,STAT_DATE,sum(total_flow) total_flow \\n\\t\\t\\t\\t from ${SOURCE_DWD_EVT_CDR_GPRS_BUSITYPETOT_DM_YYYYMM}\\n\\t\\t\\t\\t group by PHONE_NO,STAT_DATE) a where total_flow>'0' group by PHONE_NO) C\\n\\tON A.PHONE_NO = C.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_TOTAL_VALUE_YYYYMM} I on A.PHONE_NO=I.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DW_CALL_YYYYMM} D on A.PHONE_NO=D.PHONE_NO\\n/*left join ${SOURCE_DWI_USR_PESN_REALNAME_DS_YYYYMMDD} e ON A.PHONE_NO=e.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_INT_ONEPAPER_MANYNO_YYYYMM} E ON A.IDEN_NO=E.IDEN_NO\\nLEFT JOIN ${TARGET_TMP_ONEPAPER_MANYNO_YYYYMM} F ON A.IDEN_NO=F.IDEN_NO*/\\nLEFT JOIN ${TARGET_TMP_DM_SMS_TYPE_YYYYMM} G ON A.PHONE_NO=G.PHONE_NO\\nLEFT JOIN ${SOURCE_DWI_USR_PESN_THINGINTER_MS_YYYYMM} H ON A.USER_ID=H.USER_ID\\nLEFT JOIN (select PHONE_NO,sum(CALL_DUR) CALL_DURATION_M  \\n\\t\\t         from ${SOURCE_DWD_EVT_CDR_VOC_BASETOT_MS_YYYYMM} \\n\\t\\t        where OPP_CARR_ID = '01' and ROAM_TYPE in ('0','1','7') and CALL_TYPE = '1' \\n\\t\\t          and TOLL_TYPE in ('0','1','7') group by PHONE_NO) t on a.phone_no=t.phone_no\\nLEFT JOIN ${TARGET_TMP_DM_SHOUTING_YYYYMM} J ON A.PHONE_NO=J.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_WEITING_YYYYMM} K ON A.PHONE_NO=K.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_QUDAO_YYYYMM} L ON A.PHONE_NO=L.PHONE_NO\\nLEFT JOIN ${TARGET_TMP_DM_CHECK_SHOUTING_YYYYMM} M ON A.PHONE_NO=M.PHONE_NO\\nLEFT JOIN DM.TMP_DM_PUB_INCREASE_01_13 T13 ON A.PHONE_NO=T13.PHONE_NO\\nLEFT JOIN gbaserpt.tmp_app_result_${monthid} T14 ON A.PHONE_NO=T14.PHONE_NO\\nLEFT JOIN gbaserpt.tmp_dm_pub_increase_01_result_${monthid} T15 on A.PHONE_NO=T15.PHONE_NO\\nLEFT JOIN dm.tmp_credit_data_${monthid} T16 on A.PHONE_NO=T16.PHONE_NO\\nleft join gbaserpt.rpt_202205041_three_result_${monthid} T17 on A.PHONE_NO=T17.product_no"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [128]-[index:215]-[2015年5月新增月指标数据表]-[129]-['str' object has no attribute 'lfind']:{"name":"129.创建TMP_TOTAL_SHOUTING表","nodeId":"129","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_SHOUTING_YYYYMM}\\n(\\tPHONE_NO\\t\\t\\tVARCHAR(50)\\n)\\nDISTRIBUTED BY ('PHONE_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [129]-[index:216]-[2015年5月新增月指标数据表]-[214]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"214.创建credit_data临时表,并插入数据","nodeId":"214","sql":"##删除临时表\\ndrop table if exists tmp_credit_data_${monthid};\\n##创建临时表\\n create table tmp_credit_data_${monthid}\\n    (  \\n\\t   phone_no     varchar(50),        -- 手机号码\\n\\t   CREDIT_SCORE bigint,             -- 信用分数\\n       CHARACTERISTICS bigint,          -- 身份特征分数\\n       CONSUMPTION_CAPACITY bigint,     -- 消费能力分数\\n       CONNECTION bigint,               -- 人脉关系分数\\n       BEHAVIORAL_PREFERENCE bigint,    -- 行为偏好分数\\n       CREDIT_HISTORY   bigint          -- 信用历史分数\\n\\t ) distributed by ('phone_no');\\n\\t \\ninsert into tmp_credit_data_${monthid}\\nselect phone_no,                 -- 手机号码\\n       CREDIT_SUM,               -- 信用分数\\n       IDENTITY_CHAR,          -- 身份特征分数\\n       CONSUMPT_POWER ,    -- 消费能力分数\\n       CONTACTS,               -- 人脉关系分数\\n       BEHAVIOR_CHAR,    -- 行为偏好分数\\n       CREDIT_HISTORY            -- 信用历史分数\\n from gbasedwd.${table_name.name1};"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [130]-[index:217]-[2015年5月新增月指标数据表]-[73]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入语句2","nodeId":"73","sql":"INSERT INTO ${TARGET_TMP_DM_ACCT_INFO_YYYYMM}\\n(\\tACCT_NAME,\\n\\tBA_SVC_NO,\\n\\tCUST_SVC_NO,\\n\\tBANK_NO,\\n\\tMICRO_PAYMENT_NO_OLD,\\n\\tWORK_NAME,\\n\\tWORK_NO,\\n\\tMAIN_PHONE,\\n\\tACCT_ID\\t\\t)\\nSELECT A.ACCT_NAME,\\n\\t\\tA.BA_ACCT_ID,\\n\\t\\tA.CUST_CA_CODE,\\n\\t\\tB.BANK_CODE,\\n\\t\\tNULL MICRO_PAYMENT_NO_OLD,\\n\\t\\tNVL(F.WORK_NAME,G.WORK_NAME) WORK_NAME,\\n\\t\\tNVL(F.WORK_NO,G.WORK_NO)  WORK_NO,\\n\\t\\tA.MAIN_PHONE,\\n\\t\\tTO_CHAR(A.ACCT_ID)\\n FROM ${SOURCE_DWI_INCO_ACCB_ACCTCUST_DS_YYYYMMDD} A\\n LEFT JOIN (SELECT ACCT_ID,BANK_CODE\\n\\t\\t    FROM (SELECT ACCT_ID,BANK_CODE,ROW_NUMBER()OVER(PARTITION BY ACCT_ID ORDER BY BANK_CODE) RN \\n\\t\\t\\t\\t  FROM ${SOURCE_DWD_ACC_COLLEC_REC_MS_YYYYMM}) A WHERE RN=1) B ON A.ACCT_ID=B.ACCT_ID\\n LEFT JOIN (SELECT GRP_CUST_ID,MGR_ID \\n\\t\\t    FROM(SELECT A.*,ROW_NUMBER()OVER(PARTITION BY GRP_CUST_ID ORDER BY ACPT_DATE )RN \\n\\t\\t\\t\\t FROM ${SOURCE_DWD_PRTY_CUST_GRP_MANGR_DS_YYYYMMDD} A WHERE GRP_CUST_ID='66230358')  A \\n\\t\\t    WHERE RN=1) D ON A.CUST_ID =D.GRP_CUST_ID \\n LEFT JOIN ${SOURCE_DIM_RES_STAFF} E ON D.MGR_ID=E.STAFF_ID\\n LEFT JOIN ${SOURCE_DIM_RES_OPERATOR} F ON E.STAFF_ID =F.STAFF_ID\\nLEFT JOIN ${SOURCE_DIM_RES_OPERATOR} G ON G.STAFF_ID =A.CREATE_STAFF_ID;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [131]-[index:218]-[2015年5月新增月指标数据表]-[191]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseRPT","dsName":"GbaseRPT","schema_union":"GbaseRPT","schema_dev":"GbaseRPT","schema_prod":"GbaseRPT","queue_union":"","queue_dev":"","queue_prod":"","name":"191.插入数据app明细表","nodeId":"191","sql":"insert into gbaserpt.tmp_20180808_app_${monthid}\\nselect  phone_no,\\n        sum(case when b.app_name='和家亲' and b.app_type_id=5 then acce_days else 0 end) hejiaqin_acce_days,       -- 和家亲使用天数\\n        sum(case when b.app_name='和家亲' and b.app_type_id=5 then apply_dur else 0 end) hejiaqin_apply_dur,        -- 和家亲使用时长\\n        round(sum(case when b.app_name='和家亲' and b.app_type_id=5 then up_flow+down_flow else 0 end)/1024,2) hejiaqin_use_flow,   -- 和家亲使用流量\\n        sum(case when b.app_name='和飞信' and b.app_type_id=1 then acce_days else 0 end) hefeixin_acce_days,             -- 和飞信使用天数\\n        sum(case when b.app_name='和飞信' and b.app_type_id=1 then apply_dur else 0 end) hefeixin_apply_dur,       -- 和飞信使用时长\\n        round(sum(case when b.app_name='和飞信' and b.app_type_id=1 then up_flow+down_flow else 0 end)/1024,2) hefeixin_use_flow,   -- 和飞信使用流量\\n        sum(case when b.app_name='和包' and b.app_type_id=9 then acce_days else 0 end) hebao_acce_days,                -- 和包使用天数\\n        sum(case when b.app_name='和包' and b.app_type_id=9 then apply_dur else 0 end) hebao_apply_dur,          -- 和包使用时长  \\n        round(sum(case when b.app_name='和包' and b.app_type_id=9 then up_flow+up_flow else 0 end)/1024,2) hebao_use_flow,        -- 和包使用流量\\n        sum(case when b.app_name='和彩云' and b.app_type_id=20 then acce_days else 0 end) hecaiyun_acce_days,                   -- 和彩云使用天数\\n        sum(case when b.app_name='和彩云'  and b.app_type_id=20 then apply_dur else 0 end) hecaiyun_apply_dur,             -- 和彩云使用时长\\n        round(sum(case when b.app_name='和彩云' and b.app_type_id=20 then up_flow+down_flow else 0 end)/1024,2) hecaiyun_use_flow,        -- 和彩云使用流量\\n        sum(case when b.app_name='139邮箱' and b.app_type_id=11 then acce_days else 0 end) youxiang_acce_days,                   -- 139邮箱使用天数\\n        sum(case when b.app_name='139邮箱' and b.app_type_id=11 then apply_dur else 0 end) youxiang_apply_dur,             -- 139邮箱使用时长\\n        round(sum(case when b.app_name='139邮箱' and b.app_type_id=11 then up_flow+down_flow else 0 end)/1024,2)  youxiang_use_flow,          -- 139邮箱使用流量\\n        sum(case when b.app_type_id=8 then apply_count else 0 end) game_apply_count,          -- 游戏类APP使用次数\\n        round(sum(case when b.app_type_id=8 then up_flow+down_flow else 0 end)/1024,2) game_use_flow,     -- 游戏类APP使用流量\\n        max(case when b.app_type_id=8 then acce_days else 0 end) game_acce_days ,                -- 游戏类APP使用天数\\n        sum(case when b.app_name='王者荣耀' and b.app_type_id=8 then acce_days else 0 end) kinghonor_acce_days ,                 -- 王者荣耀使用天数\\n        sum(case when b.app_name='王者荣耀' and b.app_type_id=8 then apply_count else 0 end) kinghonor_access_cny,            -- 王者荣耀使用次数\\n        sum(case when b.app_name='开心消消乐' and b.app_type_id=8 then acce_days else 0 end) xiaoxiaole_acce_days,     -- 开心消消乐使用天数\\n        sum(case when b.app_name='开心消消乐' and b.app_type_id=8 then apply_count else 0 end) xiaoxiaole_apply_count, -- 开心消消乐使用次数\\n        sum(case when b.app_name='欢乐斗地主' and b.app_type_id=8 then acce_days else 0 end) doudizhu_acce_days,      -- 欢乐斗地主使用天数\\n        sum(case when b.app_name='欢乐斗地主' and b.app_type_id=8 then apply_count else 0 end) doudizhu_apply_count,    -- 欢乐斗地主使用次数\\n        sum(case when b.app_name='球球大作战' and b.app_type_id=8 then acce_days else 0 end) qiuqiu_acce_days,     --  球球大作战使用天数\\n        sum(case when b.app_name='球球大作战' and b.app_type_id=8 then apply_count else 0 end) qiuqiu_apply_count,   --  球球大作战使用次数\\n        sum(case when b.app_name='贪吃蛇大作战' and b.app_type_id=8 then acce_days else 0 end) taichishe_acce_days,   -- 贪吃蛇大作战使用天数\\n\\t      sum(case when b.app_name='贪吃蛇大作战' and b.app_type_id=8 then apply_count else 0 end) taichishe_apply_count,-- 贪吃蛇大作战使用次数\\n        sum(case when b.app_name='JJ斗地主' and b.app_type_id=8 then acce_days else 0 end) JJdoudizhu_acce_days,      -- jj斗地主使用天数\\n        sum(case when b.app_name='JJ斗地主' and b.app_type_id=8 then apply_count else 0 end) JJdoudizhu_apply_count,   -- jj斗地主使用次数\\n        sum(case when b.app_name='部落冲突' and b.app_type_id=8 then acce_days else 0 end) buluochongtu_acce_days,        -- 部落冲突使用天数\\n        sum(case when b.app_name='部落冲突' and b.app_type_id=8 then apply_count else 0 end) buluochongtu_apply_count,   -- 部落冲突使用次数\\n        sum(case when b.app_name='我的世界' and b.app_type_id=8 then acce_days else 0 end) myworld_acce_days,                      -- 我的世界使用天数\\n        sum(case when b.app_name='我的世界' and b.app_type_id=8 then apply_count else 0 end) myworld_apply_count,                -- 我的世界使用次数\\n        round(sum(case when b.app_name='我的世界' and b.app_type_id=8 then up_flow+down_flow else 0 end)/1024,2) myworld_use_flow,           -- 我的世界使用流量\\n        sum(case when b.app_name='天天爱消除' and b.app_type_id=8 then acce_days else 0 end) aixiaochu_acce_days,     -- 天天爱消除使用天数\\n        sum(case when b.app_name='天天爱消除' and b.app_type_id=8 then apply_count else 0 end) aixiaochu_apply_count, -- 天天爱消除使用次数\\n        sum(case when b.app_name='欢乐麻将全集' and b.app_type_id=8 then acce_days else 0 end) majiangquanji_acce_days,  -- 欢乐麻将全集使用天数\\n        sum(case when b.app_name='欢乐麻将全集' and b.app_type_id=8 then apply_count else 0 end) majiangquanji_apply_count, -- 欢乐麻将全集使用次数\\n        sum(case when b.app_name='欢乐斗地主' and b.app_type_id=8 then acce_days else 0 end) QQdoudizhu_acce_days,  -- QQ欢乐斗地主使用天数\\n        sum(case when b.app_name='欢乐斗地主' and b.app_type_id=8 then apply_count else 0 end) QQdoudizhu_apply_count,            -- QQ欢乐斗地主使用次数\\n        round(sum(case when b.app_name='欢乐斗地主' and b.app_type_id=8 then up_flow+down_flow else 0 end)/1024,2) QQdoudizhu_use_flow,        -- QQ欢乐斗地主使用流量\\n        sum(case when b.app_name='欢乐麻将' and b.app_type_id=8 then acce_days else 0 end) tencentmajiang_acce_days,     -- 腾讯欢乐麻将使用天数\\n        sum(case when b.app_name='欢乐麻将' and b.app_type_id=8 then apply_count else 0 end) tencentmajiang_apply_count,   -- 腾讯欢乐麻将使用次数\\n        sum(case when b.app_id=1 and b.app_type_id=2 then acce_days else 0 end ) miguread_acce_days,  -- 咪咕阅读使用天数\\n        sum(case when b.app_id=1 and b.app_type_id=2 then apply_dur else 0 end) miread_apply_dur,-- 咪咕阅读使用时长\\n        sum(case when b.app_id=2 and b.app_type_id=5 then acce_days else 0 end) miguvideo_acce_days,-- 咪咕视频使用天数\\n        sum(case when b.app_id=2 and b.app_type_id=5 then apply_dur else 0 end) miguvideo_apply_dur,  -- 咪咕视频使用时长\\n        sum(case when b.app_id=1 and b.app_type_id=8 then acce_days else 0 end) migugame_acce_days , -- 咪咕游戏使用天数\\n        sum(case when b.app_id=1 and b.app_type_id=8 then apply_count else 0 end) migugame_apply_count,   -- 咪咕游戏使用次数\\n        round(sum(case when b.app_id=1 and b.app_type_id=8 then up_flow+down_flow else 0 end)/1024,2) migugame_use_flow -- 咪咕游戏使用流量\\nfrom gbasedwi.dwi_beh_log_app_depttot_ms_${monthid} a \\nleft join (select distinct app_id,app_type_id,app_name from \\ngbasedwd.dim_app_hive where status=1) b on a.app_id=b.app_id and a.app_type_id=b.app_type_id\\ngroup by phone_no"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [132]-[index:219]-[2015年5月新增月指标数据表]-[132]-['str' object has no attribute 'lfind']:{"name":"插入语句9","nodeId":"132","dsName":"GbaseDM","sql":"insert into ${TARGET_TMP_DM_SHOUTING_YYYYMM}\\n(\\tPHONE_NO )\\nSELECT PHONE_NO FROM \\n${SOURCE_DWD_EVT_LOG_VGOP_USERALL_DREMAN_DS_YYYYMMDD}\\nGROUP BY PHONE_NO;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [133]-[index:220]-[2015年5月新增月指标数据表]-[159]-['str' object has no attribute 'lfind']:{"name":"创建TMP_TOTAL_CHECK_SHOUTING表","nodeId":"159","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_CHECK_SHOUTING_YYYYMM}\\n(\\tPHONE_NO\\t\\t\\tVARCHAR(50),\\n\\tHAOMA_ZHUANQU          BIGINT,\\n        KUANDAI_ZHUANQU        BIGINT,\\n        SHOUJI_ZHUANQU           BIGINT,\\n        LIULIANG_ZHUANQU        BIGINT,\\n        XINYEWU_ZHUANQU        BIGINT,\\n        LIULIANG_YUE                 BIGINT,\\n        TAOCAN_YULIANG          BIGINT,\\n        WODE_ZHANGDAN\\t        BIGINT)\\nDISTRIBUTED BY ('PHONE_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [134]-[index:221]-[2015年5月新增月指标数据表]-[154]-['str' object has no attribute 'lfind']:{"name":"154.插入语句11","nodeId":"154","dsName":"GbaseDM","sql":"insert into ${TARGET_TMP_DM_QUDAO_YYYYMM}\\n(\\tPHONE_NO,LIULIANG_COUNTS,XINYEWU_COUNTS\\t)\\nselect   \\n        phone_no,\\n        sum(case when type_id=1 then 1 else 0 end),   -- 流量业务次数\\n        sum(case when type_id=2 then 1 else 0 end)    -- 新业务次数\\n  from ${SOURCE_DWI_INST_ORD_LIST_DM_YYYYMM} a\\n inner join ${SOURCE_DIM_COCNEW_SZ_OFFER} b on a.plan_id=b.offer_id\\n where (chl_lvl4_cls in ('一级电渠','VGOP平台','电商平台自有电子渠道（BJCRMEC）','综合网关','门户网站','服务客户端')\\n        or staff_busi_id like 'OP_%' or staff_busi_id like 'BJCRMJT-%')\\n   and action_type in ('创建','变更')\\n group by phone_no;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [135]-[index:222]-[2015年5月新增月指标数据表]-[194]-['str' object has no attribute 'lfind']:{"name":"194.创建结果明细临时表","nodeId":"194","dsName":"GbaseRPT","sql":"drop table if exists gbaserpt.tmp_app_result_${monthid};\\nCREATE TABLE  gbaserpt.tmp_app_result_${monthid}  (\\n    phone_no  varchar(100),\\n   hejiaqin_day_num  bigint,\\n   hejiaqin_ACCESS_DUR  bigint,\\n   hejiaqin_use_flow  bigint,\\n   hefeixin_day_num  bigint,\\n   hefeixin_access_dur  bigint,\\n   hefeixin_use_flow  bigint,\\n   hebao_day_num  bigint,\\n   hebao_access_dur  bigint,\\n   hebao_use_flow  bigint,\\n   hecaiyun_day_num  bigint,\\n   hecaiyun_access_dur  bigint,\\n   hecaiyun_use_flow  bigint,\\n   youxiang_day_num  bigint,\\n   youxiang_access_dur  bigint,\\n   youxiang_use_flow  bigint,\\n   game_access_cnt  bigint,\\n   game_use_flow  bigint,\\n   game_day_num  bigint,\\n   kinghonor_day_num  bigint,\\n   kinghonor_access_cny  bigint,\\n   xiaoxiaole_day_num  bigint,\\n   xiaoxiaole_access_cnt  bigint,\\n   doudizhu_day_num  bigint,\\n   doudizhu_access_cnt  bigint,\\n   qiuqiu_day_num  bigint,\\n   qiuqiu_access_cnt  bigint,\\n   taichishe_day_num  bigint,\\n   taichishe_access_cnt  bigint,\\n   JJdoudizhu_day_num  bigint,\\n   JJdoudizhu_access_cnt  bigint,\\n   buluochongtu_day_num  bigint,\\n   buluochongtu_access_cnt  bigint,\\n   myworld_day_num  bigint,\\n   myworld_access_cnt  bigint,\\n   myworld_use_flow  bigint,\\n   aixiaochu_day_num  bigint,\\n   aixiaochu_access_cnt  bigint,\\n   majiangquanji_day_num  bigint,\\n   majiangquanji_access_cnt  bigint,\\n   QQdoudizhu_day_num  bigint,\\n   QQdoudizhu_access_cnt  bigint,\\n   QQdoudizhu_use_flow  bigint,\\n   tencentmajiang_day_num  bigint,\\n   tencentmajiang_access_cnt  bigint,\\n   SHOULD_INCOME  bigint,\\n   miguread_day_num bigint,\\n   miread_access_dur bigint,\\n   miguvideo_day_num bigint,\\n   miguvideo_access_dur bigint,\\n   migugame_day_num bigint,\\n   migugame_access_cnt bigint,\\n   migugame_use_flow bigint\\n   ) distributed by ('phone_no')","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [136]-[index:223]-[2015年5月新增月指标数据表]-[77]-['str' object has no attribute 'lfind']:{"name":"插入语句3","nodeId":"77","dsName":"GbaseDM","sql":"INSERT INTO ${TARGET_TMP_DM_SMS_TYPE_YYYYMM}\\n (\\tPHONE_NO,SMS_TYPE\\t)\\nSELECT PHONE_NO,SMS_TYPE  FROM  (\\nSELECT   ROW_NUMBER() OVER(PARTITION BY PHONE_NO ORDER BY ID DESC ) AS ID,PHONE_NO,SMS_TYPE \\nFROM (SELECT  PHONE_NO,SMS_TYPE,\\n\\t\\t CASE WHEN SMS_TYPE='套餐客户-超套达到100元'  THEN 6   \\n              WHEN SMS_TYPE='套餐客户-超套达到30元'  THEN 5\\n\\t\\t\\t  WHEN SMS_TYPE='套餐客户-超套达到5元'  THEN 4\\n              WHEN SMS_TYPE='无套餐客户-流量费用达到100元'  THEN 3\\n\\t\\t\\t  WHEN SMS_TYPE='无套餐客户-流量费用达到5元'    THEN 2\\n\\t\\t\\t  WHEN SMS_TYPE='无套餐客户-首次使用提醒'      THEN 1  END ID    \\n\\t FROM (SELECT PHONE_NO,USER_ID,\\n              CASE WHEN SMS_CONTENT LIKE '%套餐内国内流量已用完,超出套餐外流量费用已达100元%' THEN '套餐客户-超套达到100元'\\n\\t\\t\\t\\t   WHEN SMS_CONTENT LIKE '%套餐内国内流量已用完,超出套餐外流量费用已达30元%' THEN '套餐客户-超套达到30元' \\n\\t\\t\\t\\t   WHEN SMS_CONTENT LIKE '%套餐内国内流量已用完,超出套餐外流量费用已达5元%' THEN '套餐客户-超套达到5元'\\n\\t\\t\\t\\t   WHEN SMS_CONTENT LIKE '%套餐内国内流量已用完%' THEN '套餐客户-剩余0M' \\n\\t\\t\\t\\t   WHEN SMS_CONTENT LIKE '%流量费用已达100元%' THEN '无套餐客户-流量费用达到100元'\\n\\t\\t\\t\\t   WHEN SMS_CONTENT LIKE '%流量费用已达5元%' THEN '无套餐客户-流量费用达到5元' \\n\\t\\t\\t\\t   WHEN SMS_CONTENT LIKE '%您本月已产生上网数据流量,资费为1元/M%' THEN '无套餐客户-首次使用提醒' \\n\\t\\t\\t  END SMS_TYPE\\n\\t       FROM ${SOURCE_DWD_ACC_SMSSEND_REC_MS_YYYYMM}\\n\\t       WHERE BUSI_TYPE IN (2243,4566,2244,2240,60000,60001) AND SMS_TYPE <> 1 AND SMS_CONTENT NOT LIKE '%CENTREX总机%'  AND SMS_CONTENT NOT LIKE '%WLAN%'  AND STAT_DATE <= '${curmlastday}' \\n\\t       GROUP BY PHONE_NO,USER_ID,\\n\\t\\t\\t\\tCASE WHEN SMS_CONTENT LIKE '%套餐内国内流量已用完,超出套餐外流量费用已达100元%' \\n\\t\\t\\t\\t\\t\\tTHEN '套餐客户-超套达到100元'\\n\\t\\t\\t\\t\\t WHEN SMS_CONTENT LIKE '%套餐内国内流量已用完,超出套餐外流量费用已达30元%' \\n\\t\\t\\t\\t\\t\\tTHEN '套餐客户-超套达到30元' \\n\\t\\t\\t\\t\\t WHEN SMS_CONTENT LIKE '%套餐内国内流量已用完,超出套餐外流量费用已达5元%' \\n\\t\\t\\t\\t\\t\\tTHEN '套餐客户-超套达到5元'\\n\\t\\t\\t\\t\\t WHEN SMS_CONTENT LIKE '%套餐内国内流量已用完%' THEN '套餐客户-剩余0M' \\n\\t\\t\\t\\t\\t WHEN SMS_CONTENT LIKE '%流量费用已达100元%' THEN '无套餐客户-流量费用达到100元'\\n\\t\\t\\t\\t\\t WHEN SMS_CONTENT LIKE '%流量费用已达5元%' THEN '无套餐客户-流量费用达到5元' \\n\\t\\t\\t\\t\\t WHEN SMS_CONTENT LIKE '%您本月已产生上网数据流量,资费为1元/M%' THEN '无套餐客户-首次使用提醒' \\n\\t\\t\\t\\tEND) A\\n  WHERE SMS_TYPE IS NOT NULL  \\n  GROUP BY PHONE_NO,SMS_TYPE ) A) A WHERE ID ='1';","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [137]-[index:224]-[2015年5月新增月指标数据表]-[75]-['str' object has no attribute 'lfind']:{"name":"75.创建TMP_DM_SMS_TYPE","nodeId":"75","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_SMS_TYPE_YYYYMM}\\n      (PHONE_NO         VARCHAR(20),\\n       SMS_TYPE           VARCHAR(100)\\t) \\nDISTRIBUTED BY ('PHONE_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [138]-[index:227]-[2015年5月新增月指标数据表]-[205]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseRPT","dsName":"GbaseRPT","schema_union":"GbaseRPT","schema_dev":"GbaseRPT","schema_prod":"GbaseRPT","queue_union":"","queue_dev":"","queue_prod":"","name":"205.往结果临时表中插入数据","nodeId":"205","sql":" insert into gbaserpt.tmp_dm_pub_increase_01_result_${monthid}\\n select \\n   c.phone_no ,\\n   a.txsp_use_flow  ,    -- 腾讯视频使用流量\\n   a.yksp_use_flow  ,    -- 优酷视频使用流量\\n   a.pptv_use_flow  ,    -- PPTV使用流量\\n   a.mgzb_use_flow  ,    -- 咪咕直播使用流量\\n   a.mgsp_use_flow  ,    -- 芒果TV使用流量\\n   a.aqy_use_flow  ,     -- 爱奇艺使用流量\\n   a.bibi_use_flow  ,    -- 哔哩哔哩使用流量\\n   a.ks_use_flow  ,      -- 快手使用流量\\n   a.jrtt_use_flow  ,    -- 今日头条使用流量\\n   a.bd_use_flow  ,      -- 百度使用流量\\n   a.ysj_use_flow ,      -- 云视界使用流量\\n   nvl(b.cx_offer_name,0)  cx_offer_name , -- 畅享套餐名称\\n   nvl(b.cx_offer_level,0) cx_offer_level,  -- 畅享套餐档位\\n   nvl(d.bxl_offer_bhd,0)  bxl_offer_bhd ,  -- 不限量模组套餐资源饱和度\\n   nvl(e.should_income,0)      -- 当月ARPU（剔除即扣即返收入）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} c \\nleft join gbaserpt.tmp_dm_pub_increase_01_video_${monthid} a on c.phone_no=a.phone_no\\nleft join gbaserpt.tmp_dm_pub_increase_01_cx_${monthid} b on c.phone_no=b.phone_no\\nleft join (select k.phone_no,k.USE_RES_NUM/k.TOTAL_RES_NUM  bxl_offer_bhd-- 不限量模组套餐资源饱和度 \\nfrom (select phone_no,\\n       sum(USE_RES_NUM) USE_RES_NUM,\\n       sum(TOTAL_RES_NUM) TOTAL_RES_NUM  \\nfrom gbasedwi.DWI_INCO_BILL_FREERES_MS_${monthid}\\nwhere plan_id in(111002060404,111002060405,111002060006,111002060007) and prod_id<>'54001105'\\ngroup by phone_no) k) d on c.phone_no=d.phone_no\\nleft join ( select phone_no,sum(should_income) should_income  -- 当月ARPU（剔除即扣即返收入）      \\nfrom gbasedwi.dwi_inco_bill_item_tot_ms_${monthid}\\nwhere acct_item_id not in (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798,4686,4821,4820) \\n-- 20190222日调整acct_item_id not in(3693,4596,4626,4637,4658,4667)\\n-- 20190417日调整 4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798) \\ngroup by phone_no) e on c.phone_no=e.phone_no\\nwhere (c.PROD_KIND_CODE= 171000000001 And c.MONTH_ARRIVE_FLAG=1) or c.MONTH_OFF_FLAG  =1;"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [139]-[index:228]-[2015年5月新增月指标数据表]-[111]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"111.插入语句8","nodeId":"111","sql":"insert into ${TARGET_TMP_DM_TOTAL_VALUE_YYYYMM}\\n(\\tPHONE_NO,           \\n    TOTAL_VALUE, -- GPRS国内资源总量\\n\\tLOCAL_TOTAL_VALUE,\\n\\tCALL_TOTAL_VALUE\\t\\n)\\nselect a.phone_no,\\n       c.RES_TOTAL_NUM,\\n\\t   b.LOCAL_TOTAL_VALUE,\\n\\t   b.CALL_TOTAL_VALUE\\t\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid}  a\\nleft join (     \\n         select  PHONE_NO ,\\n                 sum(nvl(case when USE_TYPE \\n\\t             in ('国内通用流量','加油包','套外赠送国内流量','流量加油包','赠送全国通用流量','赠送国内通用流量',\\n\\t             '通用流量指定用户定额统付','京彩卡国内流量','物联网国内通用流量','季包/卡流量','半年包/卡流量',\\n\\t             '国内数据流量','年包/卡流量','和包流量充值','通用流量指定用户限量统付','北京通国内流量','流量福包',\\n\\t              '通用流量指定用户定额统付闲时','通用流量指定用户全量统付闲时','通用流量指定用户限量统付闲时','积分兑换数据流量包',\\n\\t             '特时特价流量包') then TOTAL_RES_NUM end,0))/1024*1.0,\\n                 sum(nvl(case when  USE_TYPE like '%本地%' and res_unit=1024 then TOTAL_RES_NUM end,0))/1024*1.0 LOCAL_TOTAL_VALUE,\\n                 sum(nvl(case when res_unit=60 then total_res_num end,0))/60  CALL_TOTAL_VALUE\\n         from gbasedwi.DWI_INCO_BILL_FREERES_MS_${monthid}\\n\\t\\t where prod_id<>'54001105'\\n         group by PHONE_NO\\n\\t\\t ) b on a.phone_no=b.phone_no\\nleft join (\\n           select phone_no,\\n                 sum(case when b.item_code is not null then a.FREE_RES_TOTAL_NUM else 0 end)/1024*1.0 RES_TOTAL_NUM\\n           from gbasedwd.dwd_acc_offer_freeres_ms_${monthid} a\\n           left join (\\n                      select item_code from dm.dim_pub_freeres_lty_itemcode group by item_code\\n                     ) b on a.item_code=b.item_code \\n\\t\\t  where a.boss_prod_id not in ('54001105','53005095','50002352','54001809') \\n\\t\\t    and to_number(FREE_RES_total_NUM)<1000000000000000000      \\n           group by a.phone_no\\n           ) c on a.phone_no=c.phone_no\\n\\t\\t "} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [140]-[index:229]-[2015年5月新增月指标数据表]-[151]-['str' object has no attribute 'lfind']:{"name":"151.创建TMP_TOTAL_QUDAO表","nodeId":"151","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_QUDAO_YYYYMM}\\n(\\tPHONE_NO\\t\\t\\tVARCHAR(50),\\n  LIULIANG_COUNTS BIGINT,\\n  XINYEWU_COUNTS BIGINT\\t)\\nDISTRIBUTED BY ('PHONE_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [141]-[index:230]-[2015年5月新增月指标数据表]-[163]-['str' object has no attribute 'lfind']:{"name":"163.插入语句12","nodeId":"163","dsName":"GbaseDM","sql":"INSERT INTO ${TARGET_TMP_DM_CHECK_SHOUTING_YYYYMM}\\n (PHONE_NO,HAOMA_ZHUANQU,KUANDAI_ZHUANQU,SHOUJI_ZHUANQU,LIULIANG_ZHUANQU,\\nXINYEWU_ZHUANQU,LIULIANG_YUE,TAOCAN_YULIANG,WODE_ZHANGDAN)\\nselect\\n    wt_mobile,\\n    sum(case when wt_event in('sy_hkzq_xhrw','sy_hkzq_4grzk','sy_hkzq_cjllwk')then 1 else 0 end) haoma_zhuanqu, -- 号码专区\\n    sum(case when wt_event in('sy_kdzq_ydgkd','sy_kdzq_zzfw','sy_kdzq_kdxf') then 1 else 0 end) kuandai_zhuanqu,  -- 宽带专区\\n    sum(case when wt_event in('sy_sjsc_iphone7','sy_sjsc_hwp10','sy_sjsc_oppor11','sy_sjsc_sjscgd')then 1 else 0 end) shouji_zhuanqu, -- 手机专区\\n    sum(case when wt_event in('sy_llzq_rwkllb','sy_llzq_wdll','sy_llzq_rwxllhbqg','sy_llzq_rwxllhb') then 1 else 0 end) liuliang_zhuanqu, -- 流量专区\\n    0 xinyewu_zhuanqu,-- 新业务专区（目前未上线）\\n    sum(case when wt_event ='sy_llzq_wdll' then 1 else 0 end) liuliang_yue,-- 流量查询\\n    sum(case when wt_event ='sy_sytjw_tcyl' then 1 else 0 end) taocan_yuliang,-- 套餐余量\\n    sum(case when wt_event ='sy_sytjw_wdzd' then 1 else 0 end) wode_zhangdan -- 我的账单\\n  from (\\n        select wt_mobile,lower(wt_event) wt_event from gbasedwd.dwd_chl_app_hand_office_ios_dm_${monthid}\\n        union all\\n        select wt_mobile,lower(wt_event) wt_event from gbasedwd.dwd_chl_app_hand_office_android_dm_${monthid}\\n        ) a group by wt_mobile;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [142]-[index:231]-[2015年5月新增月指标数据表]-[65]-['str' object has no attribute 'lfind']:{"name":"删除所有临时表","nodeId":"65","dsName":"GbaseDM","sql":"DROP TABLE ${TARGET_TMP_DW_CALL_YYYYMM};\\nDROP TABLE ${TARGET_TMP_DM_ACCT_INFO_YYYYMM};\\nDROP TABLE ${TARGET_TMP_DM_SMS_TYPE_YYYYMM};\\nDROP TABLE ${TARGET_TMP_DM_TOTAL_VALUE_YYYYMM};\\nDROP TABLE ${TARGET_DM_PUB_INCREASE_01_YYYYMM};\\nDROP TABLE ${TARGET_TMP_DM_SHOUTING_YYYYMM};\\nDROP TABLE ${TARGET_TMP_DM_WEITING_YYYYMM};\\nDROP TABLE ${TARGET_TMP_DM_QUDAO_YYYYMM};\\nDROP TABLE ${TARGET_TMP_DM_CHECK_SHOUTING_YYYYMM};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [143]-[index:232]-[2015年5月新增月指标数据表]-[196]-['str' object has no attribute 'lfind']:{"name":"196.结果明细表中插入数据","nodeId":"196","dsName":"GbaseRPT","sql":" insert into gbaserpt.tmp_app_result_${monthid}\\n select a.phone_no,\\n   hejiaqin_day_num ,\\n   hejiaqin_ACCESS_DUR ,\\n   hejiaqin_use_flow ,\\n   hefeixin_day_num ,\\n   hefeixin_access_dur ,\\n   hefeixin_use_flow ,\\n   hebao_day_num ,\\n   hebao_access_dur ,\\n   hebao_use_flow ,\\n   hecaiyun_day_num ,\\n   hecaiyun_access_dur ,\\n   hecaiyun_use_flow ,\\n   youxiang_day_num ,\\n   youxiang_access_dur ,\\n   youxiang_use_flow ,\\n   game_access_cnt ,\\n   game_use_flow ,\\n   game_day_num ,\\n   kinghonor_day_num ,\\n   kinghonor_access_cny ,\\n   xiaoxiaole_day_num ,\\n   xiaoxiaole_access_cnt ,\\n   doudizhu_day_num ,\\n   doudizhu_access_cnt ,\\n   qiuqiu_day_num ,\\n   qiuqiu_access_cnt ,\\n   taichishe_day_num ,\\n   taichishe_access_cnt ,\\n   JJdoudizhu_day_num ,\\n   JJdoudizhu_access_cnt ,\\n   buluochongtu_day_num ,\\n   buluochongtu_access_cnt ,\\n   myworld_day_num ,\\n   myworld_access_cnt ,\\n   myworld_use_flow ,\\n   aixiaochu_day_num ,\\n   aixiaochu_access_cnt ,\\n   majiangquanji_day_num ,\\n   majiangquanji_access_cnt ,\\n   QQdoudizhu_day_num ,\\n   QQdoudizhu_access_cnt ,\\n   QQdoudizhu_use_flow ,\\n   tencentmajiang_day_num ,\\n   tencentmajiang_access_cnt ,\\n   d.SHOULD_INCOME ,\\n   miguread_day_num,\\n   miread_access_dur,\\n   miguvideo_day_num,\\n   miguvideo_access_dur,\\n   migugame_day_num,\\n   migugame_access_cnt,\\n   migugame_use_flow\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join gbaserpt.tmp_20180808_app_${monthid} c on a.phone_no=c.phone_no\\nleft join \\n(select phone_no,sum(SHOULD_INCOME) SHOULD_INCOME -- 应收收入  \\nfrom gbasedwi.DWI_INCO_BILL_ITEM_TOT_MS_${monthid} \\nwhere ACCT_ITEM_ID in(925,772,778,3661,620,507,621,194,55,932,92) \\ngroup by phone_no) d on a.phone_no=d.phone_no\\nwhere (a.PROD_KIND_CODE= 171000000001 And a.MONTH_ARRIVE_FLAG=1) or a.MONTH_OFF_FLAG  =1;","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [144]-[index:233]-[2015年5月新增月指标数据表]-[172]-['str' object has no attribute 'lfind']:{"name":"172.创建TMP_13","nodeId":"172","dsName":"GbaseDM","sql":"drop table dm.tmp_DM_PUB_INCREASE_01_13;\\nCREATE TABLE dm.tmp_DM_PUB_INCREASE_01_13\\n(\\tPHONE_NO\\t\\t\\tVARCHAR(50)\\t)\\nDISTRIBUTED BY ('PHONE_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [145]-[index:234]-[2015年5月新增月指标数据表]-[67]-['str' object has no attribute 'lfind']:{"name":"67.创建TMP_DW_CALL表","nodeId":"67","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DW_CALL_YYYYMM}\\n( \\tPHONE_NO\\t\\t\\tVARCHAR(50),\\n\\tGOT_OUT_NET1\\t\\tBIGINT(20),\\n\\tGOT_IN_NET1\\t\\t\\tBIGINT(20),\\n\\tINTER_OUT_NET1\\t\\tBIGINT(20),\\n\\tINTER_IN_NET1\\t\\tBIGINT(20),\\n\\tGOT_OUT_NET2\\t\\tBIGINT(20),\\n\\tGOT_IN_NET2\\t\\t\\tBIGINT(20),\\n\\tINTER_OUT_NET2\\t\\tBIGINT(20),\\n\\tINTER_IN_NET2\\t\\tBIGINT(20)\\t)\\nDISTRIBUTED BY ('PHONE_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [146]-[index:235]-[2015年5月新增月指标数据表]-[135]-['str' object has no attribute 'lfind']:{"name":"创建TMP_TOTAL_WEITING表","nodeId":"135","dsName":"GbaseDM","sql":"CREATE TABLE ${TARGET_TMP_DM_WEITING_YYYYMM}\\n(\\tPHONE_NO\\t\\t\\tVARCHAR(50)\\t)\\nDISTRIBUTED BY ('PHONE_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [147]-[index:238]-[order_user个人客户月视图自动生成程序月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_ORDER_USER_${monthid};\\ncreate table DM_AUTORPT_ORDER_USER_${monthid} distributed by ('PRODUCT_NO') as select * from  DM_AUTORPT_ORDER_USER_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [148]-[index:239]-[order_user个人客户月视图自动生成程序月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_ORDER_USER_${monthid} select * from DM_AUTORPT_ORDER_USER_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [149]-[index:242]-[order_user个人客户月视图自动生成程序月调度传输]-[17]-['str' object has no attribute 'lfind']:{"name":"更新主套餐维表","nodeId":"17","dsName":"Gbase_6_DM","sql":"truncate table  DIM_OFFER_STATIC;\\ninsert into DIM_OFFER_STATIC select * from DIM_OFFER_STATIC@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [150]-[index:244]-[业务稽核单差错表累计]-[3]-['str' object has no attribute 'lfind']:{"name":"3.创建稽核单表","nodeId":"3","dsName":"GbaseDM","sql":"drop table SA_D_DM_BBC_BI_D2D_BUSI_dt_${dayid};\\ncreate table SA_D_DM_BBC_BI_D2D_BUSI_dt_${dayid}\\n( op_time date,\\n  org_id varchar(30) DEFAULT NULL COMMENT '部门ID',\\n  audit_id varchar(30) DEFAULT NULL COMMENT '稽核单ID',\\n  audit_tic_type varchar(15) DEFAULT NULL COMMENT '稽核单类型',\\n  done_date datetime DEFAULT NULL COMMENT '业务日期',\\n  bill_id varchar(50) DEFAULT NULL COMMENT '受理号码',\\n  busi_type_id_by_d2d varchar(50) DEFAULT NULL COMMENT '业务分类ID',\\n  business_name varchar(50) DEFAULT NULL COMMENT '业务名称',\\n  brand varchar(50) DEFAULT NULL COMMENT '品牌',\\n  done_code bigint(14) DEFAULT NULL COMMENT '渠道发卡受理编号',\\n  case_no bigint(20) DEFAULT NULL COMMENT '无纸化日志工单编号',\\n  file_id bigint(14) DEFAULT NULL COMMENT '批次号',\\n  order_code varchar(50) DEFAULT NULL COMMENT '操作流水',\\n  cust_id varchar(50) DEFAULT NULL COMMENT '客户编号',\\n  customer_order_id varchar(50) DEFAULT NULL COMMENT '订单编号',\\n  cust_name varchar(255) DEFAULT NULL COMMENT '客户姓名',\\n  special_num_name varchar(15) DEFAULT NULL COMMENT '号码等级',\\n  bill_id_num varchar(8) DEFAULT NULL COMMENT '手机号码号段',\\n  opr_object_name varchar(1000) DEFAULT NULL COMMENT '变更策划或产品名称',\\n  channel_type_name varchar(50) DEFAULT NULL COMMENT '受理渠道',\\n  pre_order_id bigint(14) DEFAULT NULL COMMENT '预处理工单号',\\n  is_wzh varchar(2) DEFAULT NULL COMMENT '是否无纸化',\\n  sys_auto varchar(2) DEFAULT NULL COMMENT '是否自动稽核',\\n  is_relation_receipt varchar(2) DEFAULT NULL COMMENT '是否关联票据',\\n  order_state_name varchar(50) DEFAULT NULL COMMENT '订单状态',\\n  is_channel_mid varchar(2) DEFAULT NULL COMMENT '是否中台业务',\\n  op_name varchar(100) DEFAULT NULL COMMENT '操作员',\\n  op_code varchar(50) DEFAULT NULL COMMENT '操作员工号',\\n  op_id varchar(30) DEFAULT NULL COMMENT '操作员ID',\\n  audit_status varchar(10) DEFAULT NULL COMMENT '稽核状态',\\n  auditor_name varchar(12) DEFAULT NULL COMMENT '稽核员姓名',\\n  auditor_code varchar(50) DEFAULT NULL COMMENT '稽核员工号',\\n  auditor varchar(30) DEFAULT NULL COMMENT '稽核员ID',\\n  audit_time datetime DEFAULT NULL COMMENT '稽核时间',\\n  audit_desc varchar(4000) DEFAULT NULL COMMENT '稽核说明',\\n  audit_modify_counts int(4) DEFAULT NULL COMMENT '修改次数（只包括业务的差错）',\\n  err_op_name varchar(100) DEFAULT NULL COMMENT '修改人',\\n  err_op_code varchar(50) DEFAULT NULL COMMENT '修改人工号',\\n  err_op_id varchar(30) DEFAULT NULL COMMENT '修改人ID',\\n  err_time datetime DEFAULT NULL COMMENT '修改时间',\\n  err_mdy_desc varchar(4000) DEFAULT NULL COMMENT '修改说明',\\n  rechecker_name varchar(100) DEFAULT NULL COMMENT '复核人',\\n  rechecker_code varchar(50) DEFAULT NULL COMMENT '复核人工号',\\n  rechecker varchar(30) DEFAULT NULL COMMENT '复核人ID',\\n  recheck_time datetime DEFAULT NULL COMMENT '复核时间',\\n  recheck_desc varchar(4000) DEFAULT NULL COMMENT '复核说明',\\n  tck_cmp_time datetime DEFAULT NULL COMMENT '稽核数据生成时间',\\n  deadline datetime DEFAULT NULL COMMENT '稽核时限',\\n  batch_audit int\\n) COMPRESS(1, 3)  ENGINE=EXPRESS DISTRIBUTED BY('audit_id') DEFAULT CHARSET=utf8 TABLESPACE='sys_tablespace'\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [151]-[index:245]-[业务稽核单差错表累计]-[5]-['str' object has no attribute 'lfind']:{"name":"5.SQL语句","nodeId":"5","dsName":"GbaseDM","sql":"delete from SA_D_DM_BBC_BI_D2D_BUSI_dm where op_time='${day_id}';\\ninsert into SA_D_DM_BBC_BI_D2D_BUSI_dm\\nselect '${day_id}',a.* from gbaseods.ODS_D_A_BBC_BI_D2D_BUSI_${dayid} a;\\n\\ninsert into SA_D_DM_BBC_BI_D2D_BUSI_dt_${dayid}\\nselect \\nop_time,\\norg_id,\\naudit_id,\\naudit_tic_type,\\ndone_date,\\nbill_id,\\nbusi_type_id_by_d2d,\\nbusiness_name,\\nbrand,\\ndone_code,\\ncase_no,\\nfile_id,\\norder_code,\\ncust_id,\\ncustomer_order_id,\\ncust_name,\\nspecial_num_name,\\nbill_id_num,\\nopr_object_name,\\nchannel_type_name,\\npre_order_id,\\nis_wzh,\\nsys_auto,\\nis_relation_receipt,\\norder_state_name,\\nis_channel_mid,\\nop_name,\\nop_code,\\nop_id,\\naudit_status,\\nauditor_name,\\nauditor_code,\\nauditor,\\naudit_time,\\naudit_desc,\\naudit_modify_counts,\\nerr_op_name,\\nerr_op_code,\\nerr_op_id,\\nerr_time,\\nerr_mdy_desc,\\nrechecker_name,\\nrechecker_code,\\nrechecker,\\nrecheck_time,\\nrecheck_desc,\\ntck_cmp_time,\\ndeadline,\\nbatch_audit\\nfrom (select *,row_number()over(partition by audit_id order by op_time desc,recheck_time)rn\\n      from SA_D_DM_BBC_BI_D2D_BUSI_dm)a where rn=1","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [152]-[index:246]-[业务稽核单差错表累计]-[7]-['str' object has no attribute 'lfind']:{"name":"7.创建业务差错表","nodeId":"7","dsName":"GbaseDM","sql":"drop table sa_d_dm_bbc_bi_d2d_busi_err_dt_${dayid};\\nCREATE TABLE sa_d_dm_bbc_bi_d2d_busi_err_dt_${dayid} (\\n  op_time  date,\\n  ticket_id varchar(30) DEFAULT NULL COMMENT ' 业务稽核单ID ',\\n  err_id varchar(20) DEFAULT NULL COMMENT '差错ID',\\n  item varchar(20) DEFAULT NULL COMMENT ' 稽核项 ',\\n  point varchar(20) DEFAULT NULL COMMENT ' 稽核点 ',\\n    remark   varchar(4000)\\n) COMPRESS(1, 3)  ENGINE=EXPRESS DISTRIBUTED BY('ticket_id') DEFAULT CHARSET=utf8 TABLESPACE='sys_tablespace'","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [153]-[index:247]-[业务稽核单差错表累计]-[9]-['str' object has no attribute 'lfind']:{"name":"9.SQL语句","nodeId":"9","dsName":"GbaseDM","sql":"delete from sa_d_dm_bbc_bi_d2d_busi_err_dm where op_time='${day_id}';\\ninsert into sa_d_dm_bbc_bi_d2d_busi_err_dm\\nselect '${day_id}',a.* from gbaseods.ODS_D_A_BBC_BI_D2D_BUSI_ERR_${dayid} a;\\n\\ninsert into sa_d_dm_bbc_bi_d2d_busi_err_dt_${dayid}\\nselect \\na.op_time,\\na.ticket_id,\\nerr_id,\\nitem,\\npoint,\\nremark\\nfrom sa_d_dm_bbc_bi_d2d_busi_err_dm a\\ninner join (select ticket_id,max(op_time)op_time\\n            from sa_d_dm_bbc_bi_d2d_busi_err_dm \\n\\t\\t\\tgroup by ticket_id)b on a.ticket_id=b.ticket_id and a.op_time=b.op_time\\ninner join SA_D_DM_BBC_BI_D2D_BUSI_dt_${dayid} c on a.ticket_id=c.audit_id and c.audit_status<>'稽核通过'\\n;\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [154]-[index:248]-[电子稽核系统视图-票据稽核单数据同步]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"3.数据同步","nodeId":"3","sql":"drop table if  exists dm.DM_PUB_D2D_RECEIPT_TICKET_dd;\\ncreate table dm.DM_PUB_D2D_RECEIPT_TICKET_dd distributed by ('audit_id')\\nselect * from DM_PUB_D2D_RECEIPT_TICKET_dd@dblink_dm;\\n\\n\\n\\n###########以下表仅用与前台数据日期的更新\\ndrop table if exists DM_PUB_D2D_RECEIPT_TICKET_${dayid};\\ncreate table DM_PUB_D2D_RECEIPT_TICKET_${dayid} like DM_PUB_D2D_RECEIPT_TICKET_${pdayid};\\n\\ndrop table DM_PUB_D2D_RECEIPT_TICKET_${pdayid};\\n\\ndelete from dim_d2d_ORGANIZED_NAME;\\ninsert into dim_d2d_ORGANIZED_NAME\\nselect distinct organized_name\\nfrom (\\nselect distinct organized_name from DM_BBC_BI_D2D_BUSI_DD\\nunion all\\nselect distinct organized_name from dm_pub_d2d_receipt_ticket_dd\\n)a"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [155]-[index:251]-[自助分析平台日指标视图]-[21]-['str' object has no attribute 'lfind']:{"name":"21.临时表1的创建","nodeId":"21","dsName":"GbaseDM","sql":"drop table  TMP1_DM_PUB_NEW_ACCT;\\ncreate table  TMP1_DM_PUB_NEW_ACCT(\\n                    OP_TIME              date \\n                   ,STATIS_DATE          varchar(10)\\n                   ,PRODUCT_NO           varchar(20)\\n                   ,D_AC_001             decimal(12,2)\\n                   ,D_AC_002             decimal(12,2)\\n                   ,D_AC_003             decimal(12,2)\\n                   ,D_AC_004             decimal(12,2)\\n                   ,D_AC_005             decimal(12,2)\\n                   ,D_AC_006             decimal(12,2)\\n                   ,D_AC_007             decimal(12,2)\\n                   ,D_AC_008             decimal(12,2)\\n                   ,D_AC_009             decimal(12,2)\\n                   ,D_AC_010             decimal(12,2)\\n                   ,D_AC_011             decimal(12,2)\\n                   ,D_AC_012             decimal(12,2)\\n                   ,D_AC_013             decimal(12,2)\\n                   ,D_AC_014             decimal(12,2)\\n                   ,D_AC_015             decimal(12,2)\\n                   ,D_AC_016             decimal(12,2)\\n                   ,D_AC_017             decimal(12,2)\\n                   ,D_AC_018             decimal(12,2)\\n                   ,D_AC_019             decimal(12,2)\\n                   ,D_AC_020             decimal(12,2)\\n                   ,D_AC_021             decimal(12,2)\\n                   ,D_AC_022             decimal(12,2)  \\n                   ,D_AC_023             decimal(12,2)\\n                   ,D_AC_024             decimal(12,2)\\n                   ,D_AC_025             decimal(12,2)\\n                   ,D_AC_026             decimal(12,2)\\n                   ,D_AC_027             decimal(12,2)\\n                   ,D_AC_028             decimal(12,2)\\n                   ,D_AC_029             decimal(12,2)\\n                   ,D_AC_030             decimal(12,2)\\n                   ,D_AC_031             decimal(12,2)\\n                   ,D_AC_032             decimal(12,2)\\n                   ,D_AC_033             decimal(12,2)\\n                   ,D_AC_034             INTEGER\\n                   ,D_AC_035             INTEGER\\n                   ,D_AC_036             INTEGER\\n                   ,D_AC_037             INTEGER\\n                   ,D_AC_038             INTEGER\\n                   ,D_AC_039             INTEGER\\n                   ,D_AC_040             INTEGER\\n                   ,D_AC_041             INTEGER\\n                   ,D_AC_042             INTEGER\\n                   ,D_AC_043             INTEGER\\n                   ,D_AC_044             INTEGER\\n                   ,D_AC_045             INTEGER\\n                   ,D_AC_046             INTEGER\\n                   ,D_AC_047             INTEGER\\n                   ,D_AC_048             INTEGER\\n                   ,D_AC_049             INTEGER\\n                   ,D_AC_050             INTEGER )distributed by ('PRODUCT_NO')\\n                                         ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [156]-[index:252]-[自助分析平台日指标视图]-[20]-['str' object has no attribute 'lfind']:{"name":"20.临时表的插入","nodeId":"20","dsName":"GbaseDM","sql":"insert into TMP_DM_PUB_NEW_ACCT\\n\\t(\\n\\t\\tOP_TIME            ,\\n\\t\\tSTATIS_DATE        ,\\n\\t\\tPRODUCT_NO         ,\\n\\t\\tD_AC_001            ,\\n\\t\\tD_AC_002            ,\\n\\t\\tD_AC_003            ,\\n\\t\\tD_AC_004            ,\\n\\t\\tD_AC_005            ,\\n\\t\\tD_AC_006            ,\\n\\t\\tD_AC_007            ,\\n\\t\\tD_AC_008            ,\\n\\t\\tD_AC_009            ,\\n\\t\\tD_AC_010            ,\\n\\t\\tD_AC_011            ,\\n\\t\\tD_AC_012            ,\\n\\t\\tD_AC_013            ,\\n\\t\\tD_AC_014            ,\\n\\t\\tD_AC_015            ,\\n\\t\\tD_AC_016            ,\\n\\t\\tD_AC_017            ,\\n\\t\\tD_AC_018                 \\n\\t)\\n\\t\\n\\tselect to_date('${dayid}','YYYYMMDD') as op_time,        \\n         ${dayid}  as STAT_DATE, \\n         PHONE_NO ,  \\n          Sum(a.SHOULD_INCOME),\\n\\t\\tSum(Case When b.TYPE_NAME = '本地通话费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '漫游通话费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '普通国内长途费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '普通港澳台长途费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '普通国际长途费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = 'IP国内长途费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = 'IP港澳台长途费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = 'IP国际长途费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '话音增值业务收入' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '短信数据业务收入' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '非短信数据业务收入' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = 'CMNET业务收入' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '其他数据业务收入' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '月租费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '套餐月租费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME = '信息费' Then a.SHOULD_INCOME Else 0 End),\\n\\t\\tSum(Case When b.TYPE_NAME is Null Then a.SHOULD_INCOME Else 0 End)\\n\\tFrom gbasedwi.DWI_INCO_BILL_ITEM_TOT_DS_${dayid} a \\n\\tLeft Outer Join gbasedwd.DIM_RPT_GENERAL_SHEET1 b On a.ACCT_ITEM_ID = b.Charge_Code\\n\\tGroup By phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [157]-[index:254]-[自助分析平台日指标视图]-[30]-['str' object has no attribute 'lfind']:{"name":"30.临时表2的插入","nodeId":"30","dsName":"GbaseDM","sql":"insert into TMP2_DM_PUB_NEW_CALL   \\n(OP_TIME                      \\n        ,STATIS_DATE          \\n        ,PRODUCT_NO           \\n        ,D_V_001              \\n        ,D_V_002              \\n        ,D_V_003              \\n        ,D_V_004              \\n        ,D_V_005              \\n        ,D_V_006              \\n        ,D_V_007              \\n        ,D_V_008              \\n        ,D_V_009              \\n        ,D_V_010              \\n        ,D_V_011              \\n        ,D_V_012              \\n        ,D_V_013              \\n        ,D_V_014              \\n        ,D_V_015              \\n        ,D_V_016              \\n        ,D_V_017              \\n        ,D_V_018              \\n        ,D_V_019              \\n        ,D_V_020              \\n        ,D_V_021              \\n        ,D_V_022              \\n        ,D_V_023              \\n        ,D_V_024              \\n        ,D_V_025              \\n        ,D_V_026              \\n        ,D_V_027              \\n        ,D_V_028              \\n        ,D_V_029              \\n        ,D_V_030              \\n        ,D_V_031              \\n        ,D_V_032              \\n        ,D_V_033              \\n        ,D_V_034              \\n        ,D_V_035              \\n        ,D_V_036              \\n        ,D_V_037              \\n        ,D_V_038              \\n        ,D_V_039              \\n        ,D_V_040              \\n        ,D_V_041              \\n        ,D_V_042              \\n        ,D_V_043              \\n\\t    ,D_V_044                \\n\\t\\t,D_V_045                  \\n\\t\\t,D_V_046                  \\n\\t    ,D_V_047                \\n\\t    ,D_V_048                \\n\\t    ,D_V_049                \\n\\t    ,D_V_050       )        \\n \\n                      \\nselect a.STAT_DATE\\n       ,'${day_id}'\\n\\t   ,a.PHONE_NO\\n\\t   ,nvl(b.CALL_DUR         ,0)     as D_V_001 \\n       ,nvl(b.CALING_CALL_DUR  ,0)     as D_V_002 \\n       ,nvl(b.CALLED_DUR       ,0)     as D_V_003 \\n       ,nvl(c.LOC_CALL_DUR            ,0)     as  D_V_004       \\n       ,nvl(c.LOC_CALING_DUR          ,0)     as  D_V_005\\n       ,nvl(c.LOC_CALLED_BILL_DUR     ,0)     as  D_V_006\\n       ,nvl(c.LROAM_BILL_DUR          ,0)     as  D_V_007\\n       ,nvl(c.LROAM_OUT_BILL_DUR      ,0)     as  D_V_008\\n       ,nvl(c.LROAM_IN_BILL_DUR       ,0)     as  D_V_009\\n       ,nvl(c.HMT_ROAM_BILL_DUR       ,0)     as  D_V_010\\n       ,nvl(c.HMT_ROAM_OUT_BILL_DUR   ,0)     as  D_V_011\\n       ,nvl(c.HMT_ROAM_IN_BILL_DUR    ,0)     as  D_V_012\\n       ,nvl(c.INTER_ROAM_BILL_DUR     ,0)     as  D_V_013\\n       ,nvl(c.INTER_ROAM_OUT_BILL_DUR ,0)     as  D_V_014\\n       ,nvl(c.INTER_ROAM_IN_BILL_DUR  ,0)     as  D_V_015\\n       ,nvl(c.LOC_NO_TOLL_CALL_DUR    ,0)     as  D_V_016\\n       ,nvl(d.LAND_TOLL_CALL_DUR      ,0)     as  D_V_017\\n       ,nvl(d.HMT_TOLL_CALL_DUR       ,0)     as  D_V_018\\n       ,nvl(d.INTER_TOLL_CALL_DUR     ,0)     as  D_V_019\\n       ,nvl(b.T_CALL_DUR  ,0)    as  D_V_020           \\n       ,nvl(b.G_CALL_DUR  ,0)    as  D_V_021    \\n       ,nvl(b.CALL_NUM    ,0)    as  D_V_022    \\n       ,nvl(b.CALING_NUM  ,0)    as  D_V_023    \\n       ,nvl(b.CALLED_NUM  ,0)    as  D_V_024    \\n       ,nvl(c.LOC_CALL_NUM       ,0)    as   D_V_025          \\n       ,nvl(c.LOC_CALING_NUM     ,0)    as   D_V_026   \\n       ,nvl(c.LOC_CALLED_NUM     ,0)    as   D_V_027   \\n       ,nvl(c.LROAM_NUM          ,0)    as   D_V_028   \\n       ,nvl(c.LROAM_OUT_NUM      ,0)    as   D_V_029   \\n       ,nvl(c.LROAM_IN_NUM       ,0)    as   D_V_030   \\n       ,nvl(c.HMT_ROAM_NUM       ,0)    as   D_V_031   \\n       ,nvl(c.HMT_ROAM_OUT_NUM   ,0)    as   D_V_032   \\n       ,nvl(c.HMT_ROAM_IN_NUM    ,0)    as   D_V_033   \\n       ,nvl(c.INTER_ROAM_NUM     ,0)    as   D_V_034   \\n       ,nvl(c.INTER_ROAM_OUT_NUM ,0)    as   D_V_035   \\n       ,nvl(c.INTER_ROAM_IN_NUM  ,0)    as   D_V_036   \\n       ,nvl(c.LOC_NO_TOLL_NUM    ,0)    as   D_V_037   \\n       ,nvl(d.LAND_TOLL_CALL_NUM  ,0)  as  D_V_038\\n       ,nvl(d.HMT_TOLL_CALL_NUM   ,0)  as  D_V_039\\n       ,nvl(d.INTER_TOLL_CALL_NUM ,0)  as  D_V_040\\n       ,nvl(b.T_CALL_NUM         ,0)  as D_V_041\\n       ,nvl(b.G_CALL_NUM         ,0)  as D_V_042\\n       ,nvl(E.CALL_DAYS          ,0)   as D_V_043\\n\\t   ,NULL             as      D_V_044 \\n       ,NULL             as      D_V_045 \\n       ,NULL             as      D_V_046 \\n       ,NULL             as      D_V_047 \\n       ,NULL             as      D_V_048 \\n       ,NULL             as      D_V_049 \\n       ,NULL             as      D_V_050 \\n from gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a  \\n left join gbasedwi.DWI_BEH_USE_VOC_USERTOT_DS_${dayid}   b  \\n      on a.PHONE_NO = b.PHONE_NO and a.user_id=b.user_id\\n left join gbasedwi.DWI_BEH_USE_VOC_ROAMTOT_DS_${dayid} c     \\n      on a.PHONE_NO = c.PHONE_NO and a.user_id=c.user_id\\nleft join gbasedwi.DWI_BEH_USE_VOC_TOLLTOT_DS_${dayid} d   \\n       on a.PHONE_NO = d.PHONE_NO and a.user_id=d.user_id\\n left join gbasedwi.DWI_BEH_USE_VOC_USERCALLTIME_DS_${dayid} e    \\n       on a.PHONE_NO = e.PHONE_NO and a.user_id=e.user_id\\n\\twhere PROD_KIND_CODE = 171000000001 And (MONTH_ARRIVE_FLAG = 1 Or MONTH_OFF_FLAG = 1 Or MONTH_NEW_FLAG = 1)\\t\\n \\n \\n \\n ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [158]-[index:256]-[自助分析平台日指标视图]-[35]-['str' object has no attribute 'lfind']:{"name":"35.临时表3的创建","nodeId":"35","dsName":"GbaseDM","sql":"drop table TMP3_DM_PUB_NEW_NEWBUSI;\\ncreate table TMP3_DM_PUB_NEW_NEWBUSI\\n( OP_TIME          DATE\\n  ,STATIS_DATE      VARCHAR(10)\\n  ,PRODUCT_NO       VARCHAR(20)\\n  ,D_N_001          BIGINT\\n  ,D_N_002          BIGINT\\n  ,D_N_003          BIGINT\\n  ,D_N_004          BIGINT\\n  ,D_N_005          BIGINT\\n  ,D_N_006          BIGINT\\n  ,D_N_007          BIGINT\\n  ,D_N_008          BIGINT\\n  ,D_N_009          BIGINT\\n  ,D_N_010          BIGINT\\n  ,D_N_011          BIGINT\\n  ,D_N_012          BIGINT\\n  ,D_N_013          BIGINT\\n  ,D_N_014          BIGINT\\n  ,D_N_015          BIGINT\\n  ,D_N_016          BIGINT\\n  ,D_N_017          BIGINT\\n  ,D_N_018          BIGINT\\n  ,D_N_019          BIGINT\\n  ,D_N_020          BIGINT\\n  ,D_N_021          BIGINT\\n  ,D_N_022          BIGINT\\n  ,D_N_023          BIGINT\\n  ,D_N_024          BIGINT\\n  ,D_N_025          BIGINT\\n  ,D_N_026          BIGINT\\n  ,D_N_027          BIGINT\\n  ,D_N_028          BIGINT\\n  ,D_N_029          BIGINT\\n  ,D_N_030          BIGINT\\n  ,D_N_031          BIGINT\\n  ,D_N_032          BIGINT\\n  ,D_N_033          BIGINT\\n  ,D_N_034          BIGINT\\n  ,D_N_035          BIGINT\\n  ,D_N_036          BIGINT\\n  ,D_N_037          BIGINT\\n  ,D_N_038          BIGINT\\n  ,D_N_039          BIGINT\\n  ,D_N_040          BIGINT\\n  ,D_N_041          BIGINT\\n  ,D_N_042          BIGINT\\n  ,D_N_043          BIGINT\\n  ,D_N_044          BIGINT\\n  ,D_N_045          BIGINT\\n  ,D_N_046          BIGINT\\n  ,D_N_047          BIGINT\\n  ,D_N_048          BIGINT\\n  ,D_N_049          BIGINT\\n  ,D_N_050          BIGINT\\n  ,GPRS_TOTAL_FLOW  BIGINT -- 当日GPRS使用次数\\n  ,GPRS_TOTAL_NUM   BIGINT -- 当日GPRS使用时长（分钟）\\n  )distributed by('PRODUCT_NO');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [159]-[index:259]-[自助分析平台日指标视图]-[22]-['str' object has no attribute 'lfind']:{"name":"22.临时表1的插入","nodeId":"22","dsName":"GbaseDM","sql":" insert into TMP1_DM_PUB_NEW_ACCT(\\n                    OP_TIME\\n                   ,STATIS_DATE\\n                   ,PRODUCT_NO\\n                   ,D_AC_001\\n                   ,D_AC_002\\n                   ,D_AC_003\\n                   ,D_AC_004\\n                   ,D_AC_005\\n                   ,D_AC_006\\n                   ,D_AC_007\\n                   ,D_AC_008\\n                   ,D_AC_009\\n                   ,D_AC_010\\n                   ,D_AC_011\\n                   ,D_AC_012\\n                   ,D_AC_013\\n                   ,D_AC_014\\n                   ,D_AC_015\\n                   ,D_AC_016\\n                   ,D_AC_017\\n                   ,D_AC_018\\n                   ,D_AC_019\\n                   ,D_AC_020\\n                   ,D_AC_021\\n                   ,D_AC_022\\n                   ,D_AC_023\\n                   ,D_AC_024\\n                   ,D_AC_025\\n                   ,D_AC_026\\n                   ,D_AC_027\\n                   ,D_AC_028\\n                   ,D_AC_029\\n                   ,D_AC_030\\n                   ,D_AC_031\\n                   ,D_AC_032\\n                   ,D_AC_033\\n                   ,D_AC_034\\n                   ,D_AC_035\\n                   ,D_AC_036\\n                   ,D_AC_037\\n                   ,D_AC_038\\n                   ,D_AC_039\\n                   ,D_AC_040\\n                   ,D_AC_041\\n                   ,D_AC_042\\n                   ,D_AC_043\\n                   ,D_AC_044\\n                   ,D_AC_045\\n                   ,D_AC_046\\n                   ,D_AC_047\\n                   ,D_AC_048\\n                   ,D_AC_049\\n                   ,D_AC_050 )\\nselect  \\n    a.STAT_DATE,                                                                            \\n    ${dayid} as STAT_DATE,                                              \\n    a.PHONE_NO ,                                                        \\n    nvl(cast(b.D_AC_001 as decimal(12,2)),0) as D_AC_001     ,  \\n    nvl(b.D_AC_002,0)  as D_AC_002      ,                     \\n    nvl(b.D_AC_003,0)  as D_AC_003      ,                     \\n    nvl(b.D_AC_004,0)  as D_AC_004      ,                     \\n    nvl(b.D_AC_005,0)  as D_AC_005      ,                     \\n    nvl(b.D_AC_006,0)  as D_AC_006      ,                     \\n    nvl(b.D_AC_007,0)  as D_AC_007      ,                     \\n    nvl(b.D_AC_008,0)  as D_AC_008      ,                     \\n    nvl(b.D_AC_009,0)  as D_AC_009      ,                     \\n    nvl(b.D_AC_010,0)  as D_AC_010      ,                     \\n    nvl(b.D_AC_011,0)  as D_AC_011      ,                     \\n    nvl(b.D_AC_012,0)  as D_AC_012      ,                     \\n    nvl(b.D_AC_013,0)  as D_AC_013      ,                     \\n    nvl(b.D_AC_014,0)  as D_AC_014      ,                     \\n    nvl(b.D_AC_015,0)  as D_AC_015      ,                     \\n    nvl(b.D_AC_016,0)  as D_AC_016      ,                     \\n    nvl(b.D_AC_017,0)  as D_AC_017      ,                     \\n    nvl(b.D_AC_018,0)  as D_AC_018      ,                     \\n        nvl(t2.TOTAL_RCHRG_FUND       ,0)     as  D_AC_019                      ,         \\n        nvl(SELF_RCHRG_FUND        ,0)     as  D_AC_020               ,         \\n        nvl(SYS_RCHRG_FUND         ,0)     as  D_AC_021               ,         \\n        nvl(PAY_CARD_RCHRG_AMT     ,0)     as  D_AC_022               ,         \\n        nvl(BANK_REPLE_CHARGE      ,0)     as  D_AC_023               ,         \\n        nvl(BANK_INSTD_AMT         ,0)     as  D_AC_024               ,         \\n        nvl(HALL_PAY_AMT           ,0)     as  D_AC_025               ,         \\n        nvl(AIR_RCHRG_AMT          ,0)     as  D_AC_026               ,         \\n        nvl(OWG_GATW_RCHRG         ,0)     as  D_AC_027               ,         \\n        nvl(NET_RCHRG_PAY_AMT      ,0)     as  D_AC_028               ,         \\n        nvl(SSTM_PAY_AMT           ,0)     as  D_AC_029               ,         \\n        nvl(CBOSS_PAY              ,0)     as  D_AC_030               ,         \\n        nvl(MOBPAY_PAY_AMT         ,0)     as  D_AC_031               ,         \\n        nvl(SMALL_AMT_RCHRG        ,0)     as  D_AC_032               ,         \\n        nvl(ACTV_PRISE_RCHRG       ,0)     as  D_AC_033               ,         \\n        nvl(t2.TOTAL_RCHRG_NUM        ,0)     as  D_AC_034               ,         \\n        nvl(SELF_RCHRG_NUM         ,0)     as  D_AC_035               ,         \\n        nvl(SYS_RCHRG_NUM          ,0)     as  D_AC_036               ,         \\n        nvl(PAY_CARD_RCHRG_NUM     ,0)     as  D_AC_037               ,         \\n        nvl(AIR_RCHRG_NUM          ,0)     as  D_AC_038               ,         \\n        nvl(HALL_PAY_NUM           ,0)     as  D_AC_039               ,         \\n        nvl(NET_RCHRG_PAY_NUM      ,0)     as  D_AC_040               ,         \\n        nvl(SSTM_PAY_NUM           ,0)     as  D_AC_041               ,         \\n        null                            D_AC_042                      ,         \\n        null                            D_AC_043                      ,         \\n        null                            D_AC_044                      ,         \\n        null                            D_AC_045                      ,         \\n        null                            D_AC_046                      ,         \\n        null                            D_AC_047                      ,         \\n        null                            D_AC_048                      ,         \\n        null                            D_AC_049                      ,         \\n        null                            D_AC_050                                \\n from gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a     \\n  left join (select phone_no,count(distinct pay_recd_id)TOTAL_RCHRG_NUM,sum(pay_amt)*0.01 as TOTAL_RCHRG_FUND\\n            from gbasedwd.dwd_acc_rchrg_flag_new_ds_${dayid} where stat_date='${day_id}' \\n\\t\\t\\tgroup by phone_no) t2 on a.PHONE_NO=t2.PHONE_NO\\n left join TMP_DM_PUB_NEW_ACCT b\\n        on a.PHONE_NO = b.PRODUCT_NO\\n left join ( select PHONE_NO          ,\\n                    sum(TOTAL_RCHRG_FUND    )  as  TOTAL_RCHRG_FUND    ,\\n                    sum(SELF_RCHRG_FUND     )  as  SELF_RCHRG_FUND     ,\\n                    sum(SYS_RCHRG_FUND      )  as  SYS_RCHRG_FUND      ,\\n                    sum(PAY_CARD_RCHRG_AMT  )  as  PAY_CARD_RCHRG_AMT  ,\\n                    sum(BANK_REPLE_CHARGE   )  as  BANK_REPLE_CHARGE   ,\\n                    sum(BANK_INSTD_AMT      )  as  BANK_INSTD_AMT      ,\\n                    sum(HALL_PAY_AMT        )  as  HALL_PAY_AMT        ,\\n                    sum(AIR_RCHRG_AMT       )  as  AIR_RCHRG_AMT       ,\\n                    sum(OWG_GATW_RCHRG      )  as  OWG_GATW_RCHRG      ,\\n                    sum(NET_RCHRG_PAY_AMT   )  as  NET_RCHRG_PAY_AMT   ,\\n                    sum(SSTM_PAY_AMT        )  as  SSTM_PAY_AMT        ,\\n                    sum(CBOSS_PAY           )  as  CBOSS_PAY           ,\\n                    sum(MOBPAY_PAY_AMT      )  as  MOBPAY_PAY_AMT      ,\\n                    sum(SMALL_AMT_RCHRG     )  as  SMALL_AMT_RCHRG     ,\\n                    sum(ACTV_PRISE_RCHRG    )  as  ACTV_PRISE_RCHRG    ,\\n                    sum(TOTAL_RCHRG_NUM     )  as  TOTAL_RCHRG_NUM     ,\\n                    sum(SELF_RCHRG_NUM      )  as  SELF_RCHRG_NUM      ,\\n                    sum(SYS_RCHRG_NUM       )  as  SYS_RCHRG_NUM       ,\\n                    sum(PAY_CARD_RCHRG_NUM  )  as  PAY_CARD_RCHRG_NUM  ,\\n                    sum(AIR_RCHRG_NUM       )  as  AIR_RCHRG_NUM       ,\\n                    sum(HALL_PAY_NUM        )  as  HALL_PAY_NUM        ,\\n                    sum(NET_RCHRG_PAY_NUM   )  as  NET_RCHRG_PAY_NUM   ,\\n                    sum(SSTM_PAY_NUM        )  as  SSTM_PAY_NUM      \\n          from   gbasedwi.DWI_INCO_USERPAY_INDI_DT_${monthid}     \\n\\t\\t  where STAT_DATE='${day_id} '\\n          group by phone_no ) c\\n        on a.PHONE_NO = c.PHONE_NO\\nWhere PROD_KIND_CODE = 171000000001 And (MONTH_ARRIVE_FLAG = 1 Or MONTH_OFF_FLAG = 1 Or MONTH_NEW_FLAG = 1)\\t","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [160]-[index:260]-[自助分析平台日指标视图]-[40]-['str' object has no attribute 'lfind']:{"name":"40.目标表数据的插入","nodeId":"40","dsName":"GbaseDM","sql":"INSERT INTO ${DM_AUTORPT_DAY_VIEW_YYYYMMDD}\\n(\\tOP_TIME,\\n\\tPRODUCT_NO,\\n\\tACCT_ID,\\n\\tACTIVE_DATE,\\n\\tADDRESS_ID,\\n\\tAGE,\\n\\tBA_SVC_NO,\\n\\tBAL_ORG_ID,\\n\\tBALANCE_AMOUNT,\\n\\tBILL_TYPE,\\n\\tBIND_MARK,\\n\\tBINDEND_DATE,\\n\\tBINDSTART_DATE,\\n\\tBRAND_ID,\\n\\tCHANNEL_ID,\\n\\tCHANNELTYPE_ID,\\n\\tCITY_ID,\\n\\tCONT_ID,\\n\\tCOUNTY_ID,\\n\\tCREATE_DATE,\\n\\tCREATE_ORGID,\\n\\tCREATOR_NO,\\n\\tCREDIT_AMOUNT,\\n\\tCREDIT_LEVEL,\\n\\tCS_ZGD_MARK,\\n\\tCUST_ADDRESS,\\n\\tCUST_CLASS_ID,\\n\\tCUST_ID,\\n\\tCUST_NAME,\\n\\tCUST_SVC_NO,\\n\\tCUSTSTATUS_ID,\\n\\tCUSTTYPE_ID,\\n\\tD_AC_001,\\n\\tD_AC_002,\\n\\tD_AC_003,\\n\\tD_AC_004,\\n\\tD_AC_005,\\n\\tD_AC_006,\\n\\tD_AC_007,\\n\\tD_AC_008,\\n\\tD_AC_009,\\n\\tD_AC_010,\\n\\tD_AC_011,\\n\\tD_AC_012,\\n\\tD_AC_013,\\n\\tD_AC_014,\\n\\tD_AC_015,\\n\\tD_AC_016,\\n\\tD_AC_017,\\n\\tD_AC_018,\\n\\tD_AC_019,\\n\\tD_AC_020,\\n\\tD_AC_021,\\n\\tD_AC_022,\\n\\tD_AC_023,\\n\\tD_AC_024,\\n\\tD_AC_025,\\n\\tD_AC_026,\\n\\tD_AC_027,\\n\\tD_AC_028,\\n\\tD_AC_029,\\n\\tD_AC_030,\\n\\tD_AC_031,\\n\\tD_AC_032,\\n\\tD_AC_033,\\n\\tD_AC_034,\\n\\tD_AC_035,\\n\\tD_AC_036,\\n\\tD_AC_037,\\n\\tD_AC_038,\\n\\tD_AC_039,\\n\\tD_AC_040,\\n\\tD_AC_041,\\n\\tD_AC_042,\\n\\tD_AC_043,\\n\\tD_AC_044,\\n\\tD_AC_045,\\n\\tD_AC_046,\\n\\tD_AC_047,\\n\\tD_AC_048,\\n\\tD_AC_049,\\n\\tD_AC_050,\\n\\tD_N_001,\\n\\tD_N_002,\\n\\tD_N_003,\\n\\tD_N_004,\\n\\tD_N_005,\\n\\tD_N_006,\\n\\tD_N_007,\\n\\tD_N_008,\\n\\tD_N_009,\\n\\tD_N_010,\\n\\tD_N_011,\\n\\tD_N_012,\\n\\tD_N_013,\\n\\tD_N_014,\\n\\tD_N_015,\\n\\tD_N_016,\\n\\tD_N_017,\\n\\tD_N_018,\\n\\tD_N_019,\\n\\tD_N_020,\\n\\tD_N_021,\\n\\tD_N_022,\\n\\tD_N_023,\\n\\tD_N_024,\\n\\tD_N_025,\\n\\tD_N_026,\\n\\tD_N_027,\\n\\tD_N_028,\\n\\tD_N_029,\\n\\tD_N_030,\\n\\tD_N_031,\\n\\tD_N_032,\\n\\tD_N_033,\\n\\tD_N_034,\\n\\tD_N_035,\\n\\tD_N_036,\\n\\tD_N_037,\\n\\tD_N_038,\\n\\tD_N_039,\\n\\tD_N_040,\\n\\tD_N_041,\\n\\tD_N_042,\\n\\tD_N_043,\\n\\tD_N_044,\\n\\tD_N_045,\\n\\tD_N_046,\\n\\tD_N_047,\\n\\tD_N_048,\\n\\tD_N_049,\\n\\tD_N_050,\\n\\tD_V_001,\\n\\tD_V_002,\\n\\tD_V_003,\\n\\tD_V_004,\\n\\tD_V_005,\\n\\tD_V_006,\\n\\tD_V_007,\\n\\tD_V_008,\\n\\tD_V_009,\\n\\tD_V_010,\\n\\tD_V_011,\\n\\tD_V_012,\\n\\tD_V_013,\\n\\tD_V_014,\\n\\tD_V_015,\\n\\tD_V_016,\\n\\tD_V_017,\\n\\tD_V_018,\\n\\tD_V_019,\\n\\tD_V_020,\\n\\tD_V_021,\\n\\tD_V_022,\\n\\tD_V_023,\\n\\tD_V_024,\\n\\tD_V_025,\\n\\tD_V_026,\\n\\tD_V_027,\\n\\tD_V_028,\\n\\tD_V_029,\\n\\tD_V_030,\\n\\tD_V_031,\\n\\tD_V_032,\\n\\tD_V_033,\\n\\tD_V_034,\\n\\tD_V_035,\\n\\tD_V_036,\\n\\tD_V_037,\\n\\tD_V_038,\\n\\tD_V_039,\\n\\tD_V_040,\\n\\tD_V_041,\\n\\tD_V_042,\\n\\tD_V_043,\\n\\tD_V_044,\\n\\tD_V_045,\\n\\tD_V_046,\\n\\tD_V_047,\\n\\tD_V_048,\\n\\tD_V_049,\\n\\tD_V_050,\\n\\tDAY_NEW_MARK,\\n\\tDAY_OFF_MARK,\\n\\tDEAL_OPERATOR,\\n\\tDEPT_ID,\\n\\tDONE_CODE,\\n\\tDONE_DATE,\\n\\tEDUCATION_ID,\\n\\tENTERPRISE_ID,\\n\\tENTERPRISE_MARK,\\n\\tENTERPRISE_SCALE_ID,\\n\\tEXCHANGE_ID,\\n\\tEXPIRE_SCORE,\\n\\tF_CHANNEL_ID,\\n\\tF_DEPT_ID,\\n\\tFIRST_CHARGETIME,\\n\\tFIRST_UNVALID_CALLTIME,\\n\\tFIRST_VALID_CALLTIME,\\n\\tIDEN_ID,\\n\\tIDEN_NO,\\n\\tIMEI,\\n\\tIMSI_NO,\\n\\tINDUSTRY_ID,\\n\\tINNET_TIME,\\n\\tIS_CHANGE_USIM,\\n\\tIS_HANDLE_4G,\\n\\tIS_MIFI_4G,\\n\\tIS_OUT_NET,\\n\\tIS_SCROE_SIX,\\n\\tIS_SCROE_THREE,\\n\\tIS_TERMINAL_4G,\\n\\tIS_TEST_4G,\\n\\tIS_YIJING_ZEROCALL,\\n\\tIS_YIJINGPHONE_USER,\\n\\tLAST_TRANS_DATE,\\n\\tLAST_USERSTATUS_ID,\\n\\tLASTSUB_USERSTATUS_ID,\\n\\tMONTH_ARRIVE_MARK,\\n\\tMONTH_NEW_MARK,\\n\\tMONTH_OFF_MARK,\\n\\tOCCUPATION_ID,\\n\\tOFF_REASON_ID,\\n\\tPASS_GRADE,\\n\\tPAYBILL_FLAG,\\n\\tPLAN_ID,\\n\\tPOST_BILL_FLAG,\\n\\tPOST_CODE,\\n\\tPRE_DESTORY_TIME,\\n\\tPROD_CATALOG_ID,\\n\\tREPAY_SCORE,\\n\\tRISK_FLAG,\\n\\tROAM_TYPE,\\n\\tSEX_ID,\\n\\tSIM_NO,\\n\\tSTOP_CALL_FLAG,\\n\\tSTOP_LEVEL,\\n\\tSUB_BILL_ID,\\n\\tSUB_BRAND_ID,\\n\\tSUB_BRAND_ID1,\\n\\tSUB_USERSTATUS_ID,\\n\\tTD_MARK,\\n\\tTERMINAL_4G,\\n\\tUSER_GRADE,\\n\\tUSER_ID,\\n\\tUSER_INNET_ID,\\n\\tUSER_NAME,\\n\\tUSER_OFFTIME,\\n\\tUSER_OPEN_ID,\\n\\tUSER_OPENTIME,\\n\\tUSERSTATUS_ID,\\n\\tUSERTYPE_ID,\\n\\tVALID_NEW_MARK,\\n\\tVIP_MARK,\\n\\tVIP_SCALE_ID,\\n\\tVIP_SCALE_ID1,\\n\\tVPMN_MARK,\\n\\tWATCH_FLAG,\\n\\tZEROCALL_CUR_FLAG,\\n\\tZEROCALL_H_FLAG\\t\\t)\\nSELECT \\tA.OP_TIME,\\n\\t\\tA.PRODUCT_NO,\\n\\t\\tA.ACCT_ID,\\n\\t\\tA.ACTIVE_DATE,\\n\\t\\tA.ADDRESS_ID,\\n\\t\\tA.AGE,\\n\\t\\tA.BA_SVC_NO,\\n\\t\\tA.BAL_ORG_ID,\\n\\t\\tA.BALANCE_AMOUNT,\\n\\t\\tA.BILL_TYPE,\\n\\t\\tA.BIND_MARK,\\n\\t\\tA.BINDEND_DATE,\\n\\t\\tA.BINDSTART_DATE,\\n\\t\\tA.BRAND_ID,\\n\\t\\tA.CHANNEL_ID,\\n\\t\\tA.CHANNELTYPE_ID,\\n\\t\\tA.CITY_ID,\\n\\t\\tA.CONT_ID,\\n\\t\\tA.COUNTY_ID,\\n\\t\\tA.CREATE_DATE,\\n\\t\\tA.CREATE_ORGID,\\n\\t\\tA.CREATOR_NO,\\n\\t\\tA.CREDIT_AMOUNT,\\n\\t\\tA.CREDIT_LEVEL,\\n\\t\\tA.CS_ZGD_MARK,\\n\\t\\tA.CUST_ADDRESS,\\n\\t\\tA.CUST_CLASS_ID,\\n\\t\\tA.CUST_ID,\\n\\t\\tA.CUST_NAME,\\n\\t\\tA.CUST_SVC_NO,\\n\\t\\tA.CUSTSTATUS_ID,\\n\\t\\tA.CUSTTYPE_ID,\\n\\t\\tB.D_AC_001,\\n\\t\\tB.D_AC_002,\\n\\t\\tB.D_AC_003,\\n\\t\\tB.D_AC_004,\\n\\t\\tB.D_AC_005,\\n\\t\\tB.D_AC_006,\\n\\t\\tB.D_AC_007,\\n\\t\\tB.D_AC_008,\\n\\t\\tB.D_AC_009,\\n\\t\\tB.D_AC_010,\\n\\t\\tB.D_AC_011,\\n\\t\\tB.D_AC_012,\\n\\t\\tB.D_AC_013,\\n\\t\\tB.D_AC_014,\\n\\t\\tB.D_AC_015,\\n\\t\\tB.D_AC_016,\\n\\t\\tB.D_AC_017,\\n\\t\\tB.D_AC_018,\\n\\t\\tB.D_AC_019,\\n\\t\\tB.D_AC_020,\\n\\t\\tB.D_AC_021,\\n\\t\\tB.D_AC_022,\\n\\t\\tB.D_AC_023,\\n\\t\\tB.D_AC_024,\\n\\t\\tB.D_AC_025,\\n\\t\\tB.D_AC_026,\\n\\t\\tB.D_AC_027,\\n\\t\\tB.D_AC_028,\\n\\t\\tB.D_AC_029,\\n\\t\\tB.D_AC_030,\\n\\t\\tB.D_AC_031,\\n\\t\\tB.D_AC_032,\\n\\t\\tB.D_AC_033,\\n\\t\\tB.D_AC_034,\\n\\t\\tB.D_AC_035,\\n\\t\\tB.D_AC_036,\\n\\t\\tB.D_AC_037,\\n\\t\\tB.D_AC_038,\\n\\t\\tB.D_AC_039,\\n\\t\\tB.D_AC_040,\\n\\t\\tB.D_AC_041,\\n\\t\\tB.D_AC_042,\\n\\t\\tB.D_AC_043,\\n\\t\\tB.D_AC_044,\\n\\t\\tB.D_AC_045,\\n\\t\\tB.D_AC_046,\\n\\t\\tB.D_AC_047,\\n\\t\\tB.D_AC_048,\\n\\t\\tB.D_AC_049,\\n\\t\\tB.D_AC_050,\\n\\t\\tC.D_N_001,\\n\\t\\tC.D_N_002,\\n\\t\\tC.D_N_003,\\n\\t\\tC.D_N_004,\\n\\t\\tC.D_N_005,\\n\\t\\tC.D_N_006,\\n\\t\\tC.D_N_007,\\n\\t\\tC.D_N_008,\\n\\t\\tC.D_N_009,\\n\\t\\tC.D_N_010,\\n\\t\\tC.D_N_011,\\n\\t\\tC.D_N_012,\\n\\t\\tC.D_N_013,\\n\\t\\tC.D_N_014,\\n\\t\\tC.D_N_015,\\n\\t\\tC.D_N_016,\\n\\t\\tC.D_N_017,\\n\\t\\tC.D_N_018,\\n\\t\\tC.D_N_019,\\n\\t\\tC.D_N_020,\\n\\t\\tC.D_N_021,\\n\\t\\tC.D_N_022,\\n\\t\\tC.D_N_023,\\n\\t\\tC.D_N_024,\\n\\t\\tC.D_N_025,\\n\\t\\tC.D_N_026,\\n\\t\\tC.D_N_027,\\n\\t\\tC.D_N_028,\\n\\t\\tC.D_N_029,\\n\\t\\tC.D_N_030,\\n\\t\\tC.D_N_031,\\n\\t\\tC.D_N_032,\\n\\t\\tC.D_N_033,\\n\\t\\tC.D_N_034,\\n\\t\\tC.D_N_035,\\n\\t\\tC.D_N_036,\\n\\t\\tC.D_N_037,\\n\\t\\tC.D_N_038,\\n\\t\\tC.D_N_039,\\n\\t\\tC.D_N_040,\\n\\t\\tC.D_N_041,\\n\\t\\tC.D_N_042,\\n\\t\\tC.D_N_043,\\n\\t\\tC.D_N_044,\\n\\t\\tC.D_N_045,\\n\\t\\tC.D_N_046,\\n\\t\\tC.D_N_047,\\n\\t\\tC.D_N_048,\\n\\t\\tC.D_N_049,\\n\\t\\tC.D_N_050,\\n\\t\\tD.D_V_001,\\n\\t\\tD.D_V_002,\\n\\t\\tD.D_V_003,\\n\\t\\tD.D_V_004,\\n\\t\\tD.D_V_005,\\n\\t\\tD.D_V_006,\\n\\t\\tD.D_V_007,\\n\\t\\tD.D_V_008,\\n\\t\\tD.D_V_009,\\n\\t\\tD.D_V_010,\\n\\t\\tD.D_V_011,\\n\\t\\tD.D_V_012,\\n\\t\\tD.D_V_013,\\n\\t\\tD.D_V_014,\\n\\t\\tD.D_V_015,\\n\\t\\tD.D_V_016,\\n\\t\\tD.D_V_017,\\n\\t\\tD.D_V_018,\\n\\t\\tD.D_V_019,\\n\\t\\tD.D_V_020,\\n\\t\\tD.D_V_021,\\n\\t\\tD.D_V_022,\\n\\t\\tD.D_V_023,\\n\\t\\tD.D_V_024,\\n\\t\\tD.D_V_025,\\n\\t\\tD.D_V_026,\\n\\t\\tD.D_V_027,\\n\\t\\tD.D_V_028,\\n\\t\\tD.D_V_029,\\n\\t\\tD.D_V_030,\\n\\t\\tD.D_V_031,\\n\\t\\tD.D_V_032,\\n\\t\\tD.D_V_033,\\n\\t\\tD.D_V_034,\\n\\t\\tD.D_V_035,\\n\\t\\tD.D_V_036,\\n\\t\\tD.D_V_037,\\n\\t\\tD.D_V_038,\\n\\t\\tD.D_V_039,\\n\\t\\tD.D_V_040,\\n\\t\\tD.D_V_041,\\n\\t\\tD.D_V_042,\\n\\t\\tD.D_V_043,\\n\\t\\tD.D_V_044,\\n\\t\\tD.D_V_045,\\n\\t\\tD.D_V_046,\\n\\t\\tD.D_V_047,\\n\\t\\tD.D_V_048,\\n\\t\\tD.D_V_049,\\n\\t\\tD.D_V_050,\\n\\t\\tA.DAY_NEW_MARK,\\n\\t\\tA.DAY_OFF_MARK,\\n\\t\\tA.DEAL_OPERATOR,\\n\\t\\tNULL,\\n\\t\\tA.DONE_CODE,\\n\\t\\tA.DONE_DATE,\\n\\t\\tA.EDUCATION_ID,\\n\\t\\tA.ENTERPRISE_ID,\\n\\t\\tA.ENTERPRISE_MARK,\\n\\t\\tA.ENTERPRISE_SCALE_ID,\\n\\t\\tA.EXCHANGE_ID,\\n\\t\\tA.EXPIRE_SCORE,\\n\\t\\tA.F_CHANNEL_ID,\\n\\t\\tA.F_DEPT_ID,\\n\\t\\tA.FIRST_CHARGETIME,\\n\\t\\tA.FIRST_UNVALID_CALLTIME,\\n\\t\\tA.FIRST_VALID_CALLTIME,\\n\\t\\tA.IDEN_ID,\\n\\t\\tA.IDEN_NO,\\n\\t\\tA.IMEI,\\n\\t\\tA.IMSI_NO,\\n\\t\\tA.INDUSTRY_ID,\\n\\t\\tA.INNET_TIME,\\n\\t\\tA.IS_CHANGE_USIM,\\n\\t\\tA.IS_HANDLE_4G,\\n\\t\\tA.IS_MIFI_4G,\\n\\t\\tA.IS_OUT_NET,\\n\\t\\tA.IS_SCROE_SIX,\\n\\t\\tA.IS_SCROE_THREE,\\n\\t\\tA.IS_TERMINAL_4G,\\n\\t\\tA.IS_TEST_4G,\\n\\t\\tA.IS_YIJING_ZEROCALL,\\n\\t\\tA.IS_YIJINGPHONE_USER,\\n\\t\\tA.LAST_TRANS_DATE,\\n\\t\\tA.LAST_USERSTATUS_ID,\\n\\t\\tA.LASTSUB_USERSTATUS_ID,\\n\\t\\tA.MONTH_ARRIVE_MARK,\\n\\t\\tA.MONTH_NEW_MARK,\\n\\t\\tA.MONTH_OFF_MARK,\\n\\t\\tA.OCCUPATION_ID,\\n\\t\\tA.OFF_REASON_ID,\\n\\t\\tA.PASS_GRADE,\\n\\t\\tA.PAYBILL_FLAG,\\n\\t\\tA.PLAN_ID,\\n\\t\\tA.POST_BILL_FLAG,\\n\\t\\tA.POST_CODE,\\n\\t\\tA.PRE_DESTORY_TIME,\\n\\t\\tA.PROD_CATALOG_ID,\\n\\t\\tA.REPAY_SCORE,\\n\\t\\tA.RISK_FLAG,\\n\\t\\tA.ROAM_TYPE,\\n\\t\\tA.SEX_ID,\\n\\t\\tA.SIM_NO,\\n\\t\\tA.STOP_CALL_FLAG,\\n\\t\\tA.STOP_LEVEL,\\n\\t\\tA.SUB_BILL_ID,\\n\\t\\tA.SUB_BRAND_ID,\\n\\t\\tA.SUB_BRAND_ID1,\\n\\t\\tA.SUB_USERSTATUS_ID,\\n\\t\\tA.TD_MARK,\\n\\t\\tA.TERMINAL_4G,\\n\\t\\tA.USER_GRADE,\\n\\t\\tA.USER_ID,\\n\\t\\tA.USER_INNET_ID,\\n\\t\\tA.USER_NAME,\\n\\t\\tA.USER_OFFTIME,\\n\\t\\tA.USER_OPEN_ID,\\n\\t\\tA.USER_OPENTIME,\\n\\t\\tA.USERSTATUS_ID,\\n\\t\\tA.USERTYPE_ID,\\n\\t\\tA.VALID_NEW_MARK,\\n\\t\\tA.VIP_MARK,\\n\\t\\tA.VIP_SCALE_ID,\\n\\t\\tA.VIP_SCALE_ID1,\\n\\t\\tA.VPMN_MARK,\\n\\t\\tA.WATCH_FLAG,\\n\\t\\tA.ZEROCALL_CUR_FLAG,\\n\\t\\tA.IS_HANDLE_4G\\nFROM DM.DM_PUB_USER_${dayid} A\\nLEFT JOIN TMP1_DM_PUB_NEW_ACCT B ON A.PRODUCT_NO=B.PRODUCT_NO\\nLEFT JOIN TMP3_DM_PUB_NEW_NEWBUSI C ON A.PRODUCT_NO=C.PRODUCT_NO\\nLEFT JOIN TMP2_DM_PUB_NEW_CALL   D ON A.PRODUCT_NO=D.PRODUCT_NO\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [161]-[index:261]-[自助分析平台日指标视图]-[37]-['str' object has no attribute 'lfind']:{"name":"37.临时表3的插入","nodeId":"37","dsName":"GbaseDM","sql":"insert into TMP3_DM_PUB_NEW_NEWBUSI\\n              ( OP_TIME\\n               ,STATIS_DATE\\n               ,PRODUCT_NO\\n               ,D_N_001\\n               ,D_N_002\\n               ,D_N_003\\n               ,D_N_004\\n               ,D_N_005\\n               ,D_N_006\\n               ,D_N_007\\n               ,D_N_008\\n               ,D_N_009\\n               ,D_N_010\\n               ,D_N_011\\n               ,D_N_012\\n               ,D_N_013\\n               ,D_N_014\\n               ,D_N_015\\n               ,D_N_016\\n               ,D_N_017\\n               ,D_N_018\\n               ,D_N_019\\n               ,D_N_020\\n               ,D_N_021\\n               ,D_N_022\\n               ,D_N_023\\n               ,D_N_024\\n               ,D_N_025\\n               ,D_N_026\\n               ,D_N_027\\n               ,D_N_028\\n               ,D_N_029\\n               ,D_N_030\\n               ,D_N_031\\n               ,D_N_032\\n               ,D_N_033\\n               ,D_N_034\\n               ,D_N_035\\n               ,D_N_036\\n               ,D_N_037\\n               ,D_N_038\\n               ,D_N_039\\n               ,D_N_040\\n               ,D_N_041\\n               ,D_N_042\\n               ,D_N_043\\n               ,D_N_044\\n               ,D_N_045\\n               ,D_N_046\\n               ,D_N_047\\n               ,D_N_048\\n               ,D_N_049\\n               ,D_N_050\\n               ,gprs_total_flow  -- 当日GPRS使用次数\\n               ,gprs_total_num   -- 当日GPRS使用时长（分钟）\\n              )\\n\\t        select a.STAT_DATE\\n                    ,'${dayid}'\\n                    ,a.PHONE_NO\\n                    ,t1.SMS_P2P_NUM                 D_N_001\\n                    ,t1.SMS_P2P_INNET_NUM           D_N_002\\n                    ,t1.SMS_P2P_NETO_NUM            D_N_003\\n                    ,t1.SMS_P2P_NETO_CTC_CMC_NUM    D_N_004\\n                    ,t1.SMS_P2P_NETO_CUC_CMC_NUM    D_N_005\\n                    ,t1.MMS_P2P_NUM                 D_N_006\\n                    ,t1.MMS_P2P_INNET_NUM           D_N_007\\n                    ,t1.MMS_P2P_NETO_NUM            D_N_008\\n                    ,t1.MMS_P2P_CTC_NUM             D_N_009\\n                    ,t1.MMS_P2P_CUC_NUM             D_N_010\\n                    ,t1.MMS_INTER_NUM               D_N_011\\n                    ,cast(t2.GPRS_TOTAL_FLOW as signed)             D_N_012\\n                    ,cast(t2.GPRS_BUSY_FLOW as  signed)            D_N_013\\n                    ,cast(t2.GPRS_IDLE_FLOW as signed)             D_N_014\\n                    ,cast(t2.GPRS_UP_FLOW  as signed)              D_N_015\\n                    ,cast(t2.GPRS_DOWN_FLOW as signed)             D_N_016\\n                    ,cast(t3.WLAN_TOTAL_FLOW  as  signed)          D_N_017\\n                    ,t3.WLAN_TOTAL_DUR              D_N_018\\n                    ,t3.WLAN_CMCCEDU_DUR            D_N_019\\n                    ,cast(t2.GPRS_CMWAP_FLOW as signed)            D_N_020\\n                    ,cast(t2.GPRS_CMNET_FLOW  as signed)           D_N_021\\n                    ,t2.CMWAP_DUR                           D_N_022\\n                    ,t2.CMNET_DUR                           D_N_023\\n                     ,cast((t2.GPRS_LAND_ROAM_FLOW+t2.GPRS_INTER_ROAM_FLOW+t2.GPRS_HMT_ROAM_FLOW) as signed) D_N_024\\n                    ,cast(t2.BILL_FLOW  as signed)    D_N_025\\n                    ,case when (t1.SMS_P2P_NUM+t1.MMS_P2P_NUM+t3.WLAN_TOTAL_FLOW+t2.GPRS_TOTAL_FLOW)> 0 or t4.CALL_NUM>0 then 1 else 0 end                D_N_026\\n                    ,cast(t2.G4_NET_GPRS_FLOW   as signed)          D_N_027\\n                    ,cast(t2.G4_NET_GPRS_UP_FLOW   as signed)      D_N_028\\n                    ,cast(t2.G4_NET_GPRS_DOWN_FLOW  as signed)      D_N_029\\n                    ,cast(t2.GPRS_LAND_ROAM_FLOW  as signed)        D_N_030\\n                    ,null                           D_N_031\\n                    ,null                           D_N_032\\n                    ,null                           D_N_033\\n                    ,null                           D_N_034\\n                    ,null                           D_N_035\\n                    ,null                           D_N_036\\n                    ,null                           D_N_037\\n                    ,null                           D_N_038\\n                    ,null                           D_N_039\\n                    ,null                           D_N_040\\n                    ,null                           D_N_041\\n                    ,null                           D_N_042\\n                    ,null                           D_N_043\\n                    ,null                           D_N_044\\n                    ,null                           D_N_045\\n                    ,null                           D_N_046\\n                    ,null                           D_N_047\\n                    ,null                           D_N_048\\n                    ,null                           D_N_049\\n                    ,null                           D_N_050\\n                    ,gprs_total_flow  -- 当日GPRS使用次数\\n                    ,gprs_total_num   -- 当日GPRS使用时长（分钟）\\n              from  gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid}  a\\n\\t\\t\\t        left join  gbasedwi.DWI_BEH_USE_SMS_USERTOT_DS_${dayid} t1 on a.phone_no = t1.phone_no and a.user_id=t1.user_id\\n              left join  (select distinct * from  gbasedwi.DWI_BEH_USE_GPRS_USERTOT_DS_${dayid}) t2 on a.phone_no = t2.phone_no and a.user_id=t2.user_id\\n\\t\\t\\t  -- gbasedwi.DWI_BEH_USE_GPRS_USERTOT_DS_${dayid} t2 on a.phone_no = t2.phone_no\\n              left join  gbasedwi.DWI_BEH_USE_WLAN_TOT_DS_${dayid}  t3 on a.phone_no = t3.phone_no and a.user_id=t3.user_id\\n\\t\\t\\t        left join  gbasedwi.DWI_BEH_USE_VOC_USERTOT_DS_${dayid} t4 on a.phone_no = t4.phone_no and a.user_id=t4.user_id\\n\\t\\t\\t       where PROD_KIND_CODE = 171000000001 And (MONTH_ARRIVE_FLAG = 1 Or MONTH_OFF_FLAG = 1 Or MONTH_NEW_FLAG = 1)\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [162]-[index:262]-[自助分析平台日指标视图]-[19]-['str' object has no attribute 'lfind']:{"name":"创建临时表","nodeId":"19","dsName":"GbaseDM","sql":"drop table TMP_DM_PUB_NEW_ACCT;\\ncreate table TMP_DM_PUB_NEW_ACCT \\n( OP_TIME       date             ,    \\n  STATIS_DATE   varchar(10)      ,    \\n  PRODUCT_NO    varchar(20)      ,    \\n  D_AC_001      decimal(12,2)    ,   \\n  D_AC_002      decimal(12,2)      ,   \\n  D_AC_003      decimal(12,2)      ,   \\n  D_AC_004      decimal(12,2)      ,   \\n  D_AC_005      decimal(12,2)      ,   \\n  D_AC_006      decimal(12,2)      ,   \\n  D_AC_007      decimal(12,2)      ,   \\n  D_AC_008      decimal(12,2)      ,   \\n  D_AC_009      decimal(12,2)      ,   \\n  D_AC_010      decimal(12,2)      ,   \\n  D_AC_011      decimal(12,2)      ,   \\n  D_AC_012      decimal(12,2)      ,   \\n  D_AC_013      decimal(12,2)      ,   \\n  D_AC_014      decimal(12,2)      ,   \\n  D_AC_015      decimal(12,2)      ,   \\n  D_AC_016      decimal(12,2)      ,   \\n  D_AC_017      decimal(12,2)      ,   \\n  D_AC_018       decimal(12,2)        )  distributed by ('PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [163]-[index:263]-[自助分析平台日指标视图]-[31]-['str' object has no attribute 'lfind']:{"name":"31.临时表2的创建","nodeId":"31","dsName":"GbaseDM","sql":"drop table TMP2_DM_PUB_NEW_CALL;\\ncreate table TMP2_DM_PUB_NEW_CALL\\n       (OP_TIME       DATE   \\n        ,STATIS_DATE  VARCHAR(10) \\n        ,PRODUCT_NO   VARCHAR(20)  \\n        ,D_V_001      INTEGER \\n        ,D_V_002      INTEGER \\n        ,D_V_003      INTEGER \\n        ,D_V_004      INTEGER \\n        ,D_V_005      INTEGER \\n        ,D_V_006      INTEGER \\n        ,D_V_007      INTEGER \\n        ,D_V_008      INTEGER \\n        ,D_V_009      INTEGER \\n        ,D_V_010      INTEGER \\n        ,D_V_011      INTEGER \\n        ,D_V_012      INTEGER \\n        ,D_V_013      INTEGER \\n        ,D_V_014      INTEGER \\n        ,D_V_015      INTEGER \\n        ,D_V_016      INTEGER \\n        ,D_V_017      INTEGER \\n        ,D_V_018      INTEGER \\n        ,D_V_019      INTEGER  \\n        ,D_V_020      INTEGER \\n        ,D_V_021      INTEGER \\n        ,D_V_022      INTEGER \\n        ,D_V_023      INTEGER \\n        ,D_V_024      INTEGER \\n        ,D_V_025      INTEGER \\n        ,D_V_026      INTEGER \\n        ,D_V_027      INTEGER \\n        ,D_V_028      INTEGER \\n        ,D_V_029      INTEGER \\n        ,D_V_030      INTEGER \\n        ,D_V_031      INTEGER \\n        ,D_V_032      INTEGER \\n        ,D_V_033      INTEGER \\n        ,D_V_034      INTEGER \\n        ,D_V_035      INTEGER \\n        ,D_V_036      INTEGER \\n        ,D_V_037      INTEGER \\n        ,D_V_038      INTEGER \\n        ,D_V_039      INTEGER \\n        ,D_V_040      INTEGER \\n        ,D_V_041      INTEGER \\n        ,D_V_042      INTEGER \\n        ,D_V_043      INTEGER \\n\\t    ,D_V_044      INTEGER     \\n\\t\\t,D_V_045      INTEGER     \\n\\t\\t,D_V_046      INTEGER     \\n\\t    ,D_V_047      INTEGER     \\n\\t    ,D_V_048      INTEGER     \\n\\t    ,D_V_049      INTEGER     \\n\\t    ,D_V_050      INTEGER     )distributed by ('PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [164]-[index:265]-[群组业务办理累计视图数据同步]-[3]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"3","dsName":"Gbase_6_DM","sql":" drop table if exists dm_pub_family_group_${dayid};\\n create table dm_pub_family_group_${dayid} like dm_pub_family_group_yyyymmdd","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [165]-[index:266]-[群组业务办理累计视图数据同步]-[4]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"4","dsName":"Gbase_6_DM","sql":" insert into dm_pub_family_group_${dayid}\\n select  * from dm_pub_family_group_${dayid}@dblink_dm","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [166]-[index:270]-[渠道酬金020504月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CHANNEL_020504_${monthid};\\nCREATE TABLE  DM_PUB_CHANNEL_020504_${monthid} distributed by('PHONE_NUM')  as select * from DM_PUB_CHANNEL_020504_YYYYMM ;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [167]-[index:271]-[渠道酬金020504月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CHANNEL_020504_${monthid} \\n(select * from   \\n ODS_M_F_OTR_020504_SOCIETYQUALITYLIST_${monthid}@dblink_ods);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [168]-[index:274]-[账务数据（日指标）日累计调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_ACCT_${dayid};\\ncreate table  DM_PUB_ACCT_${dayid} distributed by ('product_no') as select * from  DM_PUB_ACCT_YYYYMMDD;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:15 | 【ERROR】<run>@<step1_trans_sql_code> | [169]-[index:275]-[账务数据（日指标）日累计调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into  DM_PUB_ACCT_${dayid} select * from  DM_PUB_ACCT_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [170]-[index:279]-[2013年9月日累计新增加指标]-[44]-['str' object has no attribute 'lfind']:{"name":"创建临时表1","nodeId":"44","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_01;\\nCREATE TABLE TMP_DM_20130916_01\\n(\\tPRODUCT_NO\\t\\t\\t\\t\\tVARCHAR(20),\\n\\tCALL_TOTAL_PROPORTION\\t\\tDECIMAL(20,3),\\n\\tMESSAGE_TOTAL_PROPORTION\\tDECIMAL(20,3),\\n\\tGPRS_TOTAL_PROPORTION\\t\\tDECIMAL(20,3)\\t)    DISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [171]-[index:281]-[2013年9月日累计新增加指标]-[133]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"133.插入临时表12","nodeId":"133","sql":"insert into TMP_DM_20130916_012\\n (PRODUCT_NO,\\n  NORMAL_TOTAL_VALUE,\\n  NORMAL_USED_VALUE,\\n  ACTIVE_DAYS_4G    \\n )select \\n   a.phone_no,\\n   b.last_gprs_flow_m,   /*--GPRS资源总量*/\\n   b.last1m_boss_gprs_value,    /*--GPRS资源使用量*/\\n   c.active_days_4g        /*--4G活跃天数*/\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a       \\nleft join (\\n       select b.phone_no,\\n\\t          sum(nvl(case when b.USE_TYPE is not null  then TOTAL_RES_NUM end ,0) )/1024/1024 as last_gprs_flow_m,       /*GPRS总量*/\\n\\t          sum(nvl(case when b.USE_TYPE is not null then USE_RES_NUM end ,0))/1024/1024 as  last1m_boss_gprs_value  /*GPRS使用 */\\n       from dm.dim_gprs_use_type a \\n       left join ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD} b on a.use_type=b.use_type\\n\\t   where  TOTAL_RES_NUM<1000000000000000000 and prod_id<>'54001105'\\n       group by b.phone_no\\n    /*select phone_no, 20190226日口径调整\\n\\tsum(nvl(case when  USE_TYPE in ('国内通用流量','本地闲时流量','本地4G流量直充赠送','本地通用流量','本地流量','季包/卡流量','闲时流量','国内通用流量直充赠送','本地数据流量','通用流量指定用户定额统付','流量嗨包月包','本地4G流量','寒暑假国内流量','无线DDN数据流量（关停）','半年包/卡流量','积分兑换数据流量包')  then TOTAL_RES_NUM end ,0) )/1024/1024 as last_gprs_flow_m,       GPRS总量\\n\\tsum(nvl(case when  USE_TYPE in ('国内通用流量','本地闲时流量','本地4G流量直充赠送','本地通用流量','本地流量','季包/卡流量','闲时流量','国内通用流量直充赠送','本地数据流量','通用流量指定用户定额统付','流量嗨包月包','本地4G流量','寒暑假国内流量','无线DDN数据流量（关停）','半年包/卡流量','积分兑换数据流量包')  then USE_RES_NUM end ,0))/1024/1024 as  last1m_boss_gprs_value  GPRS使用\\n    from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD} \\n    group by PHONE_NO*/\\n\\t    ) b on a.PHONE_NO=b.PHONE_NO\\nleft join (select PHONE_NO,count(distinct STAT_DATE) active_days_4g \\n\\t      from GBASEDWD.DWD_EVT_CDR_GPRS_BUSITYPETOT_DM_${monthid}\\n\\t\\t   where   STAT_DATE<='${day_id}'  and NET_TYPE=6  group by PHONE_NO) c on a.PHONE_NO=c.PHONE_NO\\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG  =1 "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [172]-[index:282]-[2013年9月日累计新增加指标]-[126]-['str' object has no attribute 'lfind']:{"name":"126.插入临时表11","nodeId":"126","dsName":"GbaseDM","sql":"insert into TMP_DM_20130916_011\\n       (PRODUCT_NO,\\n      IS_UNIFIED_PACKAGE,\\n  \\t  IS_YIJING_ACCT_USER,\\n      IS_ZHENGQI_PACKAGE,\\n\\t  IS_UNIFIED_ZHENGQI,\\n\\t  CO_COUNTY_ID)  \\t\\n\\t            select a.phone_no,\\n                  case when b.product_no is not null then 1 else 0 end   is_unified_package,\\n                  case when c.product_no is not null then 1 else 0 end   IS_YIJING_ACCT_USER,\\n \\t\\t\\t\\t  case when d.phone_no is not null then 1 else 0 end   IS_ZHENGQI_PACKAGE, /*是否办理政企套餐*/\\n\\t\\t\\t\\t  case when e.phone_no is not null then 1 else 0 end   IS_UNIFIED_ZHENGQI, /*是否办理政企统一套餐*/\\n\\t\\t\\t\\t  nvl(f.CO_COUNTY_ID,999)\\t\\t/*CO归属部门*/\\t\\n\\t\\t\\tfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a            /*用户资料小表日表 */\\n           left join (select distinct product_no from gbasemsm.msm_dw_basekpi_110491_detail_${dayid}) b on  a.phone_no=b.product_no   \\n\\t\\t   left join (select distinct product_no from gbasemsm.msm_dw_basekpi_110492_detail_${dayid}) c on  a.phone_no=c.product_no   \\n\\t\\t   left join (select distinct phone_no from  dm.tmp_dm_pub_20130916_msm_${dayid}) d on  a.phone_no=d.phone_no\\n\\t\\t   left join (select distinct phone_no from  dm.tmp_dm_pub_20130916_msm_${dayid} where offer_type_id=1) e on  a.phone_no=e.phone_no\\n\\t    left join (select distinct case when county_id=0 then dept_county_id \\n                  else county_id end CO_COUNTY_ID\\n                  ,offer_type_id\\n                  ,phone_no  from  dm.tmp_dm_pub_20130916_msm_${dayid} ) f on a.phone_no=f.phone_no\\n\\t\\twhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG =1;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [173]-[index:283]-[2013年9月日累计新增加指标]-[157]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"157.创建临时表13","nodeId":"157","sql":"DROP TABLE TMP_DM_20130916_013;\\nCREATE TABLE TMP_DM_20130916_013\\n(PRODUCT_NO           VARCHAR(20),\\n is_4sim_user         SMALLINT,\\n chl_type             varchar(50),\\n offer_gprs_package   bigint,\\n last_offer_gprs_package bigint,\\n chl_lvl              varchar(50),\\n send_card_brand      varchar(500),\\n account_balance      decimal(12,3),\\n is_acct_user         smallint,\\n is_4gpuls            smallint,      -- 是否4G+终端用户\\n is_comm_user         smallint       -- 是否为通信客户（不含物联网）\\n) DISTRIBUTED BY ('PRODUCT_NO');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [174]-[index:284]-[2013年9月日累计新增加指标]-[131]-['str' object has no attribute 'lfind']:{"name":"131.插入临时表10","nodeId":"131","dsName":"GbaseDM","sql":"insert into TMP_DM_20130916_010\\n (PRODUCT_NO,\\n  GPRS_ACCT_FEE ,\\n   GPRS_ACCT_FEE_LAST1   \\n )\\nselect \\n   a.phone_no,\\n   b.gprs_acct_fee,          /*--流量收入（财务口径）*/\\n   c.gprs_acct_fee_last1    /* --流量收入(财务口径)-前1月*/\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a     \\nleft join (select phone_no,sum(should_fee) as gprs_acct_fee   /*--流量收入（财务口径）*/\\n             from gbasemsm.msm_dw_basekpi_110311_${dayid} group by phone_no) b on a.phone_no=b.phone_no\\nleft join (select phone_no,sum(should_fee) as gprs_acct_fee_last1 /*--流量收入(财务口径)-前1月*/\\n             from gbasemsm.msm_dw_basekpi_110311_${p1month} group by phone_no) c on a.phone_no=c.phone_no                                  \\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG  =1 ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [175]-[index:285]-[2013年9月日累计新增加指标]-[91]-['str' object has no attribute 'lfind']:{"name":"91.创建临时表6","nodeId":"91","dsName":"GbaseDM","sql":"drop table tmp_dm_20130916_06;\\ncreate table tmp_dm_20130916_06\\n( product_no            varchar(20),\\n  gprs_monthly_fee      decimal(12,2), -- 流量出账-月租费\\n  gprs_gasbag_fee       decimal(12,2), -- 流量出账-加油包费\\n  gprs_flow_fee         decimal(12,2), -- 流量出账-流量费\\n  gprs_wlan_fee         decimal(12,2), -- 流量出账-WLAN\\n  gprs_yearhalfyear_fee decimal(12,2), -- 流量出账-年包半年包\\n  gprs_quarter_fee      decimal(12,2), -- 流量出账-季包\\n  gprs_payment_fee      decimal(12,2), -- 流量出账-流量统付\\n  gprs_direct_fee       decimal(12,2), -- 流量出账-流量直充\\n  gprs_infinite_fee     decimal(12,2), -- 流量出账-不限量\\n  gprs_personality_fee  decimal(12,2), -- 流量出账-个性化\\n  gprs_national_fee     decimal(12,2), -- 流量出账-国漫套餐\\n  gprs_unified_fee      decimal(12,2), -- 流量出账-统付\\n  day_fee               decimal(12,2), -- 流量出账\\n  user_4gnet_flag       smallint,\\n  offer_bracket         bigint ,\\n  last_offer_bracket    bigint\\n) distributed by ('product_no');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [176]-[index:286]-[2013年9月日累计新增加指标]-[132]-['str' object has no attribute 'lfind']:{"name":"创建临时表12","nodeId":"132","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_012;\\n CREATE TABLE TMP_DM_20130916_012\\n  (PRODUCT_NO           VARCHAR(20),\\n   NORMAL_TOTAL_VALUE      BIGINT,  \\n  NORMAL_USED_VALUE        BIGINT,\\n  ACTIVE_DAYS_4G           SMALLINT\\n   )  DISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [177]-[index:290]-[2013年9月日累计新增加指标]-[125]-['str' object has no attribute 'lfind']:{"name":"创建临时表11","nodeId":"125","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_011;\\n CREATE TABLE TMP_DM_20130916_011\\n   (PRODUCT_NO           VARCHAR(20),\\n  IS_UNIFIED_PACKAGE SMALLINT,\\nIS_YIJING_ACCT_USER  SMALLINT,\\nIS_ZHENGQI_PACKAGE   SMALLINT,\\nIS_UNIFIED_ZHENGQI   SMALLINT,\\nCO_COUNTY_ID        VARCHAR(10)\\n  )  DISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [178]-[index:291]-[2013年9月日累计新增加指标]-[179]-['str' object has no attribute 'lfind']:{"name":"179.创建临时表并插入","nodeId":"179","dsName":"GbaseDM","sql":" ###删除临时表\\n drop table if exists dm.tmp_dm_pub_20130916_age_${dayid};\\n ###创建临时表\\n create table dm.tmp_dm_pub_20130916_age_${dayid}\\n (\\n  phone_no varchar(20),\\n  net_age decimal(30,1),\\n  CUST_LEVEL int,\\n  sex varchar(10)\\n  ) distributed by('phone_no');\\n  ##插入数据\\n insert into dm.tmp_dm_pub_20130916_age_${dayid}\\n  select a.phone_No,\\n        round((date(${dayid})-date(a.innet_date))/365,1) net_age,     -- 网龄\\n        nvl(b.CUST_LEVEL,-1),                                      -- 客户星级标识\\n        a.sex                                              -- 性别\\n    from gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a \\n left join (\\n             select a.phone_no,  \\n                    b.crdt_lvl CUST_LEVEL\\n              from gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a\\n              left join  (\\n\\t\\t\\t               select  phone_no,\\n                                   max(CRDT_LVL) crdt_lvl\\n                           from gbasedwd.DWD_SVC_USR_CREDIT_dS_${dayid}\\n                           group by phone_no\\n\\t\\t\\t            ) b on a.phone_no=b.phone_no\\n\\t          group by a.phone_no,  \\n                    b.crdt_lvl \\n           ) b on a.phone_no=b.phone_no\\nwhere a.PROD_KIND_CODE='171000000001' And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1); ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [179]-[index:293]-[2013年9月日累计新增加指标]-[96]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"96.插入临时表7","nodeId":"96","sql":"INSERT INTO TMP_DM_20130916_07\\n (PRODUCT_NO,\\n\\tIS_2016STOCK_USER_ACT,\\n\\tIS_2016ENTER_USER_ACT,       \\n\\tGPRS_DIRECT_FEE,\\n\\tINCALL_DAY,\\n\\tGIVE_LOCAL_TOTAL,\\n\\tGIVE_LOCAL_4G_TOTAL,\\n\\tGIVE_USED_VALUE,\\n\\tIS_2016STOCK_USER,\\n\\tIS_2016ENTER_USER,\\n  IS_2017STOCK_USER,\\n  IS_2017ALLNET_USER,\\n  IS_2017STOCK_USER_ACT,\\n  IS_2017ALLNET_USER_ACT,\\n  IS_2017ENTER_USER,\\n  IS_2017ENTER_USER_ACT,\\n  IS_INTERNET_THINGS,\\n  IS_2018STOCK_USER,\\n  CHL_ID,\\n  GROUP_CUST_LEVEL,\\n  lvl_name,\\n  GRP_NAME,\\n  GRP_STATE_ID\\n\\t)\\nselect  a.PHONE_NO,\\n\\t\\tcase when b.USER_NO is null then 0 else 1 end ,      /*是否2016年拍照价值保有客户*/\\n\\t\\tcase when c.USER_NO is null then 0 else 1 end ,      /*是否2016年拍照集团成员保有客户*/\\n\\t\\tnvl(d.GPRS_DIRECT_FEE,0),                               /*流量出账-流量直充*/\\n\\t\\tnvl(e.incall_day,0),\\n\\t\\tnvl(f.give_local_total,0),                             /*本地通用流量GPRS赠送资源 */\\n\\t\\tnvl(f.give_local_4g_total,0),                          /*本地4G流量GPRS赠送资源*/\\n\\t\\tnvl(f.give_used_value,0),                              /*GRPS赠送资源使用量*/\\n\\t\\tcase when g.PRODUCT_NO is null then 0 else 1 end ,     /*是否2016年拍照价值客户*/\\n\\t\\tcase when h.PRODUCT_NO is null then 0 else 1 end ,     /*是否2016年拍照集团成员*/\\n\\t\\tcase when j.USER_NO is null then 0 else 1 end ,     /*是否2017年拍照价值客户*/\\n\\t\\t0,-- case when k.PHONE_NO is null then 0 else 1 end  ,     /*是否2017年拍照全网存量客户*/\\n\\t\\t0,-- case when t1.product_no is null then 0 else 1 end ,      /*2017年拍照价值保有客户*/\\n\\t\\t0,#case when t2.product_no is null then 0 else 1 end,      /*2017年拍照全网存量保有客户*/\\n\\t\\t0,-- case when t3.PHONE_NO is null then 0 else 1 end ,     /*2017年拍照集团成员*/\\n\\t\\t0,#case when t4.product_no is null then 0 else 1 end,      /*2017年拍照保有集团成员*/\\n\\t\\tcase when t5.user_no is null then 0 else 1 end,     /*是否物联网卡用户*/\\n\\t\\tcase when t6.user_no is null then 0 else 1 end ,     /*是否2018年拍照价值客户*/\\n\\t  nvl(t8.chl_id,'99'),                                 /*CO归属分公司*/\\n\\t  nvl(t8.group_cust_level,'00'),                       /*集团客户级别*/\\n\\t  nvl(t8.lvl_name,'不详'),                                 /*CO重要程度*/\\n\\t  nvl(t8.grp_name,''),                                 /*CO客户名称*/\\n\\t  nvl(t8.grp_state_id,0)                               /*CO在网状态*/\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a              /*用户资料小表日表 */\\nleft join (select USER_NO\\n\\t\\t   from gbasedwi.DWI_USR_PESN_STOCKSHOT_DS_${dayid}  /*客户保有公司拍照用户日表*/\\n\\t\\t   where CUR_DAY_KEEP_FLAG=1 group by USER_NO) b on a.PHONE_NO=b.USER_NO\\nleft join (select USER_NO\\n\\t\\t   from  gbasedwi.DWI_USR_PESN_ENTSHOT_DS_${dayid}       /*客户保有集团拍照用户日表*/\\n\\t\\t   where CUR_DAY_KEEP_FLAG=1 group by USER_NO) c  on a.PHONE_NO=c.USER_NO\\nleft join (select PHONE_NO,\\n\\t\\t\\t\\t  sum(case when ACCT_ITEM_ID in  ('3048','3099') then MT_SHOULD_INCOME else  0 end )  GPRS_DIRECT_FEE\\n\\t\\t   from  gbasedwi.dwi_inco_bill_item_tot_ds_${dayid}        /*综合账单明细日汇总日表*/\\n\\t\\t   group by phone_no) d  on  a.PHONE_NO=d.PHONE_NO\\nleft join (select PHONE_NO,count(distinct STAT_DATE) incall_day\\n\\t\\t   from gbasedwd.DWD_EVT_CDR_VOC_BASETOT_DM_${monthid}   /*语音通话基本情况汇总日累计表*/\\n\\t\\t   where CALL_TYPE ='2' and  STAT_DATE <='${day_id}' group by PHONE_NO) e\\n\\ton a.PHONE_NO=e.PHONE_NO\\nleft join (select PHONE_NO ,\\n\\t\\t\\t\\t  sum(case when  PLAN_ID in ('111002047001','111002007215','111002051400','111002001395','111002052644','111002004039','111002007237','111002057604','111002070829','111002051400',\\n                                             '111002001975','111002070829'\\n                                            )  then TOTAL_RES_NUM else 0 end)*1.0/1024 GIVE_LOCAL_TOTAL, -- 20190222 日调整,'111002070829','111002051400' -- 20222027增加'111002001975','111002070829'\\n\\t\\t\\t\\t  sum(case when  PLAN_ID ='111002004038'  then TOTAL_RES_NUM else 0 end)*1.0/1024 GIVE_LOCAL_4G_TOTAL,\\n\\t\\t\\t\\t  sum(case when  PLAN_ID in ('111002047001','111002007215','111002051400','111002001395','111002052644','111002004039','111002007237','111002004038','111002057604','111002070829','111002051400',\\n                                             '111002001975'\\n                                            )  then USE_RES_NUM else 0 end)*1.0/1024 GIVE_USED_VALUE -- 20190222日调整,'111002070829','111002051400' -- 20221027增加'111002001975'\\n\\t\\t  from  ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD}     /*免费资源统计日表*/\\n\\t\\t  -- where PLAN_ID in ('111002047001','111002007215','111002051400','111002001395','111002052644','111002004039','111002007237','111002004038')\\n\\t\\t  group by PHONE_NO \\n\\t\\t  ) f on  a.PHONE_NO=f.PHONE_NO\\nleft join gbasedwd.dw_cs_stock_snapshot_2016 g  on a.PHONE_NO=g.PRODUCT_NO\\nleft join gbasedwi.dw_enterprise_snapshot_2016 h on a.PHONE_NO=h.PRODUCT_NO\\nleft join gbasedwi.DWI_USR_PESN_STOCKSHOT_2017  j  on a.PHONE_NO=j.USER_NO\\n#left join gbasedwi.DWI_USR_WN_STOCKSHOT_2017 k on a.PHONE_NO=k.PHONE_NO\\n#left join gbasedwi.DWI_USR_GRP_MEB_SHOT_2017 t3 on a.PHONE_NO=t3.PHONE_NO\\n#left join (select distinct product_no from gbasemsm.msm_dw_basekpi_110471_detail_${dayid} where add_online_mark='是' and add_fee_mark='是') t1 on a.PHONE_NO=t1.PRODUCT_NO\\n#left join (select distinct product_no from gbasemsm.msm_dw_basekpi_110493_detail_${dayid} where cur_online_mark = '在网' and cur_fee_mark = '是') t2 on a.PHONE_NO=t2.PRODUCT_NO\\n#left join (select distinct product_no from gbasemsm.msm_dw_basekpi_110497_detail_${dayid} where add_online_mark='是' and add_fee_mark='是') t4 on a.PHONE_NO=t4.PRODUCT_NO\\nleft join (select distinct user_no from gbasedwi.dwi_usr_pesn_thinginter_ds_${dayid}) t5 on a.phone_no=t5.user_no\\nleft join gbasedwi.dwi_usr_pesn_stockshot_2018 t6 on a.phone_no=t6.user_no\\n-- left join gbaseods.ods_d_f_crm_01005_group_custext_${dayid} t7 on a.cust_id=t7.cust_id\\nleft join (select\\n               a.cust_id,b.chl_id,b.grp_name,\\n               case when b.grp_cust_state=2 then 1\\n                    else 3 end grp_state_id, -- 1在网 3断开 0不详\\n\\t\\t\\t\\t\\tc.group_cust_level,i.lvl_name\\n             from gbasedwi.dwi_usr_pesn_allcust_ds_${dayid} a\\n             left join gbasedwi.dwi_usr_grp_custinfo_ds_${dayid} b on a.parnt_grp=b.parnt_grp\\n\\t\\t\\t left join gbaseods.ods_d_f_crm_01005_group_custext_${dayid} c on a.parnt_grp=c.cust_id\\n\\t\\t\\t left join gbasedwd.dim_pub_grp_scale i on b.GRP_SCALE_ID= i.grp_scale_id\\n           ) t8 on a.cust_id=t8.cust_id\\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG  =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [180]-[index:294]-[2013年9月日累计新增加指标]-[89]-['str' object has no attribute 'lfind']:{"name":"89.创建临时表5","nodeId":"89","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_05;\\nCREATE TABLE TMP_DM_20130916_05\\n( PRODUCT_NO              VARCHAR(20) ,\\n # DAY_FEE                 DECIMAL(16,2),\\n\\tDAY_LAST1_FEE           DECIMAL(16,2),\\n\\tDAY_LAST2_FEE           DECIMAL(16,2),\\n\\tDAY_LAST3_FEE           DECIMAL(16,2),\\n\\tGPRS_FEE                DECIMAL(16,2),\\n\\tGPRS_AMOUNT             DECIMAL(16,2),\\n\\tGPRS_WLAN_AMOUNT        DECIMAL(16,2),\\n\\tGPRS_LAST1_FEE          DECIMAL(16,2),\\n\\tGPRS_LAST1_AMOUNT       DECIMAL(16,2),\\n\\tGPRS_WLANLAST1_AMOUNT   DECIMAL(16,2),\\n\\tPLAN_MONTHLY_FEE        DECIMAL(16,2),\\n  roamout_fee            decimal(12,2), -- 国漫出访费用（含国漫套餐包） ########以下国漫20181031调整取数口径\\n  roamout_packflow_fee   decimal(12,2), -- 国漫出访流量费用（含套餐包）\\n  roam_pack_fee          decimal(12,2), -- 国漫套餐包费用\\n  roamout_flow_fee       decimal(12,2), -- 国漫出访流量费用（不含套餐包）\\n  roamout_call_fee       decimal(12,2), -- 国漫出访话音费用\\n  roamout_sms_fee        decimal(12,2)  -- 国漫出访短信费用           \\n)DISTRIBUTED BY ('PRODUCT_NO');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [181]-[index:295]-[2013年9月日累计新增加指标]-[209]-['str' object has no attribute 'lfind']:{"name":"209.临时表","nodeId":"209","dsName":"GbaseDM","sql":" drop table if exists dm.tmp_dm_pub_20130916_msm_${dayid};\\nCREATE TABLE dm.tmp_dm_pub_20130916_msm_${dayid}\\n(\\n  phone_no varchar(20) ,\\n  offer_type_id int(10) ,\\n  plan_id bigint(20) ,\\n  plan_name varchar(100) ,\\n  eff_time datetime ,\\n  exp_time datetime ,\\n  county_id int(11) ,\\n  dept_county_id varchar(10) ,\\n  source_mark int(11) \\n)DISTRIBUTED BY ('phone_no')\\n\\n;\\n\\ndrop table if exists dm.tmp_dm_pub_20130916_msm_01_${dayid};\\ncreate table dm.tmp_dm_pub_20130916_msm_01_${dayid} like dm.tmp_dm_pub_20130916_msm_${dayid};\\n\\ninsert into dm.tmp_dm_pub_20130916_msm_01_${dayid}\\n   (   phone_no,       \\n       offer_type_id,  \\n       plan_id,        \\n       plan_name,       \\n       eff_time,       \\n       exp_time,       \\n       county_id,\\n       dept_county_id\\n       )\\n\\n select a.phone_no\\n       ,a.offer_type_id\\n       ,a.plan_id\\n       ,a.plan_name\\n       ,a.eff_time\\n       ,a.exp_time\\n       ,nvl(e.county_id,0)\\n       ,nvl(f.dept_county_id,0)\\n  from \\n      (\\n       select a.phone_no\\n              ,b.offer_type_id\\n              ,a.plan_id\\n              ,a.plan_name\\n              ,a.eff_time\\n              ,a.exp_time\\n        from gbasedwi.dwi_inst_offer_plan_ds_${dayid} a\\n        inner join gbasemsm.dim_msm_offer_mc_plan b on a.plan_id=b.plan_id\\n       where eff_time<=date('${nextmfirstday}')\\n         and exp_time>date('${nextmfirstday}')\\n      ) a\\n  left join gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} b on a.phone_no=b.phone_no\\n  left join (select cust_id\\n                    ,floor(parnt_grp) parnt_grp\\n               from gbasedwi.dwi_usr_pesn_allcust_ds_${dayid}\\n            ) c on b.cust_id=c.cust_id \\n  left join (select floor(chl_id) chl_id\\n                    ,grp_cust_id grp_cust_id\\n               from gbasedwi.dwi_usr_grp_custinfo_ds_${dayid}\\n            ) d on to_char(c.parnt_grp)=to_char(d.grp_cust_id)\\n  left join (select floor(channel_id) channel_id\\n                    ,county_id \\n                    ,county_name\\n              from gbasedwd.dim_enterprise_channel_transform\\n             where county_id in (1,4,5,6,7,8,9,10,11,12,13,14,401,403,404,405,406,407,408,409,506,601)\\n-- (1,4,5,6,7,8,9,10,11,12,13,14,401,403,404,405,407,408,409)\\n            ) e on d.chl_id=e.channel_id\\n  left join gbasedwi.dwi_usr_pesn_persn_loc_ds_${dayid} f on a.phone_no=f.phone_no;\\n\\ndrop table if exists dm.tmp_dm_pub_20130916_msm_02_${dayid};\\ncreate table dm.tmp_dm_pub_20130916_msm_02_${dayid} like dm.tmp_dm_pub_20130916_msm_01_${dayid};\\n\\n\\ninsert into  dm.tmp_dm_pub_20130916_msm_02_${dayid}\\nselect a.*  from  dm.tmp_dm_pub_20130916_msm_01_${dayid} a \\nleft join gbasemsm.msm_dw_basekpi_10492_internetthing_${pmonthid} b on a.phone_no=b.product_no \\nwhere b.product_no is null;\\n\\n\\ninsert into dm.tmp_dm_pub_20130916_msm_${dayid}\\n   (   phone_no,       \\n       offer_type_id,  \\n       plan_id,        \\n       plan_name,       \\n       eff_time,       \\n       exp_time,       \\n       county_id,\\n       dept_county_id,\\n       source_mark\\n       )\\nselect \\n       a.phone_no,       \\n       a.offer_type_id,  \\n       a.plan_id,        \\n       a.plan_name,       \\n       a.eff_time,       \\n       a.exp_time,       \\n       a.county_id,\\n       a.dept_county_id,\\n       b.source_mark\\n \\nfrom  dm.tmp_dm_pub_20130916_msm_02_${dayid}  a \\ninner join (\\n select a.msisdn   phone_no , \\n       max(source_mark) source_mark \\n  from (  \\n       select distinct user_id msisdn,\\n              0 source_mark \\n         from gbasedwi.dwi_int_03004_ms_${pmonthid}\\n        union\\n       select distinct msisdn,\\n              1 source_mark\\n        from gbasedwi.dwi_int_02004_di_${dayid}\\n        where join_date>='${curmfirstday}' \\n       ) a\\n group by a.msisdn )b on a.phone_no=b.phone_no;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [182]-[index:296]-[2013年9月日累计新增加指标]-[171]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"171.创建通话天数临时表并插入数据","nodeId":"171","sql":"#删除临时表\\ndrop table if exists tmp_call_days_${dayid};\\n#创建临时表\\ncreate table tmp_call_days_${dayid}\\n(\\n phone_no varchar(20),\\n call_days int\\n)distributed by ('phone_no');\\n#插入数据\\ninsert into tmp_call_days_${dayid}\\nselect phone_no,count(distinct stat_date) \\nfrom gbasedwd.dwd_evt_cdr_voc_basetot_dm_${monthid}\\nwhere stat_date<='${day_id}'\\ngroup by phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [183]-[index:297]-[2013年9月日累计新增加指标]-[109]-['str' object has no attribute 'lfind']:{"name":"109.插入临时表9","nodeId":"109","dsName":"GbaseDM","sql":"INSERT INTO TMP_DM_20130916_09\\n (\\tPRODUCT_NO,\\n    IS_NET_PLAY,\\n\\tIS_OFFER_4G,\\n\\tODD_TOTAL_VALUE,\\n\\tODD_USED_VALUE,\\n\\tchl_id,\\n\\tCHL_NAME,\\n\\tVALID_ACTIVE_TIME,\\n\\tIS_50UP_PACKAGE)\\nselect a.PHONE_NO,\\n\\t   case when b.PHONE_NO is null then 0 else 1 end as IS_NET_PLAY ,     /*是否手机上网用户及上网卡用户*/\\n\\t   case when c.PHONE_NO is null then 0 else 1 end as IS_OFFER_4G,     /*是否办理4G套餐*/\\n\\t   d.odd_total_value,          /*流量滚存资源*/\\n\\t   d.odd_used_value,            /*流量滚存资源使用量*/\\n\\t   e.chl_id,          -- 渠道编码\\n\\t   e.CHL_NAME,        /*渠道名称*/\\n\\t   e.VALID_ACTIVE_TIME,    /*有效激活时间*/\\n\\t  case when f.PHONE_NO is null then 0 else 1 end as IS_50UP_PACKAGE     /*是否办理流量模组50元以上套餐*/\\nfrom  gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a            /*用户资料小表日表 */\\nleft join (select distinct phone_no from gbasedwi.DWI_BEH_USE_NETUSER_DS_${dayid}  where MOB_USER_FLAG=1 and  MT_OBASS_FLOW>0  \\n              \\t    union\\n                   select distinct product_no as phone_no from gbasemsm.msm_dw_basekpi_4g_speed_card_detail_dm  where start_date between '${curm_first_day}' and '${day_id}'  \\n\\t\\t\\t          minus\\n\\t\\t\\t          select USER_NO as phone_no from  gbasedwi.DWI_USR_PESN_THINGINTER_DS_${dayid}\\n\\t\\t\\t ) b  on a.phone_no=b.phone_no\\n\\nleft join /*(select distinct a.PHONE_NO from gbasedwi.DWI_INST_OFFER_ADDBUSI_DS_${dayid} a   \\n\\t\\t   inner join gbasedwd.dim_basekpi_4g_offer b on a.PLAN_ID=b.offer_id \\n\\t\\t   where date(a.UPDT_TIME)<='${day_id}' and date(a.EXP_TIME)>'${curm_last_day}' \\n\\t\\t\\tunion \\n\\t\\t   select distinct  a.PHONE_NO from  gbasedwi.DWI_INST_OFFER_PLAN_DS_${dayid}  a \\n\\t\\t   inner join gbasedwd.dim_basekpi_4g_offer b on  a.PLAN_ID=  b.offer_id \\n\\t\\t   where date(a.UPDT_TIME)<='${day_id}' and date(a.EXP_TIME)>'${curm_last_day}'   \\n\\t\\t\\tunion \\n\\t\\t   select distinct a.PHONE_NO from gbasedwi.DWI_INST_OFFER_PLOY_DS_${dayid}  a \\n\\t\\t   inner join gbasedwd.dim_basekpi_4g_offer b on a.PLAN_ID=b.offer_id \\n\\t\\t   where date(a.UPDT_TIME)<='${day_id}' and date(a.EXP_TIME)>'${curm_last_day}') c */\\n\\t\\t   (select distinct product_no phone_no from TMP_DM_20130916_09_02 where flag=1 and (member_flag<>3 or freeflow>=300)) c\\n\\ton a.PHONE_NO=c.PHONE_NO\\nleft join (select PHONE_NO,sum(a.ROLL_TOTUSE_RES_NUM)/1024/1024 odd_total_value,\\n\\t\\t\\t\\t  sum(a.ROLL_USE_RES_NUM)/1024/1024 odd_used_value\\n\\t\\t   from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD}  a \\t\\t/*免费资源统计日表*/\\n\\t\\t  left join dm.dim_201511002_offer_list b on a.PLAN_ID=b.offer_id group by a.PHONE_NO) d \\n\\ton a.PHONE_NO=d.PHONE_NO\\nleft join (select phone_no,chl_id,chl_name,valid_active_time from gbasedwi.dwi_res_nac_code_num_dt_${dayid} group by phone_no,chl_id,chl_name,VALID_ACTIVE_TIME)  e on a.phone_no=e.phone_no\\t\\nleft join (select distinct phone_no from gbasemsm.msm_dw_basekpi_110510_detail_${dayid} \\n\\t ) f on a.phone_no=f.phone_no\\t\\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG  =1;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [184]-[index:298]-[2013年9月日累计新增加指标]-[194]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"194.创建临时表 一 201811","nodeId":"194","sql":"##删除表\\ndrop table dm.tmp_20130916_stop_${dayid};\\n##创建临时表\\ncreate table dm.tmp_20130916_stop_${dayid}\\n(\\nuser_id varchar(50),\\nis_ststop bigint, -- 是否申停\\nis_kfstop bigint, -- 是否客服停机\\nis_yffstop bigint, -- 是否预付费申停停机\\nis_blxxstop bigint, -- 是否不良信息停机\\nis_hhstop bigint,-- 是否黑户停机\\nis_realstop bigint-- 是否实名登记停机\\t\\n)distributed by ('user_id');\\n##插入数据\\ninsert into dm.tmp_20130916_stop_${dayid}\\nselect user_id,\\n       max(case when substr(os_status,1,1)=1 then 1 else 0 end) as is_ststop , -- 是否申停\\n       max(case when substr(os_status,2,1)=1 then 1 else 0 end) as is_kfstop , -- 是否客服停机\\n       max(case when substr(os_status,36,1)=1 then 1 else 0 end) as is_yffstop , -- 是否预付费申停停机\\n       max(case when substr(os_status,25,1)=1 then 1 else 0 end) as is_blxxstop , -- 是否不良信息停机\\n       max(case when substr(os_status,3,1)=1 or substr(os_status,33,1)=1 then 1 else 0 end) as is_hhstop ,-- 是否黑户停机\\n       max(case when substr(os_status,30,1)=1 then 1 else 0 end) as is_realstop -- 是否实名登记停机\\t\\nfrom (\\n      select user_id,os_status from gbaseods.ods_d_f_crm_01541_ins_user_os_state_d_${dayid}\\n      union all \\n      select user_id,os_status from gbaseods.ods_d_f_crm_01541_ins_user_os_state_w_${dayid}\\n     ) a \\ngroup by user_id ;\\n#########################################################################################################################\\n####删除表\\ndrop table dm.tmp_20130916_realname1_${dayid};\\n####创建表\\ncreate table dm.tmp_20130916_realname1_${dayid}\\n(\\nphone_no varchar(50),\\ndengji_chl_name varchar(50), -- 登记渠道名称\\ndone_datetime varchar(50), -- 停机时间\\nuser_type varchar(50) -- 用户类型（实名口径）\\n)distributed by ('phone_no');\\ninsert into dm.tmp_20130916_realname1_${dayid}\\nselect a.phone_no,\\n       b.dengji_chl_name, -- 登记渠道名称\\n       c.done_datetime, -- 停机时间\\n       b.user_type   -- 用户类型（实名口径）\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a \\nleft join (\\n   select  distinct a.phone_no,a.user_type,\\n\\t              nvl(g.org_chl_short_name ,h.oper_chel_name) as dengji_chl_name  -- 登记渠道名称\\n           from gbasedwi.DWI_USR_PESN_REALNAME_ent_DS_${dayid}  a \\n\\t\\t  left join (select a.phone_no,a.CHL_AGNT_CODE,a.CREATE_OPER_ID from (select phone_no,CHL_AGNT_CODE,CREATE_OPER_ID,\\n\\t\\t\\t               row_number() over(partition by phone_no order by CREATE_DATE ASC) rn \\n\\t\\t\\t           from gbasedwd.dwd_svc_usr_realname_ds_${dayid}) a\\n\\t\\t\\t             where a.rn=1) f on a.phone_no=f.phone_no\\n        left join (select distinct staff_id,oper_chl_id,oper_chel_name \\n\\t\\t      from gbasedwd.dim_chl_operator_ds_${dayid}) h  -- 20190531 用28日表出29日的这个指标 29 30 两天的数据异常\\n\\t\\ton f.CREATE_OPER_ID=h.staff_id\\n        left join (select distinct org_chl_code, ORG_CHL_SHORT_NAME from \\n                    gbasedwd.dwd_prty_chl_orgchl_ds_${dayid}) g on f.CHL_AGNT_CODE=g.org_chl_code \\n\\t\\t) b on a.phone_no=b.phone_no\\nleft join ( \\n          select distinct user_Id,done_datetime\\n\\t\\t  from (\\n\\t\\t        select user_Id,done_datetime from gbaseods.ods_d_f_crm_01541_ins_user_os_state_d_${dayid}\\n                union all \\n                select user_Id,done_datetime from gbaseods.ods_d_f_crm_01541_ins_user_os_state_w_${dayid}\\n\\t\\t       ) a \\n\\t\\t  ) c on a.user_id=c.user_id   ;\\n\\ndrop table dm.tmp_20130916_realname_${dayid};\\ncreate table dm.tmp_20130916_realname_${dayid}  distributed by ('phone_no')\\nselect phone_no,dengji_chl_name,done_datetime,user_type\\nfrom (select *,row_number()over(partition by phone_no order by dengji_chl_name)rn\\nfrom dm.tmp_20130916_realname1_${dayid}\\n)a where rn=1\\n;\\n######################################################################################################\\n\\n##删除表\\n drop table dm.tmp_20130916_real_${dayid};\\n ##创建表\\n create table dm.tmp_20130916_real_${dayid}\\n (\\n      phone_no varchar(50),\\n      isbxl_arriveuse bigint, -- 是否不限量套餐到达用户\\n\\t  mgsp_flow_m bigint, -- 咪咕视频流量（MB)\\n\\t  ysj_flow_m bigint, -- 云视界流量（MB）\\n\\t  is_onetofive bigint, -- 一证N号标识\\n\\t  is_ststop bigint, -- 是否申停\\n\\t  is_kfstop  bigint, -- 是否客服停机\\n\\t  is_yffstop bigint, -- 是否预付费申停停机\\n\\t  is_blxxstop bigint, -- 是否不良信息停机\\n\\t  is_hhstop bigint,-- 是否黑户停机\\n\\t  is_realstop bigint,-- 是否实名登记停机\\n\\t  dengji_chl_name varchar(100), -- 实名登记渠道\\n\\t  done_datetime date, -- 停机时间\\n      use_type_real varchar(20)  -- 用户类型（实名口径）\\n )distributed by('phone_no');     \\n ##插入数据\\ninsert into dm.tmp_20130916_real_${dayid}\\nselect a.phone_no,\\n       case when b.phone_no is not null then 1 else 0 end isbxl_arriveuse, -- 是否不限量套餐到达用户\\n\\t   c.mgsp_flow_m, -- 咪咕视频流量（MB)\\n\\t   c.ysj_flow_m, -- 云视界流量（MB）\\n\\t   d.is_onetofive, -- 一证N号标识\\n\\t   e.is_ststop , -- 是否申停\\n\\t   e.is_kfstop , -- 是否客服停机\\n\\t   e.is_yffstop , -- 是否预付费申停停机\\n\\t   e.is_blxxstop , -- 是否不良信息停机\\n\\t   e.is_hhstop ,-- 是否黑户停机\\n\\t   e.is_realstop,-- 是否实名登记停机  \\n\\t   f.dengji_chl_name, -- 实名登记渠道\\n\\t   f.done_datetime, -- 停机时间\\n       f.user_type   -- 用户类型（实名口径）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a   \\nleft join (select distinct phone_No from gbasemsm.msm_st_basekpi_110631_detail_${dayid}) b on a.phone_no=b.phone_no\\nleft join (select phone_no,\\n       sum(case when b.service_id in ('1750000006','1030000006') then a.total_flow_m else 0 end) mgsp_flow_m, -- 咪咕视频流量（MB)\\n       sum(case when b.service_id='1750100001' then a.total_flow_m else 0 end) ysj_flow_m -- 云视界流量（MB）\\n         from ( select phone_no,Content_bill_id,sum(total_flow)/1024/1024 total_flow_M \\n                from gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${monthid} where stat_date<='${day_id}'\\n         group by phone_no,Content_bill_id ) a  \\n          left join dm.dim_serviceid_type b on a.Content_bill_id=b.Service_id\\n            group by phone_no) c on a.phone_no=c.phone_no\\nleft join (select distinct phone_No,is_onetofive from gbasedwi.dwi_usr_pesn_realname_ent_ds_${dayid}) d on a.phone_no=d.phone_no\\nleft join dm.tmp_20130916_stop_${dayid} e on a.user_id=e.user_id    \\nleft join dm.tmp_20130916_realname_${dayid} f on a.phone_no=f.phone_no\\nwhere a.PROD_KIND_CODE='171000000001' And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1);\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [185]-[index:301]-[2013年9月日累计新增加指标]-[83]-['str' object has no attribute 'lfind']:{"name":"创建临时表4","nodeId":"83","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_04;\\nCREATE TABLE TMP_DM_20130916_04\\n(   PRODUCT_NO          VARCHAR(20) ,\\n    ACCT_ID             VARCHAR(20),\\n    CYCLE_DATE          INTEGER     ,\\n    OWE_FEE             DECIMAL(16,2)   ,\\n    OWE_MONTH\\t        INTEGER     )    \\n\\tDISTRIBUTED BY ('PRODUCT_NO') nolock;\\t","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [186]-[index:302]-[2013年9月日累计新增加指标]-[95]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"95.创建临时表7","nodeId":"95","sql":"DROP TABLE TMP_DM_20130916_07;\\nCREATE TABLE TMP_DM_20130916_07\\n( PRODUCT_NO                VARCHAR(20),\\n  IS_2016STOCK_USER_ACT     VARCHAR(20),\\n  IS_2016ENTER_USER_ACT     VARCHAR(20),\\n  GPRS_DIRECT_FEE           DECIMAL(12,2),\\n  INCALL_DAY                INTEGER,\\n  GIVE_LOCAL_TOTAL          BIGINT,\\n  GIVE_LOCAL_4G_TOTAL       BIGINT,\\n  GIVE_USED_VALUE           BIGINT,\\n  IS_2016STOCK_USER         BIGINT,\\n  IS_2016ENTER_USER         BIGINT,\\n  IS_2017STOCK_USER         BIGINT,\\n  IS_2017ALLNET_USER        BIGINT,\\n  IS_2017STOCK_USER_ACT     BIGINT,\\n  IS_2017ALLNET_USER_ACT  \\tBIGINT,\\n  IS_2017ENTER_USER         BIGINT,\\n  IS_2017ENTER_USER_ACT\\t    BIGINT,\\n  IS_INTERNET_THINGS        BIGINT,\\n  IS_2018STOCK_USER         BIGINT,\\n  CHL_ID                    VARCHAR(3),\\n  GROUP_CUST_LEVEL          VARCHAR(2),\\n  lvl_name                  VARCHAR(20),\\n  GRP_NAME                  VARCHAR(300),\\n  GRP_STATE_ID              smallint\\n) DISTRIBUTED BY ('PRODUCT_NO');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [187]-[index:303]-[2013年9月日累计新增加指标]-[79]-['str' object has no attribute 'lfind']:{"name":"创建临时表3","nodeId":"79","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_03;\\nCREATE TABLE TMP_DM_20130916_03\\n(   PRODUCT_NO               VARCHAR(20) ,\\n    WLAN_GPRS                BIGINT      ,\\n\\tWLANPC_GPRS              BIGINT      ,\\n\\tIS_SCHOOL_USER           SMALLINT    ,\\n\\tIMEI_COUNT               INTEGER     ,\\n\\tGPRS_TNET_TOTAL_FLOW     BIGINT,\\nGPRS_NO_BILLING    BIGINT     ,\\n\\tGPRS_BILLING       BIGINT     ,\\n    TOTAL_FEE\\t       DECIMAL(13,3)    )    DISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [188]-[index:306]-[2013年9月日累计新增加指标]-[97]-['str' object has no attribute 'lfind']:{"name":"97.创建临时表8","nodeId":"97","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_08;\\nCREATE TABLE TMP_DM_20130916_08\\n      ( PRODUCT_NO                     VARCHAR(20) ,\\n        OFFER_CHOICE_PACKAGE           BIGINT      ,\\n        OFFER_PLAN_FEE                 BIGINT      ,\\n        OFFER_CHOICE_PACKAGE_USED      BIGINT      ,\\n        OFFER_PLAN_FEE_USED            BIGINT      ,\\n        IDEN_NAME                      VARCHAR(200) ,\\n        PARTY_IDEN_ID                  VARCHAR(200) ,\\n        PROD_IDEN                      VARCHAR(100) ,\\n        CUST                           SMALLINT     ,\\n        JINGBAN                        SMALLINT     ,\\n        IS_USE_LEGAL                   BIGINT       ,\\n        IS_RES_LEGAL                   BIGINT       ,\\n        ENTERPRISE_MARK                VARCHAR(30)  ,\\n        DEPT_NAME                      VARCHAR(30)  ,\\n\\t\\tOFFER_4G_PACKAGE_S\\t\\t\\t   BIGINT       ,\\n\\t\\tOFFER_4G_PACKAGE_USED          BIGINT       ,\\n\\t\\tOFFER_4G_SATUR                 DECIMAL(20,3),\\n\\t\\tOFFER_4G_SHARE_PACKAGE         BIGINT       ,\\n\\t\\tOFFER_4G_SHARE_PACKAGE_USED    BIGINT       ,\\n\\t\\tOFFER_4G_MAIN_PACKAGE          BIGINT       ,\\n\\t\\tOFFER_4G_MAIN_PACKAGE_USED     BIGINT       ,\\n\\t\\tOFFER_4G_MAIN_SATUR            DECIMAL(20,3),\\n\\t\\tOFFER_MAIN_GPRS_SATUR          DECIMAL(20,3),\\n\\t\\tOFFER_ALL_GPRS_SATUR\\t\\t   DECIMAL(20,3),\\n        RESOURCE_RESIDUAL_RATE         DECIMAL(20,3),\\n        NORMAL_TOTUSE_RES_NUM          BIGINT,\\n        NORMAL_USE_RES_NUM             BIGINT\\t\\n)  DISTRIBUTED BY ('PRODUCT_NO') nolock;\\n##2018/10/25添加\\n###饱和度-主要流量资源\\n##删除表\\ndrop table dm.tmp_offer_main_gprs_${dayid};\\n#创建表\\ncreate table dm.tmp_offer_main_gprs_${dayid}\\n(\\nphone_no varchar(20),\\nmain_gprs_resource_bhd decimal(10,4)   \\n)distributed by ('phone_no');\\n#插入数据\\ninsert into dm.tmp_offer_main_gprs_${dayid}\\nselect a.phone_no,\\n       b.USE_RES_NUM/b.TOTAL_RES_NUM main_gprs_resource_bhd-- 饱和度主要流量资源\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a   \\nleft join ( \\n          select phone_no,\\n                 sum(case when b.item_code is not null then a.FREE_RES_USE_NUM else 0 end) USE_RES_NUM,\\n                 sum(case when b.item_code is not null then a.FREE_RES_TOTAL_NUM else 0 end) TOTAL_RES_NUM\\n         from gbasedwd.${table_name.name1} a\\n         left join (\\n                    select item_code from dm.dim_pub_freeres_item_code group by item_code\\n                   ) b on a.item_code=b.item_code\\n\\t    where a.boss_prod_id<>'54001105' -- 限速服务\\n         group by a.phone_no\\n\\t\\t ) b on a.phone_no=b.phone_no\\nwhere a.PROD_KIND_CODE='171000000001'  And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1);\\n\\n\\n\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [189]-[index:307]-[2013年9月日累计新增加指标]-[99]-['str' object has no attribute 'lfind']:{"name":"99.创建临时表9","nodeId":"99","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_09;\\nCREATE TABLE TMP_DM_20130916_09\\n(PRODUCT_NO        VARCHAR(20) ,\\n  IS_NET_PLAY       SMALLINT    ,\\n\\tIS_OFFER_4G       SMALLINT    ,\\n\\tODD_TOTAL_VALUE   BIGINT      ,\\n\\tODD_USED_VALUE    BIGINT      ,\\n\\tchl_id            varchar(50),\\n\\tCHL_NAME          VARCHAR(100),\\n\\tVALID_ACTIVE_TIME DATETIME    ,\\n\\tIS_50UP_PACKAGE   SMALLINT\\n\\t)  DISTRIBUTED BY ('PRODUCT_NO');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [190]-[index:308]-[2013年9月日累计新增加指标]-[163]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"163.创建目标表","nodeId":"163","sql":"drop table dm.dm_pub_20130916_${dayid};\\nCREATE TABLE dm.dm_pub_20130916_${dayid}\\n(\\n  OP_TIME               date,\\n  STATIS_DATE           bigint(20),\\n  PRODUCT_NO            varchar(20),\\n  CALL_TOTAL_PROPORTION decimal(20,3),\\n  MESSAGE_TOTAL_PROPORTION decimal(20,3),\\n  GPRS_TOTAL_PROPORTION    decimal(20,3),\\n  GPRS_NO_BILLING   bigint(20),\\n  GPRS_BILLING      bigint(20),\\n  TOTAL_FEE         decimal(13,3),\\n  WLAN_GPRS         bigint(20),\\n  WLANPC_GPRS       bigint(20),\\n  IS_SCHOOL_USER    smallint(6),\\n  IMEI_COUNT        int(11),\\n  GPRS_TNET_TOTAL_FLOW bigint(20),\\n  CYCLE_DATE int(11),\\n  OWE_FEE decimal(16,2),\\n  OWE_MONTH         int(11),\\n  #DAY_FEE          decimal(16,2),\\n  day_last1_fee     decimal(16,2),\\n  day_last2_fee     decimal(16,2),\\n  day_last3_fee     decimal(16,2),\\n  gprs_fee          decimal(16,2),\\n  gprs_amount       decimal(16,2),\\n  gprs_wlan_amount  decimal(16,2),\\n  gprs_last1_fee    decimal(16,2),\\n  gprs_last1_amount decimal(16,2),\\n  GPRS_WLANLAST1_AMOUNT decimal(16,2),\\n  gprs_monthly_fee      decimal(12,2), -- 流量出账-月租费\\n  gprs_gasbag_fee       decimal(12,2), -- 流量出账-加油包费\\n  gprs_flow_fee         decimal(12,2), -- 流量出账-流量费\\n  gprs_wlan_fee         decimal(12,2), -- 流量出账-WLAN\\n  gprs_yearhalfyear_fee decimal(12,2), -- 流量出账-年包半年包\\n  gprs_quarter_fee      decimal(12,2), -- 流量出账-季包\\n  gprs_payment_fee      decimal(12,2), -- 流量出账-流量统付\\n  gprs_direct_fee       decimal(12,2), -- 流量出账-流量直充\\n  gprs_infinite_fee     decimal(12,2), -- 流量出账-不限量\\n  gprs_personality_fee  decimal(12,2), -- 流量出账-个性化\\n  gprs_national_fee     decimal(12,2), -- 流量出账-国漫套餐\\n  gprs_unified_fee      decimal(12,2), -- 流量出账-统付\\n  day_fee               decimal(12,2), -- 流量出账\\n  OFFER_BRACKET bigint,\\n  USER_4GNET_FLAG smallint(6),\\n  IS_2016STOCK_USER_ACT varchar(20),\\n  IS_2016ENTER_USER_ACT varchar(20),\\n  #GPRS_DIRECT_FEE decimal(12,2),\\n  INCALL_DAY int(11),\\n  GIVE_LOCAL_TOTAL bigint(20),\\n  GIVE_LOCAL_4G_TOTAL bigint(20),\\n  GIVE_USED_VALUE bigint(20),\\n  OFFER_CHOICE_PACKAGE bigint(20),\\n  OFFER_PLAN_FEE bigint(20),\\n  IDEN_NAME varchar(200),\\n  PARTY_IDEN_ID varchar(200),\\n  PROD_IDEN varchar(200),\\n  CUST smallint(6),\\n  JINGBAN smallint(6),\\n  IS_2016STOCK_USER bigint(20),\\n  IS_2016ENTER_USER bigint(20),\\n  IS_USE_LEGAL bigint(20),\\n  IS_RES_LEGAL bigint(20),\\n  ENTERPRISE_MARK varchar(30),\\n  DEPT_NAME varchar(30),\\n  OFFER_CHOICE_PACKAGE_USED bigint(20),\\n  OFFER_PLAN_FEE_USED bigint(20),\\n  IS_NET_PLAY smallint(6),\\n  IS_OFFER_4G smallint(6),\\n  ODD_TOTAL_VALUE bigint(20),\\n  ODD_USED_VALUE bigint(20),\\n  GPRS_ACCT_FEE decimal(20,4),\\n  IS_UNIFIED_PACKAGE smallint(6),\\n  NORMAL_TOTAL_VALUE bigint(20),\\n  NORMAL_USED_VALUE bigint(20),\\n  ACTIVE_DAYS_4G smallint(6),\\n  GPRS_ACCT_FEE_LAST1 decimal(12,2),\\n  #GPRS_PAYMENT_FEE decimal(12,2),\\n  OFFER_4G_PACKAGE_S bigint(20),\\n  OFFER_4G_PACKAGE_USED bigint(20),\\n  OFFER_4G_SATUR decimal(20,3),\\n  OFFER_4G_SHARE_PACKAGE bigint(20),\\n  OFFER_4G_SHARE_PACKAGE_USED bigint(20),\\n  OFFER_4G_MAIN_PACKAGE bigint(20),\\n  OFFER_4G_MAIN_PACKAGE_USED bigint(20),\\n  OFFER_4G_MAIN_SATUR decimal(20,3),\\n  OFFER_MAIN_GPRS_SATUR decimal(20,3),\\n  OFFER_ALL_GPRS_SATUR decimal(20,3),\\n  IS_YIJING_ACCT_USER smallint(6),\\n  IS_2017STOCK_USER bigint(20),\\n  IS_2017ALLNET_USER bigint(20),\\n  IS_2017STOCK_USER_ACT bigint(20),\\n  IS_2017ALLNET_USER_ACT bigint(20),\\n  IS_2017ENTER_USER bigint(20),\\n  RESOURCE_RESIDUAL_RATE decimal(20,3),\\n  NORMAL_TOTUSE_RES_NUM bigint(20),\\n  NORMAL_USE_RES_NUM bigint(20),\\n  IS_2017ENTER_USER_ACT bigint(20),\\n  IS_ZHENGQI_PACKAGE smallint(6),\\n  IS_UNIFIED_ZHENGQI smallint(6),\\n  CO_COUNTY_ID varchar(10),\\n  IS_INTERNET_THINGS bigint(20),\\n  CHL_NAME varchar(100),\\n  VALID_ACTIVE_TIME datetime,\\n  IS_50UP_PACKAGE smallint(6),\\n  LAST_OFFER_BRACKET bigint,\\n  IS_4SIM_USER smallint(6),\\n  CHL_TYPE varchar(50),\\n  OFFER_GPRS_PACKAGE bigint(20),\\n  LAST_OFFER_GPRS_PACKAGE bigint(20),\\n  chl_lvl           varchar(50), \\n\\tsend_card_brand   varchar(500),\\n\\tIS_2018STOCK_USER    BIGINT,\\n  chl_id               varchar(3),\\n  group_cust_level     varchar(2),\\n  grp_name             varchar(300),\\n  grp_state_id         smallint,\\n\\tplan_monthly_fee     decimal(16,2),\\n\\taccount_balance      decimal(12,3),\\n  is_acct_user         smallint,\\n  is_4gpuls            smallint,      -- 是否4G+终端用户\\n  is_comm_user         smallint,      -- 是否为通信客户（不含物联网）\\n  chl_id1              varchar(50),   -- 渠道编码\\n  roamout_fee          decimal(12,2), -- 国漫出访费用（含国漫套餐包）\\n  roamout_packflow_fee decimal(12,2), -- 国漫出访流量费用（含套餐包）\\n  roam_pack_fee        decimal(12,2), -- 国漫套餐包费用\\n  roamout_flow_fee     decimal(12,2), -- 国漫出访流量费用（不含套餐包）\\n  roamout_call_fee     decimal(12,2), -- 国漫出访话音费用\\n  roamout_sms_fee      decimal(12,2),  -- 国漫出访短信费用\\n  last_note            varchar(4000),   -- 最新公共注释\\n  cx_offer_name varchar(50),\\n  cx_offer_level bigint(21),\\n  bxl_offer_bhd decimal(46,4),\\n  sms_CXLL_cnt decimal(23,0),\\n  sms_CXYL_cnt decimal(23,0),\\n  mt_should_income decimal(54,2),\\n  call_days int,\\n  IS_4GNET_user_kaohe int,\\n  IS_offer_user int,\\n  county_id int,\\n  net_age decimal(30,1),\\n  CUST_LEVEL int,\\n  sex varchar(10),\\n  dx_gprs_resource_bhd decimal(10,4), #饱和度-定向流量资源\\n  bxl_gprs_resource_bhd decimal(10,4), #饱和度-不限量产品 \\n  isbxl_arriveuse bigint, -- 是否不限量套餐到达用户  ##以下20181130日添加\\n mgsp_flow_m bigint, -- 咪咕视频流量（MB)\\nysj_flow_m bigint, -- 云视界流量（MB）\\nis_onetofive bigint, -- 一证N号标识   \\nis_ststop bigint, -- 是否申停\\nis_kfstop  bigint, -- 是否客服停机\\nis_yffstop bigint, -- 是否预付费申停停机\\nis_blxxstop bigint, -- 是否不良信息停机     \\nis_hhstop bigint,-- 是否黑户停机\\nis_realstop bigint,-- 是否实名登记停机\\ndengji_chl_name varchar(100), -- 实名登记渠道\\ndone_datetime varchar(20), -- 停机时间\\nuse_type_real varchar(20),  -- 用户类型（实名口径）\\nlvl_name   varchar(20)\\n) distributed by ('product_no');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [191]-[index:309]-[2013年9月日累计新增加指标]-[92]-['str' object has no attribute 'lfind']:{"name":"92.插入临时表6","nodeId":"92","dsName":"GbaseDM","sql":"insert into tmp_dm_20130916_06\\n (  product_no             ,\\n    gprs_monthly_fee,     -- 流量出账-月租费\\n    gprs_gasbag_fee,      -- 流量出账-加油包费\\n    gprs_flow_fee,        -- 流量出账-流量费\\n    gprs_wlan_fee,        -- 流量出账-WLAN\\n    gprs_yearhalfyear_fee,-- 流量出账-年包半年包\\n    gprs_quarter_fee,     -- 流量出账-季包\\n    gprs_payment_fee,     -- 流量出账-流量统付\\n    gprs_direct_fee,      -- 流量出账-流量直充\\n    gprs_infinite_fee,    -- 流量出账-不限量\\n    gprs_personality_fee, -- 流量出账-个性化\\n    gprs_national_fee,    -- 流量出账-国漫套餐\\n    gprs_unified_fee ,    -- 流量出账-统付\\n    day_fee,              -- 流量出账    \\n    user_4gnet_flag  ,\\n    offer_bracket    ,\\n    last_offer_bracket\\t)\\nselect\\n    a.phone_no,\\n\\t\\tnvl(gprs_monthly_fee    ,0), -- 流量出账-月租费\\n    nvl(gprs_gasbag_fee     ,0), -- 流量出账-加油包费\\n    nvl(gprs_flow_fee       ,0), -- 流量出账-流量费\\n    nvl(gprs_wlan_fee       ,0), -- 流量出账-WLAN\\n    nvl(gprs_yearhalfyear_fee,0), -- 流量出账-年包半年包\\n    nvl(gprs_quarter_fee    ,0), -- 流量出账-季包\\n    nvl(gprs_payment_fee    ,0), -- 流量出账-流量统付\\n    nvl(gprs_direct_fee     ,0), -- 流量出账-流量直充\\n    nvl(gprs_infinite_fee   ,0), -- 流量出账-不限量\\n    nvl(gprs_personality_fee,0), -- 流量出账-个性化\\n    nvl(gprs_national_fee   ,0), -- 流量出账-国漫套餐\\n    nvl(gprs_unified_fee    ,0), -- 流量出账-统付\\n    nvl(day_fee             ,0), -- 流量出账    \\n\\t\\tcase when e.phone_no is null then 0 else 1 end as user_4gnet_flag,       /*是否4G网络客户*/\\n      nvl(c.offer_bracket,0) as offer_bracket,             /*4G主套餐档位*/\\n\\t  nvl(d.offer_bracket,0) as last_offer_bracket         /*4G主套餐档位(上月)*/\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a        /*用户资料小表日表 */\\nleft join (select\\n               phone_no,\\n\\t\\t\\t\\t       sum(case when acct_type='月租费'     then mt_should_income else 0 end) as gprs_monthly_fee,     -- 流量出账-月租费\\n               sum(case when acct_type='加油包费'   then mt_should_income else 0 end) as gprs_gasbag_fee,      -- 流量出账-加油包费\\n               sum(case when acct_type='流量费'     then mt_should_income else 0 end) as gprs_flow_fee,        -- 流量出账-流量费\\n               sum(case when acct_type='WLAN'       then mt_should_income else 0 end) as gprs_wlan_fee,        -- 流量出账-WLAN\\n               sum(case when acct_type='年包半年包' then mt_should_income else 0 end) as gprs_yearhalfyear_fee,-- 流量出账-年包半年包\\n               sum(case when acct_type='季包'       then mt_should_income else 0 end) as gprs_quarter_fee,     -- 流量出账-季包\\n               sum(case when acct_type='流量统付'   then mt_should_income else 0 end) as gprs_payment_fee,     -- 流量出账-流量统付\\n               sum(case when acct_type='流量直充'   then mt_should_income else 0 end) as gprs_direct_fee,      -- 流量出账-流量直充\\n               sum(case when acct_type='不限量'     then mt_should_income else 0 end) as gprs_infinite_fee,    -- 流量出账-不限量\\n               sum(case when acct_type='个性化'     then mt_should_income else 0 end) as gprs_personality_fee, -- 流量出账-个性化\\n               sum(case when acct_type='国漫套餐'   then mt_should_income else 0 end) as gprs_national_fee,    -- 流量出账-国漫套餐\\n               sum(case when acct_type='统付'       then mt_should_income else 0 end) as gprs_unified_fee,     -- 流量出账-统付\\n               sum(mt_should_income) as day_fee  -- 流量出账\\n\\t\\t\\t\\t     from gbasedwi.dwi_inco_bill_item_tot_ds_${dayid} a    /*综合账单明细日汇总日表*/\\n\\t\\t        inner join dm.dim_account_list b on a.acct_item_id=b.acct_item_id\\n\\t\\t        group by phone_no) b  on  a.phone_no=b.phone_no\\nleft join (select  phone_no,offer_bracket from(\\n\\t\\t   select a.phone_no,\\n\\t\\t          b.offer_bracket,\\n\\t\\t          a.create_time,\\n\\t\\t          row_number() over(partition by a.phone_no order by create_time) rn\\n\\t\\t   from gbasedwi.dwi_inst_offer_plan_ds_${dayid}  a   /*资产订购信息表日表*/\\n\\t\\t   inner join dm.dim_pub_offer_4g_bracket  b  on a.PLAN_ID=b.offer_id\\n\\t\\t   where a.cur_cycle_state<>104 and b.offer_type='主套餐' and a.eff_time<>a.exp_time) a where rn=1) c\\n\\ton a.phone_no=c.phone_no\\nleft join gbasemsm.msm_dw_basekpi_4g_user_${dayid} e on a.phone_no=e.phone_no\\nleft join (select  phone_no,offer_bracket from(\\n\\t\\t   select a.phone_no,\\n\\t\\t          b.offer_bracket,\\n\\t\\t          a.create_time,\\n\\t\\t          row_number() over(partition by a.phone_no order by create_time) rn\\n\\t\\t   from gbasedwi.dwi_inst_offer_plan_ms_${pmonthid}  a   /*资产订购信息表日表*/\\n\\t\\t   inner join dm.dim_pub_offer_4g_bracket  b  on a.PLAN_ID=b.offer_id\\n\\t\\t   where a.cur_cycle_state<>104 and b.offer_type='主套餐' and a.eff_time<>a.exp_time) a where rn=1 ) d\\n\\ton a.phone_no=d.phone_no\\nwhere (a.month_arrive_flag=1 and a.prod_kind_code= 171000000001) or a.month_off_flag  =1;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [192]-[index:310]-[2013年9月日累计新增加指标]-[203]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"203.创建临时表","nodeId":"203","sql":"####删除表\\ndrop table dm.tmp_20130916_note_${dayid};\\n####创建表\\ncreate table dm.tmp_20130916_note_${dayid}     \\n(\\nbill_id varchar(50),\\nnote varchar(4000)\\n)distributed by ('bill_id');\\n####插入数据\\ninsert into dm.tmp_20130916_note_${dayid}\\nselect bill_id,\\n       note \\nfrom ( select bill_id,\\n                note,\\n\\t       done_date,\\n\\t   row_number() over(partition by bill_id order by done_date desc) rn \\n      from (\\n\\t         select bill_id,note,done_date,note_type,EXPIRE_DATE from gbaseods.ods_d_f_crm_10005_insx_share_notes_d_${dayid}\\n             union all\\n             select bill_id,note,done_date,note_type,EXPIRE_DATE from gbaseods.ods_d_f_crm_10005_insx_share_notes_w_${dayid}\\n\\t\\t  )  a\\n\\t  where a.note_type='注释' and EXPIRE_DATE>='${day_id}'\\n\\t  ) e where e.rn=1 "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [193]-[index:311]-[2013年9月日累计新增加指标]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"8.插入目标表数据","nodeId":"8","sql":"insert into ${DM_PUB_20130916_YYYYMMDD}\\n   ( OP_TIME,\\n     STATIS_DATE,\\n     PRODUCT_NO,\\n     CALL_TOTAL_PROPORTION,\\n     MESSAGE_TOTAL_PROPORTION,\\n     GPRS_TOTAL_PROPORTION,\\n     GPRS_NO_BILLING,\\n     GPRS_BILLING,\\n     TOTAL_FEE,\\n     WLAN_GPRS,\\n     WLANPC_GPRS,\\n     IS_SCHOOL_USER,\\n     IMEI_COUNT,\\n     GPRS_TNET_TOTAL_FLOW,\\n     CYCLE_DATE,\\n     OWE_FEE,\\n     OWE_MONTH,\\n     #DAY_FEE,\\n     DAY_LAST1_FEE,\\n     DAY_LAST2_FEE,\\n     DAY_LAST3_FEE,\\n     GPRS_FEE,\\n     GPRS_AMOUNT,\\n     GPRS_WLAN_AMOUNT,\\n     GPRS_LAST1_FEE,\\n     GPRS_LAST1_AMOUNT,\\n     GPRS_WLANLAST1_AMOUNT,\\n     gprs_monthly_fee,     -- 流量出账-月租费\\n     gprs_gasbag_fee,      -- 流量出账-加油包费\\n     gprs_flow_fee,        -- 流量出账-流量费\\n     gprs_wlan_fee,        -- 流量出账-WLAN\\n     gprs_yearhalfyear_fee,-- 流量出账-年包半年包\\n     gprs_quarter_fee,     -- 流量出账-季包\\n     gprs_payment_fee,     -- 流量出账-流量统付\\n     gprs_direct_fee,      -- 流量出账-流量直充\\n     gprs_infinite_fee,    -- 流量出账-不限量\\n     gprs_personality_fee, -- 流量出账-个性化\\n     gprs_national_fee,    -- 流量出账-国漫套餐\\n     gprs_unified_fee ,    -- 流量出账-统付\\n     day_fee,              -- 流量出账\\n     OFFER_BRACKET,\\n     USER_4GNET_FLAG,\\n     IS_2016STOCK_USER_ACT,\\n     IS_2016ENTER_USER_ACT,\\n     #GPRS_DIRECT_FEE,\\n     INCALL_DAY,\\n     GIVE_LOCAL_TOTAL,\\n     GIVE_LOCAL_4G_TOTAL,\\n     GIVE_USED_VALUE,\\n     OFFER_CHOICE_PACKAGE,\\n     OFFER_PLAN_FEE,\\n     IDEN_NAME,\\n     PARTY_IDEN_ID,\\n     PROD_IDEN,\\n     CUST,\\n     JINGBAN,\\n     IS_2016STOCK_USER,\\n     IS_2016ENTER_USER,\\n     IS_USE_LEGAL,\\n     IS_RES_LEGAL,\\n     ENTERPRISE_MARK,\\n     DEPT_NAME,\\n     OFFER_CHOICE_PACKAGE_USED,\\n     OFFER_PLAN_FEE_USED,\\n     IS_NET_PLAY,\\n     IS_OFFER_4G,\\n     ODD_TOTAL_VALUE,\\n     ODD_USED_VALUE,\\n     GPRS_ACCT_FEE ,\\n     IS_UNIFIED_PACKAGE,\\n\\t NORMAL_TOTAL_VALUE,\\n\\t NORMAL_USED_VALUE,\\n\\t ACTIVE_DAYS_4G,\\n\\t GPRS_ACCT_FEE_LAST1,\\n\\t #GPRS_PAYMENT_FEE,\\n\\t OFFER_4G_PACKAGE_S,\\n\\t OFFER_4G_PACKAGE_USED,\\n\\t OFFER_4G_SATUR,\\n\\t OFFER_4G_SHARE_PACKAGE,\\n\\t OFFER_4G_SHARE_PACKAGE_USED,\\n\\t OFFER_4G_MAIN_PACKAGE,\\n\\t OFFER_4G_MAIN_PACKAGE_USED,\\n\\t OFFER_4G_MAIN_SATUR,\\n\\t OFFER_MAIN_GPRS_SATUR,\\n\\t OFFER_ALL_GPRS_SATUR,\\n\\t IS_YIJING_ACCT_USER,\\n\\t IS_2017STOCK_USER,\\n\\t IS_2017ALLNET_USER,\\n\\t IS_2017STOCK_USER_ACT,\\n   IS_2017ALLNET_USER_ACT,\\n   IS_2017ENTER_USER,\\n\\t RESOURCE_RESIDUAL_RATE,\\n   NORMAL_TOTUSE_RES_NUM,\\n   NORMAL_USE_RES_NUM,\\n   IS_2017ENTER_USER_ACT,\\n   IS_ZHENGQI_PACKAGE,\\n   IS_UNIFIED_ZHENGQI,\\n   CO_COUNTY_ID,\\n   IS_INTERNET_THINGS,\\n   CHL_NAME,\\n   VALID_ACTIVE_TIME,\\n   IS_50UP_PACKAGE,\\n   LAST_OFFER_BRACKET,\\n   is_4sim_user,\\n   chl_type,\\n   offer_gprs_package,\\n   last_offer_gprs_package,\\n   chl_lvl,\\n   send_card_brand,\\n   is_2018stock_user,\\n   chl_id,\\n   group_cust_level,\\n   grp_name,\\n   GRP_STATE_ID,\\n   PLAN_MONTHLY_FEE,\\n   account_balance, -- 账户余额\\n   is_acct_user,    -- 是否为出账客户（不含物联网）\\n   is_4gpuls,       -- 是否4G+终端用户               \\n   is_comm_user,    -- 是否为通信客户（不含物联网）  \\n   chl_id1,         -- 渠道编码\\n   roamout_fee,            -- 国漫出访费用（含国漫套餐包）\\n   roamout_packflow_fee,   -- 国漫出访流量费用（含套餐包）\\n   roam_pack_fee,          -- 国漫套餐包费用\\n   roamout_flow_fee,       -- 国漫出访流量费用（不含套餐包）\\n   roamout_call_fee,       -- 国漫出访话音费用\\n   roamout_sms_fee,\\t       -- 国漫出访短信费用    \\n   last_note ,              -- 最新公共注释\\n   cx_offer_name ,\\n  cx_offer_level,\\n bxl_offer_bhd,\\n sms_CXLL_cnt,\\n sms_CXYL_cnt ,\\n mt_should_income,\\n call_days,   -- 通话天数\\n IS_4GNET_user_kaohe,\\n IS_offer_user,\\n county_id,\\n net_age,\\n CUST_LEVEL,\\n sex,\\n dx_gprs_resource_bhd,\\n bxl_gprs_resource_bhd,\\n  isbxl_arriveuse , -- 是否不限量套餐到达用户  ##以下20181130日添加\\n mgsp_flow_m, -- 咪咕视频流量（MB)\\nysj_flow_m, -- 云视界流量（MB）\\nis_onetofive, -- 一证N号标识\\nis_ststop, -- 是否申停\\nis_kfstop, -- 是否客服停机\\nis_yffstop, -- 是否预付费申停停机\\nis_blxxstop, -- 是否不良信息停机\\nis_hhstop,-- 是否黑户停机\\nis_realstop,-- 是否实名登记停机\\ndengji_chl_name, -- 实名登记渠道\\ndone_datetime, -- 停机时间\\nuse_type_real, -- 用户类型（实名口径）\\nlvl_name\\n)\\nselect \\tdistinct \\n        '${day_id}',\\n        '${dayid}',\\n\\t\\t a.PHONE_NO,\\n\\t\\t b.CALL_TOTAL_PROPORTION,                 /*套餐语音资源使用率*/\\n\\t\\t b.MESSAGE_TOTAL_PROPORTION,              /*套餐语音资源使用率*/\\n\\t\\t b.GPRS_TOTAL_PROPORTION,                  /*套餐流量资源使用率 */\\n     d.GPRS_NO_BILLING,                        /*非计费流量*/\\n\\t\\t d.GPRS_BILLING,                           /*计费流量*/\\n\\t\\t d.TOTAL_FEE,                              /*套餐外上网费*/\\n     d.WLAN_GPRS,                              /*WLAN手机上网流量*/\\n\\t\\t d.WLANPC_GPRS,                            /*WLANPC手机上网流量*/\\n\\t\\t d.IS_SCHOOL_USER,                         /*是否校园基站用户*/\\n\\t\\t d.IMEI_COUNT,                             /*用户换机次数*/\\n\\t\\t d.GPRS_TNET_TOTAL_FLOW ,                   /*T网流量*/\\n        e.CYCLE_DATE,                              /*首次欠费月份 */\\n\\t\\t nvl(e.OWE_FEE,0),                        /*总欠费金额*/\\n\\t\\t nvl(e.OWE_MONTH,0),                       /*欠费月份数 */\\n    # f.DAY_FEE,                                /*流量出账*/\\n\\t\\t f.DAY_LAST1_FEE,\\n\\t\\t f.DAY_LAST2_FEE,\\n\\t\\t f.DAY_LAST3_FEE,\\n\\t\\t f.GPRS_FEE,\\n\\t\\t f.GPRS_AMOUNT,\\n\\t\\t f.GPRS_WLAN_AMOUNT,\\n\\t\\t f.GPRS_LAST1_FEE,\\n\\t\\t f.GPRS_LAST1_AMOUNT,\\n\\t\\t f.GPRS_WLANLAST1_AMOUNT,\\n\\t\\t g.gprs_monthly_fee,     -- 流量出账-月租费\\n     g.gprs_gasbag_fee,      -- 流量出账-加油包费\\n     g.gprs_flow_fee,        -- 流量出账-流量费\\n     g.gprs_wlan_fee,        -- 流量出账-WLAN\\n     g.gprs_yearhalfyear_fee,-- 流量出账-年包半年包\\n     g.gprs_quarter_fee,     -- 流量出账-季包\\n     g.gprs_payment_fee,     -- 流量出账-流量统付\\n     g.gprs_direct_fee,      -- 流量出账-流量直充\\n     g.gprs_infinite_fee,    -- 流量出账-不限量\\n     g.gprs_personality_fee, -- 流量出账-个性化\\n     g.gprs_national_fee,    -- 流量出账-国漫套餐\\n     g.gprs_unified_fee ,    -- 流量出账-统付\\n     g.day_fee,              -- 流量出账\\n     g.offer_bracket,\\n\\t\\t g.user_4gnet_flag,\\n\\t\\t h.IS_2016STOCK_USER_ACT,\\n\\t\\t h.IS_2016ENTER_USER_ACT,\\n\\t\\t #h.GPRS_DIRECT_FEE,\\n\\t\\t h.incall_day,\\n\\t\\t h.GIVE_LOCAL_TOTAL,\\n\\t\\t h.GIVE_LOCAL_4G_TOTAL,\\n\\t\\t h.GIVE_USED_VALUE,\\n\\t\\t i.OFFER_CHOICE_PACKAGE,\\n\\t\\t i.OFFER_PLAN_FEE,\\n\\t\\t i.IDEN_NAME,\\n\\t\\t i.PARTY_IDEN_ID,\\n\\t\\t i.PROD_IDEN,\\n\\t\\t i.CUST,\\n\\t\\t i.JINGBAN,\\n\\t\\t h.IS_2016STOCK_USER,\\n\\t\\t h.IS_2016ENTER_USER,\\n\\t\\t i.IS_USE_LEGAL,\\n\\t\\t i.IS_RES_LEGAL,\\n\\t\\t i.ENTERPRISE_MARK,\\n\\t\\t i.DEPT_NAME,\\n\\t\\t i.OFFER_CHOICE_PACKAGE_USED,\\n\\t\\t i.OFFER_PLAN_FEE_USED,\\n\\t\\t j.IS_NET_PLAY,\\n\\t\\t j.IS_OFFER_4G,\\n\\t\\t j.ODD_TOTAL_VALUE,\\n\\t\\t j.ODD_USED_VALUE,\\n\\t   k.GPRS_ACCT_FEE,\\n\\t\\t m.IS_UNIFIED_PACKAGE,\\n\\t\\tr.NORMAL_TOTAL_VALUE,\\n\\t r.NORMAL_USED_VALUE,\\n\\t r.ACTIVE_DAYS_4G,\\n\\t k.GPRS_ACCT_FEE_LAST1,\\n\\t #g.gprs_payment_fee,\\n\\t i.offer_4g_package_s,\\n\\t i.offer_4g_package_used,\\n\\t i.offer_4g_satur,\\n\\t i.offer_4g_share_package,\\n\\t i.offer_4g_share_package_used,\\n\\t i.offer_4g_main_package,\\n\\t i.offer_4g_main_package_used,\\n\\t i.offer_4g_main_satur,\\n\\t i.offer_main_gprs_satur,\\n\\t i.offer_all_gprs_satur,\\n   m.is_yijing_acct_user,\\n   h.is_2017stock_user,\\n\\t h.is_2017allnet_user,\\n\\t h.is_2017stock_user_act,\\n   h.is_2017allnet_user_act,\\n   h.is_2017enter_user,\\n\\t i.resource_residual_rate,\\n   i.normal_totuse_res_num,\\n   i.normal_use_res_num,\\n   h.is_2017enter_user_act,\\n   m.is_zhengqi_package,\\n   m.is_unified_zhengqi,\\n   m.co_county_id,\\n   h.is_internet_things,\\n   j.chl_name,\\n   j.valid_active_time\\t,\\n   j.is_50up_package\\t,\\n   g.last_offer_bracket,\\n   n.is_4sim_user,\\n   n.chl_type,\\n   n.offer_gprs_package,\\n   n.last_offer_gprs_package,\\n   n.chl_lvl,\\n   n.send_card_brand,\\n   h.is_2018stock_user,\\n   h.chl_id,\\n   h.group_cust_level,\\n   h.grp_name,\\n   h.grp_state_id,\\n   f.plan_monthly_fee,\\n   n.account_balance, -- 账户余额\\n   n.is_acct_user,    -- 是否为出账客户（不含物联网）\\n   n.is_4gpuls,       -- 是否4G+终端用户\\n   n.is_comm_user,    -- 是否为通信客户（不含物联网）\\n   j.chl_id,          -- 渠道编码\\n   f.roamout_fee,            -- 国漫出访费用（含国漫套餐包）\\n   f.roamout_packflow_fee,   -- 国漫出访流量费用（含套餐包）\\n   f.roam_pack_fee,          -- 国漫套餐包费用\\n   f.roamout_flow_fee,       -- 国漫出访流量费用（不含套餐包）\\n   f.roamout_call_fee,       -- 国漫出访话音费用\\n   f.roamout_sms_fee,\\t       -- 国漫出访短信费用\\n   q.note,                    -- 最新公共注释\\n  x.cx_offer_name ,\\n  x.cx_offer_level,\\n  x.bxl_offer_bhd,\\n  x.sms_CXLL_cnt,\\n  x.sms_CXYL_cnt ,\\n  nvl(x.mt_should_income,0),\\n  y.call_days,\\n  z.IS_4GNET_user_kaohe,\\n  z.IS_offer_user,\\n  z.county_id,\\n  o.net_age,\\n  o.CUST_LEVEL,\\n  o.sex,\\n  p.dx_gprs_resource_bhd,\\n  t2.bxl_gprs_resource_bhd,\\nt1.isbxl_arriveuse , -- 是否不限量套餐到达用户  ##以下20181130日添加\\nt1.mgsp_flow_m, -- 咪咕视频流量（MB)\\nt1.ysj_flow_m, -- 云视界流量（MB）\\nt1.is_onetofive, -- 一证N号标识\\nt1.is_ststop, -- 是否申停\\nt1.is_kfstop, -- 是否客服停机\\nt1.is_yffstop, -- 是否预付费申停停机\\nt1.is_blxxstop, -- 是否不良信息停机\\nt1.is_hhstop,-- 是否黑户停机\\nt1.is_realstop,-- 是否实名登记停机\\nt1.dengji_chl_name, -- 实名登记渠道\\nt1.done_datetime, -- 停机时间\\nt1.use_type_real, -- 用户类型（实名口径）\\nh.lvl_name\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a            /*用户资料小表日表 */\\n left join tmp_dm_20130916_01 b on a.PHONE_NO = b.product_no\\n /*left join tmp_dm_20130916_02 c on a.PHONE_NO = c.product_no*/\\n left join tmp_dm_20130916_03 d on a.PHONE_NO = d.product_no     \\n left join tmp_dm_20130916_04 e on a.PHONE_NO = trim(e.product_no) and a.acct_id=e.acct_id\\n left join tmp_dm_20130916_05 f on a.PHONE_NO = f.product_no\\n left join tmp_dm_20130916_06 g on a.PHONE_NO = g.product_no\\n left join tmp_dm_20130916_07 h on a.PHONE_NO = h.product_no\\n left join tmp_dm_20130916_08 i on a.PHONE_NO = i.product_no\\n left join tmp_dm_20130916_09 j on a.PHONE_NO = j.product_no\\n left join TMP_DM_20130916_011 m on a.phone_no=m.product_no\\n left join tmp_dm_20130916_010 k on a.PHONE_NO = k.product_no\\n left join TMP_DM_20130916_012 r on a.phone_no=r.product_no\\n left join TMP_DM_20130916_013 n on a.phone_no=n.product_no\\n left join dm.tmp_20130916_note_${dayid} q on a.phone_no=q.bill_id\\nleft join gbaserpt.tmp_dm_pub_20130916_cx_${dayid} x on a.phone_no=x.phone_no\\nleft join tmp_call_days_${dayid} y on a.phone_no=y.phone_no\\nleft join dm.tmp_dm_pub_20130916_user_${dayid} z on a.phone_no=z.phone_no\\nleft join dm.tmp_dm_pub_20130916_age_${dayid} o on a.phone_no=o.phone_no\\nleft join dm.tmp_offer_dx_gprs_${dayid} p on a.phone_no=p.phone_no\\nleft join dm.tmp_offer_bxl_gprs_${dayid} t2 on a.phone_no=t2.phone_no\\nleft join dm.tmp_20130916_real_${dayid} t1 on a.phone_no=t1.phone_no\\nwhere a.PROD_KIND_CODE='171000000001'  And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1);"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [194]-[index:312]-[2013年9月日累计新增加指标]-[84]-['str' object has no attribute 'lfind']:{"name":"插入临时表4","nodeId":"84","dsName":"GbaseDM","sql":"INSERT INTO TMP_DM_20130916_04\\n(   PRODUCT_NO,\\n    ACCT_ID,\\n    CYCLE_DATE,\\n    OWE_FEE,\\n    OWE_MONTH\\t)\\nselect PHONE_NO,ACCT_ID,\\n\\t   min(BILL_CYCLE) as cycle_date,     /*首次欠费月份*/\\n\\t   sum(NOT_WRTOF_FEE) as owe_fee,           /*总欠费金额*/\\n\\t  (round (${pmonthid}/100)-round(min(BILL_CYCLE)/100))*12+${month}+\\n\\t  truncate(min(BILL_CYCLE)/100,0)*100-min(BILL_CYCLE) as owe_month   /*欠费月份数*/   \\nfrom gbasedwd.DWD_ACC_BILLOWE_DS_${dayid}      /*欠费账单日表*/\\ngroup by PHONE_NO,ACCT_ID","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [195]-[index:313]-[2013年9月日累计新增加指标]-[130]-['str' object has no attribute 'lfind']:{"name":"创建临时表10","nodeId":"130","dsName":"GbaseDM","sql":"DROP TABLE TMP_DM_20130916_010;\\n CREATE TABLE TMP_DM_20130916_010\\n  (PRODUCT_NO           VARCHAR(20),\\n   GPRS_ACCT_FEE        DECIMAL(12,2),\\n   GPRS_ACCT_FEE_LAST1    DECIMAL(12,2)\\n   )  DISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [196]-[index:315]-[2013年9月日累计新增加指标]-[175]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"175.创建临时表并插入数据","nodeId":"175","sql":" ###删除临时表\\n drop table if exists dm.tmp_dm_pub_20130916_user_${dayid};\\n ##创建临时表\\n create table dm.tmp_dm_pub_20130916_user_${dayid}\\n ( \\n   PHONE_NO varchar(20),\\n   IS_4GNET_user_kaohe int,\\n   IS_offer_user int,\\n   county_id int\\n ) distributed by('phone_no');\\n##插入数据\\ninsert into dm.tmp_dm_pub_20130916_user_${dayid}\\nselect a.PHONE_NO,\\n       '0' IS_4GNET_user_kaohe, -- 是否4G网络客户（考核）\\n       case when c.PHONE_NO is not null then 1 else 0 end IS_offer_user,       -- 是否拍照老旧集团套餐客户\\n       c.county_id                                                             -- 拍照老旧集团套餐归属部门\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a \\n-- left join (select distinct phone_no from gbasemsm.msm_dw_basekpi_110672_detail_${dayid}) b on a.phone_no=b.phone_no\\nleft join (select distinct phone_no,county_id from gbasemsm.msm_dw_basekpi_110626_snapshot_yyyymmdd) c on a.phone_no=c.phone_no ##此年表每年需更换数据日期\\n where a.PROD_KIND_CODE='171000000001' And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1); "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [197]-[index:316]-[2013年9月日累计新增加指标]-[158]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"158.插入临时表13","nodeId":"158","sql":"insert into TMP_DM_20130916_013\\n(product_no,\\n is_4sim_user,\\n chl_type,\\n offer_gprs_package,\\n last_offer_gprs_package,\\n chl_lvl,\\n send_card_brand,\\n account_balance,\\n is_acct_user,\\n is_4gpuls,\\n is_comm_user\\n)\\nselect\\n    a.phone_no,\\n    case when b.subs_id is not null then 1 else 0 end as is_4sim_user,\\n    c.chl_type,\\n    d.offer_gprs_package,\\n    e.last_offer_gprs_package,\\n    c.chl_lvl,\\n    c.send_card_brand,\\n    case when f3.user_no is null then nvl(f.account_balance,f2.acct_book_balance) else nvl(f2.acct_book_balance,f.account_balance) end,\\n    case when g.phone_no is not null then 1 else 0 end as is_acct_user,\\n    nvl(is_4gpuls,0) as is_4gpuls, \\n    case when h.phone_no is not null then 1 else 0 end as is_comm_user\\n from gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a            /*用户资料小表日表 */\\n left join (select distinct subs_id from gbasemsm.msm_dw_one_four_only_detail_${dayid} where cnt is not null) b on  a.phone_no=b.subs_id\\n left join gbasedwi.dwi_res_nac_code_num_dt_${dayid} c on  a.phone_no=c.phone_no\\n left join (select phone_no,offer_gprs_package\\n\\t\\t         from (select row_number() over(PARTITION by a.PHONE_NO order by b.offer_money desc) as id,\\n\\t\\t      \\t\\t\\t\\ta.PHONE_NO,\\n\\t\\t      \\t\\t\\t\\tb.offer_money as offer_gprs_package     \\n\\t\\t      \\t\\t from  gbasedwi.dwi_inst_offer_addbusi_ds_${dayid}  a    /*增值策划订购信息表月表*/\\n\\t\\t      \\t\\t inner join dm.dim_pub_4G_offer_package b  on a.PLAN_ID=b.offer_id    -- dm.dim_pub_4G_offer_package\\n\\t\\t      \\t\\t where to_char(a.eff_time,'yyyy-mm-dd')<='${curm_first_day}' and  to_char(a.EXP_TIME,'yyyy-mm-dd') >='${day_id}') aa\\n\\t\\t         where id ='1') d on  a.phone_no=d.phone_no\\nleft join (select product_no,max(offer_gprs_package) as last_offer_gprs_package from dm.dm_pub_20130916_${premlastday} group by product_no) e on  a.phone_no=e.product_no\\nleft join (select user_no,sum(balance_amount)*1.0/100 account_balance from gbaseods.${tablename.ods50050}\\n           group by user_no) f on a.phone_no=f.user_no\\nleft join (select acct_id,sum(acct_book_balance) acct_book_balance from gbasedwd.dwd_acc_book_balanc_ds_${dayid}\\n           group by acct_id) f2 on a.acct_id=f2.acct_id\\nleft join gbasedwi.dwi_usr_pesn_thinginter_ds_${dayid} f3 on a.phone_no=f3.user_no\\nleft join (select distinct a.phone_no\\n             from gbasedwi.dwi_inco_bill_item_tot_ds_${dayid} a\\n            inner join gbasedwi.dwi_int_02004_di_${dayid} b on a.phone_no=b.msisdn\\n             left join gbasedwi.dwi_usr_pesn_thinginter_ds_${dayid} c on a.phone_no=c.user_no\\n            where c.user_no is null) g on a.phone_no=g.phone_no\\nleft join (select distinct phone_no \\n           from gbasemsm.msm_dw_product_tongxin_user_dm_${monthid} a\\n           left join gbasedwi.dwi_usr_pesn_thinginter_ds_${dayid} c on a.phone_no=c.user_no\\n            where a.op_time<=${dayid} and c.user_no is null \\n\\t\\t\\t) h on a.phone_no=h.phone_no\\nleft join (select a.phone_no,case when c.tac is null then 0 else 1 end is_4gpuls\\n\\t\\t         from gbasedwi.dwi_beh_use_steadyimei_ms_${pmonthid} a /*稳定终端信息月表月表*/\\n\\t\\t         left join dm.dim_4gplus_tac c on a.tac=c.tac  -- 20190225 调整维度表 原维度表dm.dim_4gplus_tac_bak_20190225\\n           ) i on a.phone_no=i.phone_no\\nwhere (a.month_arrive_flag=1 and a.prod_kind_code= 171000000001) or a.month_off_flag =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [198]-[index:317]-[2013年9月日累计新增加指标]-[185]-['str' object has no attribute 'lfind']:{"name":"185.饱和度临时表","nodeId":"185","dsName":"GbaseDM","sql":"### 饱和度-定向流量资源\\n#删除表\\ndrop table dm.tmp_offer_dx_gprs_${dayid};\\n#创建表\\ncreate table dm.tmp_offer_dx_gprs_${dayid}\\n(\\nphone_no varchar(20),\\ndx_gprs_resource_bhd decimal(10,4)\\n)distributed by ('phone_no');\\n#插入数据\\ninsert into dm.tmp_offer_dx_gprs_${dayid}\\nselect a.phone_no,\\n       b.USE_RES_NUM/b.TOTAL_RES_NUM dx_gprs_resource_bhd  #饱和度-定向流量资源\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a   \\nleft join (select  b.phone_no,sum(b.USE_RES_NUM) USE_RES_NUM,sum(b.TOTAL_RES_NUM) TOTAL_RES_NUM from dm.dim_dx_flow a\\nleft join ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD} b on a.plan_id=b.plan_id and a.use_type=b.use_type \\ngroup by phone_no) b on a.phone_no=b.phone_no\\nwhere a.PROD_KIND_CODE='171000000001'  And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1);\\n#########################################################################################################################\\n\\n##########################################################################################################################\\n###饱和度-不限量产品\\n##删除表\\ndrop table dm.tmp_offer_bxl_gprs_${dayid};\\n#创建表\\ncreate table dm.tmp_offer_bxl_gprs_${dayid}\\n(\\nphone_no varchar(20),\\nbxl_gprs_resource_bhd decimal(10,4) ##饱和度-不限量产品 20190524 日调整口径\\n)distributed by ('phone_no');\\n##插入数据\\ninsert into dm.tmp_offer_bxl_gprs_${dayid}\\nselect a.phone_no,\\n       b.USE_RES_NUM/b.TOTAL_RES_NUM bxl_gprs_resource_bhd ##饱和度-不限量产品\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a   \\nleft join (\\n         select  a.phone_no,\\n\\t\\t         sum(case when b.plan_id is not null then a.USE_RES_NUM else 0 end ) USE_RES_NUM,\\n\\t\\t         sum(case when b.plan_Id is not null then a.TOTAL_RES_NUM else 0 end ) TOTAL_RES_NUM \\n         from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD} a\\n         left join (\\n                    select plan_id From dm.dim_bxl_product group by plan_id\\n                    ) b on a.plan_Id=b.plan_id \\n         where a.prod_attr_name not in ('限速控制小流量包','限速服务','国内(含港澳台)限速服务')  \\n\\t\\t group by a.phone_no\\n\\t\\t ) b on a.phone_no=b.phone_no\\nwhere a.PROD_KIND_CODE='171000000001'  And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1);\\n\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [199]-[index:318]-[2013年9月日累计新增加指标]-[90]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"90.插入临时表5","nodeId":"90","sql":"insert into tmp_dm_20130916_05\\n( product_no,\\n  #day_fee,\\n\\tday_last1_fee,    \\n\\tday_last2_fee,\\n\\tday_last3_fee,\\n\\tgprs_fee,\\n\\tgprs_amount,\\n\\tgprs_wlan_amount,\\n\\tgprs_last1_fee,\\n\\tgprs_last1_amount,\\n\\tgprs_wlanlast1_amount,\\n\\tplan_monthly_fee,\\n\\troamout_fee,            -- 国漫出访费用（含国漫套餐包）\\n  roamout_packflow_fee,   -- 国漫出访流量费用（含套餐包）\\n  roam_pack_fee,          -- 国漫套餐包费用\\n  roamout_flow_fee,       -- 国漫出访流量费用（不含套餐包）\\n  roamout_call_fee,       -- 国漫出访话音费用\\n  roamout_sms_fee\\t        -- 国漫出访短信费用\\n)\\nselect\\n     a.phone_no,\\n\\t   #nvl(b.day_fee,0),            /*当日的流量出账费用 */\\n\\t   nvl(c.day_fee,0),             /*上月当日的流量出账费用*/\\n\\t   nvl(c.day_last1_fee,0),       /*前两个月当日的流量出账费用*/\\n\\t   nvl(c.day_last2_fee,0),       /*前3个月当日的流量出账费用 */\\n\\t   nvl(f.gprs_fee,0)    ,        /*主套餐分摊-流量收入*/\\n\\t   nvl(f.gprs_amount,0) ,        /*主套餐分摊-GPRS流量收入*/\\n\\t   nvl(f.gprs_wlan_amount,0),    /*主套餐分摊-WLAN流量收入*/\\n\\t   nvl(c.gprs_fee,0)  ,          /*上个月主套餐分摊-流量收入*/\\n\\t   nvl(c.gprs_amount,0),         /*上个月主套餐分摊-GPRS流量收入*/\\n\\t   nvl(c.gprs_wlan_amount,0),    /*上个月主套餐分摊-WLAN流量收入*/\\n\\t   nvl(b.plan_monthly_fee,0),    /*上个月主套餐分摊-WLAN流量收入*/\\n\\t   nvl(b.roamout_fee,0),          -- 国漫出访费用（含国漫套餐包）\\n     nvl(b.roamout_packflow_fee,0), -- 国漫出访流量费用（含套餐包）\\n     nvl(b.roam_pack_fee,0),        -- 国漫套餐包费用\\n     nvl(b.roamout_flow_fee,0),     -- 国漫出访流量费用（不含套餐包）\\n     nvl(b.roamout_call_fee,0),     -- 国漫出访话音费用\\n     nvl(b.roamout_sms_fee,0)       -- 国漫出访短信费用\\n  from gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a            /*用户资料小表月表 */\\n  left join (select\\n                 phone_no,\\n                 sum(case when b.acct_item_id is not null then mt_should_income else 0 end) as plan_monthly_fee,\\n                 sum(case when c.acct_item_id is not null then mt_should_income else 0 end ) as roamout_fee,          -- 国漫出访费用（含国漫套餐包）\\n   \\t             sum(case when c.acct_item_type in (1,2) then mt_should_income else 0 end ) as roamout_packflow_fee,  -- 国漫出访流量费用（含套餐包）\\n   \\t             sum(case when c.acct_item_type=1 then mt_should_income else 0 end ) as roam_pack_fee,                -- 国漫套餐包费用\\n   \\t             sum(case when c.acct_item_type=2 then mt_should_income else 0 end ) as roamout_flow_fee,             -- 国漫出访流量费用（不含套餐包）\\n   \\t             sum(case when c.acct_item_type=3 then mt_should_income else 0 end ) as roamout_call_fee,             -- 国漫出访话音费用\\n   \\t             sum(case when c.acct_item_type=4 then mt_should_income else 0 end ) as roamout_sms_fee\\t              -- 国漫出访短信费用\\n\\t\\t           from gbasedwi.dwi_inco_bill_item_tot_ds_${dayid} a   /*综合账单明细日汇总日表*/\\n\\t\\t           left join dm.dim_plan_packfee b on a.acct_item_id=b.acct_item_id\\n               left join dm.dim_acct_roam c on a.acct_item_id=c.acct_item_id\\n\\t\\t          group by phone_no) b on a.PHONE_NO=b.PHONE_NO\\n  left join (select product_no phone_no,max(day_fee) day_fee,max(day_last1_fee) day_last1_fee,\\n  \\t\\t\\t\\t          max(day_last2_fee) day_last2_fee,max(gprs_fee) gprs_fee,\\n  \\t\\t\\t\\t          max(gprs_amount) gprs_amount,max(gprs_wlan_amount)  gprs_wlan_amount\\n  \\t\\t         from dm.dm_pub_20130916_${p1month} group by product_no) c on a.PHONE_NO=c.PHONE_NO\\n  left join (select\\n                 phone_no,\\n  \\t\\t\\t     \\t   sum(cmc_data_flow_func_fee+wlan_fee) gprs_fee,\\n  \\t\\t\\t     \\t   sum(cmc_data_flow_func_fee) gprs_amount,\\n  \\t\\t\\t     \\t   sum(wlan_fee) gprs_wlan_amount\\n  \\t\\t          from gbasedwi.dwi_inco_bill_share_mon_ds_${dayid}\\n  \\t\\t         where busi_chgaddtax_kind = 1    /*分摊收入月包日表*/\\n  \\t\\t         group by phone_no) f on  a.phone_no=trim(f.PHONE_NO)\\n  where (a.month_arrive_flag=1 and a.prod_kind_code=171000000001) or a.month_off_flag=1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [200]-[index:320]-[2013年9月日累计新增加指标]-[80]-['str' object has no attribute 'lfind']:{"name":"插入临时表3","nodeId":"80","dsName":"GbaseDM","sql":"INSERT INTO TMP_DM_20130916_03\\n(   PRODUCT_NO               ,\\n    WLAN_GPRS                ,        /*WLAN手机上网流量*/\\n\\tWLANPC_GPRS              ,        /*WLANPC手机上网流量*/\\n\\tIS_SCHOOL_USER           ,        /*是否校园基站用户*/\\n\\tIMEI_COUNT               ,        /*用户换机次数*/\\n\\tGPRS_TNET_TOTAL_FLOW,\\n\\tGPRS_NO_BILLING,                /*非计费流量*/\\n\\tGPRS_BILLING,                   /*计费流量*/\\n\\tTOTAL_FEE\\t\\t)               /*套餐外上网费*/\\nselect  a.PHONE_NO,\\n           b.WLAN_PHONE_NET_FLOW,\\n\\t   b.WLAN_PC_ONNET_FLOW,\\n            null,\\n          0, -- d.num1,\\n\\t\\te.GPRS_TNET_TOTAL_FLOW,\\n\\t\\tc.NO_BILL_FLOW,\\n\\t\\tc.BILL_FLOW,\\n\\t\\tnvl(e.TOTAL_FEE,0)+nvl(f.TOTAL_FEE1,0)\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid}  a      /*用户 资料小表日表*/\\nleft join gbasedwi.DWI_BEH_USE_WLAN_TOT_DT_${dayid} b \\t/*WLAN汇总日累计表*/\\n\\t    on a.PHONE_NO=b.PHONE_NO\\nLEFT JOIN (select phone_no,sum(BILL_FLOW) BILL_FLOW,sum(NO_BILL_FLOW)  NO_BILL_FLOW\\n            from GBASEDWI.DWI_BEH_USE_GPRS_USERTOT_DT_${dayid}\\n             group by phone_no) C ON A.PHONE_NO=C.PHONE_NO\\n-- GBASEDWI.DWI_BEH_USE_GPRS_USERTOT_DT_${dayid} C ON A.PHONE_NO=C.PHONE_NO\\nleft join (select PHONE_NO,\\n\\t\\t\\t\\t  nvl(sum(case when /* BUSI_DTL_TYPE='BI240000' and*/ NET_TYPE =2 then \\n\\t\\t\\t\\t  nvl(BUSY_UP_FLOW,0)+nvl(IDLE_UP_FLOW,0)+nvl(BUSY_DOWN_FLOW,0)+nvl(IDLE_DOWN_FLOW,0)end)/1024,0)   as GPRS_TNET_TOTAL_FLOW,\\n\\t\\t\\t\\t  nvl(sum(TOTAL_FEE) ,0) TOTAL_FEE\\n\\t\\t   from gbasedwd.DWD_EVT_CDR_GPRS_BUSITYPETOT_DM_${monthid}       /*GPRS按业务类型汇总多日表*/\\n\\t\\t   where STAT_DATE <= '${day_id}' group by PHONE_NO) e on a.PHONE_NO =e.PHONE_NO\\nleft join (select phone_no,sum(fee) TOTAL_FEE1 from gbasedwd.DWD_EVT_CDR_WLAN_BASETOT_DS_${dayid}\\n\\t\\t   group by phone_no) f on a.phone_no=f.phone_no\\n/*left join (select  product_no,sum(1) num1\\n\\t\\t   from (select case when substr(user_number,1,2) ='86' then substr(user_number,3) \\n\\t\\t\\t\\t\\t\\telse user_number end product_no,imei \\n\\t\\t\\t\\t from gbasedwd.DWD_EVT_CDR_ORIG_RAW01_VOC_DS_${dayid}\\n\\t\\t\\t\\t where user_number is not null and (mns_type='0' or mns_type is null )\\n\\t\\t\\t\\t   and dr_type='0'  and imei is not null  group by product_no,imei ) a\\n\\t\\t   group by product_no  having  sum(1)>1) d on a.phone_no=d.product_no*/\\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG=1;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [201]-[index:321]-[2013年9月日累计新增加指标]-[148]-['str' object has no attribute 'lfind']:{"name":"148.插入临时表09_02","nodeId":"148","dsName":"GbaseDM","sql":"drop table TMP_DM_20130916_09_01;\\ncreate table  TMP_DM_20130916_09_01\\n             (\\n             op_time                date             \\n            ,product_no            varchar(20)\\n            ,flag                int\\n            ,offer_id               bigint\\n            ,offer_name             varchar(100)\\n            ,apply_date          date\\n            ,offer_kind          varchar(20)   \\n             )DISTRIBUTED BY ('PRODUCT_NO');\\n\\n\\ninsert into  TMP_DM_20130916_09_01\\nselect  '2016-11-28' \\n        ,a.PHONE_NO\\n        ,(case when a.phone_no is not null then 1 else 0 end) flag\\n        ,a.plan_id\\n        ,a.offer_name\\n        ,ACPT_DATE\\n        ,offer_kind_divide          \\n        from                \\n        (select phone_no ,\\n          offer_name    ,\\n          plan_id,\\n          ACPT_DATE,\\n          offer_kind_divide   from \\n        (select PHONE_NO,plan_id,PLAN_NAME,create_time,CREATE_OPER_ID,ACPT_DATE,EXP_TIME from gbasedwi.DWI_INST_OFFER_ADDBUSI_DS_${dayid} where date(ACPT_DATE)<='${day_id}'and date(EXP_TIME)>'${curm_last_day}'\\n        union all\\n        select PHONE_NO,plan_id,PLAN_NAME,create_time,CREATE_OPER_ID,ACPT_DATE,EXP_TIME from gbasedwi.DWI_INST_OFFER_PLAN_DS_${dayid} where  date(ACPT_DATE)<='${day_id}'  and date(EXP_TIME)>'${curm_last_day}'\\n        union all\\n        select PHONE_NO,plan_id,PLAN_NAME,create_time,CREATE_OPER_ID,ACPT_DATE,EXP_TIME from gbasedwi.DWI_INST_OFFER_PLOY_DS_${dayid}  where  date(ACPT_DATE)<='${day_id}'  and date(EXP_TIME)>'${curm_last_day}'\\n          ) a \\n        inner join gbasedwd.dim_basekpi_4g_offer b\\n        on a.plan_id=b.offer_id)  a ;\\n        \\n        \\n\\n        \\n drop table    TMP_DM_20130916_09_02;\\n create table  TMP_DM_20130916_09_02 \\n  (          op_time            date             \\n            ,product_no            varchar(20)    \\n            ,flag                int         \\n            ,member_flag        int             \\n            ,freeflow           decimal(20,4)   \\n             ) distributed by ('product_no');\\n            \\n\\n  insert into  TMP_DM_20130916_09_02       \\n          select a.op_time,a.product_no,a.flag,1,null from  TMP_DM_20130916_09_01  a\\n          where flag=1 and not (offer_name='和家庭' and date(apply_date)>='2016-06-01' and year(date(apply_date))=${year} )      \\n          \\n          union all \\n          \\n          select a.op_time,a.product_no,a.flag,case when b.product_no is null then 2 else 3 end,c.total_value    \\n          from (select * from  TMP_DM_20130916_09_01 where flag=1 and offer_name='和家庭' and date(apply_date)>='2016-06-01') a \\n          left join \\n          (select distinct BILL_NO product_no from  gbasedwi.DWI_INST_OFFER_TEAM_DS_${dayid} A\\n          where A.plan_id in('111005000050','111001001744') and CUR_CYCLE_STATE=1 and data_desc in('4G多终端流量共享成员角色','群组手机成员角色')) b \\n          on a.product_no=b.product_no \\n          left join  \\n          (\\n              select a.product_no,sum(b.NORMAL_TOTUSE_RES_NUM)/1024/1024 total_value\\n              from  TMP_DM_20130916_09_01 a\\n              left join ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD} b on a.product_no=b.PHONE_NO and a.offer_id=b.PLAN_ID\\n              where a.offer_kind in('4G主套餐','30元及以上流量包') and b.res_unit=1024\\n              group by a.product_no\\n          ) c on a.product_no=c.product_no  ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [202]-[index:323]-[2013年9月日累计新增加指标]-[98]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"98.插入临时表8","nodeId":"98","sql":"INSERT INTO  TMP_DM_20130916_08\\n (\\tPRODUCT_NO,\\n\\tOFFER_CHOICE_PACKAGE,\\n\\tOFFER_PLAN_FEE,\\n\\tOFFER_CHOICE_PACKAGE_USED,\\n\\tOFFER_PLAN_FEE_USED,\\n\\tIDEN_NAME,\\n\\tPARTY_IDEN_ID,\\n\\tPROD_IDEN,\\n\\tCUST,\\n\\tJINGBAN,\\n\\tIS_USE_LEGAL,\\n\\tIS_RES_LEGAL,\\n\\tENTERPRISE_MARK,\\n\\tDEPT_NAME,\\n\\tOFFER_4G_PACKAGE_S,\\n\\tOFFER_4G_PACKAGE_USED,\\n\\tOFFER_4G_SATUR,\\n\\tOFFER_4G_SHARE_PACKAGE,      \\n\\tOFFER_4G_SHARE_PACKAGE_USED,\\n\\tOFFER_4G_MAIN_PACKAGE,\\n\\tOFFER_4G_MAIN_PACKAGE_USED,\\n\\tOFFER_4G_MAIN_SATUR,\\n\\tOFFER_MAIN_GPRS_SATUR,\\n\\tOFFER_ALL_GPRS_SATUR,\\n\\tRESOURCE_RESIDUAL_RATE,\\n    NORMAL_TOTUSE_RES_NUM,\\n    NORMAL_USE_RES_NUM\\t)\\nselect\\ta.PHONE_NO,\\n\\t\\tb.offer_choice_package,         /*流量资源-流量可选包*/\\n\\t\\tb.OFFER_PLAN_FEE,               /*流量资源-主套餐*/\\n\\t\\tb.offer_choice_package_used,    /*流量资源使用量-可选包*/\\n\\t\\tb.OFFER_PLAN_FEE_used,          /*流量资源使用量-主套餐*/\\n\\t\\tc.CUST_TYPE,                          /*机主证件类型*/\\n\\t\\tc.PARTY_TYPE,                   /*经办人证件类型*/\\n\\t\\tc.RES_TYPE,                         /*责任人证件类型*/\\n\\t\\tc.IS_CUST_LEGAL,                   /*机主信息是否合规*/\\n\\t\\tc.IS_PARTY_LEGAL,                /*经办人信息是否合规*/\\n\\t\\tc.IS_USE_LEGAL,           /*使用人信息是否合规*/\\n\\t\\tc.IS_RES_LEGAL,      /*责任人信息是否合规*/\\n\\t\\tnull,/*c.GRP_CUST_FLAG,                         CRM客户类型*/ -- 20181207下线\\n\\t\\tnull,/*case when e.CO_CODE is not null and e.DEPT_AREA_ID not in ('99','999')  then h.CHANNEL_NAME  \\n\\t\\telse f.DEPT_COUNTY_NAME end dept_county_name,        三级部门  */\\n\\t   nvl(k.offer_4G_package_S,0),     /*----流量资源-4G套餐*/\\n\\t   nvl(k.offer_4g_package_used,0),/*----流量资源使用量-4G套餐*/\\n\\t   nvl(k.offer_4G_satur,0),              /*----饱和度-4G套餐*/\\n\\t   nvl(l.offer_4G_share_package,0) ,           /*----流量资源-4G飞享或和4G套餐*/\\n       nvl(l.offer_4G_share_package_used,0)    ,   /*----流量资源使用量-4G飞享或和4G套餐*/\\n       nvl(m.offer_4G_main_package,0),       /*----流量资源-4G主套餐*/\\n       nvl(m.offer_4g_main_package_used,0),  /*----流量资源使用-4G主套餐*/\\n       nvl(m.offer_4G_main_satur,0),         /*----饱和度-4G主套餐*/\\n       nvl(hh.main_gprs_resource_bhd,0),      #20181025日 调整 ##nvl(n.offer_main_gprs_satur,0),/*饱和度-主要流量资源*/\\n       nvl(n.offer_all_gprs_satur,0) ,  /*饱和度-全流量资源*/\\n\\t   case when nvl(i.normal_totuse_res_num,0)=0 then 0 else 1-i.normal_use_res_num*1.0/i.normal_totuse_res_num end RESOURCE_RESIDUAL_RATE, /*资源剩余率*/\\n\\t   nvl(i.normal_totuse_res_num,0),    /*总资源量*/\\n\\t   nvl(i.normal_use_res_num,0)        /*总资源使用量*/\\nfrom  gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} a            /*用户资料小表日表 */\\nleft join (select a.PHONE_NO,\\n\\t\\t\\t\\t  sum(case when b.offer_type in ('可选包') then a.NORMAL_TOTUSE_RES_NUM else 0 end) offer_choice_package,\\n\\t\\t\\t\\t  sum(case when c.plan_id is not null then a.NORMAL_TOTUSE_RES_NUM else 0 end)    offer_plan_fee,\\n\\t\\t\\t\\t  sum(case when b.offer_type in ('可选包') then a.NORMAL_USE_RES_NUM  else 0 end) offer_choice_package_used,\\n\\t\\t\\t\\t  sum(case when c.plan_id is not null  then a.NORMAL_USE_RES_NUM  else 0 end)    offer_plan_fee_used\\n\\t\\t   from (select PHONE_NO,PLAN_ID,sum(a.NORMAL_TOTUSE_RES_NUM)/1024/1024 NORMAL_TOTUSE_RES_NUM,\\n\\t\\t\\t\\t\\t\\tsum(a.NORMAL_USE_RES_NUM)/1024/1024 NORMAL_USE_RES_NUM\\n\\t\\t\\t\\t from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD}  a       /*免费资源统计日表*/\\n\\t\\t\\t\\t where a.USE_TYPE not in ('闲时流量','咪咕视频本地专属流量') group by PHONE_NO,PLAN_ID ) a\\n\\t\\t   left join dm.dim_pub_gprs_limit b on a.PLAN_ID=b.offer_id\\n\\t\\t   left join (select PHONE_NO,\\n\\t\\t\\t\\t\\t\\t\\t max(case when EFF_TIME<'${nextmfirstday}' then PLAN_ID end) plan_id\\n\\t\\t\\t\\t\\t  from gbasedwi.DWI_INST_OFFER_PLAN_DS_${dayid} /*主策划订购信息表日表*/\\n\\t\\t\\t\\t\\t  group by PHONE_NO  ) c on c.PLAN_ID=a.PLAN_ID and a.PHONE_NO=c.PHONE_NO\\n\\t\\t\\tgroup by a.PHONE_NO)\\tb on a.PHONE_NO=b.PHONE_NO\\nleft join gbasedwi.DWI_USR_PESN_REALNAME_ENT_DS_${dayid} c\\n        on a.PHONE_NO=c.PHONE_NO  /*实名制用户日表*/\\nleft join gbasedwi.DWI_USR_GRP_MEB_DS_${pdayid} e on a.PHONE_NO=e.MEMB_NO /*集团成员信息表日表*/\\nleft join gbasedwi.DWI_USR_PESN_PERSN_LOC_DS_${pdayid} g on a.PHONE_NO=g.PHONE_NO   /*集团成员信息表日表*/\\nleft join gbasedwd.DIM_PUB_COUNTY_DEPT f on g.DEPT_COUNTY_ID=f.DEPT_COUNTY_ID\\nleft join  gbasedwd.dim_enterprise_channel h  on e.DEPT_AREA_ID=h.CHANNEL_ID\\nleft join\\n           (select a.PHONE_NO,\\n           sum(case when b.offer_id is not null then a.total_value else 0 end) offer_4G_package_s,/*----流量资源-4G套餐*/\\n           sum(case when b.offer_id is not null then a.used_value else 0 end)  offer_4g_package_used ,/*----流量资源使用量-4G套餐*/\\n           sum(case when b.offer_id is not null then a.used_value else 0 end)/sum(case when b.offer_id is not null  then a.total_value else 0 end)\\toffer_4G_satur /*----饱和度-4G套餐*/\\n           from (select phone_no,plan_id,sum(a.total_res_num)/1024/1024 total_value,\\n           \\t\\t\\t\\t\\t    sum(a.use_res_num)/1024/1024 used_value\\n           \\t\\t\\t\\t from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD}  a       /*免费资源统计日表*/\\n           \\t\\t\\t\\twhere a.RES_UNIT='1024'\\n           \\t\\t\\t\\t  and a.USE_TYPE not in ('赠送国内通用流量','赠送晚间特惠流量','国内通用流量直充赠送','本地4G流量直充赠送',\\n                                           '季包（卡）流量直充赠送','季包（卡）流量直充赠送','定向流量指定用户全量统付',\\n                                           '定向流量指定用户限量统付','定向流量不限用户限量统付','闲时流量','闲时本地通用流量',\\n                                           '转赠国内流量','咪咕视频本地专属流量') group by phone_no,plan_id) a\\n           \\t\\t\\t\\t  left join gbasedwd.dim_basekpi_4g_offer  b on a.PLAN_ID=b.offer_id\\n            group by a.phone_no )\\n            k on a.PHONE_NO=k.PHONE_NO\\nleft join\\n           (select a.PHONE_NO,\\n           sum(case when b.offer_id is not null  then a.total_value else 0 end) offer_4G_share_package,/*----流量资源-4G飞享或和4G套餐*/\\n           sum(case when b.offer_id is not null then a.used_value else 0 end)    offer_4G_share_package_used /*----流量资源使用量-4G飞享或和4G套餐*/\\n           from (select PHONE_NO,PLAN_ID,sum(a.TOTAL_RES_NUM)/1024/1024 total_value,\\n           \\t\\t\\t\\t\\t      sum(a.USE_RES_NUM)/1024/1024 used_value\\n           \\t\\t\\t\\t  from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD}  a       /*免费资源统计日表*/\\n           \\t\\t\\t\\t  where a.RES_UNIT='1024' and a.USE_TYPE not in ('赠送国内通用流量','赠送晚间特惠流量','国内通用流量直充赠送','本地4G流量直充赠送','季包（卡）流量直充赠送',\\n                   '季包（卡）流量直充赠送','定向流量指定用户全量统付','定向流量指定用户限量统付','定向流量不限用户限量统付','闲时流量','闲时本地通用流量','转赠国内流量')  group by PHONE_NO,PLAN_ID) a\\n           \\t\\t\\t\\t  left join dm.dim_pub_4g_share  b on a.PLAN_ID=b.offer_id\\tgroup by a.PHONE_NO )\\n           \\t\\t\\t\\t  l on a.PHONE_NO=l.PHONE_NO\\nleft join\\n           (select a.PHONE_NO,\\n           sum(case when b.offer_id is not null  then a.total_value else 0 end) offer_4G_main_package,/*----流量资源-4G主套餐*/\\n           sum(case when b.offer_id is not null then a.used_value else 0 end)    offer_4g_main_package_used,/*----流量资源使用-4G主套餐*/\\n           sum(case when b.offer_id is not null then a.used_value else 0 end)/sum(case when b.offer_id is not null  then a.total_value else 0 end)\\toffer_4G_main_satur/*----饱和度-4G主套餐*/\\n           from (select PHONE_NO,PLAN_ID,sum(a.TOTAL_RES_NUM)/1024/1024 total_value,\\n           \\t\\t\\t\\t\\t      sum(a.USE_RES_NUM)/1024/1024 used_value\\n           \\t\\t\\t\\t from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD}  a       /*免费资源统计日表*/\\n           \\t\\t\\t\\twhere a.RES_UNIT='1024'\\n           \\t\\t\\t\\t  and a.USE_TYPE not in ('赠送国内通用流量','赠送晚间特惠流量','国内通用流量直充赠送','本地4G流量直充赠送',\\n           \\t\\t\\t\\t                         '季包（卡）流量直充赠送','季包（卡）流量直充赠送','定向流量指定用户全量统付',\\n           \\t\\t\\t\\t                         '定向流量指定用户限量统付','定向流量不限用户限量统付','闲时流量','闲时本地通用流量',\\n           \\t\\t\\t\\t                         '转赠国内流量','咪咕视频本地专属流量')   group by PHONE_NO,PLAN_ID) a\\n           \\t\\t\\t\\t  left join (select distinct a.offer_id from gbasedwd.dim_basekpi_4g_offer  a\\n           \\t                    inner join (select distinct plan_id offer_id from gbasedwi.dim_svc_off_static_ds_${dayid} where EXISTS_TABLE_NAME='DWI_INST_OFFER_PLAN_DS') d  on a.offer_id=d.offer_id) b\\n           \\t              on a.PLAN_ID=b.offer_id\\tgroup by a.PHONE_NO )\\n           \\t\\t\\t\\t  m on a.PHONE_NO=m.PHONE_NO\\nleft join\\n\\t\\t   (select a.PHONE_NO,\\n           sum(case when b.offer_id is not null then a.used_value else 0 end)/sum(case when b.offer_id is not null then a.total_value else 0 end)  offer_main_gprs_satur  ,  /*饱和度-主要流量资源*/\\n           sum(case when b.offer_id is not null then a.used_value else 0 end)/sum(case when a.plan_id is not null then a.total_value else 0 end)   offer_all_gprs_satur   /*饱和度-全流量资源*/\\n           from (select phone_no,plan_id,sum(a.total_res_num)/1024/1024 total_value,\\n\\t\\t\\t\\t\\t              sum(a.USE_RES_NUM)/1024/1024 used_value\\n\\t\\t\\t\\t          from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD}  a       /*免费资源统计日表*/\\n\\t\\t\\t\\t          where a.RES_UNIT='1024'\\n\\t\\t\\t\\t            and a.USE_TYPE not in ('赠送国内通用流量','赠送晚间特惠流量','国内通用流量直充赠送','本地4G流量直充赠送',\\n\\t\\t\\t\\t                                   '季包（卡）流量直充赠送','季包（卡）流量直充赠送','定向流量指定用户全量统付',\\n\\t\\t\\t\\t                                   '定向流量指定用户限量统付','定向流量不限用户限量统付','闲时流量','闲时本地通用流量',\\n\\t\\t\\t\\t                                   '转赠国内流量','CPE流量','WLAN','咪咕视频本地专属流量')\\n\\t\\t\\t\\t          group by phone_no,plan_id) a\\n\\t\\t\\t\\t  left join\\n\\t\\t\\t\\t  (select distinct offer_id from dm.dim_pub_choice_limit\\n                   union all\\n                   select distinct plan_id offer_id from gbasedwi.dim_svc_off_static_ds_${dayid} where EXISTS_TABLE_NAME='DWI_INST_OFFER_PLAN_DS') b\\n\\t              on a.PLAN_ID=b.offer_id\\tgroup by a.PHONE_NO )\\n\\t\\t\\t\\t  n on a.phone_no=n.phone_no\\nleft join\\n(select PHONE_NO,sum(case when b.offer_id is not null then a.normal_totuse_res_num else 0 end) normal_totuse_res_num,\\n                     sum(case when b.offer_id is not null then a.normal_use_res_num else 0 end)    normal_use_res_num\\n               from ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD} a\\n          left join dim_201510033_offer_list  b on a.PLAN_ID=b.offer_id  /*免费资源统计日表*/\\n          where a.RES_UNIT='1024' and (a.USE_TYPE not like '%WLAN%' or a.USE_TYPE<>'咪咕视频本地专属流量' or a.use_type<>'咪咕视频流量')\\n    group by PHONE_NO) I on a.PHONE_NO=I.PHONE_NO\\nleft join dm.tmp_offer_main_gprs_${dayid} hh on a.phone_no=hh.phone_no #20181025日添加\\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG  =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [203]-[index:324]-[2013年9月日累计新增加指标]-[167]-['str' object has no attribute 'lfind']:{"name":"167.创建临时表20180816","nodeId":"167","dsName":"GbaseRPT","sql":"drop table if exists gbaserpt.tmp_dm_pub_20130916_cx_${dayid};\\nCREATE TABLE gbaserpt.tmp_dm_pub_20130916_cx_${dayid} (\\n  phone_no varchar(20),\\n  cx_offer_name varchar(50),\\n  cx_offer_level bigint(21),\\n  bxl_offer_bhd decimal(46,4),\\n  sms_CXLL_cnt decimal(23,0),\\n  sms_CXYL_cnt decimal(23,0),\\n  mt_should_income decimal(54,2)\\n)DISTRIBUTED BY ('phone_no')","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [204]-[index:325]-[2013年9月日累计新增加指标]-[45]-['str' object has no attribute 'lfind']:{"name":"插入临时表1","nodeId":"45","dsName":"GbaseDM","sql":"INSERT INTO TMP_DM_20130916_01\\n (\\tPRODUCT_NO,\\n    CALL_TOTAL_PROPORTION,     /*套餐语音资源使用率*/\\n\\tMESSAGE_TOTAL_PROPORTION,   /*套餐短信资源使用率*/\\n\\tGPRS_TOTAL_PROPORTION\\t)    /*套餐流量资源使用率*/\\nSELECT PHONE_NO,\\n        SUM(CASE WHEN USE_TYPE='语音' THEN CAST(CAST(USE_RES_NUM AS DECIMAL(20,3))/CAST(TOTAL_RES_NUM AS DECIMAL(20,3)) AS DECIMAL(20,3)) ELSE 0 END) CALL_TOTAL_PROPORTION,\\n        SUM(CASE WHEN USE_TYPE='短信' THEN CAST(CAST(USE_RES_NUM AS DECIMAL(20,3))/CAST(TOTAL_RES_NUM AS DECIMAL(20,3)) AS DECIMAL(20,3)) ELSE 0 END) MESSAGE_TOTAL_PROPORTION,\\n        SUM(CASE WHEN USE_TYPE='数据流量' THEN CAST(CAST(USE_RES_NUM AS DECIMAL(20,3))/CAST(TOTAL_RES_NUM AS DECIMAL(20,3)) AS DECIMAL(20,3)) ELSE 0 END ) GPRS_TOTAL_PROPORTION\\n     FROM (SELECT PHONE_NO,\\n\\t              USE_TYPE,\\n\\t\\t\\t\\t  SUM(USE_RES_NUM) AS USE_RES_NUM,\\n\\t\\t\\t\\t  SUM(TOTAL_RES_NUM) AS TOTAL_RES_NUM \\n\\t  FROM ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD} WHERE USE_TYPE IN ('语音','短信','数据流量') \\n\\t  GROUP BY PHONE_NO,USE_TYPE) A\\nWHERE TOTAL_RES_NUM > 0 GROUP BY PHONE_NO\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [205]-[index:326]-[2013年9月日累计新增加指标]-[168]-['str' object has no attribute 'lfind']:{"name":"168.插入数据","nodeId":"168","dsName":"GbaseRPT","sql":" insert into gbaserpt.tmp_dm_pub_20130916_cx_${dayid}\\n select  a.phone_no,\\n        b.cx_offer_name,    -- 畅享套餐名称\\n        b.cx_offer_level,   -- 畅享套餐档位\\n        c.bxl_offer_bhd,    -- 不限量模组套餐资源饱和度\\n        d.sms_CXLL_cnt,     -- 短信查询流量次数\\n        d.sms_CXYL_cnt,      -- 短信查询余量次数\\n        nvl(e.mt_should_income,0)  -- 月累计消费金额（剔除即扣即返收入）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a   \\nleft join  (select d.phone_no phone_no,\\n                   e.cx_offer_name cx_offer_name, -- 畅享套餐名称\\n                   e.cx_offer_level cx_offer_level-- 畅享套餐档位\\n            from (\\n\\t\\t\\t     select a.phone_no phone_no,\\n\\t\\t\\t             max(b.offer_id) call_offer_id, \\n\\t\\t\\t\\t\\t\\t max(c.offer_id) gprs_offer_id\\n                  from gbasedwi.dwi_inst_offer_list_all_ds_${dayid} a\\n                  left join dm.dim_offer_call_list b on a.plan_id=b.offer_id\\n                  left join dm.dim_offer_gprs_list c on a.plan_id=c.offer_id \\n\\t\\t\\t\\t  where date(a.exp_time)>='${curm_last_day}' \\n\\t\\t\\t\\t  group by phone_no\\n\\t\\t\\t\\t ) d \\n                  left join dm.dim_cx_offer_type_list e on d.call_offer_id=e.call_id and d.gprs_offer_id=e.gprs_id\\n          ) b on a.phone_no=b.phone_no\\nleft join (select k.phone_no,k.USE_RES_NUM/k.TOTAL_RES_NUM  bxl_offer_bhd -- 不限量模组套餐资源饱和度 \\nfrom (select phone_no,\\n       sum(USE_RES_NUM) USE_RES_NUM,\\n       sum(TOTAL_RES_NUM) TOTAL_RES_NUM  \\nfrom ${SOURCE_DWI_INCO_BILL_FREERES_DS_YYYYMMDD} \\nwhere plan_id in(111002060404,111002060405,111002060006,111002060007) and prod_id<>'54001105'\\ngroup by phone_no) k) c on a.phone_no=c.phone_no\\nleft join (select\\n    wod_code,\\n    sum(case when req_code='CXLL' then 1 else 0 end) sms_CXLL_cnt, -- 短信查询流量次数\\n    sum(case when req_code='CXYL' then 1 else 0 end)  sms_CXYL_cnt -- 短信查询余量次数\\n  from gbasedwd.dwd_evt_hci_smshall_dnlog_dm_${monthid}\\n where stat_date<='${day_id}'\\n group by wod_code) d on a.phone_no=d.wod_code\\nleft join (select phone_no,sum(mt_should_income)  mt_should_income\\n           from gbasedwi.dwi_inco_bill_item_tot_ds_${dayid}\\n           where acct_item_id not in(4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798,4686,4821,4820) \\n\\t\\t   -- 20190222日 调整acct_item_id not in(3693,4596,4626,4637,4658,4667)\\n\\t\\t   -- 20190417日调整 (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798) \\n           group by phone_no \\n\\t\\t  ) e on a.phone_no=e.phone_no\\nwhere a.PROD_KIND_CODE='171000000001'  And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1); \\n","parentDsName":"GbaseRPT"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [206]-[index:329]-[2013年9月日累计新增加指标日累计调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"7.创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_20130916_${dayid};\\ncreate table DM_PUB_20130916_${dayid} distributed by ('PRODUCT_NO') as select * from DM_PUB_20130916_YYYYMMDD;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [207]-[index:330]-[2013年9月日累计新增加指标日累计调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_20130916_${dayid} select * from DM_PUB_20130916_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [208]-[index:333]-[渠道酬金020508月调度传输]-[5]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"5","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CHANNEL_020508_${monthid};\\nCREATE TABLE  DM_PUB_CHANNEL_020508_${monthid} distributed by('channel_code')  as select * from DM_PUB_CHANNEL_020508_YYYYMM ;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [209]-[index:334]-[渠道酬金020508月调度传输]-[6]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"6","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CHANNEL_020508_${monthid} \\n(select * from   \\n ODS_M_F_OTR_020508_TERMINALPAYLIST_${monthid}@dblink_ods);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [210]-[index:337]-[2012年12月新增指标]-[91]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"91.插入数据15","nodeId":"91","sql":"insert into ${DM_PUB_201212018_TMP15_MONTHID}\\n (\\t phone_no\\n\\t,IS_TD_USER\\n\\t,CALL_DURATION_M\\n\\t,OUT_CALL_DUREATION_M\\n\\t,IN_CALL_DURATION_M\\n\\t,INPLAN_OUT_CALL_DURAION_M\\n\\t,INPLAN_IN_CALL_DURATION_M\\n\\t,OUTPLAN_OUT_CALL_DURATION_M\\n\\t,OUTPLAN_IN_CALL_DURATION_M\\n\\t,TD_CALL_NUM\\n\\t,TD_VOICE_NUM\\n\\t,TD_GPRS_NUM\\n\\t,LAST_STOP_DATE\\n\\t,STOP_TWICE_NUM                      )\\nselect\\t t1.phone_no\\n\\t\\t,case when a.TD_USER_FLAG = 0 and (b.T_GPRS_UP_FLOW <> 0 or b.T_GPRS_FLOW <> 0  or b.T_GPRS_DOWN_FLOW <> 0 or f.T_CALL_NUM <> 0 ) then 1 else 0 end as is_td_user\\n\\t\\t/*是否TD网络    case when a.td_use_mark = 0 and (b.GPRS_TNET_FLOWUP <> 0 or b.GPRS_TNET_TOTAL_FLOW <> 0 or b.GPRS_TNET_FLOWDOWN <> 0 or c.VS0034_C <> 0 ) then 1 else 0 end as is_td_user,*/\\n\\t\\t,f.CALL_DUR                   /*各月通话时长*/\\n\\t\\t,f.CALING_CALL_DUR            /*各月主叫通话时长*/\\n\\t\\t,f.CALLED_DUR                /*各月被叫通话时长*/\\n\\t\\t,c.INPLAN_OUT_CALL_DURAION_M             /*各月套餐内主叫通话时长*/\\n\\t\\t,c.INPLAN_IN_CALL_DURATION_M             /*各月套餐内被叫通话时长*/\\n\\t\\t,c.OUTPLAN_OUT_CALL_DURATION_M           /*各月套餐外主叫通话时长*/\\n\\t\\t,c.OUTPLAN_IN_CALL_DURATION_M            /*各月套餐外被叫通话时长*/\\n\\t\\t,h.G3_CALL_COMM_DAYS       TD_CALL_NUM   /*TD网络通信天数*/\\n\\t\\t,h.G3_COMM_DAYS           TD_VOICE_NUM   /*TD网络语音通信天数*/\\n\\t\\t,h.G3_GPRS_COMM_DAYS  TD_GPRS_NUM    \\t /*TD网络GPRS通信天数*/\\n\\t\\t,t5.last_stop_date    LAST_STOP_DATE     /*最后停机时间*/\\n\\t\\t,m.STOP_TWICE_NUM                  \\t \\t /*双停次数*/\\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join gbasedwi.DWI_USR_PESN_MS_${monthid} a  /*个人用户资料月表*/  on t1.phone_no=a.phone_no\\nleft join (select phone_no,sum(T_GPRS_UP_FLOW) T_GPRS_UP_FLOW,\\n\\t\\t\\t\\t sum(T_GPRS_FLOW) T_GPRS_FLOW,sum(T_GPRS_DOWN_FLOW) T_GPRS_DOWN_FLOW\\n\\t\\t   from gbasedwi.DWI_BEH_USE_GPRS_USERTOT_MS_${monthid} group by phone_no) b /*用户GPRS业务汇总月表*/\\n\\ton t1.phone_no=b.phone_no\\nleft join (select phone_no,sum(CALL_DUR) CALL_DUR,sum(CALING_CALL_DUR) CALING_CALL_DUR\\n\\t\\t\\t\\t ,sum(CALLED_DUR) CALLED_DUR,sum(T_CALL_NUM) T_CALL_NUM\\n\\t\\t   from gbasedwi.DWI_BEH_USE_VOC_USERTOT_MS_${monthid} group by phone_no) f /*用户语音行为汇总月表*/\\n\\ton t1.phone_no=f.phone_no\\nleft join gbasedwi.DWI_BEH_USE_COMM_USER_MS_${monthid} h   /*通信用户汇总月表*/   on t1.phone_no=h.phone_no\\nleft join (select phone_no,sum(case when ACCT_START_ACTION in (89,31) then 1 else 0 end) as STOP_TWICE_NUM\\n\\t\\t   from  gbasedwd.DWD_ACC_ACCOPEN_DT_${monthid}  /*账务开通月表*/\\n\\t\\t   where ACCT_START_ACTION in (83,29,89,31,302,305,59,53) group by phone_no) m on t1.phone_no=m.phone_no\\nleft join (select phone_no,\\n\\t\\t\\t\\t  sum(case when  OUT_PROD_FLAG='0' and call_type='1' then call_dur else 0 end ) INPLAN_OUT_CALL_DURAION_M,\\n\\t\\t\\t\\t  sum(case when  OUT_PROD_FLAG='0' and call_type='2' then call_dur else 0 end ) INPLAN_IN_CALL_DURATION_M,\\n\\t\\t\\t\\t  sum(case when  OUT_PROD_FLAG='1' and call_type='1' then call_dur else 0 end ) OUTPLAN_OUT_CALL_DURATION_M,\\n\\t\\t\\t\\t  sum(case when  OUT_PROD_FLAG='1' and call_type='2' then call_dur else 0 end ) OUTPLAN_IN_CALL_DURATION_M\\n\\t\\t  from  gbasedwd.DWD_EVT_CDR_VOC_BASETOT_MS_${monthid} group by phone_no) c on t1.phone_no=c.phone_no\\nleft join (select user_id,max(case when STOP_STATE in (0) then a.ACPT_TIME\\n\\t\\t\\t\\t  else greatest (nvl(BUSN_STOP_TIME,'1900-01-01'),nvl(ACCT_STOP_TIME,'1900-01-01'),\\n\\t\\t\\t\\t\\t\\t\\t\\t nvl(MANG_STOP_TIME,'1900-01-01'),nvl(R_STOP_TIME,'1900-01-01'),\\n\\t\\t\\t\\t\\t\\t\\t\\t nvl(CALL_STOP_TIME,'1900-01-01')  ) end) as last_stop_date    /*最后停机时间 */\\n\\t\\t   from gbasedwd.DWD_SVC_USR_STOP_DS_${curmlastday} a group by user_id) t5 on t1.user_id=t5.user_id\\nwhere (t1.MONTH_ARRIVE_FLAG=1 And t1.PROD_KIND_CODE= 171000000001) or t1.MONTH_OFF_FLAG  =1"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [211]-[index:338]-[2012年12月新增指标]-[26]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"临时表6","nodeId":"26","sql":"drop table ${DM_PUB_201212018_TMP06_MONTHID};\\ncreate table ${DM_PUB_201212018_TMP06_MONTHID}\\n (\\t user_id                      BIGINT\\n\\t,WLAN_GPRS                    BIGINT\\n\\t,WLANPC_GPRS                  BIGINT\\n\\t,CALL_10086_COUNT             INTEGER\\n\\t,STOP_ONCE_NUM                INTEGER\\n\\t,OWE_FEE                      DECIMAL(13, 3)\\n\\t,RES_SPEC_NAME                VARCHAR(256)\\n\\t,MAT_CODE                     VARCHAR(25)\\n\\t,DONE_DATE                    date\\n\\t,ROOM_NAME                    VARCHAR(100)\\n) DISTRIBUTED BY('user_id') nolock;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [212]-[index:339]-[2012年12月新增指标]-[14]-['str' object has no attribute 'lfind']:{"name":"临时表1","nodeId":"14","dsName":"GbaseDM","sql":"create table  ${DM_PUB_201212018_TMP01_MONTHID}\\n  ( phone_no\\t\\t\\t\\tvarchar(20),\\n\\t is_turn_brand\\t\\t\\tSMALLINT,\\n\\t old_order_name\\t       VARCHAR(200),\\n\\t new_order_name\\t       VARCHAR(200) ,\\n         TURN_BRAND_OLD         INTEGER\\t     ,\\n\\t  TURN_BRAND_NEW         INTEGER      ) \\nDISTRIBUTED BY('phone_no') nolock;\\n\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [213]-[index:340]-[2012年12月新增指标]-[68]-['str' object has no attribute 'lfind']:{"name":"68.临时表13","nodeId":"68","dsName":"GbaseDM","sql":"drop table ${DM_PUB_201212018_TMP13_MONTHID};\\ncreate table ${DM_PUB_201212018_TMP13_MONTHID}\\n (   product_no         varchar(20)\\n\\t,IS_OFFER_4G\\t\\tSMALLINT\\n\\t,IS_CONTRACT_4G\\t \\tSMALLINT\\n\\t,GPRS_FEE           DECIMAL(13, 3)\\n\\t,IS_STRESS\\t\\t\\tSMALLINT\\n) DISTRIBUTED BY('product_no') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [214]-[index:341]-[2012年12月新增指标]-[21]-['str' object has no attribute 'lfind']:{"name":"插入数据3","nodeId":"21","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP03_MONTHID}\\n (\\tuser_id,OWE_THREE_FEE  ) \\nselect user_id,sum(NOT_WRTOF_FEE) OWE_THREE_FEE\\nfrom (select user_id,NOT_WRTOF_FEE from ${DWD_ACC_BILLOWE_MS_MONTHID}\\n\\t\\tunion all\\n\\t  select user_id,NOT_WRTOF_FEE from ${DWD_ACC_BILLOWE_MS_PMONTHID}\\n\\t\\tunion all\\n\\t  select user_id,NOT_WRTOF_FEE from ${DWD_ACC_BILLOWE_MS_P2MONTHID}) t1\\ngroup by user_id;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [215]-[index:342]-[2012年12月新增指标]-[78]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据14","nodeId":"78","sql":"\\t  \\n\\t  insert into ${DM_PUB_201212018_TMP14_MONTHID}\\n (\\t phone_no\\n    ,IS_CHANGE_USIM\\n\\t,IS_HANDLE_4G\\n\\t,IS_TERMINAL_4G\\n\\t,IS_MIFI_4G\\n\\t,TERMINAL_4G\\n\\t,IS_TEST_4G\\t\\t) \\nselect distinct a.phone_no,\\n       case when    b.phone_no is null then  0 else  1 end as IS_CHANGE_USIM ,    /*截止到当月是否更换USIM卡用户*/\\n\\t\\tcase when c.phone_no is null then  0 else  1 end as IS_HANDLE_4G ,\\n\\t\\tcase when c.phone_no is not null and  d.user_id is not null then\\t1 else  0 end as  IS_TERMINAL_4G,\\n\\t\\tcase when e.phone_no is null then  0  else 1 end  as  IS_MIFI_4G,    \\n\\t\\td.ATTR_VAL TERMINAL_4G,                                                            \\n\\t\\tcase when f.phone_no is not null  then  1 else  0 end as IS_TEST_4G \\nfrom GBASEDWI.DWI_USR_PESN_PARTINFO_MS_${monthid}  a\\n left join (select distinct a.phone_no from gbasedwi.DWI_INST_ORD_LIST_DM_${monthid}  a   /*订单明细信息表日表*/\\n                      inner  join (select distinct a.phone_no  from  gbasedwd.DWD_RES_SVC_SIM_DS_${curmlastday}  a       /*SIM卡资源信息日表*/                               \\n                                      left join gbasedwd.DWD_RES_SVC_MKT_SPEC_DS_${curmlastday} b    /*营销资源规格日表*/  on  a.RES_SPEC_ID =b.RES_SPEC_ID   \\n                                      where b.RES_NAME like '%USIM%' and MANG_STATE =5) b  on a.phone_no=b.phone_no\\n                      where a.ORD_TYPE in('补卡','换卡')) b  on a.phone_no=b.phone_no\\nleft join (select distinct phone_no from gbasedwi.DWI_INST_OFFER_ADDBUSI_DS_${curmlastday}\\n\\t\\t   where plan_id in (111002002175) and CUR_CYCLE_STATE=1) c on a.phone_no=c.phone_no \\nleft join (select a.user_id,substr(a.ATTR_VAL,13) ATTR_VAL \\n\\t\\t   from GBASEDWI.DWI_INST_ATTR_PLOY_SERV_DS_${curmlastday}  a\\n\\t\\t   inner join (select user_id,max(UPDT_TIME) UPDT_TIME \\n\\t\\t\\t\\t\\t   from GBASEDWI.DWI_INST_ATTR_PLOY_SERV_DS_${curmlastday}\\n\\t\\t\\t\\t\\t   where ATTR_VAL like '%LTE%' \\n\\t\\t\\t\\t\\t\\t and ATTR_NAME='终端机型' and plan_id in(111003009356,111003009357,111003009358,111003009359,111003009360,111003009361,111003009362,111003009363,111003009364,111003009365,111003009366,111003009367,111003009368,111003009369,111003009370,111003009371,111003009372,111003009373,111003009374,111003009375,111003009376,111003009377,111003009378,111003009379,111003009380,111003009381,111003009382,111003009383,111003009384,111003009385,111003009386,111003009387,111003009388,111003009389,111003009390,111003009391,111003009392,111003009393,111003009394,111003009395,111003009396,111003009397,111003009398,111003009399,111003009400,111003009401,111003009402,111003009403,111003009404,111003009405,111003009406,111003009407,111003009408,111003009409,111003009410,111003009411,111003009412,111003009413,111003009414,111003009415,111003009416,111003009417,111003009418,111003009419,111003009420,111003009421,111003009422,111003009423,111003009424,111003009425,111003009426,111003009427,111003009428,111003009429,111003009430,111003009431,111003009432,111003009433,111003009434,111003009435,111003009436,111003009437,111003009438,111003009439,111003009440,111003009441,111003009442,111003009443,111003009444,111003009445,111003009446,111003009447)\\n\\t\\t\\t\\t\\t\\t and CUR_CYCLE_SERV_STATE In(1,104) group by user_id )  b \\n\\t\\t\\t\\ton  a.user_id=b.user_id and  a.UPDT_TIME=b.UPDT_TIME\\n\\t\\t   where a.ATTR_VAL like '%LTE%' \\n\\t\\t\\t and a.ATTR_NAME='终端机型' and a.plan_id in(111003009356,111003009357,111003009358,111003009359,111003009360,111003009361,111003009362,111003009363,111003009364,111003009365,111003009366,111003009367,111003009368,111003009369,111003009370,111003009371,111003009372,111003009373,111003009374,111003009375,111003009376,111003009377,111003009378,111003009379,111003009380,111003009381,111003009382,111003009383,111003009384,111003009385,111003009386,111003009387,111003009388,111003009389,111003009390,111003009391,111003009392,111003009393,111003009394,111003009395,111003009396,111003009397,111003009398,111003009399,111003009400,111003009401,111003009402,111003009403,111003009404,111003009405,111003009406,111003009407,111003009408,111003009409,111003009410,111003009411,111003009412,111003009413,111003009414,111003009415,111003009416,111003009417,111003009418,111003009419,111003009420,111003009421,111003009422,111003009423,111003009424,111003009425,111003009426,111003009427,111003009428,111003009429,111003009430,111003009431,111003009432,111003009433,111003009434,111003009435,111003009436,111003009437,111003009438,111003009439,111003009440,111003009441,111003009442,111003009443,111003009444,111003009445,111003009446,111003009447)\\n\\t\\t\\t  and a.CUR_CYCLE_SERV_STATE In(1,104) group by a.user_id,a.ATTR_VAL)  d \\n\\ton  a.user_id=d.user_id\\nleft join (select phone_no from gbasedwi.DWI_INST_OFFER_PLAN_DS_${curmlastday} where plan_id in (111001000713,111001000714) and CUR_CYCLE_STATE =1  group by phone_no  ) e on a.phone_no=e.phone_no\\nleft join (select phone_no from gbasedwi.DWI_INST_OFFER_PLAN_DS_${curmlastday}  where plan_id in (111001000523,111001000525) and CUR_CYCLE_STATE=1  group by phone_no  ) f on a.phone_no=f.phone_no\\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG  =1"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [216]-[index:343]-[2012年12月新增指标]-[143]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"143.创建当月收入临时表","nodeId":"143","sql":" ###删除表\\n drop table if exists dm.tmp_201212018_curm_arpu_${monthid};\\n ###创建表\\n create table dm.tmp_201212018_curm_arpu_${monthid}\\n (\\n phone_no varchar(20),\\n curm_arpu decimal(18,2) ###当月ARPU（剔除国际业务收入）\\n )distributed by ('phone_no');\\n ###插入数据\\ninsert into dm.tmp_201212018_curm_arpu_${monthid}\\nselect\\ndistinct\\na.phone_no,\\nc.HF0004-b.IC1300-b.IC0500-b.IC0400-b.IC0800-b.IC0700-d.ROAMOUT_FEE should_income ###当月ARPU（剔除国际业务收入）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a  \\nleft join dm.DM_AUTORPT_ACCT_${monthid} b on a.phone_no=b.product_no\\nleft join dm.DM_AUTORPT_HIS_INDEX_${monthid} c on a.phone_no=c.product_no\\nleft join dm.DM_PUB_INCREASE_${monthid} d on a.phone_no=d.product_no\\nwhere (a.prod_kind_code= 171000000001 and a.month_arrive_flag=1) or a.month_off_flag  =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [217]-[index:344]-[2012年12月新增指标]-[65]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据11","nodeId":"65","sql":"insert into ${DM_PUB_201212018_TMP11_MONTHID}\\n (\\tuser_id\\t) \\nselect distinct t1.user_id    user_id\\nfrom ( select a.user_id from ${DWI_INST_ATTR_PLOY_SERV_MS_MONTHID} a\\n\\t   inner join ${DIM_LTE_BINDPHONE_OFFER} b on a.PLAN_ID=b.offer_id\\n\\t   where upper(a.ATTR_VAL) like '%LTE%' and a.CUR_CYCLE_SERV_STATE in (1,104)\\n\\t\\t and a.EFF_TIME>='${prem_first_day}' and a.EFF_TIME<='${var.date4}' and b.offer_type='LTE'\\n\\t  UNION all\\n\\t\\tselect c.user_id from ${DWI_INST_ATTR_PLOY_SERV_MS_MONTHID} c\\n\\t\\tinner join ${DIM_LTE_BINDPHONE_OFFER} d on c.PLAN_ID=d.offer_id\\n\\t\\twhere upper(c.ATTR_VAL) like '%IPHONE%' and c.CUR_CYCLE_SERV_STATE in (1,104)\\n\\t\\tand c.EFF_TIME>='${prem_first_day}' and c.EFF_TIME<='${var.date4}' and d.offer_type='IPHONE') t1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [218]-[index:345]-[2012年12月新增指标]-[116]-['str' object has no attribute 'lfind']:{"name":"116.删除临时表","nodeId":"116","dsName":"GbaseDM","sql":"drop table ${DM_PUB_201212018_TMP01_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP021_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP02_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP03_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP04_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP05_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP06_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP07_MONTHID};\\nDROP TABLE ${DM_PUB_201212018_TMP08_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP09_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP10_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP14_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP13_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP1301_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP1302_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP12_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP11_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP15_MONTHID};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [219]-[index:346]-[2012年12月新增指标]-[30]-['str' object has no attribute 'lfind']:{"name":"临时表8","nodeId":"30","dsName":"GbaseDM","sql":"create table  ${DM_PUB_201212018_TMP08_MONTHID}\\n      (    user_id                      BIGINT\\n      ) DISTRIBUTED BY('user_id') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [220]-[index:347]-[2012年12月新增指标]-[69]-['str' object has no attribute 'lfind']:{"name":"69.插入数据13","nodeId":"69","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP13_MONTHID}\\n (\\tproduct_no,IS_OFFER_4G,IS_CONTRACT_4G,GPRS_FEE,IS_STRESS\\t) \\nselect a.phone_no ,\\n\\t\\tcase when b.phone_no is null then 0 else  1 end ,\\n\\t\\tcase when c.USER_ID is null then 0 else 1 end ,\\n\\t\\tnvl(e.gprs_fee,0) ,\\n\\t\\tcase when f.phone_no is null then 0 else 1 end\\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} a \\nleft join  /*(select distinct phone_no \\n\\t\\t\\tfrom (select distinct a.phone_no from GBASEDWI.DWI_INST_OFFER_ADDBUSI_MS_${monthid} a \\n\\t\\t\\tinner join gbasedwd.dim_basekpi_4g_offer b on  a.plan_id=  b.offer_id \\n\\t\\t\\twhere a.EFF_TIME<='${curm_last_day}' and a.EXP_TIME>'${curm_last_day}'\\n             union all\\n\\t\\t\\tselect distinct a.phone_no from GBASEDWI.DWI_INST_OFFER_PLAN_MS_${monthid} a  \\n\\t\\t\\tinner join gbasedwd.dim_basekpi_4g_offer b on  a.plan_id=b.offer_id\\n\\t\\t\\twhere a.EFF_TIME<='${curm_last_day}' and a.EXP_TIME>'${curm_last_day}' ) a )  b */\\n\\t\\t\\t(select distinct product_no phone_no from ${DM_PUB_201212018_TMP1302_MONTHID} where flag=1 and (member_flag<>3 or freeflow>=300 ))  b\\n\\t        on a.phone_no =b.phone_no\\nleft join (select distinct USER_ID from ${DWI_INST_ATTR_PLOY_SERV_MS_MONTHID} \\n\\t\\t   where upper(ATTR_VAL) like '%LTE%' and CUR_CYCLE_SERV_STATE in (1,104) \\n\\t\\t     and to_char(EFF_TIME,'yyyymmdd')>='${curmfirstday}' and to_char(EFF_TIME,'yyyymmdd')<='${curmlastday}' \\n\\t\\t\\t and plan_id in (select offer_id from ${DIM_LTE_BINDPHONE_OFFER} where offer_type='LTE')\\n\\t\\t\\tUNION\\n\\t\\t  select distinct USER_ID from  ${DWI_INST_ATTR_PLOY_SERV_MS_MONTHID}\\n\\t\\t  where upper(ATTR_VAL) like '%IPHONE%' and CUR_CYCLE_SERV_STATE in (1,104) \\n\\t\\t    and to_char(EFF_TIME,'yyyymmdd')>='${curmfirstday}' and to_char(EFF_TIME,'yyyymmdd')<='${curmlastday}' \\n\\t\\t\\tand plan_id in (select offer_id from ${DIM_LTE_BINDPHONE_OFFER} where offer_type='IPHONE')) c \\n\\ton a.USER_ID =c.USER_ID\\nleft join (select phone_no,sum(should_INCOME)  as gprs_fee from ${DWI_INCO_BILL_ITEM_TOT_MS_MONTHID}   a \\n\\t\\t   inner join (select * from gbasemsm.dim_ckpi_basekpi_feeitem where fee_type_name='流量' ) b \\n\\t\\t\\t\\ton a.ACCT_ITEM_ID=b.fee_item_id group by phone_no) e  on a.phone_no=e.phone_no\\nleft join  gbasedwi.dwi_usr_pesn_high_ms_${monthid}  f  on a.phone_no =f.phone_no \\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG  =1","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [221]-[index:348]-[2012年12月新增指标]-[136]-['str' object has no attribute 'lfind']:{"name":"136.创建临时表并插入数据","nodeId":"136","dsName":"GbaseDM","sql":"###删除表\\ndrop table if exists tmp_dm_pub_201212018_commuser_${monthid};\\n###创建表\\ncreate table tmp_dm_pub_201212018_commuser_${monthid}\\n (\\n   phone_no varchar(20),\\n   is_comm_user varchar(10)\\n ) distributed by ('phone_no');\\n###插入数据\\ninsert into tmp_dm_pub_201212018_commuser_${monthid}\\nselect a.phone_no,\\n       b.is_comm_user     #是否为通信客户（不含物联网）\\n       from gbasedwi.DWI_USR_PESN_PARTINFO_MS_${monthid} a \\nleft join (select product_no,IS_COMM_USER from dm.DM_PUB_20130916_${curmlastday} group by product_no,IS_COMM_USER ) b on a.phone_no=b.product_no\\nwhere a.PROD_KIND_CODE='171000000001' And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1);","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [222]-[index:349]-[2012年12月新增指标]-[64]-['str' object has no attribute 'lfind']:{"name":"临时表11","nodeId":"64","dsName":"GbaseDM","sql":"create table  ${DM_PUB_201212018_TMP11_MONTHID}\\n      (    user_id                      BIGINT \\n      ) DISTRIBUTED BY('user_id') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [223]-[index:350]-[2012年12月新增指标]-[20]-['str' object has no attribute 'lfind']:{"name":"临时表3","nodeId":"20","dsName":"GbaseDM","sql":"create table  ${DM_PUB_201212018_TMP03_MONTHID}\\n      ( user_id                      BIGINT\\n       ,OWE_THREE_FEE                DECIMAL(14, 2)\\n      ) DISTRIBUTED BY('user_id') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [224]-[index:351]-[2012年12月新增指标]-[19]-['str' object has no attribute 'lfind']:{"name":"19.插入数据2","nodeId":"19","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP02_MONTHID}\\n (\\t user_id\\n\\t,PRODUCT_NO\\n\\t,IS_STABLE_IMEI      \\n\\t,IS_NEW_IMEI\\n\\t,IS_TURN_BRAND\\n\\t,OLD_ORDER_NAME\\n\\t,NEW_ORDER_NAME\\n\\t,TRUTH_NAME\\n\\t,BIRTH_DAY\\n\\t,ENTERPRISE_MARK\\n\\t,VIP_MANAGER_ID\\n\\t,WORK_NAME\\n\\t,STATION_NAME\\n\\t,VIP_NO\\n\\t,IS_APPLY_STOP\\n\\t,CALL_DAYS\\n\\t,MESSAGE_DAYS\\n\\t,IS_ACCT_USER\\n\\t,ISCARD_DOUBLE\\n\\t,ENT_CUST_ID\\n\\t,DOUBLE_CARD_TYPE\\n\\t,IS_ACTIVE\\n\\t,IS_PHOTO_USER\\n\\t,PHOTO_DEPT\\n\\t,OPPOSITE_NUMBER\\n\\t,OPPOSITE_PHONE_NUMBER\\n\\t,CUST_LEVEL\\n\\t,IMSI_NO\\n\\t,SCALE_ID\\n\\t,BRAND_ID\\n\\t,MAIN_BRAND_ID\\n\\t,IS_OFFER_4G\\n\\t,IS_STRESS\\n\\t,CUST_TYPE\\n\\t,DEPT_NAME\\n\\t,ENTERPRISE_MARK1\\n\\t,IS_MISSUSER\\n\\t,CAMPUS_ID\\n\\t,IS_USIM_USER\\n\\t,IS_NFC_USER\\n\\t,IS_YIJINGPHONE_USER\\n\\t,DUAL_CARD\\n\\t,TERM_IMEI\\n\\t,CMNET_TIME\\n\\t,CMWAP_TIME\\n\\t,TURN_BRAND_OLD\\n\\t,TURN_BRAND_NEW\\n    ,IS_YIJING_ACCT_USER \\t) \\nselect\\t t1.USER_ID                     USER_ID\\n        ,t1.PHONE_NO                    PRODUCT_NO\\n\\t\\t,t2.STAB_TERM_USER_FLAG         IS_STABLE_IMEI\\n        ,t2.NEW_MACH_USER_FLAG          IS_NEW_IMEI\\n        ,t3.IS_TURN_BRAND     \\t\\t\\tIS_TURN_BRAND\\n        ,t3.OLD_ORDER_NAME              OLD_ORDER_NAME\\n        ,t3.new_order_name              NEW_ORDER_NAME\\n\\t\\t,t2.REALNAME_USER_FLAG          TRUTH_NAME\\n        ,t2.CUST_BIRTHDAY               BIRTH_DAY\\n        ,t4.GRP_MEMB_FLAG               ENTERPRISE_MARK\\n        ,t2.VIP_MGR_ID                  VIP_MANAGER_ID\\n        ,t2.VIP_MGR_NAME                WORK_NAME\\n        ,t2.VIP_MGR_OWNER_DEPT          STATION_NAME\\n\\t\\t,t2.VIP_CARD_NO                 VIP_NO\\n        ,t2.STOP_USER_FLAG              IS_APPLY_STOP\\n        ,t9.CALL_DAYS                   CALL_DAYS\\n        ,nvl(t12.D_N_026,0)                 MESSAGE_DAYS\\n        ,t2.BILL_USER_FLAG              IS_ACCT_USER\\n        ,t2.DOU_CARD_USER_FLAG          ISCARD_DOUBLE\\n        ,t11.CO_CODE                     ENT_CUST_ID\\n        ,t2.DOU_CARD_TYPE               DOUBLE_CARD_TYPE\\n\\t\\t,t4.ACTIVE_USER_FLAG            IS_ACTIVE\\n\\t\\t,t6.IS_PHOTO_USER\\t\\t\\t\\tIS_PHOTO_USER\\n\\t\\t,t6.PHOTO_DEPT             \\t\\tPHOTO_DEPT\\n        ,t2.COMM_OPP_NUM                OPPOSITE_NUMBER\\n        ,t2.COMM_OPP_PHONE_NO_NUM       OPPOSITE_PHONE_NUMBER\\n        ,nvl(t13.CREDIT_LEVEL,-1)       CUST_LEVEL\\n        ,t2.IMSI                        IMSI_NO\\n        ,t2.GRP_CUST_TYPE       SCALE_ID\\n        ,t1.BRAND_ID                    BRAND_ID\\n        ,t7.main_brand_id               MAIN_BRAND_ID\\n        ,t2.G4_PROD_HANDL_FLAG          IS_OFFER_4G\\n        ,t2.IMPOT_EXIST_USER_FLAG       IS_STRESS\\n        ,t2.EXIST_CUST_PHOTO_TYPE       CUST_TYPE\\n        ,t2.EXIST_CUST_PHOTO_COUNTY_ID  DEPT_NAME\\n        ,t2.EXIST_CUST_PHOTO_GOV_BELNG  ENTERPRISE_MARK1\\n        ,t1.LOST_USER_FLAG              IS_MISSUSER\\n\\t\\t,NULL  /*t2.OWNER_SCHL  */      CAMPUS_ID\\n        ,t2.USIM_CARD_USER_FLAG         IS_USIM_USER\\n        ,t2.NFC_CARD_USER_FLAG          IS_NFC_USER\\n        ,case when t10.MSISDN is not null then 1 else 0 end   IS_YIJINGPHONE_USER\\n        ,t2.DOU_CARD_MOB_FLAG           DUAL_CARD\\n        ,t2.TERM_IMEI                   TERM_IMEI\\n\\t\\t,t5.CMNET_DUR                   CMNET_TIME\\n\\t\\t,t5.CMWAP_DUR                   CMWAP_TIME\\n\\t\\t,t3.TURN_BRAND_OLD\\n\\t\\t,t3.TURN_BRAND_NEW\\n\\t\\t,case when t14.product_no is not null then 1 else 0 end   IS_YIJING_ACCT_USER \\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join ${DWA_UV_USER_BASEINFO_MS_MONTHID} t2 on t1.user_id=t2.user_id\\nleft join ${DM_PUB_201212018_TMP01_MONTHID} t3 on t1.phone_no =t3.phone_no\\nleft join gbasedwd.DIM_PRODUCT_SUBBRAND t7 on  t1.SUB_BRAND_ID=t7.SUB_BRAND_ID\\nleft join ${DWI_USR_PESN_MS_MONTHID} t4 on t1.phone_no=t4.phone_no\\nleft join (select distinct MSISDN from gbasebas.INT_22038_COMM_MS_${monthid}) t10 on t1.phone_no=t10.MSISDN\\n/*left join (select distinct product_no from gbasebas.dw_tongxin_product_dm_new_${monthid}) t10 on t1.phone_no=t10.product_no*/\\nleft join (select distinct product_no,IS_PHOTO_USER,PHOTO_DEPT\\n\\t\\t   from DM_PUB_201212018_${pmonthid}) t6 on t1.phone_no=t6.product_no\\nleft join (select phone_no,sum(CMNET_DUR)  CMNET_DUR,sum(CMWAP_DUR)  CMWAP_DUR\\n\\t\\t   from ${DWI_BEH_USE_GPRS_USERTOT_MS_MONTHID} group by phone_no) t5 on t1.phone_no=t5.phone_no\\n\\n/*left join (select phone_no, count(distinct stat_date) COMM_DAYS from gbasedwi.dwi_beh_use_cdrcomm_user_dt_${curmlastday}\\n where stat_date >= '${curm_first_day}' and stat_date <= '${curm_last_day}' group by phone_no) t8 on t1.phone_no=t8.phone_no*/\\n \\n left join (select phone_no,count(distinct STAT_DATE)  CALL_DAYS\\n              from gbasedwd.DWD_EVT_CDR_VOC_BASETOT_DM_${monthid} group by phone_no) t9 on t1.phone_no=t9.phone_no\\nleft join ${DWI_USR_GRP_MEB_MS_MONTHID} t11  on t1.phone_no=t11.MEMB_NO\\nleft join  DM_PUB_NEWBUSI_${curmlastday}  t12 on t1.phone_no=t12.product_no\\nleft join  (\\n         select a.phone_no,  \\n                b.crdt_lvl  CREDIT_LEVEL        \\n        from gbasedwi.DWI_USR_PESN_PARTINFO_MS_${monthid} a\\n        left join  (\\n\\t\\t\\t select  phone_no,\\n                     max(CRDT_LVL) crdt_lvl\\n             from gbasedwd.DWD_SVC_USR_CREDIT_MS_${monthid}\\n             group by phone_no\\n\\t\\t\\t  ) b on a.phone_no=b.phone_no \\n\\t\\t\\tgroup by a.phone_no,b.crdt_lvl\\n\\t\\t\\t) t13 on t1.phone_no=t13.phone_no\\nleft join (select distinct product_no from gbasemsm.msm_dw_basekpi_10492_detail_${monthid}) t14  on t1.phone_no=t14.product_no\\n where (t1.MONTH_ARRIVE_FLAG=1  or t1.MONTH_OFF_FLAG  =1 ) And t1.PROD_KIND_CODE= 171000000001","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [225]-[index:352]-[2012年12月新增指标]-[67]-['str' object has no attribute 'lfind']:{"name":"插入数据12","nodeId":"67","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP12_MONTHID}\\n (\\t PRODUCT_NO\\n\\t,TRANSFER_CALL_DURATION_M \\t)\\nselect a.PHONE_NO,sum(a.TRANSFER_CALL_DURATION_M) TRANSFER_CALL_DURATION_M\\nfrom ( select PHONE_NO,OPP_NO,sum(FORW_CALL_DUR) TRANSFER_CALL_DURATION_M\\n\\t\\tfrom  ${DWI_BEH_USE_SPHERE_TOT_MS_MONTHID}\\n\\t\\twhere COMM_TYPE ='0' and OPP_CARR in ('02','03') group by PHONE_NO,OPP_NO) a\\ninner join (select CMPT_PHONE_NO from ${DWI_BEH_USE_OPP_TOT_MS_MONTHID} a\\n\\t\\t\\twhere a.CARR_NAME in ('联通','电信')) b on a.OPP_NO=b.CMPT_PHONE_NO\\ngroup by a.PHONE_NO;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [226]-[index:353]-[2012年12月新增指标]-[141]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseRPT","dsName":"GbaseRPT","schema_union":"GbaseRPT","schema_dev":"GbaseRPT","schema_prod":"GbaseRPT","queue_union":"","queue_dev":"","queue_prod":"","name":"141.创建临时表并插入数据","nodeId":"141","sql":"### 饱和度-定向流量资源\\n#删除表\\ndrop table dm.tmp_offer_dx_gprs_${monthid};\\n#创建表\\ncreate table dm.tmp_offer_dx_gprs_${monthid}\\n(\\nphone_no varchar(20),\\ndx_gprs_resource_bhd decimal(10,4)##饱和度定向流量资源\\n) distributed by ('phone_no');\\n#插入数据\\ninsert into dm.tmp_offer_dx_gprs_${monthid}    \\nselect a.phone_no,\\n       b.USE_RES_NUM/b.TOTAL_RES_NUM  ##饱和度定向流量资源\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a   \\nleft join (select  b.phone_no,sum(b.USE_RES_NUM) USE_RES_NUM,sum(b.TOTAL_RES_NUM) TOTAL_RES_NUM from dm.dim_dx_flow a\\nleft join gbasedwi.dwi_inco_bill_freeres_ms_${monthid} b on a.plan_id=b.plan_id and a.use_type=b.use_type \\ngroup by phone_no) b on a.phone_no=b.phone_no\\nwhere (a.prod_kind_code= 171000000001 and a.month_arrive_flag=1) or a.month_off_flag  =1;\\n#########################################################################################################################\\n\\n##########################################################################################################################\\n###饱和度-不限量产品\\n##删除表\\ndrop table dm.tmp_offer_bxl_gprs_${monthid};\\n#创建表\\ncreate table dm.tmp_offer_bxl_gprs_${monthid}\\n( \\nphone_no varchar(20),    \\nbxl_gprs_resource_bhd decimal(10,4) ##饱和度不限量产品 20190524日调整口径\\n)distributed by ('phone_no');\\n##插入数据\\ninsert into dm.tmp_offer_bxl_gprs_${monthid}\\nselect a.phone_no,\\n       b.USE_RES_NUM/b.TOTAL_RES_NUM ##饱和度不限量产品       \\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a   \\nleft join (\\n            select  a.phone_no,\\n\\t\\t            sum(case when b.plan_id is not null then a.USE_RES_NUM else 0 end ) USE_RES_NUM,\\n\\t\\t            sum(case when b.plan_Id is not null then a.TOTAL_RES_NUM else 0 end ) TOTAL_RES_NUM \\n            from gbasedwi.dwi_inco_bill_freeres_ms_${monthid} a\\n            left join (\\n                       select plan_id From dm.dim_bxl_product group by plan_id\\n                      ) b on a.plan_Id=b.plan_id \\n            where a.prod_attr_name not in ('限速控制小流量包','限速服务','国内(含港澳台)限速服务') \\n\\t\\t\\tgroup by a.phone_no \\n\\t\\t   ) b on a.phone_no=b.phone_no\\nwhere (a.prod_kind_code= 171000000001 and a.month_arrive_flag=1) or a.month_off_flag  =1;\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [227]-[index:354]-[2012年12月新增指标]-[66]-['str' object has no attribute 'lfind']:{"name":"临时表12","nodeId":"66","dsName":"GbaseDM","sql":"create table ${DM_PUB_201212018_TMP12_MONTHID}(\\n          PRODUCT_NO                   VARCHAR(20)\\n         ,TRANSFER_CALL_DURATION_M     BIGINT\\n) DISTRIBUTED BY('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [228]-[index:355]-[2012年12月新增指标]-[149]-['str' object has no attribute 'lfind']:{"name":"149.创建app临时表","nodeId":"149","dsName":"GbaseDM","sql":"drop table dm.tmp_201212018_apptype_${monthid};\\n##创建临时表\\nCREATE TABLE dm.tmp_201212018_apptype_${monthid}\\n( phone_no varchar(20),\\n  yk_flow_m bigint,\\n  tx_flow_m bigint,\\n  aqi_flow_m bigint,\\n  mgzb_flow_m bigint,\\n  pptv_flow_m bigint,\\n  xg_flow_m bigint,\\n  mg_flow_m bigint,\\n  blbl_flow_m bigint,\\n  wy_flow_m bigint,\\n  mgyy_flow_m bigint,\\n  wzry_flow_m bigint,\\n  mgyx_flow_m bigint,\\n  mgyd_flow_m bigint,\\n  mgdm_flow_m bigint,\\n  qqyy_flow_m bigint,\\n  kgyy_flow_m bigint,\\n  kwyy_flow_m bigint,\\n  jrtt_flow_m bigint,\\n  ks_flow_M bigint,\\n  bd_flow_m bigint,\\n  wb_flow_m bigint,\\n  sh_flow_m bigint,\\n  bfyy_flow_m bigint,\\n  ls_flow_m bigint,\\n  mgsp_flow_m bigint,\\n  ysj_flow_m bigint\\n  ) distributed by('phone_No');\\n###插入数据\\ninsert into dm.tmp_201212018_apptype_${monthid}\\nselect phone_no,\\n       sum(case when b.Service_id='1750000002' then a.total_flow_M else 0 end) yk_flow_m, -- 优酷视频流量（MB)\\n       sum(case when b.service_Id='1750000003' then a.total_flow_m else 0 end) tx_flow_m, -- 腾讯视频流量（MB)\\n       sum(case when b.service_id='1750000004' then a.total_flow_m else 0 end) aqi_flow_m, -- 爱奇艺流量（MB)\\n       sum(case when b.service_id='1750000007' then a.total_flow_m else 0 end) mgzb_flow_m, -- 咪咕直播流量（MB)\\n       sum(case when b.service_id='1750000008' then a.total_Flow_m else 0 end) pptv_flow_m, -- pptv流量（MB)\\n       sum(case when b.service_Id='1750000012' then a.total_flow_m else 0 end) xg_flow_m, -- 西瓜视频流量（MB)\\n       sum(case when b.service_Id='1750000005' then a.total_flow_m else 0 end) mg_flow_m, -- 芒果TV流量（MB)\\n       sum(case when b.service_id='1750000009' then a.total_flow_m else 0 end) blbl_flow_m, -- 哔哩哔哩流量（MB)\\n       sum(case when b.service_id='1750000052' then a.total_flow_m else 0 end) wy_flow_m, -- 网易云音乐流量（MB)\\n       sum(case when b.service_id='1750000056' then a.total_flow_m else 0 end) mgyy_flow_m, -- 咪咕音乐流量（MB)\\n       sum(case when b.service_id='1750000031' then a.total_flow_m else 0 end) wzry_flow_m, -- 王者荣耀流量（MB)\\n       sum(case when b.service_Id='1750000034' then a.total_flow_m else 0 end) mgyx_flow_m, -- 咪咕游戏流量（MB)\\n       sum(case when b.service_Id='1750000082' then a.total_flow_m else 0 end) mgyd_flow_m, -- 咪咕阅读流量（MB)\\n       sum(case when b.service_id='1750000083' then a.total_flow_m else 0 end) mgdm_flow_m, -- 咪咕动漫流量（MB)\\n       sum(case when b.service_id='1750000053' then a.total_flow_m else 0 end) qqyy_flow_m, -- QQ音乐流量（MB)\\n       sum(case when b.service_Id='1750000054' then a.total_flow_m else 0 end) kgyy_flow_m,-- 酷狗音乐流量（MB)\\n       sum(case when b.service_id='1750000055' then a.total_flow_m else 0 end) kwyy_flow_m,-- 酷我音乐流量（MB)\\n       sum(case when b.service_id='1750000081' then a.total_flow_m else 0 end) jrtt_flow_m, -- 今日头条流量（MB)\\n       sum(case when b.service_Id='1750000013' then a.total_flow_m else 0 end) ks_flow_M, -- 快手流量（MB)\\n       sum(case when b.service_Id='1750000085' then a.total_flow_m else 0 end) bd_flow_m, -- 百度流量（MB)\\n       sum(case when b.service_id='1750000084' then a.total_flow_m else 0 end) wb_flow_m,-- 微博流量（MB)\\n       sum(case when b.service_Id='1750000010' then a.total_flow_m else 0 end) sh_flow_m,-- 搜狐流量（MB)\\n       sum(case when b.service_Id='1750000011' then a.total_flow_m else 0 end) bfyy_flow_m,-- 暴风影音（MB)\\n       sum(case when b.service_id='1750000001' then a.total_flow_m else 0 end) ls_flow_m,-- 乐视流量（MB)\\n       sum(case when b.service_id in ('1750000006','1030000006') then a.total_flow_m else 0 end) mgsp_flow_m, -- 咪咕视频流量（MB)\\n       sum(case when b.service_id='1750100001' then a.total_flow_m else 0 end) ysj_flow_m -- 云视界流量（MB）\\nfrom\\n(select phone_no,Content_bill_id,sum(total_flow)/1024/1024 total_flow_M \\n         from gbasedwd.dwd_evt_cdr_gprs_busitypetot_ms_${monthid}\\n     group by phone_no,Content_bill_id ) a  \\nleft join dm.dim_serviceid_type b on a.Content_bill_id=b.Service_id\\ngroup by phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [229]-[index:356]-[2012年12月新增指标]-[32]-['str' object has no attribute 'lfind']:{"name":"临时表9","nodeId":"32","dsName":"GbaseDM","sql":"create table  ${DM_PUB_201212018_TMP09_MONTHID}\\n (    user_id                      BIGINT\\n          ,phone_no                   varchar(20)\\n          ,IS_TEST_4G                   SMALLINT\\n          ,IS_PREPARATION_CARD          SMALLINT\\n          ,IS_ACTIVATION_CARD           SMALLINT\\n\\t\\t  ,IS_SELL\\t\\t\\t\\t\\t\\tSMALLINT\\n          ,IS_139MAILBOX_USER           SMALLINT\\n          ,IS_DELAY_USER                SMALLINT\\n          ,IS_LISTPROTECT_USER          SMALLINT\\n          ,IS_BILLPROTECT_USER          SMALLINT\\n          ,IS_3G_ASSESSUSER             SMALLINT\\n          ,IS_4G_ASSESSUSER             SMALLINT\\n          ,BA_SVC_NO                    VARCHAR(30)\\n\\t\\t  ,TD_PHONE\\t\\t\\t\\t\\t\\tVARCHAR(100)\\n) DISTRIBUTED BY('user_id') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [230]-[index:357]-[2012年12月新增指标]-[23]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"23.插入数据4","nodeId":"23","sql":"insert into ${DM_PUB_201212018_TMP04_MONTHID}\\n (\\t phone_no\\n\\t,free_flow_all\\n\\t,CALL_TOTAL_PROPORTION\\n\\t,MESSAGE_TOTAL_PROPORTION\\n\\t,LAST_GPRS_FLOW_M\\n\\t,GPRS_TOTAL_PROPORTION\\n\\t,MARGIN_GPRS\\n    ,call_used_value\\t)\\nselect\\tt1.phone_no,\\n\\t\\ta.free_flow_all,\\n\\t\\tcase when a.call_total_value=0 then 0 else cast(cast(a.call_used_value as decimal(15,3))/cast(a.call_total_value as decimal(15,3)) as decimal(15,3)) end call_total_proportion,\\n\\t\\ta.message_total_proportion,\\n\\t\\tb.LAST_GPRS_FLOW_M        LAST_GPRS_FLOW_M,              /*各月GPRS资源总量*/\\n\\t\\tcase when b.LAST_GPRS_FLOW_M=0 then 0 else cast(cast((b.LAST_GPRS_FLOW_M -b.MARGIN_GPRS) AS DECIMAL(15,3))/CAST(b.LAST_GPRS_FLOW_M AS DECIMAL(15,3))  AS DECIMAL(15,3)) end GPRS_TOTAL_PROPORTION,\\t\\t/*套餐流量资源使用率*/\\n\\t\\tb.MARGIN_GPRS           MARGIN_GPRS,             /*月GPRS资源余量*/\\n\\t\\ta.call_used_value    call_used_value          /*语音资源使用量*/\\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join (select phone_no,\\n        nvl(sum(case when USE_TYPE='数据流量' then total_value  end)/1024,0) FREE_FLOW_ALL,\\n        sum(case when USE_TYPE='短信' then  cast(cast(used_value as decimal(13,3))/cast(total_value as decimal(13,3)) as decimal(13,3)) else 0 end)       message_total_proportion,\\n        nvl(sum(case when res_unit=60 then total_value end ),0)/60 call_total_value,\\n        nvl(sum(case when res_unit=60 then  used_value end),0)/60 call_used_value\\n\\t from (select phone_no,USE_TYPE,res_unit,sum(USE_RES_NUM) as used_value,sum(TOTAL_RES_NUM) as total_value\\n\\t\\t   from ${DWI_INCO_BILL_FREERES_MS_MONTHID}\\n\\t       where USE_TYPE in ('短信','数据流量') or res_unit=60 group by phone_no,USE_TYPE,res_unit) a where total_value > 0\\n\\t       group by phone_no) a on t1.phone_no=a.phone_no\\nleft join (select  phone_no,last_gprs_flow_m/1024 LAST_GPRS_FLOW_M,       /*gprs资源总量*/\\n\\t\\t\\t\\t\\t(last_gprs_flow_m-last1m_boss_gprs_value) /1024 MARGIN_GPRS    /*gprs资源余量*/\\n\\t\\t\\tfrom (select b.phone_no,\\n                         sum(nvl(case when b.USE_TYPE is not null then TOTAL_RES_NUM end ,0) ) as last_gprs_flow_m,       /*GPRS总量*/\\n                         sum(nvl(case when b.USE_TYPE is not null then USE_RES_NUM end ,0)) as  last1m_boss_gprs_value  /*GPRS使用 */\\n                  from dm.dim_gprs_use_type a \\n                  left join gbasedwi.DWI_INCO_BILL_FREERES_MS_${monthid} b on a.use_type=b.use_type\\n\\t\\t\\t\\t  where TOTAL_RES_NUM<1000000000000000000 and prod_id<>'54001105'\\n                  group by b.phone_no\\n\\t\\t\\t      /*select phone_no,20190226日调整口径\\n\\t\\t\\t\\t\\t\\tsum(nvl(case when  USE_TYPE in ('国内通用流量','本地闲时流量','本地4G流量直充赠送','本地通用流量','本地流量','季包/卡流量','闲时流量','国内通用流量直充赠送','本地数据流量','通用流量指定用户定额统付','流量嗨包月包','本地4G流量','寒暑假国内流量','无线DDN数据流量（关停）','半年包/卡流量','积分兑换数据流量包')  then TOTAL_RES_NUM end ,0) ) as last_gprs_flow_m,       GPRS总量\\n\\t\\t\\t\\t\\t\\tsum(nvl(case when  USE_TYPE in ('国内通用流量','本地闲时流量','本地4G流量直充赠送','本地通用流量','本地流量','季包/卡流量','闲时流量','国内通用流量直充赠送','本地数据流量','通用流量指定用户定额统付','流量嗨包月包','本地4G流量','寒暑假国内流量','无线DDN数据流量（关停）','半年包/卡流量','积分兑换数据流量包')  then USE_RES_NUM end ,0)) as  last1m_boss_gprs_value  GPRS使用\\n\\t\\t\\t\\t  from  gbasedwi.DWI_INCO_BILL_FREERES_MS_${monthid} \\n\\t\\t\\t\\t  group by phone_no*/\\n\\t\\t\\t\\t  ) a \\n\\t     ) b on t1.phone_no=b.phone_no\\nwhere (t1.MONTH_ARRIVE_FLAG=1 And t1.PROD_KIND_CODE= '171000000001') or t1.MONTH_OFF_FLAG  =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [231]-[index:361]-[2012年12月新增指标]-[24]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"临时表5","nodeId":"24","sql":"drop table ${DM_PUB_201212018_TMP05_MONTHID};\\ncreate table  ${DM_PUB_201212018_TMP05_MONTHID}\\n (   product_no                   varchar(20)\\n\\t,CUR_PROMOTION_SCORE          BIGINT\\n\\t,CUR_DATA_SCORE               BIGINT\\n\\t,CUR_CONSUME_SCORE            BIGINT\\n\\t,CHANGE_SCORE_MONTH           BIGINT\\n\\t,CHANGE_SCORE_YEAR            BIGINT\\n\\t,FREE_FLOW_ALL                BIGINT\\n\\t,ACTIVE_COUNT                 SMALLINT\\n\\t,GPRS_COUNT1                  INTEGER\\n\\t,GPRS_COUNT2                  INTEGER\\n\\t,GPRS_COUNT3                  INTEGER\\n\\t,GPRS_COUNT4                  INTEGER\\n\\t,IS_4G_USER                   SMALLINT\\n) DISTRIBUTED BY('product_no') nolock;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [232]-[index:362]-[2012年12月新增指标]-[90]-['str' object has no attribute 'lfind']:{"name":"临时表15","nodeId":"90","dsName":"GbaseDM","sql":"create table  ${DM_PUB_201212018_TMP15_MONTHID}\\n      (   phone_no                           varchar(20)\\n\\t      ,IS_TD_USER                        SMALLINT\\n          ,CALL_DURATION_M                   BIGINT\\n          ,OUT_CALL_DUREATION_M              BIGINT\\n          ,IN_CALL_DURATION_M                BIGINT   \\n          ,INPLAN_OUT_CALL_DURAION_M         BIGINT\\n          ,INPLAN_IN_CALL_DURATION_M         BIGINT\\n          ,OUTPLAN_OUT_CALL_DURATION_M       BIGINT \\n          ,OUTPLAN_IN_CALL_DURATION_M        BIGINT\\n          ,TD_CALL_NUM                       INTEGER\\n          ,TD_VOICE_NUM                      INTEGER\\n          ,TD_GPRS_NUM                       INTEGER\\n          ,LAST_STOP_DATE                    DATETIME\\n          ,STOP_TWICE_NUM                    INTEGER\\n          ,IS_SELL                           SMALLINT\\n      ) DISTRIBUTED BY('phone_no') nolock;\\n\\t  \\n\\t  ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [233]-[index:363]-[2012年12月新增指标]-[15]-['str' object has no attribute 'lfind']:{"name":"插入数据1","nodeId":"15","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP01_MONTHID} \\n(phone_no,\\n is_turn_brand,\\n old_order_name,\\n new_order_name,\\n TURN_BRAND_OLD,\\n TURN_BRAND_NEW)\\n  select t1.phone_no\\n        ,max(case when a.ord_type = '转品牌' then 1 else 0 end ) as is_turn_brand                       \\n        ,max(case when a.ord_type = '转品牌' and to_char(c.EXP_TIME,'yyyy-mm-dd') = '${curm_last_day}' then c.plan_name end) as old_order_name   \\n        ,max(case when a.ord_type = '转品牌' and to_char(c.EFF_TIME,'yyyy-mm-dd') = '${nextm_first_day}' and c.CUR_CYCLE_STATE= 1 then c.plan_name  end) as new_order_name   \\n\\t\\t,d.turn_brand_old        \\n        ,d.turn_brand_new  \\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join gbasedwi.DWI_INST_ORD_LIST_DM_${monthid} a   on t1.phone_no=a.phone_no\\nleft join gbasedwi.DWI_INST_OFFER_PLAN_MS_${monthid} c on t1.phone_no = c.phone_no \\nleft join ( select phone_no,\\nmax(case when ord_type = '转品牌' and attr_val_1 = '动感地带' then 4104 \\n    when ord_type = '转品牌' and attr_val_1 = '全球通' then 1101 \\n\\twhen ord_type = '转品牌' and attr_val_1 = '神州行5元卡' then 6120 \\n\\twhen ord_type = '转品牌' and attr_val_1 = '神州行B' then 6616 \\n\\twhen ord_type = '转品牌' and attr_val_1 = '神州行畅听卡' then 6110 \\n\\twhen ord_type = '转品牌' and attr_val_1 = '神州行大众卡' then 7107 \\n\\twhen ord_type = '转品牌' and attr_val_1 is null  then 0 end ) as turn_brand_old,   \\nmax(case when ord_type = '转品牌' and attr_val_2 = '动感地带' then 4104 \\n    when ord_type = '转品牌' and attr_val_2 = '全球通' then 1101 \\n\\twhen ord_type = '转品牌' and attr_val_2 = '神州行5元卡' then 6120 \\n\\twhen ord_type = '转品牌' and attr_val_2 = '神州行B' then 6616 \\n\\twhen ord_type = '转品牌' and attr_val_2 = '神州行畅听卡' then 6110 \\n\\twhen ord_type = '转品牌' and attr_val_2 = '神州行大众卡' then 7107 end ) as turn_brand_new   \\nfrom gbasedwi.DWI_INST_ORD_LIST_DM_${monthid} where ord_type = '转品牌' group by phone_no ) d  on t1.phone_no=d.phone_no\\nwhere to_char(a.STAT_DATE,'YYYYMM')=${monthid}  and ((t1.MONTH_ARRIVE_FLAG=1 And t1.PROD_KIND_CODE= 171000000001) or t1.MONTH_OFF_FLAG  =1 )\\ngroup by t1.phone_no,d.turn_brand_old,d.turn_brand_new \\n\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [234]-[index:364]-[2012年12月新增指标]-[109]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"临时表14","nodeId":"109","sql":"create table  ${DM_PUB_201212018_TMP14_MONTHID}\\n      (   phone_no               varchar(20)\\n\\t,IS_CHANGE_USIM                    SMALLINT\\n\\t,IS_HANDLE_4G        SMALLINT\\n\\t,IS_TERMINAL_4G     SMALLINT\\n\\t,IS_MIFI_4G                SMALLINT\\n\\t,TERMINAL_4G           varchar(800)\\n\\t,IS_TEST_4G              SMALLINT\\n      ) DISTRIBUTED BY('phone_no') nolock;\\n\\t  "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [235]-[index:365]-[2012年12月新增指标]-[18]-['str' object has no attribute 'lfind']:{"name":"临时表2","nodeId":"18","dsName":"GbaseDM","sql":"create table  ${DM_PUB_201212018_TMP02_MONTHID}\\n (\\t user_id                      BIGINT\\n           ,PRODUCT_NO                   VARCHAR(20)\\n           ,IS_STABLE_IMEI               SMALLINT\\n           ,IS_NEW_IMEI                  SMALLINT\\n           ,IS_TURN_BRAND                SMALLINT\\n           ,OLD_ORDER_NAME               VARCHAR(200)\\n           ,NEW_ORDER_NAME               VARCHAR(200)\\n           ,TRUTH_NAME                   SMALLINT\\n           ,BIRTH_DAY                    DATE\\n           ,ENTERPRISE_MARK              SMALLINT\\n           ,VIP_MANAGER_ID               VARCHAR(30)\\n           ,WORK_NAME                    VARCHAR(20)\\n           ,STATION_NAME                 VARCHAR(100)\\n           ,VIP_NO                       VARCHAR(50)\\n           ,IS_APPLY_STOP                SMALLINT\\n           ,CALL_DAYS                    BIGINT\\n           ,MESSAGE_DAYS                 BIGINT\\n           ,IS_ACTIVE                    SMALLINT\\n           ,IS_ACCT_USER                 SMALLINT\\n           ,ISCARD_DOUBLE                SMALLINT\\n           ,ENT_CUST_ID                  VARCHAR(50)\\n           ,DOUBLE_CARD_TYPE             SMALLINT\\n\\t\\t   ,IS_PHOTO_USER\\t\\t\\t\\t SMALLINT\\n           ,PHOTO_DEPT                   INTEGER\\n           ,TURN_BRAND_OLD               INTEGER\\n           ,TURN_BRAND_NEW               INTEGER\\n           ,OPPOSITE_NUMBER              INTEGER\\n           ,OPPOSITE_PHONE_NUMBER        INTEGER\\n           ,CUST_LEVEL                   INTEGER\\n           ,IMSI_NO                      VARCHAR(30)\\n           ,SCALE_ID                     SMALLINT\\n           ,BRAND_ID                     SMALLINT\\n           ,MAIN_BRAND_ID                SMALLINT\\n           ,IS_OFFER_4G                  SMALLINT\\n           ,IS_STRESS                    SMALLINT\\n           ,CUST_TYPE                    VARCHAR(20)\\n           ,DEPT_NAME                    VARCHAR(20)\\n           ,ENTERPRISE_MARK1             VARCHAR(50)\\n           ,IS_MISSUSER                  varchar(1)\\n           ,CAMPUS_ID                    SMALLINT\\n           ,IS_USIM_USER                 SMALLINT\\n           ,IS_NFC_USER                  SMALLINT\\n           ,IS_YIJINGPHONE_USER          SMALLINT\\n           ,DUAL_CARD                    varchar(1)\\n           ,TERM_IMEI                    VARCHAR(20)\\n           ,CMNET_TIME                   BIGINT\\n           ,CMWAP_TIME                   BIGINT\\n           ,IS_YIJING_ACCT_USER          SMALLINT\\n) DISTRIBUTED BY('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [236]-[index:366]-[2012年12月新增指标]-[35]-['str' object has no attribute 'lfind']:{"name":"插入数据10","nodeId":"35","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP10_MONTHID}\\n (\\tuser_id,ACCT2,ACCT12,ACCT14,ACCT16,IR_STAR_LONG,ACK_INTLONG,FIRST_NET_AWAKE \\t) \\nselect \\t distinct  t1.user_id\\t\\tuser_id\\n\\t\\t,case when t2.ACCT_ITEM_ID='472' then t2.BILL_INCOME else 0 end \\tACCT2\\n\\t\\t,case when t2.ACCT_ITEM_ID='2003' then t2.BILL_INCOME else 0 end\\tACCT12\\n\\t\\t,case when t2.ACCT_ITEM_ID='1086' then t2.BILL_INCOME else 0 end\\tACCT14\\n\\t\\t,case when t2.ACCT_ITEM_ID='1063' then t2.BILL_INCOME else 0 end\\tACCT16\\n\\t\\t,case when t2.ACCT_ITEM_ID='21' then t2.BILL_INCOME else 0 end\\t\\tIR_STAR_LONG\\n\\t\\t,case when t2.ACCT_ITEM_ID='1141' then t2.BILL_INCOME else 0 end\\tACK_INTLONG\\n\\t\\t,case when t3.busi_type=2244 then 1 else 0 end\\t\\t\\t\\t\\t\\tFIRST_NET_AWAKE\\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join ${DWI_INCO_BILL_ITEM_TOT_MS_MONTHID} t2 \\n\\ton t1.user_id=t2.user_id and t2.ACCT_ITEM_ID in ('472','2003','1086','1063','21','1141')\\nleft join ${DWD_ACC_SMSSEND_REC_MS_MONTHID} t3 on t1.user_id=t3.user_id\\nwhere (t1.MONTH_ARRIVE_FLAG=1 And t1.PROD_KIND_CODE= 171000000001) or t1.MONTH_OFF_FLAG  =1","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [237]-[index:368]-[2012年12月新增指标]-[34]-['str' object has no attribute 'lfind']:{"name":"临时表10","nodeId":"34","dsName":"GbaseDM","sql":"create table  ${DM_PUB_201212018_TMP10_MONTHID}\\n      (    user_id                      BIGINT\\n          ,ACCT2                        DECIMAL(14, 2)\\n          ,ACCT12                       DECIMAL(14, 2)\\n          ,ACCT14                       DECIMAL(14, 2)\\n          ,ACCT16                       DECIMAL(14, 2)\\n          ,IR_STAR_LONG                 DECIMAL(14, 2)\\n          ,ACK_INTLONG                  DECIMAL(14, 2)\\n          ,FIRST_NET_AWAKE              SMALLINT\\n      ) DISTRIBUTED BY('user_id') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [238]-[index:369]-[2012年12月新增指标]-[131]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"131.创建表并插入数据","nodeId":"131","sql":" ##删除表\\n drop table if exists dm.tmp_dm_pub_201212018_user_${monthid};\\n ##创建表\\n create table dm.tmp_dm_pub_201212018_user_${monthid}\\n (\\n PHONE_NO varchar(20),\\n IS_4GNET_user_kaohe int,\\n IS_offer_user int,\\n county_id int\\n ) distributed by('PHONE_NO');\\n ##插入数据\\n insert into dm.tmp_dm_pub_201212018_user_${monthid}\\n select a.PHONE_NO,\\n       '0' IS_4GNET_user_kaohe, -- case when b.PHONE_NO is not null then 1 else 0 end IS_4GNET_user_kaohe, -- 是否4G网络客户（考核）\\n       case when c.PHONE_NO is not null then 1 else 0 end IS_offer_user,       -- 是否拍照老旧集团套餐客户\\n       c.county_id                                                             -- 拍照老旧集团套餐归属部门\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_MS_${monthid} a \\n-- left join (select distinct phone_no from gbasemsm.msm_dw_basekpi_10672_detail_${monthid}) b on a.phone_no=b.phone_no\\nleft join (select distinct phone_no,county_id from gbasemsm.msm_dw_basekpi_110626_snapshot_yyyymmdd) c on a.phone_no=c.phone_no\\n where a.PROD_KIND_CODE='171000000001' And \\n(a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1);"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [239]-[index:370]-[2012年12月新增指标]-[29]-['str' object has no attribute 'lfind']:{"name":"插入数据7","nodeId":"29","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP07_MONTHID}\\n (\\t user_id\\n\\t,phone_no\\n\\t,CPU_FREQUENCY\\n\\t,IS_GSM\\n\\t,IS_CDMA\\n\\t,TERMSCREEN_ID\\n\\t,TERM_SEGMENT\\n\\t,FLAG_2G\\n\\t,FLAG_3G\\n\\t,FLAG_4G\\n\\t,DEPT_CHANNEL_ID\\n\\t,LAST_YEAR_PHONE\\n\\t,IS_YEAR_PHONE\\n    ,DUAL_CARD\\t)\\nselect\\t distinct t1.user_id\\t\\tuser_id\\n\\t\\t,t1.phone_no\\t\\t\\t\\t\\tphone_no\\n\\t\\t,t3.CPU_FREQUENCY\\t\\t\\tCPU_FREQUENCY\\n\\t\\t,case when t3.term_mode LIKE '%GSM%' then 1 else 0 end   IS_GSM\\n\\t\\t,case when t3.term_mode LIKE '%CDMA%' then 1 else 0 end  IS_CDMA\\n\\t\\t,t3.SCREEN_ID              TERMSCREEN_ID\\n\\t\\t,t3.term_mode                   TERM_SEGMENT\\n\\t\\t,t8.flag_2g                     FLAG_2G\\n\\t\\t,t8.flag_3g                     FLAG_3G\\n\\t\\t,t8.flag_4g                     FLAG_4G\\n\\t\\t,t4.DEPT_SUBAREA_ID             DEPT_CHANNEL_ID\\n\\t\\t,t7.LAST_YEAR_PHONE\\t\\t        LAST_YEAR_PHONE\\n\\t\\t,t7.IS_YEAR_PHONE\\t            IS_YEAR_PHONE\\n\\t\\t,t8.DUAL_CARD                   dual_card\\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join (select distinct a.PHONE_NO,CPU_FREQUENCY,term_mode,SCREEN_ID\\n\\t\\t   from gbasedwi.DWI_BEH_USE_STEADYIMEI_MS_${monthid}  a     /*稳定终端信息月表月表*/\\n\\t\\t   left join gbasedwi.DWI_RES_TERM_MARK_MS_${monthid}  b \\t/*终端品牌信息-市场月表*/\\n\\t\\t\\t\\ton a.TAC=b.imei_section) t3 on t1.phone_no=t3.phone_no\\nleft join ${DWI_USR_PESN_PERSN_LOC_MS_MONTHID} t4 on t1.phone_no=t4.phone_no\\nleft join ${DM_PUB_201212018_PMONTHID} t7 on t1.phone_no=t7.product_no\\nleft join (SELECT A.PHONE_NO,B.G2_MODEL flag_2g,B.G3_MODEL flag_3g,B.G4_MODEL flag_4g,B.DOU_CARD_FLAG dual_card\\n             FROM GBASEDWI.DWI_BEH_USE_STEADYIMEI_MS_${monthid} A\\n             LEFT JOIN GBASEDWD.DWD_RES_SVC_TERM_BRAND_OBASS_MS_${monthid} B ON A.TAC=B.TAC_NO) t8 on t1.phone_no=t8.phone_no\\nwhere (t1.MONTH_ARRIVE_FLAG=1 And t1.PROD_KIND_CODE= 171000000001) or t1.MONTH_OFF_FLAG  =1","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [240]-[index:371]-[2012年12月新增指标]-[22]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"临时表4","nodeId":"22","sql":"drop table ${DM_PUB_201212018_TMP04_MONTHID};\\ncreate table  ${DM_PUB_201212018_TMP04_MONTHID}\\n (   phone_no                      varchar(20)\\n\\t,free_flow_all                    BIGINT\\n\\t,CALL_TOTAL_PROPORTION        DECIMAL(14,3)\\n\\t,MESSAGE_TOTAL_PROPORTION     DECIMAL(14,3)\\n\\t,LAST_GPRS_FLOW_M\\t\\t\\t  BIGINT\\n\\t,GPRS_TOTAL_PROPORTION\\t\\t  DECIMAL(14,3)\\n\\t,MARGIN_GPRS\\t\\t\\t\\t  BIGINT\\n,CALL_USED_VALUE                                BIGINT\\n) DISTRIBUTED BY('phone_no') nolock;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [241]-[index:372]-[2012年12月新增指标]-[28]-['str' object has no attribute 'lfind']:{"name":"临时表7","nodeId":"28","dsName":"GbaseDM","sql":"create table ${DM_PUB_201212018_TMP07_MONTHID}\\n      (    user_id                    bigint\\n          ,phone_no                   varchar(20)\\n          ,CPU_FREQUENCY                INTEGER\\n          ,IS_GSM                       SMALLINT\\n          ,IS_CDMA                      SMALLINT\\n          ,TERMSCREEN_ID                VARCHAR(10)\\n          ,TERM_SEGMENT                 VARCHAR(300)\\n          ,FLAG_2G                      varchar(1)\\n          ,FLAG_3G                      varchar(1)\\n          ,FLAG_4G                      varchar(1)\\n          ,DEPT_CHANNEL_ID              INTEGER\\n          ,LAST_YEAR_PHONE              SMALLINT\\n          ,IS_YEAR_PHONE                SMALLINT\\n          ,DUAL_CARD                    varchar (1)\\n      ) DISTRIBUTED BY('user_id') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [242]-[index:374]-[2012年12月新增指标]-[27]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据6","nodeId":"27","sql":"insert into ${DM_PUB_201212018_TMP06_MONTHID}\\n (\\t user_id\\n\\t,WLAN_GPRS\\n\\t,WLANPC_GPRS\\n\\t,CALL_10086_COUNT\\n\\t,STOP_ONCE_NUM\\n\\t,OWE_FEE\\n\\t,RES_SPEC_NAME\\n\\t,MAT_CODE\\n\\t,DONE_DATE\\n\\t,ROOM_NAME\\t)\\nselect   distinct\\n         t1.user_id                     user_id\\n\\t\\t,t2.WLAN_TOTAL_FLOW             WLAN_GPRS\\n\\t\\t,t2.WLAN_PC_ONNET_FLOW          WLANPC_GPRS\\n\\t\\t,t3.L3M_DIAL_10086_PERSN_NUM    CALL_10086_COUNT\\n\\t\\t,t4.CUR_MON_USER_BILL_STOP_NUM  STOP_ONCE_NUM\\n\\t\\t,NVL(t5.OWE_AMT,0)             OWE_FEE\\n\\t\\t,t7.res_spec_name               RES_SPEC_NAME\\n\\t\\t,t7.mat_code                    MAT_CODE\\n\\t\\t,t7.done_date                   DONE_DATE\\n\\t\\t,t7.room_name                   ROOM_NAME\\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join ${DWI_BEH_USE_WLAN_TOT_MS_MONTHID} t2 on t1.phone_no=t2.phone_no\\nleft join (select phone_no,sum(L3M_DIAL_10086_PERSN_NUM) L3M_DIAL_10086_PERSN_NUM\\n\\t\\t   from ${DWA_UV_USER_CUSTSERV_MS_MONTHID} group by phone_no) t3 on t1.phone_no=t3.phone_no\\nleft join ${DWI_USR_PESN_STOPINDEX_MS_MONTHID} t4 on t1.user_id=t4.user_id\\nleft join (select phone_no,sum(OWE_AMT) OWE_AMT FROM gbasedwi.DWI_INCO_OWE_ITEM_TOT_MS_${monthid}\\n\\t\\t   GROUP BY phone_no) t5 on t1.phone_no=t5.phone_no\\nleft join (select phone_no,\\n                  res_spec_name,  /*sim卡类型*/\\n\\t              mat_code,       /*物料编码*/\\n\\t              done_date,      /*换卡时间*/\\n\\t             room_name       /*换卡营业厅*/\\nfrom (select row_number() over(PARTITION by  t1.phone_no order by t1.ACPT_DATE desc  ) as id ,\\n\\t\\t\\t t1.SIM_NO,\\n\\t\\t\\t t1.phone_no         phone_no,\\n\\t\\t\\t t1.ACPT_DATE        done_date ,\\n\\t\\t\\t t2.RES_NAME         res_spec_name,\\n\\t\\t\\t t2.LOGISTICS_CODE   mat_code,\\n\\t\\t\\t t3.ALIAS            work_alias,\\n\\t\\t\\t t4.CHL_NAME         room_name\\n\\t  from gbasedwd.DWD_RES_SVC_SIM_DS_${curmlastday} t1\\n\\t  left join gbasedwd.DWD_RES_SVC_MKT_SPEC_DS_${curmlastday} t2  on  t1.res_spec_id=t2.RES_SPEC_ID\\n\\t  left join gbasedwd.DIM_CHL_OPERATOR_DS_${curmlastday} t3  on t1.OPER=t3. OPER_CODE\\n      left join gbasedwd.DIM_CHL_DEPARTINFO_DS_${curmlastday} t4 on  t4.ORG_ID=t3.ORG_ID\\n\\t  where t1.OPER is not null) aa where id=1  ) t7  on t1.phone_no=t7.phone_no\\nwhere (t1.MONTH_ARRIVE_FLAG=1 And t1.PROD_KIND_CODE= 171000000001) or t1.MONTH_OFF_FLAG  =1"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [243]-[index:375]-[2012年12月新增指标]-[124]-['str' object has no attribute 'lfind']:{"name":"124.插入临时表1302","nodeId":"124","dsName":"GbaseDM","sql":"drop table ${DM_PUB_201212018_TMP1301_MONTHID};\\ncreate table  ${DM_PUB_201212018_TMP1301_MONTHID}\\n \\t\\t    (op_time\\t            date\\n            ,product_no\\t        varchar(20)\\n            ,flag                int\\n            ,offer_id\\t           bigint\\n            ,offer_name\\t         varchar(100)\\n            ,apply_date          date\\n            ,offer_kind          varchar(20)\\n             );\\ninsert into  ${DM_PUB_201212018_TMP1301_MONTHID}\\nselect  '${curm_first_day}'\\n        ,PHONE_NO\\n        ,(case when phone_no is not null then 1 else 0 end) flag\\n        ,plan_id\\n        ,nvl(offer_name,'没订购4G套餐')\\n        ,ACPT_DATE\\n        ,offer_kind_divide\\n\\t    from\\n\\t\\t(select phone_no ,\\n\\t\\t  offer_name\\t,\\n\\t\\t  plan_id,\\n\\t\\t  date(a.ACPT_DATE) ACPT_DATE,\\n\\t\\t  offer_kind_divide   from\\n\\t\\t( select PHONE_NO,plan_id,PLAN_NAME,create_time,CREATE_OPER_ID,ACPT_DATE,EXP_TIME from GBASEDWI.DWI_INST_OFFER_ADDBUSI_MS_${monthid} where  date(ACPT_DATE)<='${curm_last_day}'  and date(EXP_TIME)>'${curm_last_day}'\\n\\t\\t  union all\\n\\t\\t  select PHONE_NO,plan_id,PLAN_NAME,create_time,CREATE_OPER_ID,ACPT_DATE,EXP_TIME from GBASEDWI.DWI_INST_OFFER_PLAN_MS_${monthid}  where  date(ACPT_DATE)<='${curm_last_day}'  and date(EXP_TIME)>'${curm_last_day}'\\n\\t\\t  union all\\n\\t\\t  select PHONE_NO,plan_id,PLAN_NAME,create_time,CREATE_OPER_ID,ACPT_DATE,EXP_TIME from GBASEDWI.DWI_INST_OFFER_PLOY_MS_${monthid}  where date(ACPT_DATE)<='${curm_last_day}'  and date(EXP_TIME)>'${curm_last_day}'\\n\\t\\t  ) a\\n\\t    inner join  gbasedwd.dim_basekpi_4g_offer b\\n        on   a.plan_id=b.offer_id) c ;\\ndrop table ${DM_PUB_201212018_TMP1302_MONTHID};\\ncreate table ${DM_PUB_201212018_TMP1302_MONTHID}\\n  \\t\\t    ( op_time\\t            date\\n              ,product_no\\t        varchar(20)\\n              ,flag\\t              int\\n              ,member_flag        int\\n              ,freeflow           decimal(16,4)\\n  \\t\\t    ) distributed by ('product_no');\\n\\ninsert into ${DM_PUB_201212018_TMP1302_MONTHID}\\n          select a.op_time,a.product_no,a.flag,1,null from ${DM_PUB_201212018_TMP1301_MONTHID}   a\\n          where flag=1 and not (offer_name='和家庭' and date(apply_date)>='2016-06-01' and year(apply_date)=${year} )\\n\\n          union all\\n\\n          select a.op_time,a.product_no,a.flag,case when b.product_no is null then 2 else 3 end,c.total_value\\n          from (select * from ${DM_PUB_201212018_TMP1301_MONTHID} where flag=1 and offer_name='和家庭' and date(apply_date)>='2016-06-01') a\\n          left join (select distinct BILL_NO  product_no  from gbasedwi.DWI_INST_OFFER_TEAM_MS_${monthid} A\\n\\t\\t  where A.plan_id in('111005000050','111001001744') and CUR_CYCLE_STATE=1 and data_desc in('4G多终端流量共享成员角色','群组手机成员角色')) b\\n          on a.product_no=b.product_no\\n          left join\\n\\t\\t  (\\n              select a.product_no,sum(b.NORMAL_TOTUSE_RES_NUM)/1024/1024 total_value\\n              from ${DM_PUB_201212018_TMP1301_MONTHID} a\\n              left join gbasedwi.DWI_INCO_BILL_FREERES_MS_${monthid} b on a.product_no=b.PHONE_NO and a.offer_id=b.plan_id\\n              where a.offer_kind in('4G主套餐','30元及以上流量包')\\n              group by a.product_no\\n          ) c on a.product_no=c.product_no  ;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [244]-[index:376]-[2012年12月新增指标]-[33]-['str' object has no attribute 'lfind']:{"name":"插入数据9","nodeId":"33","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP09_MONTHID}\\n (\\t user_id\\n\\t,phone_no\\n\\t,IS_TEST_4G\\n\\t,IS_PREPARATION_CARD\\n\\t,IS_ACTIVATION_CARD\\n\\t,IS_SELL\\n\\t,IS_139MAILBOX_USER\\n\\t,IS_DELAY_USER\\n\\t,IS_LISTPROTECT_USER\\n\\t,IS_BILLPROTECT_USER\\n\\t,IS_3G_ASSESSUSER\\n\\t,IS_4G_ASSESSUSER\\n\\t,BA_SVC_NO\\n\\t,TD_PHONE     )\\nselect\\t t1.user_id\\t\\tuser_id\\n\\t\\t,t1.phone_no\\t\\tphone_no\\n\\t\\t,t2.IS_TEST_4G\\tIS_TEST_4G\\n\\t\\t,t3.IS_PREPARATION_CARD\\n\\t\\t,t3.IS_ACTIVATION_CARD\\n\\t\\t,case when n.product_no is not null then 1 else 0 end as  IS_SELL\\n\\t\\t,case when d.phone_no is not null then 1 else 0 end \\tIS_139MAILBOX_USER\\n\\t\\t,case when e.phone_no is not null then 1 else 0 end\\t\\tIS_DELAY_USER\\n\\t\\t,t3.IS_LISTPROTECT_USER\\n\\t\\t,t3.IS_BILLPROTECT_USER\\n\\t\\t,case when t6.subs_id is not null then 1 else 0 end\\t\\tIS_3G_ASSESSUSER\\n\\t\\t,case when t7.subs_id is not null then 1 else 0 end\\t\\tIS_4G_ASSESSUSER\\n\\t\\t,t8.ACCT_ID                     BA_SVC_NO\\n\\t\\t,j.TD_PHONE           /*TD终端*/\\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join (select phone_no\\n\\t\\t\\t\\t ,max(case when PLAN_ID in (111001000523,111001000525) then 1 else 0 end) IS_TEST_4G\\n\\t\\t\\t\\t ,max(case when PLAN_ID in (111001000713,111001000714) then 1 else 0 end) IS_MIFI_4G\\n\\t\\t   from ${DWI_INST_OFFER_PLAN_MS_MONTHID} group by phone_no) t2 on t1.phone_no=t2.phone_no\\nleft join (select phone_no\\n\\t\\t\\t\\t ,max(case when BUSI_NAME like '%备卡申请%' and ACTION_TYPE='创建' and ORD_STATUS='完成' then 1 else 0 end)\\tIS_PREPARATION_CARD\\n\\t\\t\\t\\t ,max(case when BUSI_NAME like '%备卡激活%' and ACTION_TYPE='创建' and ORD_STATUS='完成' then 1 else 0 end)\\tIS_ACTIVATION_CARD\\n\\t\\t\\t\\t ,max(case when PLAN_ID=111002001483 and ORD_STATUS='完成' then 1 else 0 end) IS_LISTPROTECT_USER\\n\\t\\t\\t\\t ,max(case when PLAN_ID=111002001816 and ORD_STATUS='完成' then 1 else 0 end) IS_BILLPROTECT_USER\\n\\t\\t   from ${DWI_INST_ORD_LIST_DM_MONTHID} group by phone_no) t3 on t1.phone_no=t3.phone_no\\nleft join (select distinct a.phone_no\\n\\t\\t   from (select distinct phone_no,plan_id from ${DWI_INST_OFFER_ADDBUSI_MS_MONTHID}\\n\\t\\t\\t\\t where plan_id in(111002000661,111002000662) and CUR_CYCLE_STATE = 1) a\\n\\t\\t   left join (select product_no,min(OP_TIME) as pay_date from gbasedwd.dwd_acc_payment_dt_${monthid}\\n\\t\\t\\t\\t\\t  where to_char(OP_TIME,'dd') >=4 group by product_no) b on a.phone_no = b.product_no\\n\\t\\t   left join (select distinct product_no from gbasedwd.dwd_acc_payment_dt_${nextMonth} where to_char(OP_TIME,'dd') <= 8) c on a.phone_no = c.product_no\\n\\t\\t   left join (select distinct phone_no,BILL_CYCLE from ${DWD_ACC_BILLOWE_MS_MONTHID}) d on a.phone_no = d.phone_no\\n\\t\\t   where d.phone_no is not null and d.BILL_CYCLE <= '201604'\\n\\t\\t\\t and ((a.plan_id = 111002000661 and day(b.pay_date) <= 15) or (a.plan_id = 111002000662 \\n\\t\\t\\t and (b.product_no is not null or c.product_no is not null)))) e on  t1.phone_no=e.phone_no \\nleft join (select phone_no\\n\\t\\t   from (select row_number() over( PARTITION by phone_no order by FINISH_TIME desc) aa,\\n\\t\\t\\t\\t\\t\\tphone_no,action_type from gbasedwi.DWI_INST_ORD_LIST_DM_${monthid} a\\n\\t\\t\\t\\t where plan_id in ('111004022749','111004022750','111004022748') and ord_status='完成' ) aa\\n\\t\\t   where aa='1' and action_type='创建') d on t1.phone_no=d.phone_no\\nleft join ${DW_TD_PRODUCT_MSG_CYCLE01_MONTHID} t6 on t1.phone_no=t6.subs_id\\nleft join (select distinct subs_id from GBASEBAS.DW_LTE_PRODUCT_MSG_CYCLE01_${monthid}\\n\\t\\t   where lte_trmnl_cust_flg='1' and usdlte_ntwk_cust_flg='1') t7 on t1.phone_no=t7.subs_id\\nleft join (select a.subs_id,b.TERM_BRAND as TD_PHONE\\n\\t\\t   from gbasebas.DW_TD_PRODUCT_MSG_CYCLE01_${monthid} a\\n\\t\\t   left join  gbasedwd.DWD_RES_SVC_TERM_BRAND_OBASS_MS_${monthid}  b   /*终端品牌信息-一经月表*/\\n\\t\\t\\t\\ton  a.tac_id =b.TAC_NO)  j   on t1.phone_no=j.subs_id\\nleft join ${DWI_INCO_ACCB_USER_ACCT_MS_MONTHID} t8 on t1.user_id=t8.user_id\\nleft join dm.NG_OFF_ODS_PRODUCT_MSG n on t1.phone_no=n.product_no \\nwhere (t1.MONTH_ARRIVE_FLAG=1 And t1.PROD_KIND_CODE= 171000000001) or t1.MONTH_OFF_FLAG  =1","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [245]-[index:377]-[2012年12月新增指标]-[81]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"81.插入最终表","nodeId":"81","sql":"insert into ${DM_PUB_201212018_MONTHID}\\n (\\t OP_TIME\\n\\t,STATIS_DATE\\n\\t,PRODUCT_NO\\n\\t,CPU_FREQUENCY\\n\\t,IS_GSM\\n\\t,IS_CDMA\\n\\t,IS_STABLE_IMEI\\n\\t,IS_NEW_IMEI\\n\\t,TERMSCREEN_ID\\n\\t,IS_TURN_BRAND\\n\\t,OLD_ORDER_NAME\\n\\t,NEW_ORDER_NAME\\n\\t,TRUTH_NAME\\n\\t,BIRTH_DAY\\n\\t,ENTERPRISE_MARK\\n\\t,BA_SVC_NO\\n\\t,DEPT_CHANNEL_ID\\n\\t,VIP_MANAGER_ID\\n\\t,WORK_NAME\\n\\t,STATION_NAME\\n\\t,VIP_NO\\n\\t,IS_APPLY_STOP\\n\\t,FIRST_NET_AWAKE\\n\\t,CALL_DAYS\\n\\t,MESSAGE_DAYS\\n\\t,ACCT2\\n\\t,ACCT12\\n\\t,ACCT14\\n\\t,ACCT16\\n\\t,IR_STAR_LONG\\n\\t,ACK_INTLONG\\n\\t,CUR_PROMOTION_SCORE\\n\\t,CUR_DATA_SCORE\\n\\t,CUR_CONSUME_SCORE\\n\\t,CHANGE_SCORE_MONTH\\n\\t,CHANGE_SCORE_YEAR\\n\\t,CMNET_TIME\\n\\t,CMWAP_TIME\\n\\t,FREE_FLOW_ALL\\n\\t,IS_ACTIVE\\n\\t,IS_ACCT_USER\\n\\t,LAST_YEAR_PHONE\\n\\t,ISCARD_DOUBLE\\n\\t,ENT_CUST_ID\\n\\t,DOUBLE_CARD_TYPE\\n\\t,IS_TD_USER\\n\\t,IS_PHOTO_USER\\n\\t,PHOTO_DEPT\\n\\t,TURN_BRAND_OLD\\n\\t,TURN_BRAND_NEW\\n\\t,OPPOSITE_NUMBER\\n\\t,OPPOSITE_PHONE_NUMBER\\n\\t,CUST_LEVEL\\n\\t,IMSI_NO\\n\\t,LAST_GPRS_FLOW_M\\n\\t,CALL_TOTAL_PROPORTION\\n\\t,MESSAGE_TOTAL_PROPORTION\\n\\t,GPRS_TOTAL_PROPORTION\\n\\t,CALL_DURATION_M\\n\\t,OUT_CALL_DUREATION_M\\n\\t,IN_CALL_DURATION_M\\n\\t,INPLAN_OUT_CALL_DURAION_M\\n\\t,INPLAN_IN_CALL_DURATION_M\\n\\t,OUTPLAN_OUT_CALL_DURATION_M\\n\\t,OUTPLAN_IN_CALL_DURATION_M\\n\\t,TD_CALL_NUM\\n\\t,TD_VOICE_NUM\\n\\t,TD_GPRS_NUM\\n\\t,IS_SCHOOL_USER\\n\\t,TD_PHONE\\n\\t,WLAN_GPRS\\n\\t,WLANPC_GPRS\\n\\t,CALL_10086_COUNT\\n\\t,SCALE_ID\\n\\t,OWE_THREE_FEE\\n\\t,MARGIN_GPRS\\n\\t,GPRS_COUNT1\\n\\t,GPRS_COUNT2\\n\\t,GPRS_COUNT3\\n\\t,GPRS_COUNT4\\n\\t,TD_THREEMONTH_PHONE\\n\\t,BRAND_ID\\n\\t,MAIN_BRAND_ID\\n\\t,LAST_STOP_DATE\\n\\t,STOP_ONCE_NUM\\n\\t,STOP_TWICE_NUM\\n\\t,OWE_FEE\\n\\t,IS_SELL\\n\\t,IS_CHANGE_USIM\\n\\t,IS_HANDLE_4G\\n\\t,IS_TERMINAL_4G\\n\\t,IS_MIFI_4G\\n\\t,TERMINAL_4G\\n\\t,IS_TEST_4G\\n\\t,IS_PREPARATION_CARD\\n\\t,IS_ACTIVATION_CARD\\n\\t,IS_139MAILBOX_USER\\n\\t,IS_DELAY_USER\\n\\t,IS_LISTPROTECT_USER\\n\\t,IS_BILLPROTECT_USER\\n\\t,IS_3G_ASSESSUSER\\n\\t,IS_4G_ASSESSUSER\\n\\t,IS_4G_USER\\n\\t,IS_YEAR_PHONE\\n\\t,IS_OFFER_4G\\n\\t,IS_CONTRACT_4G\\n\\t,ACTIVE_COUNT\\n\\t,GPRS_FEE\\n\\t,IS_STRESS\\n\\t,THREE_FOUR_IMEI\\n\\t,TRANSFER_CALL_DURATION_M\\n\\t,CUST_TYPE\\n\\t,DEPT_NAME\\n\\t,ENTERPRISE_MARK1\\n\\t,IS_MISSUSER\\n\\t,CAMPUS_ID\\n\\t,IS_USIM_USER\\n\\t,IS_NFC_USER\\n\\t,IS_YIJINGPHONE_USER\\n\\t,FLAG_2G\\n\\t,FLAG_3G\\n\\t,FLAG_4G\\n\\t,RES_SPEC_NAME\\n\\t,MAT_CODE\\n\\t,DONE_DATE\\n\\t,ROOM_NAME\\n\\t,DUAL_CARD\\n    ,CALL_USED_VALUE\\n    ,IS_YIJING_ACCT_USER\\n\\t,IS_4GNET_user_kaohe\\n    ,IS_offer_user\\n    ,county_id\\n\\t,is_comm_user\\n\\t,dx_gprs_resource_bhd  ##饱和度定向流量资源\\n\\t,bxl_gprs_resource_bhd  ##饱和度不限量产品\\n\\t,curm_arpu ###当月ARPU（剔除国际业务收入）\\n,yk_flow_m -- 优酷视频流量（MB)\\n,tx_flow_m -- 腾讯视频流量（MB)\\n,aqi_flow_m -- 爱奇艺流量（MB)\\n,mgzb_flow_m -- 咪咕直播流量（MB)\\n,pptv_flow_m -- pptv流量（MB)\\n,xg_flow_m -- 西瓜视频流量（MB)\\n,mg_flow_m -- 芒果TV流量（MB)\\n,blbl_flow_m-- 哔哩哔哩流量（MB)\\n,wy_flow_m -- 网易云音乐流量（MB)\\n,mgyy_flow_m -- 咪咕音乐流量（MB)\\n,wzry_flow_m -- 王者荣耀流量（MB)\\n,mgyx_flow_m -- 咪咕游戏流量（MB)\\n,mgyd_flow_m -- 咪咕阅读流量（MB)\\n,mgdm_flow_m -- 咪咕动漫流量（MB)\\n,qqyy_flow_m  -- QQ音乐流量（MB)\\n,kgyy_flow_m -- 酷狗音乐流量（MB)\\n,kwyy_flow_m -- 酷我音乐流量（MB)\\n,jrtt_flow_m -- 今日头条流量（MB)\\n,ks_flow_M  -- 快手流量（MB)\\n,bd_flow_m -- 百度流量（MB)\\n,wb_flow_m -- 微博流量（MB)\\n,sh_flow_m -- 搜狐流量（MB)\\n,bfyy_flow_m -- 暴风影音（MB)\\n,ls_flow_m -- 乐视流量（MB)\\n,mgsp_flow_m  -- 咪咕视频流量（MB)\\n,ysj_flow_m -- 云视界流量（MB）\\n,is_onetofive -- 一证N号标识             \\n,Pmonthowefee01 -- 前第1个月欠费金额\\n,Pmonthowefee02 -- 前第2个月欠费金额\\n,Pmonthowefee03  -- 前第3个月欠费金额  \\n,user_level      -- 全球通用户档位 20190124日添加\\n)\\nselect\\t '${month_id}-01'               OP_TIME\\n\\t\\t,'${monthid}'                   STATIS_DATE\\n\\t\\t,t1.product_no\\n\\t\\t,t6.CPU_FREQUENCY               CPU_FREQUENCY\\n\\t\\t,t6.IS_GSM                      IS_GSM\\n\\t\\t,t6.IS_CDMA                     IS_CDMA\\n\\t\\t,t1.IS_STABLE_IMEI              IS_STABLE_IMEI\\n\\t\\t,t1.IS_NEW_IMEI                 IS_NEW_IMEI\\n\\t\\t,t6.TERMSCREEN_ID               TERMSCREEN_ID\\n\\t\\t,nvl(t1.IS_TURN_BRAND,0)        IS_TURN_BRAND\\n\\t\\t,t1.OLD_ORDER_NAME              OLD_ORDER_NAME\\n\\t\\t,t1.NEW_ORDER_NAME              NEW_ORDER_NAME\\n\\t\\t,t1.TRUTH_NAME                  TRUTH_NAME\\n\\t\\t,t1.BIRTH_DAY                   BIRTH_DAY\\n\\t\\t,t1.ENTERPRISE_MARK             ENTERPRISE_MARK\\n\\t\\t,t7.BA_SVC_NO                   BA_SVC_NO\\n\\t\\t,t6.DEPT_CHANNEL_ID             DEPT_CHANNEL_ID\\n\\t\\t,t1.VIP_MANAGER_ID              VIP_MANAGER_ID\\n\\t\\t,t1.WORK_NAME                   WORK_NAME\\n\\t\\t,t1.STATION_NAME                STATION_NAME\\n\\t\\t,t1.VIP_NO                      VIP_NO\\n\\t\\t,nvl(t1.IS_APPLY_STOP,0)               IS_APPLY_STOP\\n\\t\\t,t8.FIRST_NET_AWAKE             FIRST_NET_AWAKE\\n\\t\\t,t1.CALL_DAYS                   CALL_DAYS\\n\\t\\t,t1.MESSAGE_DAYS                MESSAGE_DAYS\\n\\t\\t,t8.ACCT2                       ACCT2\\n\\t\\t,t8.ACCT12                      ACCT12\\n\\t\\t,t8.ACCT14                      ACCT14\\n\\t\\t,t8.ACCT16                      ACCT16\\n\\t\\t,t8.IR_STAR_LONG                IR_STAR_LONG\\n\\t\\t,t8.ACK_INTLONG                 ACK_INTLONG\\n\\t\\t,t3.CUR_PROMOTION_SCORE         CUR_PROMOTION_SCORE\\n\\t\\t,t3.CUR_DATA_SCORE              CUR_DATA_SCORE\\n\\t\\t,t3.CUR_CONSUME_SCORE           CUR_CONSUME_SCORE\\n\\t\\t,t3.CHANGE_SCORE_MONTH          CHANGE_SCORE_MONTH\\n\\t\\t,t3.CHANGE_SCORE_YEAR           CHANGE_SCORE_YEAR\\n\\t\\t,t1.CMNET_TIME                  CMNET_TIME\\n\\t\\t,t1.CMWAP_TIME                  CMWAP_TIME\\n\\t\\t,t12.FREE_FLOW_ALL               FREE_FLOW_ALL\\n\\t\\t,t1.IS_ACTIVE                   IS_ACTIVE\\n\\t\\t,t1.IS_ACCT_USER                IS_ACCT_USER\\n\\t\\t,t6.LAST_YEAR_PHONE             LAST_YEAR_PHONE\\n\\t\\t,t1.ISCARD_DOUBLE               ISCARD_DOUBLE\\n\\t\\t,t1.ENT_CUST_ID                 ENT_CUST_ID\\n\\t\\t,t1.DOUBLE_CARD_TYPE            DOUBLE_CARD_TYPE\\n\\t\\t,t16.IS_TD_USER                  IS_TD_USER\\n\\t\\t,t1.IS_PHOTO_USER               IS_PHOTO_USER\\n\\t\\t,t1.PHOTO_DEPT                  PHOTO_DEPT\\n\\t\\t,t1.TURN_BRAND_OLD              TURN_BRAND_OLD\\n\\t\\t,t1.TURN_BRAND_NEW              TURN_BRAND_NEW\\n\\t\\t,t1.OPPOSITE_NUMBER             OPPOSITE_NUMBER\\n\\t\\t,t1.OPPOSITE_PHONE_NUMBER       OPPOSITE_PHONE_NUMBER\\n\\t\\t,t1.CUST_LEVEL                  CUST_LEVEL\\n\\t\\t,t1.IMSI_NO                     IMSI_NO\\n\\t\\t,t12.LAST_GPRS_FLOW_M            LAST_GPRS_FLOW_M\\n\\t\\t,t12.CALL_TOTAL_PROPORTION      CALL_TOTAL_PROPORTION\\n\\t\\t,t12.MESSAGE_TOTAL_PROPORTION   MESSAGE_TOTAL_PROPORTION\\n\\t\\t,t12.GPRS_TOTAL_PROPORTION      GPRS_TOTAL_PROPORTION\\n\\t\\t,t16.CALL_DURATION_M             CALL_DURATION_M\\n\\t\\t,t16.OUT_CALL_DUREATION_M        OUT_CALL_DUREATION_M\\n\\t\\t,t16.IN_CALL_DURATION_M          IN_CALL_DURATION_M\\n\\t\\t,t16.INPLAN_OUT_CALL_DURAION_M   INPLAN_OUT_CALL_DURAION_M\\n\\t\\t,t16.INPLAN_IN_CALL_DURATION_M   INPLAN_IN_CALL_DURATION_M\\n\\t\\t,t16.OUTPLAN_OUT_CALL_DURATION_M OUTPLAN_OUT_CALL_DURATION_M\\n\\t\\t,t16.OUTPLAN_IN_CALL_DURATION_M  OUTPLAN_IN_CALL_DURATION_M\\n\\t\\t,t16.TD_CALL_NUM                 TD_CALL_NUM\\n\\t\\t,t16.TD_VOICE_NUM                TD_VOICE_NUM\\n\\t\\t,t16.TD_GPRS_NUM                 TD_GPRS_NUM\\n\\t\\t,null                           IS_SCHOOL_USER\\n\\t\\t,t7.TD_PHONE                    TD_PHONE\\n\\t\\t,t4.WLAN_GPRS                   WLAN_GPRS\\n\\t\\t,t4.WLANPC_GPRS                 WLANPC_GPRS\\n\\t\\t,t4.CALL_10086_COUNT            CALL_10086_COUNT\\n\\t\\t,t1.SCALE_ID                    SCALE_ID\\n\\t\\t,t15.OWE_THREE_FEE              OWE_THREE_FEE\\n\\t\\t,t12.MARGIN_GPRS                MARGIN_GPRS\\n\\t\\t,t3.GPRS_COUNT1                 GPRS_COUNT1\\n\\t\\t,t3.GPRS_COUNT2                 GPRS_COUNT2\\n\\t\\t,t3.GPRS_COUNT3                 GPRS_COUNT3\\n\\t\\t,t3.GPRS_COUNT4                 GPRS_COUNT4\\n\\t\\t,null                           TD_THREEMONTH_PHONE\\n\\t\\t,t1.BRAND_ID                    BRAND_ID\\n\\t\\t,t1.MAIN_BRAND_ID               MAIN_BRAND_ID\\n\\t\\t,t16.LAST_STOP_DATE              LAST_STOP_DATE\\n\\t\\t,t4.STOP_ONCE_NUM               STOP_ONCE_NUM\\n\\t\\t,t16.STOP_TWICE_NUM              STOP_TWICE_NUM\\n\\t\\t,t4.OWE_FEE                     OWE_FEE\\n\\t\\t,t7.IS_SELL                     IS_SELL\\n\\t\\t,t13.IS_CHANGE_USIM              IS_CHANGE_USIM\\n\\t\\t,t13.IS_HANDLE_4G                IS_HANDLE_4G\\n\\t\\t,t13.IS_TERMINAL_4G              IS_TERMINAL_4G\\n\\t\\t,t13.IS_MIFI_4G                  IS_MIFI_4G\\n\\t\\t,t13.TERMINAL_4G                   TERMINAL_4G\\n\\t\\t,t13.IS_TEST_4G                  IS_TEST_4G\\n\\t\\t,t7.IS_PREPARATION_CARD         IS_PREPARATION_CARD\\n\\t\\t,t7.IS_ACTIVATION_CARD          IS_ACTIVATION_CARD\\n\\t\\t,t7.IS_139MAILBOX_USER          IS_139MAILBOX_USER\\n\\t\\t,t7.IS_DELAY_USER               IS_DELAY_USER\\n\\t\\t,t7.IS_LISTPROTECT_USER         IS_LISTPROTECT_USER\\n\\t\\t,t7.IS_BILLPROTECT_USER         IS_BILLPROTECT_USER\\n\\t\\t,t7.IS_3G_ASSESSUSER            IS_3G_ASSESSUSER\\n\\t\\t,t7.IS_4G_ASSESSUSER            IS_4G_ASSESSUSER\\n\\t\\t,t3.IS_4G_USER                  IS_4G_USER\\n\\t\\t,t6.IS_YEAR_PHONE               IS_YEAR_PHONE\\n\\t\\t,t11.IS_OFFER_4G                IS_OFFER_4G\\n\\t\\t,t11.IS_CONTRACT_4G             IS_CONTRACT_4G\\n\\t\\t,t3.ACTIVE_COUNT                ACTIVE_COUNT\\n\\t\\t,t11.GPRS_FEE                   GPRS_FEE\\n\\t\\t,t11.IS_STRESS                   IS_STRESS\\n\\t\\t,null  /*case when t5.user_id is not null or t6.TERM_SEGMENT like '%TD-SCDMA%'\\n\\t\\t\\tthen t2.TERM_IMEI\\n\\t\\t\\telse null end     */         THREE_FOUR_IMEI\\n\\t\\t,t10.TRANSFER_CALL_DURATION_M   TRANSFER_CALL_DURATION_M\\n\\t\\t,t1.CUST_TYPE       \\t\\t\\tCUST_TYPE\\n\\t\\t,t1.DEPT_NAME  \\t\\t\\t\\t\\tDEPT_NAME\\n\\t\\t,t1.ENTERPRISE_MARK1  \\t\\t\\tENTERPRISE_MARK1\\n\\t\\t,t1.IS_MISSUSER                 IS_MISSUSER\\n\\t\\t,NULL  /*t2.OWNER_SCHL  */\\t\\tCAMPUS_ID\\n\\t\\t,t1.IS_USIM_USER         \\t\\tIS_USIM_USER\\n\\t\\t,t1.IS_NFC_USER          \\t\\tIS_NFC_USER\\n\\t\\t,t1.IS_YIJINGPHONE_USER        \\tIS_YIJINGPHONE_USER\\n\\t\\t,t6.FLAG_2G                     FLAG_2G\\n\\t\\t,t6.FLAG_3G                     FLAG_3G\\n\\t\\t,t6.FLAG_4G                     FLAG_4G\\n\\t\\t,t4.RES_SPEC_NAME               RES_SPEC_NAME\\n\\t\\t,t4.MAT_CODE                    MAT_CODE\\n\\t\\t,t4.DONE_DATE                   DONE_DATE\\n\\t\\t,t4.ROOM_NAME                   ROOM_NAME\\n\\t\\t,t6.DUAL_CARD                   DUAL_CARD\\n\\t\\t,t12.call_used_value            CALL_USED_VALUE\\n        ,t1.IS_YIJING_ACCT_USER   IS_YIJING_ACCT_USER\\n\\t\\t,t17.IS_4GNET_user_kaohe\\n        ,t17.IS_offer_user\\n        ,t17.county_id\\n\\t\\t,t18.is_comm_user\\n\\t\\t,t19.dx_gprs_resource_bhd  ##饱和度定向流量资源\\n\\t    ,t20.bxl_gprs_resource_bhd  ##饱和度不限量产品\\n\\t\\t,t21.curm_arpu\\n,t22.yk_flow_m -- 优酷视频流量（MB)\\n,t22.tx_flow_m -- 腾讯视频流量（MB)\\n,t22.aqi_flow_m -- 爱奇艺流量（MB)\\n,t22.mgzb_flow_m -- 咪咕直播流量（MB)\\n,t22.pptv_flow_m -- pptv流量（MB)\\n,t22.xg_flow_m -- 西瓜视频流量（MB)\\n,t22.mg_flow_m -- 芒果TV流量（MB)\\n,t22.blbl_flow_m -- 哔哩哔哩流量（MB)\\n,t22.wy_flow_m -- 网易云音乐流量（MB)\\n,t22.mgyy_flow_m -- 咪咕音乐流量（MB)\\n,t22.wzry_flow_m -- 王者荣耀流量（MB)\\n,t22.mgyx_flow_m -- 咪咕游戏流量（MB)\\n,t22.mgyd_flow_m -- 咪咕阅读流量（MB)\\n,t22.mgdm_flow_m -- 咪咕动漫流量（MB)\\n,t22.qqyy_flow_m -- QQ音乐流量（MB)\\n,t22.kgyy_flow_m  -- 酷狗音乐流量（MB)\\n,t22.kwyy_flow_m -- 酷我音乐流量（MB)\\n,t22.jrtt_flow_m -- 今日头条流量（MB)\\n,t22.ks_flow_M  -- 快手流量（MB)\\n,t22.bd_flow_m  -- 百度流量（MB)\\n,t22.wb_flow_m -- 微博流量（MB)\\n,t22.sh_flow_m -- 搜狐流量（MB)\\n,t22.bfyy_flow_m -- 暴风影音（MB)\\n,t22.ls_flow_m -- 乐视流量（MB)\\n,t22.mgsp_flow_m -- 咪咕视频流量（MB)\\n,t22.ysj_flow_m -- 云视界流量（MB）\\n      ,t23.is_onetofive -- 一证N号标识             \\n      ,t23.Pmonthowefee01 -- 前第1个月欠费金额\\n      ,t23.Pmonthowefee02 -- 前第2个月欠费金额\\n      ,t23.Pmonthowefee03 -- 前第3个月欠费金额\\n\\t  ,nvl(t24.user_level,0)     -- 全球通用户档位\\nfrom   ${DM_PUB_201212018_TMP02_MONTHID} t1\\n/*left join GBASEDWD.DWD_RES_SVC_TERM_BRAND_OBASS_MS_${monthid} t2 on t1.user_id=t2.user_id*/\\nleft join ${DM_PUB_201212018_TMP05_MONTHID} t3 on t1.product_no=t3.product_no\\nleft join ${DM_PUB_201212018_TMP06_MONTHID} t4 on t1.user_id=t4.user_id\\n/* left join ${DWI_USR_PESN_4G_1M_MS_MONTHID} t5 on t1.user_id=t5.user_id */\\nleft join ${DM_PUB_201212018_TMP07_MONTHID} t6 on t1.user_id=t6.user_id\\nleft join ${DM_PUB_201212018_TMP09_MONTHID} t7 on t1.user_id=t7.user_id\\nleft join ${DM_PUB_201212018_TMP10_MONTHID} t8 on t1.user_id=t8.user_id\\nleft join ${DM_PUB_201212018_TMP11_MONTHID} t9 on t1.user_id=t9.user_id\\nleft join ${DM_PUB_201212018_TMP12_MONTHID} t10 on t1.PRODUCT_NO=t10.PRODUCT_NO\\nleft join ${DM_PUB_201212018_TMP13_MONTHID} t11 on t1.PRODUCT_NO=t11.PRODUCT_NO\\nleft join ${DM_PUB_201212018_TMP04_MONTHID} t12 on t1.PRODUCT_NO=t12.phone_no\\nleft join ${DM_PUB_201212018_TMP14_MONTHID} t13 on t1.PRODUCT_NO=t13.phone_no\\nleft join ${DM_PUB_201212018_TMP03_MONTHID} t15 on t1.user_id=t15.user_id\\nleft join ${DM_PUB_201212018_TMP15_MONTHID} t16 on t1.product_no=t16.phone_no\\nleft join dm.tmp_dm_pub_201212018_user_${monthid} t17 on t1.product_no=t17.phone_no\\nleft join dm.tmp_dm_pub_201212018_commuser_${monthid} t18 on t1.product_no=t18.phone_no\\nleft join dm.tmp_offer_dx_gprs_${monthid} t19 on t1.product_no=t19.phone_no\\nleft join dm.tmp_offer_bxl_gprs_${monthid} t20 on t1.product_no=t20.phone_no\\nleft join dm.tmp_201212018_curm_arpu_${monthid} t21 on t1.product_no=t21.phone_no\\nleft join dm.tmp_201212018_apptype_${monthid} t22 on t1.product_no=t22.phone_no\\nleft join dm.tmp_201212018_monthowefee_${monthid} t23 on t1.product_no=t23.phone_no\\nleft join dm.tmp_201212018_user_level_${monthid} t24 on t1.product_no=t24.phone_no\\n\\n\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [246]-[index:378]-[2012年12月新增指标]-[159]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"159.全球通用户档位临时表","nodeId":"159","sql":"##删除表\\ndrop table if exists dm.tmp_201212018_user_level_${monthid};     \\n##创建表\\ncreate table dm.tmp_201212018_user_level_${monthid}\\n(\\nphone_no varchar(50),\\nuser_level int,\\nuser_level_name varchar(20) \\n) distributed by ('phone_no');\\n##插入数据\\ninsert into dm.tmp_201212018_user_level_${monthid}\\nselect phone_no,\\n       user_level,\\n       user_level_name \\nfrom GBASEDWD.DWD_SVC_INST_Gotone_ds_${curmlastday}\\ngroup by phone_no,\\n         user_level,\\n         user_level_name"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [247]-[index:379]-[2012年12月新增指标]-[25]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"25.插入数据5","nodeId":"25","sql":"insert into ${DM_PUB_201212018_TMP05_MONTHID}\\n (\\t PRODUCT_NO\\n\\t,CUR_PROMOTION_SCORE\\n\\t,CUR_DATA_SCORE\\n\\t,CUR_CONSUME_SCORE\\n\\t,CHANGE_SCORE_MONTH\\n\\t,CHANGE_SCORE_YEAR\\n\\t,FREE_FLOW_ALL\\n\\t,ACTIVE_COUNT\\n\\t,GPRS_COUNT1\\n\\t,GPRS_COUNT2\\n\\t,GPRS_COUNT3\\n\\t,GPRS_COUNT4\\n\\t,IS_4G_USER\\t\\t)\\nselect \\t distinct\\n         t1.phone_no\\t\\t\\t\\t\\tPRODUCT_NO\\n\\t\\t,t2.CUR_MON_NEW_SALE_SCORE       CUR_PROMOTION_SCORE\\n\\t\\t,t8.beixiang_TRUN_NUM  CUR_DATA_SCORE\\n\\t\\t,t2.CUR_MON_NEW_CONSM_SCORE      CUR_CONSUME_SCORE\\n\\t\\t,/*t2.CUR_MON_CUT_CONSM_SCORE*/ nvl(t8.TRUN_NUM,0)      CHANGE_SCORE_MONTH\\n\\t\\t,/*nvl(nvl(t4.CHANGE_SCORE_YEAR,0)+nvl(t2.CUR_MON_CUT_CONSM_SCORE,0),0)*/\\n         case when ${monthid}=${curyfirstmonth} then nvl(t8.TRUN_NUM,0) \\n\\t\\t else nvl(nvl(t4.CHANGE_SCORE_YEAR,0)+nvl(t8.TRUN_NUM,0),0) end CHANGE_SCORE_YEAR\\n\\t\\t,t3.PHONE_NET_FREE_RES_NUM      FREE_FLOW_ALL\\n\\t\\t,nvl(t7.active_count,0)         ACTIVE_COUNT                              /*--4G活跃天数 */\\n\\t\\t/*,t4.GPRS_TOTAL_NUM               GPRS_COUNT1\\n\\t\\t,t4.GPRS_LOC_ONNET_NUM           GPRS_COUNT2*/\\n\\t\\t,l.GPRS_COUNT1\\n\\t\\t,l.GPRS_COUNT2\\n\\t\\t,l.GPRS_COUNT3                     /*当月gprs国内漫游上网次数*/\\n\\t\\t,l.GPRS_COUNT4                     /*当月gprs国际漫游上网次数*/\\n\\t\\t,t6.G4_USER_FLAG                IS_4G_USER\\nfrom ${DWI_USR_PESN_PARTINFO_MS_MONTHID} t1\\nleft join (select phone_no,\\n                  max(CUR_MON_NEW_SALE_SCORE   )   CUR_MON_NEW_SALE_SCORE ,\\n\\t\\t          max(CUR_MON_NEW_DOU_ENJOY_SCORE )  CUR_MON_NEW_DOU_ENJOY_SCORE,\\n\\t\\t          max(CUR_MON_NEW_CONSM_SCORE  )     CUR_MON_NEW_CONSM_SCORE,\\n\\t\\t          max(CUR_MON_CUT_CONSM_SCORE  )     CUR_MON_CUT_CONSM_SCORE,\\n\\t\\t          max(YEAR_TOTAL_CUT_CONSM_SCORE )  YEAR_TOTAL_CUT_CONSM_SCORE\\n           from  ${DWI_INCO_BILL_USER_SCORE_DT_CURMLASTDAY}  group by phone_no) t2 on t1.phone_no=t2.phone_no\\nleft join (select user_id,\\n\\t\\t\\t\\t  sum(PHONE_NET_FREE_RES_NUM) PHONE_NET_FREE_RES_NUM\\n\\t\\t   from ${DWA_UV_USER_DATABUSI_MS_MONTHID} group by user_id) t3 on t1.user_id=t3.user_id\\n/*left join (select phone_no,max(GPRS_TOTAL_NUM) GPRS_TOTAL_NUM,max(T_GPRS_FLOW) T_GPRS_FLOW,\\n\\t\\t\\t\\t  max(GPRS_LOC_ONNET_NUM) GPRS_LOC_ONNET_NUM,\\n\\t\\t\\t\\t  max(GPRS_LAND_ROAM_ONNET_NUM) GPRS_LAND_ROAM_ONNET_NUM,\\n\\t\\t\\t\\t  max(GPRS_INTER_ROAM_ONNET_NUM) GPRS_INTER_ROAM_ONNET_NUM\\n\\t\\t   from ${DWI_BEH_USE_GPRS_USERTOT_MS_MONTHID} group by phone_no) t4 on t1.phone_no=t4.phone_no*/\\nleft join ${DWI_USR_PESN_MS_MONTHID} t6 on t1.phone_no=t6.phone_no\\nleft join dm_pub_201212018_${pmonthid} t4 on t1.phone_no=t4.product_no\\nleft join (select phone_no,\\n\\t\\t\\t\\t  sum(CALL_NUM )  GPRS_COUNT1,\\n\\t\\t\\t\\t  sum(case when  ROAM_TYPE in (0,1,7) then  CALL_NUM  end ) GPRS_COUNT2,\\n\\t\\t\\t\\t  sum(case when  ROAM_TYPE in (5,9) then  CALL_NUM  end ) GPRS_COUNT3,\\n\\t\\t\\t\\t  sum(case when  ROAM_TYPE in (11,13,15,17,41) then  CALL_NUM  end ) GPRS_COUNT4\\n\\t\\t   from gbasedwd.DWD_EVT_CDR_GPRS_BUSITYPETOT_MS_${monthid} group by phone_no ) l on t1.phone_no=l.phone_no\\nleft join (select PHONE_NO,count(STAT_DATE) active_count from (\\n          select STAT_DATE,PHONE_NO ,sum(total_flow) total_flow  \\n\\t      from GBASEDWD.DWD_EVT_CDR_GPRS_BUSITYPETOT_DM_${monthid}\\n\\t\\t   where    NET_TYPE=6  group by STAT_DATE ,PHONE_NO) a \\n          where a.total_flow>0  group by PHONE_NO \\n       )   t7 on t1.PHONE_NO=t7.PHONE_NO\\nleft join   (select  phone_no,\\n\\t\\t\\t\\t\\t sum(case when TRUN_TYPE IN  ('12','81')  then TRUN_NUM else 0 end ) TRUN_NUM,\\n\\t\\t\\t\\t\\t sum(case when TRUN_TYPE IN  ('88')  then TRUN_NUM else 0 end ) beixiang_TRUN_NUM\\n\\t\\t\\tfrom  gbasedwi.DWI_INCO_BILL_SCORE_TRADESN_DT_${monthid} \\n            where TRUN_TYPE IN  ('12','81','88') \\n\\t\\t\\tgroup by phone_no\\n           )  t8 on t1.PHONE_NO=t8.PHONE_NO\\nwhere (t1.MONTH_ARRIVE_FLAG=1 And t1.PROD_KIND_CODE= '171000000001') or t1.MONTH_OFF_FLAG  =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [248]-[index:380]-[2012年12月新增指标]-[121]-['str' object has no attribute 'lfind']:{"name":"删除临时表","nodeId":"121","dsName":"GbaseDM","sql":"drop table ${DM_PUB_201212018_TMP01_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP021_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP02_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP03_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP04_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP05_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP06_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP07_MONTHID};\\nDROP TABLE ${DM_PUB_201212018_TMP08_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP09_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP10_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP14_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP13_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP12_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP11_MONTHID};\\ndrop table ${DM_PUB_201212018_TMP15_MONTHID};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [249]-[index:381]-[2012年12月新增指标]-[31]-['str' object has no attribute 'lfind']:{"name":"插入数据8","nodeId":"31","dsName":"GbaseDM","sql":"insert into ${DM_PUB_201212018_TMP08_MONTHID}\\n (\\tuser_id\\t) \\nselect distinct t1.user_id\\t\\tuser_id\\nfrom ${DWI_INST_OFFER_ADDBUSI_MS_MONTHID} t1\\nleft join ( select user_id,CUR_MON_FIRST_RCHRG_TIME as pay_date from ${DWI_INCO_USERPAY_INDI_MS_MONTHID}\\n\\t\\t\\twhere day(CUR_MON_FIRST_RCHRG_TIME)>=4) t2 on t1.user_id=t2.user_id\\nleft join ( select distinct user_id,BILL_CYCLE from ${DWD_ACC_BILLOWE_MS_MONTHID}) t4 on t1.user_id=t4.user_id\\nwhere t4.user_id is not null and t4.BILL_CYCLE<='${p2monthid}'","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [250]-[index:382]-[2012年12月新增指标]-[152]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"152.创建fee临时表","nodeId":"152","sql":" drop table dm.tmp_201212018_monthowefee_${monthid};\\n CREATE TABLE dm.tmp_201212018_monthowefee_${monthid}\\n (\\n  phone_No varchar(20),\\n  is_onetofive bigint(20),\\n  Pmonthowefee01 decimal(16,2),\\n  Pmonthowefee02 decimal(16,2),\\n  Pmonthowefee03 decimal(16,2)\\n) distributed by('phone_No');\\n###插入数据\\ninsert into dm.tmp_201212018_monthowefee_${monthid}\\nselect distinct\\n       a.phone_No,\\n       b.is_onetofive, -- 一证N号标识\\n       c.I0915 Pmonthowefee01, -- 前第1个月欠费金额\\n       d.I0915 Pmonthowefee02, -- 前第2个月欠费金额\\n       e.I0915 Pmonthowefee03 -- 前第3个月欠费金额\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_MS_${monthid} a \\nleft join (select distinct phone_No,is_onetofive from gbasedwi.dwi_usr_pesn_realname_ent_ds_${curmlastday}) b on a.phone_NO=b.phone_No\\nleft join (select distinct product_no,I0915 from dm.DM_AUTORPT_ACCT_${pmonthid}) c on a.phone_No=c.product_no\\nleft join (select distinct product_no,I0915 from dm.DM_AUTORPT_ACCT_${p2monthid}) d on a.phone_No=d.product_no\\nleft join (select distinct product_no,I0915 from dm.DM_AUTORPT_ACCT_${p3monthid}) e on a.phone_No=e.product_no\\nwhere (a.MONTH_ARRIVE_FLAG=1 And a.PROD_KIND_CODE= 171000000001) or a.MONTH_OFF_FLAG  =1"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [251]-[index:384]-[漫入用户位置视图（日累计）]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"gbasegrid","dsName":"gbasegrid","schema_union":"gbasegrid","schema_dev":"gbasegrid","schema_prod":"gbasegrid","queue_union":"","queue_dev":"","queue_prod":"","name":"3.提取累计漫入用户","nodeId":"3","sql":"drop table dm.tmp_grid_diffuse_location_dt_${dayid};\\ncreate table dm.tmp_grid_diffuse_location_dt_${dayid} distributed by ('phone_no')\\nselect phone_no,county_id,oper_grid_id,grid_id\\nfrom\\n(select distinct a.*,\\n       row_number()over(partition  by phone_no order by imsi desc ) rn \\nfrom gbasegrid.grid_dw_grid_110215_detail_dm_${dayid}  a \\n) a where rn=1\\n;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [252]-[index:385]-[漫入用户位置视图（日累计）]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"5.创建结果表","nodeId":"5","sql":"drop table dm.dm_grid_diffuse_location_dt_${dayid};\\ncreate table dm.dm_grid_diffuse_location_dt_${dayid}\\n(op_time    date,\\nphone_no       varchar(20),\\ncounty_id       int,   -- 常驻居住分公司\\noper_grid_id    int,   -- 常驻居住经营网格\\ngrid_id         int,   -- 常驻居住经分网格\\nmanr_gprs_4G    decimal(12,4), -- 漫入用户-4G流量(MB)\\nmanr_gprs_5G    decimal(12,4), -- 漫入用户-5G流量(MB)\\nmanr_gprs       decimal(12,4)  -- 漫入用户-总流量(MB)\\n) distributed by ('phone_no');\\ninsert into dm.dm_grid_diffuse_location_dt_${dayid}\\nselect '${day_id}',\\n       a.*,\\n       round(sum(nvl(row_4,0)),10) manr_gprs_4G,   -- 4G流量gb\\n       round(sum(nvl(row_5,0)),10) manr_gprs_5G,       -- 5G流量gb\\n       round(sum(nvl(row_4,0)+nvl(row_5,0)+nvl(total_flow,0)),10) manr_gprs       -- 总流量gb   \\nfrom dm.tmp_grid_diffuse_location_dt_${dayid} a\\nLEFT JOIN (select phone_no,\\n                  sum(nvl(data_flowup1,0)+nvl(data_flowdown1,0)+nvl(data_flowup2,0)+nvl(data_flowdown2,0))/1024/1024 as row_4\\n           from gbasedwd.dwd_evt_sttl_lte_lroam_dm_${monthid} \\n           where srctype_id='335' and STAT_DATE between '${curm_first_day}' and '${day_id}'\\n           group by 1\\n           ) b on a.phone_no=b.phone_no\\nLEFT JOIN (select phone_no,\\n                  sum(nvl(data_flowup1,0)+nvl(data_flowdown1,0)+nvl(data_flowup2,0)+nvl(data_flowdown2,0))/1024/1024 as row_5\\n           from gbasedwd.dwd_evt_sttl_g5_lroam_dm_${monthid} \\n           where srctype_id='345' and STAT_DATE between '${curm_first_day}' and '${day_id}'\\n           group by 1\\n           ) C on a.phone_no=C.phone_no\\nleft join (select phone_no,\\n                  sum(nvl(data_flowup1,0)+nvl(data_flowdown1,0)+nvl(data_flowup2,0)+nvl(data_flowdown2,0))/1024/1024 as total_flow\\n           from gbasedwd.dwd_evt_sttl_gprs_lroam_dm_${monthid} \\n           where srctype_id='325' and STAT_DATE between '${curm_first_day}' and '${day_id}'\\n           group by 1\\n           ) d on a.phone_no=d.phone_no\\ngroup by 1,2,3,4,5           \\n;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [253]-[index:386]-[漫入用户位置视图（日累计）]-[9]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"9.导表到小集群","nodeId":"9","sql":"drop table dm.dm_grid_diffuse_location_dt_${dayid};\\ncreate table dm.dm_grid_diffuse_location_dt_${dayid} distributed by ('phone_no')\\nselect * from dm_grid_diffuse_location_dt_${dayid}@dblink_dm\\n;\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [254]-[index:389]-[渠道酬金020507月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CHANNEL_020507_${monthid};\\nCREATE TABLE  DM_PUB_CHANNEL_020507_${monthid} distributed by('channel_code')  as select * from DM_PUB_CHANNEL_020507_YYYYMM ;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [255]-[index:390]-[渠道酬金020507月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CHANNEL_020507_${monthid} \\n(select * from   \\n ODS_M_F_OTR_020507_PAYSUMLIST_${monthid}@dblink_ods);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [256]-[index:393]-[竞争对手月视图月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_COMPETITOR_${monthid};\\ncreate table DM_PUB_COMPETITOR_${monthid} distributed by ('COMP_PRODUCT_NO') as select * from  DM_PUB_COMPETITOR_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [257]-[index:394]-[竞争对手月视图月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_COMPETITOR_${monthid} \\nselect  * from DM_PUB_COMPETITOR_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [258]-[index:399]-[竞争对手月视图]-[34]-['str' object has no attribute 'lfind']:{"name":"34.目标表数据的插入","nodeId":"34","dsName":"GbaseDM","sql":"  insert into  ${DM_PUB_COMPETITOR_YYYYMM}   \\n                 (OP_TIME                     ,    \\n                   COMP_PRODUCT_NO             ,    \\n                   IS_CALLUSER                 ,    \\n                   MONTH_NEW_MARK              ,    \\n                   MONTH_ARRIVE_MARK           ,    \\n                   CALL_COUNT                  ,    \\n                   SMS_MO_COUNT                ,    \\n                   MMS_MO_COUNT\\t              ,    \\n                   DEPT_COUNT_ID\\t              ,    \\n                   OUT_CALL_DURATION_M         ,    \\n                   IN_CALL_DURATION_M          ,    \\n                   COUNT_PRODUCT_NUMBER        ,    \\n                   OPEN_DATE          \\t        ,    \\n                   COUNT_DAYS\\t                ,    \\n                   TRANSFER_CALL_DURATION_M    ,    \\n                   ADVERSARY_ID                ,    \\n                   CAMPUS_NAME\\t                ,    \\n                   PRODUCT_NO1\\t                ,    \\n                   CALL_COUNT1\\t                ,    \\n                   CALL_DURATION_M1            ,    \\n                   PRODUCT_NO2\\t                ,    \\n                   CALL_COUNT2\\t                ,    \\n                   CALL_DURATION_M2            ,    \\n                   PRODUCT_NO3          \\t      ,    \\n                   CALL_COUNT3\\t                ,    \\n                   CALL_DURATION_M3\\t          ,    \\n                   PRODUCT_NO4\\t                ,    \\n                   CALL_COUNT4\\t                ,    \\n                   CALL_DURATION_M4\\t          ,    \\n                   PRODUCT_NO5\\t                ,    \\n                   CALL_COUNT5\\t                ,    \\n                   CALL_DURATION_M5            ,    \\n                   PRODUCT_NO6\\t                ,    \\n                   CALL_COUNT6\\t                ,    \\n                   CALL_DURATION_M6     \\t      ,    \\n                   PRODUCT_NO7\\t                ,    \\n                   CALL_COUNT7\\t                ,    \\n                   CALL_DURATION_M7\\t          ,    \\n                   PRODUCT_NO8\\t                ,    \\n                   CALL_COUNT8\\t                ,    \\n                   CALL_DURATION_M8\\t          ,    \\n                   PRODUCT_NO9\\t                ,    \\n                   CALL_COUNT9\\t                ,    \\n                   CALL_DURATION_M9\\t          ,    \\n                   PRODUCT_NO10\\t              ,    \\n                   CALL_COUNT10\\t              ,    \\n                   CALL_DURATION_M10           ,    \\n                   PRODUCT_NO11\\t              ,    \\n                   CALL_COUNT11\\t              ,    \\n                   CALL_DURATION_M11    \\t      ,    \\n                   PRODUCT_NO12\\t              ,    \\n                   CALL_COUNT12\\t              ,    \\n                   CALL_DURATION_M12\\t          ,    \\n                   PRODUCT_NO13\\t              ,    \\n                   CALL_COUNT13\\t              ,    \\n                   CALL_DURATION_M13\\t          ,    \\n                   PRODUCT_NO14\\t              ,    \\n                   CALL_COUNT14\\t              ,    \\n                   CALL_DURATION_M14\\t          ,    \\n                   PRODUCT_NO15\\t              ,    \\n                   CALL_COUNT15         \\t      ,    \\n                   CALL_DURATION_M15\\t          ,    \\n                   PRODUCT_NO16\\t              ,    \\n                   CALL_COUNT16\\t              ,    \\n                   CALL_DURATION_M16    \\t      ,    \\n                   PRODUCT_NO17\\t              ,    \\n                   CALL_COUNT17\\t              ,    \\n                   CALL_DURATION_M17\\t          ,    \\n                   PRODUCT_NO18\\t              ,    \\n                   CALL_COUNT18\\t              ,    \\n                   CALL_DURATION_M18\\t          ,    \\n                   PRODUCT_NO19\\t              ,    \\n                   CALL_COUNT19\\t              ,    \\n                   CALL_DURATION_M19\\t          ,    \\n                   PRODUCT_NO20\\t              ,    \\n                   CALL_COUNT20\\t              ,    \\n                   CALL_DURATION_M20    \\t      ,    \\n                   IS_SCHOOL_USER\\t,\\n                   IS_VNO,\\n\\t\\t\\t\\t   grid_id,\\n\\t\\t\\t\\t   regional_center_id) \\n                          \\n          select  TO_DATE('${monthid}','YYYYMM')  STAT_MON                   ,\\n                 a.CMPT_PHONE_NO                       ,\\n                 case when a.CALL_NUM >0 or a.SMS_NUM >0 or a.MMS_NUM >0 then 1 else 0 end IS_CALLUSER                ,\\n                 b.CUR_MON_NEW_FLAG                      ,   \\n                 b.CUR_MON_ARRV_FLAG                   ,\\n                 a.CALL_NUM                            ,\\n                 a.SMS_NUM                             ,\\n                 a.MMS_NUM                             ,\\n                 a.BELNG_DEPT_COUNTY_ID                ,\\n                 b.CALING_CALL_DUR                  ,\\n                 b.CALLED_DUR                       ,\\n                 c.COUNT_PRODUCT_NUMBER                ,\\n                 b.RENET_FIR_COMM_DATE                       ,\\n                 null   /*e.COUNT_DAYS       */                   ,\\n                 b.FORW_CALL_DUR                       ,\\n                 case when a.CARR_NAME='联通' then 1 when a.CARR_NAME='电信' then 2 end ADVERSARY_ID             ,\\n                 NULL                 ,\\n                 f.PRODUCT_NO1\\t                       ,\\n                 f.CALL_COUNT1\\t                       ,\\n                 f.CALL_DURATION_M1                    ,\\n                 f.PRODUCT_NO2\\t                       ,\\n                 f.CALL_COUNT2\\t                       ,\\n                 f.CALL_DURATION_M2                    ,\\n                 f.PRODUCT_NO3                         ,\\n                 f.CALL_COUNT3\\t                       ,\\n                 f.CALL_DURATION_M3\\t                   ,\\n                 f.PRODUCT_NO4\\t                       ,\\n                 f.CALL_COUNT4\\t                       ,\\n                 f.CALL_DURATION_M4\\t                   ,\\n                 f.PRODUCT_NO5\\t                       ,\\n                 f.CALL_COUNT5\\t                       ,\\n                 f.CALL_DURATION_M5                    ,\\n                 f.PRODUCT_NO6\\t                       ,\\n                 f.CALL_COUNT6\\t                       ,\\n                 f.CALL_DURATION_M6                    ,\\n                 f.PRODUCT_NO7\\t                       ,\\n                 f.CALL_COUNT7\\t                       ,\\n                 f.CALL_DURATION_M7\\t                   ,\\n                 f.PRODUCT_NO8\\t                       ,\\n                 f.CALL_COUNT8\\t                       ,\\n                 f.CALL_DURATION_M8\\t                   ,\\n                 f.PRODUCT_NO9\\t                       ,\\n                 f.CALL_COUNT9\\t                       ,\\n                 f.CALL_DURATION_M9\\t                   ,\\n                 f.PRODUCT_NO10\\t                       ,\\n                 f.CALL_COUNT10\\t                       ,\\n                 f.CALL_DURATION_M10                   ,\\n                 f.PRODUCT_NO11\\t                       ,\\n                 f.CALL_COUNT11\\t                       ,\\n                 f.CALL_DURATION_M11                   ,\\n                 f.PRODUCT_NO12\\t                       ,\\n                 f.CALL_COUNT12\\t                       ,\\n                 f.CALL_DURATION_M12\\t                 ,\\n                 f.PRODUCT_NO13\\t                       ,\\n                 f.CALL_COUNT13\\t                       ,\\n                 f.CALL_DURATION_M13\\t                 ,\\n                 f.PRODUCT_NO14\\t                       ,\\n                 f.CALL_COUNT14\\t                       ,\\n                 f.CALL_DURATION_M14\\t                 ,\\n                 f.PRODUCT_NO15\\t                       ,\\n                 f.CALL_COUNT15                        ,\\n                 f.CALL_DURATION_M15\\t                 ,\\n                 f.PRODUCT_NO16\\t                       ,\\n                 f.CALL_COUNT16\\t                       ,\\n                 f.CALL_DURATION_M16                   ,\\n                 f.PRODUCT_NO17\\t                       ,\\n                 f.CALL_COUNT17\\t                       ,\\n                 f.CALL_DURATION_M17\\t                 ,\\n                 f.PRODUCT_NO18\\t                       ,\\n                 f.CALL_COUNT18\\t                       ,\\n                 f.CALL_DURATION_M18\\t                 ,\\n                 f.PRODUCT_NO19\\t                       ,\\n                 f.CALL_COUNT19\\t                       ,\\n                 f.CALL_DURATION_M19\\t                 ,\\n                 f.PRODUCT_NO20\\t                       ,\\n                 f.CALL_COUNT20\\t                       ,\\n                 f.CALL_DURATION_M20                   ,\\n                 NULL                                               ,\\n                 a.virt_carr_flag as is_vno, /*--是否虚拟运营商号码 1 是 0 否*/\\n\\t\\t\\t\\t a.grid_id,\\n\\t\\t\\t\\t n.regional_center_id\\n           from gbasedwi.DWI_BEH_USE_OPP_TOT_MS_${monthid} a\\nleft join (select distinct grid_id,grid_name,regional_center_id,regional_center_name from gbasedwd.dim_pub_cell) n on a.grid_id=n.grid_id\\n           left join gbasedwi.DWI_BEH_USE_INTERCONNECTION_MS_${monthid} b  on a.CMPT_PHONE_NO = b.CMPT_PHONE_NO\\n           left join (select a.COMP_PRODUCT_NO,count(distinct a.product_no) COUNT_PRODUCT_NUMBER\\n                       from DM_PUB_COMPETITOR_TMP1   a group by a.COMP_PRODUCT_NO ) c on a.CMPT_PHONE_NO = c.COMP_PRODUCT_NO\\n           left join DM_PUB_COMPETITOR_DT_${curmlastday}  e on a.CMPT_PHONE_NO = e.COMP_PRODUCT_NO \\n           left join DM_PUB_COMPETITOR_TMP3 f on a.CMPT_PHONE_NO = f.COMP_PRODUCT_NO\\n            where   a.CARR_NAME in ('联通','电信')\\n           ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [259]-[index:401]-[竞争对手月视图]-[52]-['str' object has no attribute 'lfind']:{"name":"临时表1的创建","nodeId":"52","dsName":"GbaseDM","sql":"drop table DM_PUB_COMPETITOR_TMP1;\\ncreate table DM_PUB_COMPETITOR_TMP1\\n             (OP_TIME              DATE,\\n             COMP_PRODUCT_NO      VARCHAR(20),\\n             PRODUCT_NO           VARCHAR(20),\\n             CALL_COUNT           BIGINT,\\n             CALL_DURATION_M      BIGINT\\n            )DISTRIBUTED BY('COMP_PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [260]-[index:402]-[竞争对手月视图]-[53]-['str' object has no attribute 'lfind']:{"name":"临时表1的插入","nodeId":"53","dsName":"GbaseDM","sql":"insert into  DM_PUB_COMPETITOR_TMP1 (\\n                   OP_TIME            ,\\n                   COMP_PRODUCT_NO    ,\\n                   PRODUCT_NO         ,\\n                   CALL_COUNT         ,\\n                   CALL_DURATION_M    \\n                     )\\n       select TO_DATE('${monthid}','YYYYMM') STAT_MON ,\\n              a.OPP_NO              ,\\n              a.PHONE_NO            ,\\n              a.CALL_NUM            ,\\n              a.CALL_DUR   \\n        from ( select a.OPP_NO,a.PHONE_NO,sum(a.CALL_NUM) CALL_NUM,sum(a.CALL_DUR) CALL_DUR \\n                  from gbasedwi.DWI_BEH_USE_SPHERE_TOT_MS_${monthid} a  group by a.OPP_NO,a.PHONE_NO )a\\n         inner join gbasedwi.DWI_BEH_USE_OPP_TOT_MS_${monthid} b  on a.OPP_NO = b.CMPT_PHONE_NO\\n         where b.CARR_NAME in ('联通','电信') ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [261]-[index:403]-[竞争对手月视图]-[54]-['str' object has no attribute 'lfind']:{"name":"临时表2的创建","nodeId":"54","dsName":"GbaseDM","sql":"drop table DM_PUB_COMPETITOR_TMP2;\\ncreate table DM_PUB_COMPETITOR_TMP2\\n            (OP_TIME              DATE,\\n             ROW_RANK             BIGINT,\\n             COMP_PRODUCT_NO      VARCHAR(20),\\n             PRODUCT_NO           VARCHAR(20),\\n             CALL_COUNT           BIGINT,\\n             CALL_DURATION_M      BIGINT \\n        \\n            )DISTRIBUTED BY('COMP_PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [262]-[index:404]-[竞争对手月视图]-[55]-['str' object has no attribute 'lfind']:{"name":"临时表2的插入","nodeId":"55","dsName":"GbaseDM","sql":" insert into  DM_PUB_COMPETITOR_TMP2 (\\n                   OP_TIME            ,\\n                   ROW_RANK          ,\\n                   COMP_PRODUCT_NO    ,\\n                   PRODUCT_NO         ,\\n                   CALL_COUNT         ,\\n                   CALL_DURATION_M    \\n                     )\\n      select OP_TIME ,\\n              row_number        ,\\n              COMP_PRODUCT_NO   ,\\n              PRODUCT_NO        ,\\n              CALL_COUNT        ,\\n              CALL_DURATION_M \\n        from (select row_number () over ( PARTITION by COMP_PRODUCT_NO  order by call_count desc,product_no desc) row_number  , \\n                              op_time,\\n\\t\\t\\t\\t\\t\\t\\t                comp_product_no,\\n\\t\\t\\t\\t\\t\\t\\t                product_no,\\n\\t\\t\\t\\t\\t\\t\\t                call_count,\\n\\t\\t\\t\\t\\t\\t\\t                call_duration_m\\n              from DM_PUB_COMPETITOR_TMP1 ) a\\n             where  row_number<='20'   ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [263]-[index:405]-[竞争对手月视图]-[56]-['str' object has no attribute 'lfind']:{"name":"临时表3的创建","nodeId":"56","dsName":"GbaseDM","sql":"drop table DM_PUB_COMPETITOR_TMP3;\\ncreate table DM_PUB_COMPETITOR_TMP3\\n           ( OP_TIME                     DATE,\\n             COMP_PRODUCT_NO              VARCHAR(20),\\n             PRODUCT_NO1\\t                VARCHAR(20),\\n             CALL_COUNT1\\t                BIGINT    ,\\n             CALL_DURATION_M1             BIGINT    ,\\n             PRODUCT_NO2\\t                VARCHAR(20),\\n             CALL_COUNT2\\t                BIGINT,\\n             CALL_DURATION_M2             BIGINT,\\n             PRODUCT_NO3          \\t      VARCHAR(20),\\n             CALL_COUNT3\\t                BIGINT,\\n             CALL_DURATION_M3\\t            BIGINT,\\n             PRODUCT_NO4\\t                VARCHAR(20),\\n             CALL_COUNT4\\t                BIGINT,\\n             CALL_DURATION_M4\\t            BIGINT,\\n             PRODUCT_NO5\\t                VARCHAR(20),\\n             CALL_COUNT5\\t                BIGINT,\\n             CALL_DURATION_M5      \\t      BIGINT,\\n             PRODUCT_NO6\\t                VARCHAR(20),\\n             CALL_COUNT6\\t                BIGINT,\\n             CALL_DURATION_M6     \\t      BIGINT,\\n             PRODUCT_NO7\\t                VARCHAR(20),\\n             CALL_COUNT7\\t                BIGINT,\\n             CALL_DURATION_M7\\t            BIGINT,\\n             PRODUCT_NO8\\t                VARCHAR(20),\\n             CALL_COUNT8\\t                BIGINT,\\n             CALL_DURATION_M8\\t            BIGINT,\\n             PRODUCT_NO9\\t                VARCHAR(20),\\n             CALL_COUNT9\\t                BIGINT,\\n             CALL_DURATION_M9\\t            BIGINT,\\n             PRODUCT_NO10\\t                VARCHAR(20),\\n             CALL_COUNT10\\t                BIGINT,\\n             CALL_DURATION_M10     \\t      BIGINT,\\n             PRODUCT_NO11\\t                VARCHAR(20),\\n             CALL_COUNT11\\t                BIGINT,\\n             CALL_DURATION_M11    \\t      BIGINT,\\n             PRODUCT_NO12\\t                VARCHAR(20),\\n             CALL_COUNT12\\t                BIGINT,\\n             CALL_DURATION_M12\\t          BIGINT,\\n             PRODUCT_NO13\\t                VARCHAR(20),\\n             CALL_COUNT13\\t                BIGINT,\\n             CALL_DURATION_M13\\t          BIGINT,\\n             PRODUCT_NO14\\t                VARCHAR(20),\\n             CALL_COUNT14\\t                BIGINT,\\n             CALL_DURATION_M14\\t          BIGINT,\\n             PRODUCT_NO15\\t                VARCHAR(20),\\n             CALL_COUNT15         \\t      BIGINT,\\n             CALL_DURATION_M15\\t          BIGINT,\\n             PRODUCT_NO16\\t                VARCHAR(20),\\n             CALL_COUNT16\\t                BIGINT,\\n             CALL_DURATION_M16    \\t      BIGINT,\\n             PRODUCT_NO17\\t                VARCHAR(20),\\n             CALL_COUNT17\\t                BIGINT,\\n             CALL_DURATION_M17\\t          BIGINT,\\n             PRODUCT_NO18\\t                VARCHAR(20),\\n             CALL_COUNT18\\t                BIGINT, \\n             CALL_DURATION_M18\\t          BIGINT,\\n             PRODUCT_NO19\\t                VARCHAR(20),\\n             CALL_COUNT19\\t                BIGINT,\\n             CALL_DURATION_M19\\t          BIGINT,\\n             PRODUCT_NO20\\t                VARCHAR(20),\\n             CALL_COUNT20\\t                BIGINT,\\n             CALL_DURATION_M20    \\t      BIGINT\\n            )DISTRIBUTED BY('COMP_PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [264]-[index:406]-[竞争对手月视图]-[57]-['str' object has no attribute 'lfind']:{"name":"临时表3的插入","nodeId":"57","dsName":"GbaseDM","sql":" insert into DM_PUB_COMPETITOR_TMP3\\n            ( OP_TIME              ,\\n             COMP_PRODUCT_NO      ,\\n             PRODUCT_NO1\\t        ,\\n             CALL_COUNT1\\t       ,\\n             CALL_DURATION_M1    ,\\n             PRODUCT_NO2\\t       ,\\n             CALL_COUNT2\\t       ,\\n             CALL_DURATION_M2    ,\\n             PRODUCT_NO3         ,\\n             CALL_COUNT3\\t       ,\\n             CALL_DURATION_M3\\t   ,\\n             PRODUCT_NO4\\t       ,\\n             CALL_COUNT4\\t       ,\\n             CALL_DURATION_M4\\t   ,\\n             PRODUCT_NO5\\t       ,\\n             CALL_COUNT5\\t       ,\\n             CALL_DURATION_M5    ,\\n             PRODUCT_NO6\\t       ,\\n             CALL_COUNT6\\t       ,\\n             CALL_DURATION_M6    ,\\n             PRODUCT_NO7\\t       ,\\n             CALL_COUNT7\\t       ,\\n             CALL_DURATION_M7\\t   ,\\n             PRODUCT_NO8\\t       ,\\n             CALL_COUNT8\\t       ,\\n             CALL_DURATION_M8\\t   ,\\n             PRODUCT_NO9\\t       ,\\n             CALL_COUNT9\\t       ,\\n             CALL_DURATION_M9\\t   ,\\n             PRODUCT_NO10\\t       ,\\n             CALL_COUNT10\\t       ,\\n             CALL_DURATION_M10   ,\\n             PRODUCT_NO11\\t       ,\\n             CALL_COUNT11\\t       ,\\n             CALL_DURATION_M11   ,\\n             PRODUCT_NO12\\t       ,\\n             CALL_COUNT12\\t       ,\\n             CALL_DURATION_M12\\t ,\\n             PRODUCT_NO13\\t       ,\\n             CALL_COUNT13\\t       ,\\n             CALL_DURATION_M13\\t ,\\n             PRODUCT_NO14\\t       ,\\n             CALL_COUNT14\\t       ,\\n             CALL_DURATION_M14\\t ,\\n             PRODUCT_NO15\\t       ,\\n             CALL_COUNT15        ,\\n             CALL_DURATION_M15\\t ,\\n             PRODUCT_NO16\\t       ,\\n             CALL_COUNT16\\t       ,\\n             CALL_DURATION_M16   ,\\n             PRODUCT_NO17\\t       ,\\n             CALL_COUNT17\\t       ,\\n             CALL_DURATION_M17\\t ,\\n             PRODUCT_NO18\\t       ,\\n             CALL_COUNT18\\t       ,\\n             CALL_DURATION_M18\\t ,\\n             PRODUCT_NO19\\t       ,\\n             CALL_COUNT19\\t       ,\\n             CALL_DURATION_M19\\t ,\\n             PRODUCT_NO20\\t       ,\\n             CALL_COUNT20\\t       ,\\n             CALL_DURATION_M20 \\n              )\\n       select  TO_DATE('${monthid}','YYYYMM')  OP_TIME,\\n               comp_product_no ,\\n               max(case when row_rank ='1'  then  product_no else  0 end) ,\\n               max(case when row_rank ='1'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='1'  then  call_duration_m else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='2'  then  product_no else  0 end ),\\n               max(case when row_rank ='2'  then  call_count else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='2'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='3'  then  product_no else  0 end ),\\n               max(case when row_rank ='3'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='3'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='4'  then  product_no else  0 end ),\\n               max(case when row_rank ='4'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='4'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='5'  then  product_no else  0 end) ,\\n               max(case when row_rank ='5'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='5'  then  call_duration_m else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='6'  then  product_no else  0 end ),\\n               max(case when row_rank ='6'  then  call_count else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='6'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='7'  then  product_no else  0 end ),\\n               max(case when row_rank ='7'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='7'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='8'  then  product_no else  0 end ),\\n               max(case when row_rank ='8'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='8'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='9'  then  product_no else  0 end) ,\\n               max(case when row_rank ='9'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='9'  then  call_duration_m else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='10'  then  product_no else  0 end ),\\n               max(case when row_rank ='10'  then  call_count else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='10'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='11'  then  product_no else  0 end ),\\n               max(case when row_rank ='11'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='11'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='12'  then  product_no else  0 end ),\\n               max(case when row_rank ='12'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='12'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='13'  then  product_no else  0 end) ,\\n               max(case when row_rank ='13'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='13'  then  call_duration_m else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='14'  then  product_no else  0 end ),\\n               max(case when row_rank ='14'  then  call_count else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='14'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='15'  then  product_no else  0 end ),\\n               max(case when row_rank ='15'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='15'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='16'  then  product_no else  0 end ),\\n               max(case when row_rank ='16'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='16'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='17'  then  product_no else  0 end) ,\\n               max(case when row_rank ='17'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='17'  then  call_duration_m else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='18'  then  product_no else  0 end ),\\n               max(case when row_rank ='18'  then  call_count else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='18'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='19'  then  product_no else  0 end ),\\n               max(case when row_rank ='19'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='19'  then  call_duration_m else  0 end ),\\n\\t\\t\\t\\t\\t\\t\\t max(case when row_rank ='20'  then  product_no else  0 end ),\\n               max(case when row_rank ='20'  then  call_count else  0 end) ,\\n\\t\\t\\t\\t\\t\\t   max(case when row_rank ='20'  then  call_duration_m else  0 end )\\n      from  DM_PUB_COMPETITOR_TMP2     \\n\\t\\t\\t\\t\\t\\tgroup by comp_product_no ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [265]-[index:407]-[竞争对手月视图]-[66]-['str' object has no attribute 'lfind']:{"name":"66.创建结果表","nodeId":"66","dsName":"GbaseDM","sql":"drop table dm_pub_competitor_${monthid};\\nCREATE TABLE dm_pub_competitor_${monthid} (\\n  OP_TIME date,\\n  COMP_PRODUCT_NO varchar(20),\\n  IS_CALLUSER smallint(6),\\n  MONTH_NEW_MARK smallint(6),\\n  MONTH_ARRIVE_MARK smallint(6),\\n  CALL_COUNT bigint(20),\\n  SMS_MO_COUNT bigint(20),\\n  MMS_MO_COUNT bigint(20),\\n  DEPT_COUNT_ID smallint(6),\\n  OUT_CALL_DURATION_M bigint(20),\\n  IN_CALL_DURATION_M bigint(20),\\n  COUNT_PRODUCT_NUMBER bigint(20),\\n  OPEN_DATE date,\\n  COUNT_DAYS bigint(20),\\n  TRANSFER_CALL_DURATION_M bigint(20),\\n  ADVERSARY_ID char(1),\\n  CAMPUS_NAME varchar(200),\\n  PRODUCT_NO1 varchar(20),\\n  CALL_COUNT1 bigint(20),\\n  CALL_DURATION_M1 bigint(20),\\n  PRODUCT_NO2 varchar(20),\\n  CALL_COUNT2 bigint(20),\\n  CALL_DURATION_M2 bigint(20),\\n  PRODUCT_NO3 varchar(20),\\n  CALL_COUNT3 bigint(20),\\n  CALL_DURATION_M3 bigint(20),\\n  PRODUCT_NO4 varchar(20),\\n  CALL_COUNT4 bigint(20),\\n  CALL_DURATION_M4 bigint(20),\\n  PRODUCT_NO5 varchar(20),\\n  CALL_COUNT5 bigint(20),\\n  CALL_DURATION_M5 bigint(20),\\n  PRODUCT_NO6 varchar(20),\\n  CALL_COUNT6 bigint(20),\\n  CALL_DURATION_M6 bigint(20),\\n  PRODUCT_NO7 varchar(20),\\n  CALL_COUNT7 bigint(20),\\n  CALL_DURATION_M7 bigint(20),\\n  PRODUCT_NO8 varchar(20),\\n  CALL_COUNT8 bigint(20),\\n  CALL_DURATION_M8 bigint(20),\\n  PRODUCT_NO9 varchar(20),\\n  CALL_COUNT9 bigint(20),\\n  CALL_DURATION_M9 bigint(20),\\n  PRODUCT_NO10 varchar(20),\\n  CALL_COUNT10 bigint(20),\\n  CALL_DURATION_M10 bigint(20),\\n  PRODUCT_NO11 varchar(20),\\n  CALL_COUNT11 bigint(20),\\n  CALL_DURATION_M11 bigint(20),\\n  PRODUCT_NO12 varchar(20),\\n  CALL_COUNT12 bigint(20),\\n  CALL_DURATION_M12 bigint(20),\\n  PRODUCT_NO13 varchar(20),\\n  CALL_COUNT13 bigint(20),\\n  CALL_DURATION_M13 bigint(20),\\n  PRODUCT_NO14 varchar(20),\\n  CALL_COUNT14 bigint(20),\\n  CALL_DURATION_M14 bigint(20),\\n  PRODUCT_NO15 varchar(20),\\n  CALL_COUNT15 bigint(20),\\n  CALL_DURATION_M15 bigint(20),\\n  PRODUCT_NO16 varchar(20),\\n  CALL_COUNT16 bigint(20),\\n  CALL_DURATION_M16 bigint(20),\\n  PRODUCT_NO17 varchar(20),\\n  CALL_COUNT17 bigint(20),\\n  CALL_DURATION_M17 bigint(20),\\n  PRODUCT_NO18 varchar(20),\\n  CALL_COUNT18 bigint(20),\\n  CALL_DURATION_M18 bigint(20),\\n  PRODUCT_NO19 varchar(20),\\n  CALL_COUNT19 bigint(20),\\n  CALL_DURATION_M19 bigint(20),\\n  PRODUCT_NO20 varchar(20),\\n  CALL_COUNT20 bigint(20),\\n  CALL_DURATION_M20 bigint(20),\\n  IS_SCHOOL_USER char(1),\\n  IS_VNO smallint(6),\\n  grid_id bigint(20),\\n  regional_center_id   bigint  -- 经营网格\\n) ENGINE=EXPRESS DISTRIBUTED BY('comp_product_no') DEFAULT CHARSET=utf8 TABLESPACE='sys_tablespace'","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [266]-[index:411]-[欠费日视图]-[12]-['str' object has no attribute 'lfind']:{"name":"12.目标表数据插入","nodeId":"12","dsName":"GbaseDM","sql":" insert into  ${DM_PUB_ACCT_OWE_YYYYMMDD} \\n  (\\t\\tOP_TIME,    \\n\\t\\tPRODUCT_NO,   \\n\\t\\tACCT_ID,   \\n\\t\\tFEE_ITEM_ID,   \\n\\t\\tCYCLE_DATE,   \\n\\t\\tBRAND_TYPE_ID,  \\n\\t\\tOWE_FEE,\\n\\t\\tUSER_ID,\\n\\t\\tOWE_FEE_DT, \\n\\t\\tACCT_OWE_MONTH,\\n\\t\\tDEPT_COUNTY_ID,\\n\\t\\tDEPT_ID, \\n\\t\\tCHANNEL_KIND,\\n\\t\\tCHANNEL_ID, \\n\\t\\tUSER_OPENTIME,\\n\\t\\tUSER_OFFTIME,\\n\\t\\tUSERSTATUS_ID,     \\n\\t\\tIS_ACCT_BAD            )\\nselect\\ta.OP_TIME,            \\n\\t\\tnvl(e.LAN_BILL_NO,a.PRODUCT_NO),         \\n\\t\\ta.ACCT_ID ,           \\n\\t\\ta.FEE_ITEM_ID,      \\n\\t\\ta.CYCLE_DATE,        \\n\\t\\tcase when a.BRAND_TYPE_ID in('16' ,'4') then '1'          \\n\\t\\t\\t when a.BRAND_TYPE_ID in ('0   ' ,'9   ' ,'15  ' ,'17  ' ,'14  ' ,'2   ' ,'8   ' ,'1   ' ,'10 ','12')  then '2'  \\n\\t\\t\\t when  a.BRAND_TYPE_ID in ('6  '  ,'11 '  ,'7  '  ,'5  '  ,'13 '  ,'3  ')   then '3'      end brand_type_id,     \\n\\t\\ta. OWE_FEE ,          \\n\\t\\ta.USER_ID,            \\n\\t\\ta.OWE_FEE_DT ,          \\n\\t\\ta.ACCT_OWE_MONTH  ,     \\n\\t\\tb.DEPT_COUNTY_ID,     \\n\\t\\tb.DEPT_ID      ,       \\n\\t\\tb.CHANNEL_KIND ,       \\n\\t\\tb.CHANNEL_ID  ,      \\n\\t\\tto_date(c.INNET_DATE,'YYYYMMDD') ,      \\n\\t\\tto_date(c.OFF_DATE,'YYYYMMDD')  /*to_date(c.PRE_DESTORY_DATE,'YYYYMMDD')*/ ,     \\n\\t\\tc.BASS_USER_STATE ,   \\n\\t\\tcase when d.phone_no is null and d.acct_id is null then  0 else 1 end     \\nfrom DM_PUB_ACCT_OWE_TMP1  a \\nleft join DM_PUB_ACCT_OWE_TMP2  b  on a.PRODUCT_NO =b.PRODUCT_NO  and a. ACCT_ID =b. ACCT_ID   \\nleft join gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} c \\n\\ton a.PRODUCT_NO=c.PHONE_NO and a.ACCT_ID=c.ACCT_ID    \\nleft join (select distinct phone_no,acct_id from gbasemsm.msm_dw_basekpi_10330_owebill_${pmonthid}) d \\n\\ton a.PRODUCT_NO=d.phone_no and  a.acct_id=d.acct_id\\nleft join (select distinct LAN_BILL_NO,user_id from gbasedwi.DWI_USR_PESN_LAN_DS_${dayid}) e on a.user_id=e.user_id","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [267]-[index:413]-[欠费日视图]-[18]-['str' object has no attribute 'lfind']:{"name":"18.临时表1的插入","nodeId":"18","dsName":"GbaseDM","sql":" insert into  DM_PUB_ACCT_OWE_TMP1 (\\n              OP_TIME  ,     \\n              PRODUCT_NO  ,  \\n              ACCT_ID    ,   \\n              FEE_ITEM_ID  , \\n              CYCLE_DATE    ,\\n              BRAND_TYPE_ID ,\\n              OWE_FEE   ,\\n              USER_ID,  \\n              OWE_FEE_DT   ,   \\n              ACCT_OWE_MONTH      \\n       )\\n  select  a.STAT_DATE  ,\\n          a.PHONE_NO,        \\n          a.ACCT_ID,           \\n   \\t     \\ta.BOSS_ACCT_ITEM_ID,        \\n   \\t\\t    a.BILL_CYCLE,         \\n   \\t\\t    a.BRAND_TYPE,     \\n   \\t\\t    a.NOT_WRTOF_FEE ,        \\n   \\t\\t    a.user_id         ,           \\n   \\t\\t    sum(c.NOT_WRTOF_FEE) ,     \\n   \\t\\t    count(distinct c.BILL_CYCLE)\\n   \\t\\t from gbasedwd.DWD_ACC_BILLOWE_DS_${dayid} a   \\n   left join   gbasedwd.DWD_ACC_BILLOWE_DS_${dayid}   c  \\n       on  a.PHONE_NO=c.PHONE_NO  and  a.ACCT_ID=c.ACCT_ID\\n    where a.OWE_TYPE='0'\\n     and   c.BILL_CYCLE<=a.BILL_CYCLE\\n     group by a.STAT_DATE  ,       \\n              a.PHONE_NO,         \\n              a.ACCT_ID,          \\n              a.BOSS_ACCT_ITEM_ID,\\n              a.BILL_CYCLE,\\n              a.BRAND_TYPE,a.user_id,\\n              a.NOT_WRTOF_FEE ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [268]-[index:414]-[欠费日视图]-[23]-['str' object has no attribute 'lfind']:{"name":"23.临时表1的创建","nodeId":"23","dsName":"GbaseDM","sql":"  drop  table  DM_PUB_ACCT_OWE_TMP1;\\n   create table  DM_PUB_ACCT_OWE_TMP1\\n    (OP_TIME        DATE           ,\\n     PRODUCT_NO     VARCHAR(20)    ,      \\n     ACCT_ID        VARCHAR(20)    ,       \\n     FEE_ITEM_ID    VARCHAR(10)    ,    \\n     CYCLE_DATE     INTEGER        ,\\n     BRAND_TYPE_ID  INTEGER        , \\n     OWE_FEE        DECIMAL(12, 2) ,\\n     USER_ID        VARCHAR(30)    ,\\n     OWE_FEE_DT     DECIMAL(15, 2) ,\\n     ACCT_OWE_MONTH INTEGER  \\n )distributed by ('PRODUCT_NO')\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [269]-[index:415]-[欠费日视图]-[26]-['str' object has no attribute 'lfind']:{"name":"26.临时表2的创建","nodeId":"26","dsName":"GbaseDM","sql":"drop table DM_PUB_ACCT_OWE_TMP2;\\n  create table  DM_PUB_ACCT_OWE_TMP2\\n    (          OP_TIME         DATE ,\\n               PRODUCT_NO     VARCHAR(20),\\n               ACCT_ID        VARCHAR(20),\\n               DEPT_COUNTY_ID INTEGER,\\n               DEPT_ID        VARCHAR(60) ,\\n               CHANNEL_KIND   SMALLINT ,\\n               CHANNEL_ID     VARCHAR(60)                \\n )distributed by ('PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [270]-[index:416]-[欠费日视图]-[27]-['str' object has no attribute 'lfind']:{"name":"27.临时表2的插入","nodeId":"27","dsName":"GbaseDM","sql":" insert into DM_PUB_ACCT_OWE_TMP2 (             \\n               PRODUCT_NO      ,\\n               ACCT_ID         ,\\n               DEPT_COUNTY_ID  ,\\n               DEPT_ID         ,\\n               CHANNEL_KIND    ,\\n               CHANNEL_ID                   \\n        )\\n        \\n  select \\n         a.PHONE_NO,\\n         b.ACCT_ID  ,\\n         c.DEPT_COUNTY_ID,  \\n         d.DEPT_COUNTY_NAME ,   \\n         d.CHL_CLASS,   \\n         d.CHL_NAME      \\n  from \\n  (select a.PHONE_NO,\\n          max(a.BILL_CYCLE) BILL_CYCLE \\n         from gbasedwd.DWD_ACC_BILLOWE_DS_${dayid} a \\n     left join gbasedwi.DWI_INCO_OWE_GPRPROD_DS_${dayid} b \\n           on a.PHONE_NO=b.PHONE_NO    and a.ACCT_ID=b.ACCT_ID\\n      left join  gbasedwd.DWD_ACC_BILLOWE_DS_${dayid} c   \\n        on a.PHONE_NO=c.PHONE_NO  and  a.ACCT_ID=c.ACCT_ID    \\n  where a.OWE_TYPE='0' \\n  group by a.PHONE_NO) a \\n  left join  (select distinct ACCT_ID, \\n                     PHONE_NO,\\n\\t\\t\\t\\t\\t           BILL_CYCLE  \\n\\t\\t           from gbasedwd.DWD_ACC_BILLOWE_DS_${dayid} )  b  \\n\\t\\ton  a.PHONE_NO=b.PHONE_NO and  a.BILL_CYCLE=b.BILL_CYCLE\\n  left join gbasedwi.DWI_USR_PESN_PERSN_LOC_DS_${dayid} c   \\n     on  a.PHONE_NO=c.PHONE_NO\\n  left join (select a.STAT_DATE,\\n                    a.PHONE_NO,\\n                    a.CHL_NAME,\\n\\t\\t\\t\\t\\t          b.CHL_CLASS,\\n\\t\\t\\t\\t\\t          a.DEPT_COUNTY_NAME \\n\\t\\t          from  gbasedwi.DWI_RES_NAC_CODE_NUM_DT_${dayid} a  \\n              left join gbasedwi.DWI_RES_ENTY_CHL_DS_${dayid} b   \\n\\t\\t          on trim(a.CHL_ID)=trim(b.CHL_CODE)\\n\\t\\t           ) d \\n\\t\\t  on  a.PHONE_NO=d.PHONE_NO        ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [271]-[index:418]-[账务信息--DM_AUTORPT_ACCT_YYYYMM]-[14]-['str' object has no attribute 'lfind']:{"name":"14.插入目标表数据","nodeId":"14","dsName":"GbaseDM","sql":"insert into ${TARGET_DM_AUTORPT_ACCT_YYYYMM}\\n ( \\t OP_TIME\\n\\t,STATIS_MONTH\\n\\t,PRODUCT_NO\\n\\t,I0880\\n\\t,I0881\\n\\t,I0882\\n\\t,I0883\\n\\t,I0884\\n\\t,I0885\\n\\t,I0886\\n\\t,I0887\\n\\t,I0888\\n\\t,I0889\\n\\t,I0890\\n\\t,I0891\\n\\t,I0892\\n\\t,I0893\\n\\t,I0894\\n\\t,I0895\\n\\t,I0896\\n\\t,I0897\\n\\t,I0898\\n\\t,I0899\\n\\t,I0900\\n\\t,I0901\\n\\t,I0902\\n\\t,I0903\\n\\t,I0904\\n\\t,I0905\\n\\t,I0906\\n\\t,I0907\\n\\t,I0908\\n\\t,I0909\\n\\t,I0910\\n\\t,I0911\\n\\t,I0912\\n\\t,I0913\\n\\t,I0914\\n\\t,I0915\\n\\t,I0916\\n\\t,I0917\\n\\t,I0918\\n\\t,IC0000\\n\\t,IC0100\\n\\t,IC0101\\n\\t,IC0102\\n\\t,IC0103\\n\\t,IC0104\\n\\t,IC0105\\n\\t,IC0106\\n\\t,IC0200\\n\\t,IC0201\\n\\t,IC0202\\n\\t,IC0203\\n\\t,IC0204\\n\\t,IC0300\\n\\t,IC0301\\n\\t,IC0302\\n\\t,IC0303\\n\\t,IC0304\\n\\t,IC0400\\n\\t,IC0401\\n\\t,IC0402\\n\\t,IC0403\\n\\t,IC0404\\n\\t,IC0500\\n\\t,IC0501\\n\\t,IC0502\\n\\t,IC0503\\n\\t,IC0504\\n\\t,IC0505\\n\\t,IC0600\\n\\t,IC0601\\n\\t,IC0602\\n\\t,IC0700\\n\\t,IC0701\\n\\t,IC0702\\n\\t,IC0800\\n\\t,IC0801\\n\\t,IC0802\\n\\t,IC0900\\n\\t,IC0901\\n\\t,IC0902\\n\\t,IC0903\\n\\t,IC0904\\n\\t,IC1000\\n\\t,IC1001\\n\\t,IC1002\\n\\t,IC1003\\n\\t,IC1004\\n\\t,IC1005\\n\\t,IC1006\\n\\t,IC1007\\n\\t,IC1008\\n\\t,IC1009\\n\\t,IC1010\\n\\t,IC1011\\n\\t,IC1012\\n\\t,IC1013\\n\\t,IC1014\\n\\t,IC1015\\n\\t,IC1016\\n\\t,IC1017\\n\\t,IC1018\\n\\t,IC1019\\n\\t,IC1020\\n\\t,IC1021\\n\\t,IC1022\\n\\t,IC1023\\n\\t,IC1024\\n\\t,IC1025\\n\\t,IC1026\\n\\t,IC1027\\n\\t,IC1028\\n\\t,IC1029\\n\\t,IC1030\\n\\t,IC1031\\n\\t,IC1032\\n\\t,IC1033\\n\\t,IC1034\\n\\t,IC1035\\n\\t,IC1036\\n\\t,IC1037\\n\\t,IC1038\\n\\t,IC1039\\n\\t,IC1100\\n\\t,IC1101\\n\\t,IC1102\\n\\t,IC1103\\n\\t,IC1104\\n\\t,IC1105\\n\\t,IC1106\\n\\t,IC1107\\n\\t,IC1108\\n\\t,IC1109\\n\\t,IC1110\\n\\t,IC1111\\n\\t,IC1112\\n\\t,IC1113\\n\\t,IC1114\\n\\t,IC1115\\n\\t,IC1116\\n\\t,IC1117\\n\\t,IC1118\\n\\t,IC1119\\n\\t,IC1120\\n\\t,IC1121\\n\\t,IC1122\\n\\t,IC1123\\n\\t,IC1124\\n\\t,IC1125\\n\\t,IC1126\\n\\t,IC1127\\n\\t,IC1128\\n\\t,IC1129\\n\\t,IC1130\\n\\t,IC1131\\n\\t,IC1132\\n\\t,IC1133\\n\\t,IC1134\\n\\t,IC1135\\n\\t,IC1136\\n\\t,IC1137\\n\\t,IC1138\\n\\t,IC1139\\n\\t,IC1140\\n\\t,IC1141\\n\\t,IC1142\\n\\t,IC1143\\n\\t,IC1144\\n\\t,IC1145\\n\\t,IC1146\\n\\t,IC1147\\n\\t,IC1148\\n\\t,IC1149\\n\\t,IC1150\\n\\t,IC1151\\n\\t,IC1152\\n\\t,IC1153\\n\\t,IC1154\\n\\t,IC1155\\n\\t,IC1156\\n\\t,IC1157\\n\\t,IC1158\\n\\t,IC1159\\n\\t,IC1160\\n\\t,IC1161\\n\\t,IC1162\\n\\t,IC1163\\n\\t,IC1164\\n\\t,IC1165\\n\\t,IC1166\\n\\t,IC1167\\n\\t,IC1168\\n\\t,IC1169\\n\\t,IC1170\\n\\t,IC1171\\n\\t,IC1172\\n\\t,IC1173\\n\\t,IC1174\\n\\t,IC1175\\n\\t,IC1176\\n\\t,IC1177\\n\\t,IC1178\\n\\t,IC1179\\n\\t,IC1180\\n\\t,IC1181\\n\\t,IC1182\\n\\t,IC1183\\n\\t,IC1184\\n\\t,IC1185\\n\\t,IC1186\\n\\t,IC1187\\n\\t,IC1188\\n\\t,IC1189\\n\\t,IC1190\\n\\t,IC1191\\n\\t,IC1192\\n\\t,IC1193\\n\\t,IC1194\\n\\t,IC1200\\n\\t,IC1201\\n\\t,IC1202\\n\\t,IC1300\\n\\t,IC1301\\n\\t,IC1302\\n\\t,IC1303\\n\\t,IC1304\\n\\t,IC1305\\n\\t,IC1306\\n\\t,IC1307\\n\\t,IC1308\\n\\t,IC1309\\n\\t,IC1310\\n\\t,IC1311\\n\\t,IC1312\\n\\t,IC1313\\n\\t,IC1314\\n\\t,IC1315\\n\\t,IC1316\\n\\t,IC1317\\n\\t,IC1318\\n\\t,IC1319\\n\\t,IC1320\\n\\t,IC1400\\n\\t,IC1401\\n\\t,IC1402\\n\\t,IC1403\\n\\t,IC1404\\n\\t,IC1500\\n\\t,IC1501\\n\\t,IC1502\\n\\t,IC1503\\n\\t,IC1504\\n\\t,IC1505\\n\\t,IC1506\\n\\t,IC1507\\n\\t,IC1508\\n\\t,IC1600\\n\\t,IC1601\\n\\t,IC1602\\n\\t,IC1603\\n\\t,IC1604\\n\\t,IC1700\\t)\\nselect '${month_id}-01'            \\t\\tOP_TIME\\n      ,t1.STAT_MON                 \\t\\tSTATIS_MONTH\\n      ,t1.PHONE_NO                 \\t\\tPRODUCT_NO\\n      ,0                           \\t\\tI0880\\n      ,0                           \\t\\tI0881\\n      ,0                           \\t\\tI0882\\n      ,0                           \\t\\tI0883\\n      ,0                           \\t\\tI0884\\n      ,0                           \\t\\tI0885\\n      ,0                           \\t\\tI0886\\n     ,nvl(t4.ENTT_CARD_RCHRG_AMT,0)\\t\\tI0887      \\n     ,nvl(t2.TOTAL_RCHRG_FUND   ,0)\\t\\tI0888      \\n     ,nvl(t4.SELF_RCHRG_FUND    ,0)\\t\\tI0889      \\n     ,nvl(t4.SYS_RCHRG_FUND     ,0)\\t\\tI0890      \\n     ,nvl(t4.PAY_CARD_RCHRG_AMT ,0)\\t\\tI0891      \\n     ,nvl(t4.BANK_REPLE_CHARGE  ,0)\\t\\tI0892      \\n     ,nvl(t4.BANK_INSTD_AMT     ,0)\\t\\tI0893      \\n     ,nvl(t4.HALL_PAY_AMT       ,0)\\t\\tI0894      \\n     ,nvl(t4.AIR_RCHRG_AMT      ,0)\\t\\tI0895      \\n     ,nvl(t4.OWG_GATW_RCHRG     ,0)\\t\\tI0896      \\n     ,nvl(t4.NET_RCHRG_PAY_AMT  ,0)\\t\\tI0897      \\n     ,nvl(t4.SSTM_PAY_AMT       ,0)\\t\\tI0898      \\n     ,nvl(t4.CBOSS_PAY          ,0)\\t\\tI0899      \\n     ,nvl(t4.MOBPAY_PAY_AMT     ,0)\\t\\tI0900      \\n     ,nvl(t4.SMALL_AMT_RCHRG    ,0)\\t\\tI0901      \\n     ,nvl(t4.ACTV_PRISE_RCHRG   ,0)\\t\\tI0902      \\n     ,nvl(t2.TOTAL_RCHRG_NUM    ,0)\\t\\tI0903      \\n     ,nvl(t4.SELF_RCHRG_NUM     ,0)\\t\\tI0904      \\n     ,nvl(t4.SYS_RCHRG_NUM      ,0)\\t\\tI0905      \\n     ,nvl(t4.PAY_CARD_RCHRG_NUM ,0)\\t\\tI0906      \\n     ,nvl(t4.AIR_RCHRG_NUM      ,0)\\t\\tI0907      \\n     ,nvl(t4.HALL_PAY_NUM       ,0)\\t\\tI0908      \\n     ,nvl(t4.NET_RCHRG_PAY_NUM  ,0)\\t\\tI0909      \\n     ,nvl(t4.SSTM_PAY_NUM       ,0)\\t\\tI0910      \\n     ,t4.CUR_MON_FIRST_RCHRG_TIME   I0911      \\n     ,t4.CUR_MON_LAST_RCHRG_TIME    I0912      \\n      ,t3.I0913                         I0913\\n      ,t3.I0914                         I0914\\n      ,t6.I0915                         I0915\\n      ,t6.I0916                         I0916\\n      ,t6.I0917                         I0917\\n      ,t6.I0918                         I0918\\n      ,nvl(t7.IC0000,0)\\t\\t\\t\\t\\tIC0000\\n      ,nvl(t7.IC0100,0)\\t\\t\\t\\t\\tIC0100\\n      ,nvl(t7.IC0101,0)\\t\\t\\t\\t\\tIC0101\\n      ,nvl(t7.IC0102,0)\\t\\t\\t\\t\\tIC0102\\n      ,nvl(t7.IC0103,0)\\t\\t\\t\\t\\tIC0103\\n      ,nvl(t7.IC0104,0)\\t\\t\\t\\t\\tIC0104\\n      ,nvl(t7.IC0105,0)\\t\\t\\t\\t\\tIC0105\\n      ,nvl(t7.IC0106,0)\\t\\t\\t\\t\\tIC0106\\n      ,nvl(t7.IC0200,0)\\t\\t\\t\\t\\tIC0200\\n      ,nvl(t7.IC0201,0)\\t\\t\\t\\t\\tIC0201\\n      ,nvl(t7.IC0202,0)\\t\\t\\t\\t\\tIC0202\\n      ,nvl(t7.IC0203,0)\\t\\t\\t\\t\\tIC0203\\n      ,nvl(t7.IC0204,0)\\t\\t\\t\\t\\tIC0204\\n      ,nvl(t7.IC0300,0)\\t\\t\\t\\t\\tIC0300\\n      ,nvl(t7.IC0301,0)\\t\\t\\t\\t\\tIC0301\\n      ,nvl(t7.IC0302,0)\\t\\t\\t\\t\\tIC0302\\n      ,nvl(t7.IC0303,0)\\t\\t\\t\\t\\tIC0303\\n      ,nvl(t7.IC0304,0)\\t\\t\\t\\t\\tIC0304\\n      ,nvl(t7.IC0400,0)\\t\\t\\t\\t\\tIC0400\\n      ,nvl(t7.IC0401,0)\\t\\t\\t\\t\\tIC0401\\n      ,nvl(t7.IC0402,0)\\t\\t\\t\\t\\tIC0402\\n      ,nvl(t7.IC0403,0)\\t\\t\\t\\t\\tIC0403\\n      ,nvl(t7.IC0404,0)\\t\\t\\t\\t\\tIC0404\\n      ,nvl(t7.IC0500,0)\\t\\t\\t\\t\\tIC0500\\n      ,nvl(t7.IC0501,0)\\t\\t\\t\\t\\tIC0501\\n      ,nvl(t7.IC0502,0)\\t\\t\\t\\t\\tIC0502\\n      ,nvl(t7.IC0503,0)\\t\\t\\t\\t\\tIC0503\\n      ,nvl(t7.IC0504,0)\\t\\t\\t\\t\\tIC0504\\n      ,nvl(t7.IC0505,0)\\t\\t\\t\\t\\tIC0505\\n      ,nvl(t7.IC0600,0)\\t\\t\\t\\t\\tIC0600\\n      ,nvl(t7.IC0601,0)\\t\\t\\t\\t\\tIC0601\\n      ,nvl(t7.IC0602,0)\\t\\t\\t\\t\\tIC0602\\n      ,nvl(t7.IC0700,0)\\t\\t\\t\\t\\tIC0700\\n      ,nvl(t7.IC0701,0)\\t\\t\\t\\t\\tIC0701\\n      ,nvl(t7.IC0702,0)\\t\\t\\t\\t\\tIC0702\\n      ,nvl(t7.IC0800,0)\\t\\t\\t\\t\\tIC0800\\n      ,nvl(t7.IC0801,0)\\t\\t\\t\\t\\tIC0801\\n      ,nvl(t7.IC0802,0)\\t\\t\\t\\t\\tIC0802\\n      ,nvl(t7.IC0900,0)\\t\\t\\t\\t\\tIC0900\\n      ,nvl(t7.IC0901,0)\\t\\t\\t\\t\\tIC0901\\n      ,nvl(t7.IC0902,0)\\t\\t\\t\\t\\tIC0902\\n      ,nvl(t7.IC0903,0)\\t\\t\\t\\t\\tIC0903\\n      ,nvl(t7.IC0904,0)\\t\\t\\t\\t\\tIC0904\\n      ,nvl(t7.IC1000,0)\\t\\t\\t\\t\\tIC1000\\n      ,nvl(t7.IC1001,0)\\t\\t\\t\\t\\tIC1001\\n      ,nvl(t7.IC1002,0)\\t\\t\\t\\t\\tIC1002\\n      ,nvl(t7.IC1003,0)\\t\\t\\t\\t\\tIC1003\\n      ,nvl(t7.IC1004,0)\\t\\t\\t\\t\\tIC1004\\n      ,nvl(t7.IC1005,0)\\t\\t\\t\\t\\tIC1005\\n      ,nvl(t7.IC1006,0)\\t\\t\\t\\t\\tIC1006\\n      ,nvl(t7.IC1007,0)\\t\\t\\t\\t\\tIC1007\\n      ,nvl(t7.IC1008,0)\\t\\t\\t\\t\\tIC1008\\n      ,nvl(t7.IC1009,0)\\t\\t\\t\\t\\tIC1009\\n      ,nvl(t7.IC1010,0)\\t\\t\\t\\t\\tIC1010\\n      ,nvl(t7.IC1011,0)\\t\\t\\t\\t\\tIC1011\\n      ,nvl(t7.IC1012,0)\\t\\t\\t\\t\\tIC1012\\n      ,nvl(t7.IC1013,0)\\t\\t\\t\\t\\tIC1013\\n      ,nvl(t7.IC1014,0)\\t\\t\\t\\t\\tIC1014\\n      ,nvl(t7.IC1015,0)\\t\\t\\t\\t\\tIC1015\\n      ,nvl(t7.IC1016,0)\\t\\t\\t\\t\\tIC1016\\n      ,nvl(t7.IC1017,0)\\t\\t\\t\\t\\tIC1017\\n      ,nvl(t7.IC1018,0)\\t\\t\\t\\t\\tIC1018\\n      ,nvl(t7.IC1019,0)\\t\\t\\t\\t\\tIC1019\\n      ,nvl(t7.IC1020,0)\\t\\t\\t\\t\\tIC1020\\n      ,nvl(t7.IC1021,0)\\t\\t\\t\\t\\tIC1021\\n      ,nvl(t7.IC1022,0)\\t\\t\\t\\t\\tIC1022\\n      ,nvl(t7.IC1023,0)\\t\\t\\t\\t\\tIC1023\\n      ,nvl(t7.IC1024,0)\\t\\t\\t\\t\\tIC1024\\n      ,nvl(t7.IC1025,0)\\t\\t\\t\\t\\tIC1025\\n      ,nvl(t7.IC1026,0)\\t\\t\\t\\t\\tIC1026\\n      ,nvl(t7.IC1027,0)\\t\\t\\t\\t\\tIC1027\\n      ,nvl(t7.IC1028,0)\\t\\t\\t\\t\\tIC1028\\n      ,nvl(t7.IC1029,0)\\t\\t\\t\\t\\tIC1029\\n      ,nvl(t7.IC1030,0)\\t\\t\\t\\t\\tIC1030\\n      ,nvl(t7.IC1031,0)\\t\\t\\t\\t\\tIC1031\\n      ,nvl(t7.IC1032,0)\\t\\t\\t\\t\\tIC1032\\n      ,nvl(t7.IC1033,0)\\t\\t\\t\\t\\tIC1033\\n      ,nvl(t7.IC1034,0)\\t\\t\\t\\t\\tIC1034\\n      ,nvl(t7.IC1035,0)\\t\\t\\t\\t\\tIC1035\\n      ,nvl(t7.IC1036,0)\\t\\t\\t\\t\\tIC1036\\n      ,nvl(t7.IC1037,0)\\t\\t\\t\\t\\tIC1037\\n      ,nvl(t7.IC1038,0)\\t\\t\\t\\t\\tIC1038\\n      ,nvl(t7.IC1039,0)\\t\\t\\t\\t\\tIC1039\\n      ,nvl(t7.IC1100,0)\\t\\t\\t\\t\\tIC1100\\n      ,nvl(t7.IC1101,0)\\t\\t\\t\\t\\tIC1101\\n      ,nvl(t7.IC1102,0)\\t\\t\\t\\t\\tIC1102\\n      ,nvl(t7.IC1103,0)\\t\\t\\t\\t\\tIC1103\\n      ,nvl(t7.IC1104,0)\\t\\t\\t\\t\\tIC1104\\n      ,nvl(t7.IC1105,0)\\t\\t\\t\\t\\tIC1105\\n      ,nvl(t7.IC1106,0)\\t\\t\\t\\t\\tIC1106\\n      ,nvl(t7.IC1107,0)\\t\\t\\t\\t\\tIC1107\\n      ,nvl(t7.IC1108,0)\\t\\t\\t\\t\\tIC1108\\n      ,nvl(t7.IC1109,0)\\t\\t\\t\\t\\tIC1109\\n      ,nvl(t7.IC1110,0)\\t\\t\\t\\t\\tIC1110\\n      ,nvl(t7.IC1111,0)\\t\\t\\t\\t\\tIC1111\\n      ,nvl(t7.IC1112,0)\\t\\t\\t\\t\\tIC1112\\n      ,nvl(t7.IC1113,0)\\t\\t\\t\\t\\tIC1113\\n      ,nvl(t7.IC1114,0)\\t\\t\\t\\t\\tIC1114\\n      ,nvl(t7.IC1115,0)\\t\\t\\t\\t\\tIC1115\\n      ,nvl(t7.IC1116,0)\\t\\t\\t\\t\\tIC1116\\n      ,nvl(t7.IC1117,0)\\t\\t\\t\\t\\tIC1117\\n      ,nvl(t7.IC1118,0)\\t\\t\\t\\t\\tIC1118\\n      ,nvl(t7.IC1119,0)\\t\\t\\t\\t\\tIC1119\\n      ,nvl(t7.IC1120,0)\\t\\t\\t\\t\\tIC1120\\n      ,nvl(t7.IC1121,0)\\t\\t\\t\\t\\tIC1121\\n      ,nvl(t7.IC1122,0)\\t\\t\\t\\t\\tIC1122\\n      ,nvl(t7.IC1123,0)\\t\\t\\t\\t\\tIC1123\\n      ,nvl(t7.IC1124,0)\\t\\t\\t\\t\\tIC1124\\n      ,nvl(t7.IC1125,0)\\t\\t\\t\\t\\tIC1125\\n      ,nvl(t7.IC1126,0)\\t\\t\\t\\t\\tIC1126\\n      ,nvl(t7.IC1127,0)\\t\\t\\t\\t\\tIC1127\\n      ,nvl(t7.IC1128,0)\\t\\t\\t\\t\\tIC1128\\n      ,nvl(t7.IC1129,0)\\t\\t\\t\\t\\tIC1129\\n      ,nvl(t7.IC1130,0)\\t\\t\\t\\t\\tIC1130\\n      ,nvl(t7.IC1131,0)\\t\\t\\t\\t\\tIC1131\\n      ,nvl(t7.IC1132,0)\\t\\t\\t\\t\\tIC1132\\n      ,nvl(t7.IC1133,0)\\t\\t\\t\\t\\tIC1133\\n      ,nvl(t7.IC1134,0)\\t\\t\\t\\t\\tIC1134\\n      ,nvl(t7.IC1135,0)\\t\\t\\t\\t\\tIC1135\\n      ,nvl(t7.IC1136,0)\\t\\t\\t\\t\\tIC1136\\n      ,nvl(t7.IC1137,0)\\t\\t\\t\\t\\tIC1137\\n      ,nvl(t7.IC1138,0)\\t\\t\\t\\t\\tIC1138\\n      ,nvl(t7.IC1139,0)\\t\\t\\t\\t\\tIC1139\\n      ,nvl(t7.IC1140,0)\\t\\t\\t\\t\\tIC1140\\n      ,nvl(t7.IC1141,0)\\t\\t\\t\\t\\tIC1141\\n      ,nvl(t7.IC1142,0)\\t\\t\\t\\t\\tIC1142\\n      ,nvl(t7.IC1143,0)\\t\\t\\t\\t\\tIC1143\\n      ,nvl(t7.IC1144,0)\\t\\t\\t\\t\\tIC1144\\n      ,nvl(t7.IC1145,0)\\t\\t\\t\\t\\tIC1145\\n      ,nvl(t7.IC1146,0)\\t\\t\\t\\t\\tIC1146\\n      ,nvl(t7.IC1147,0)\\t\\t\\t\\t\\tIC1147\\n      ,nvl(t7.IC1148,0)\\t\\t\\t\\t\\tIC1148\\n      ,nvl(t7.IC1149,0)\\t\\t\\t\\t\\tIC1149\\n      ,nvl(t7.IC1150,0)\\t\\t\\t\\t\\tIC1150\\n      ,nvl(t7.IC1151,0)\\t\\t\\t\\t\\tIC1151\\n      ,nvl(t7.IC1152,0)\\t\\t\\t\\t\\tIC1152\\n      ,nvl(t7.IC1153,0)\\t\\t\\t\\t\\tIC1153\\n      ,nvl(t7.IC1154,0)\\t\\t\\t\\t\\tIC1154\\n      ,nvl(t7.IC1155,0)\\t\\t\\t\\t\\tIC1155\\n      ,nvl(t7.IC1156,0)\\t\\t\\t\\t\\tIC1156\\n      ,nvl(t7.IC1157,0)\\t\\t\\t\\t\\tIC1157\\n      ,nvl(t7.IC1158,0)\\t\\t\\t\\t\\tIC1158\\n      ,nvl(t7.IC1159,0)\\t\\t\\t\\t\\tIC1159\\n      ,nvl(t7.IC1160,0)\\t\\t\\t\\t\\tIC1160\\n      ,nvl(t7.IC1161,0)\\t\\t\\t\\t\\tIC1161\\n      ,nvl(t7.IC1162,0)\\t\\t\\t\\t\\tIC1162\\n      ,nvl(t7.IC1163,0)\\t\\t\\t\\t\\tIC1163\\n      ,nvl(t7.IC1164,0)\\t\\t\\t\\t\\tIC1164\\n      ,nvl(t7.IC1165,0)\\t\\t\\t\\t\\tIC1165\\n      ,nvl(t7.IC1166,0)\\t\\t\\t\\t\\tIC1166\\n      ,nvl(t7.IC1167,0)\\t\\t\\t\\t\\tIC1167\\n      ,nvl(t7.IC1168,0)\\t\\t\\t\\t\\tIC1168\\n      ,nvl(t7.IC1169,0)\\t\\t\\t\\t\\tIC1169\\n      ,nvl(t7.IC1170,0)\\t\\t\\t\\t\\tIC1170\\n      ,nvl(t7.IC1171,0)\\t\\t\\t\\t\\tIC1171\\n      ,nvl(t7.IC1172,0)\\t\\t\\t\\t\\tIC1172\\n      ,nvl(t7.IC1173,0)\\t\\t\\t\\t\\tIC1173\\n      ,nvl(t7.IC1174,0)\\t\\t\\t\\t\\tIC1174\\n      ,nvl(t7.IC1175,0)\\t\\t\\t\\t\\tIC1175\\n      ,nvl(t7.IC1176,0)\\t\\t\\t\\t\\tIC1176\\n      ,nvl(t7.IC1177,0)\\t\\t\\t\\t\\tIC1177\\n      ,nvl(t7.IC1178,0)\\t\\t\\t\\t\\tIC1178\\n      ,nvl(t7.IC1179,0)\\t\\t\\t\\t\\tIC1179\\n      ,nvl(t7.IC1180,0)\\t\\t\\t\\t\\tIC1180\\n      ,nvl(t7.IC1181,0)\\t\\t\\t\\t\\tIC1181\\n      ,nvl(t7.IC1182,0)\\t\\t\\t\\t\\tIC1182\\n      ,nvl(t7.IC1183,0)\\t\\t\\t\\t\\tIC1183\\n      ,nvl(t7.IC1184,0)\\t\\t\\t\\t\\tIC1184\\n      ,nvl(t7.IC1185,0)\\t\\t\\t\\t\\tIC1185\\n      ,nvl(t7.IC1186,0)\\t\\t\\t\\t\\tIC1186\\n      ,nvl(t7.IC1187,0)\\t\\t\\t\\t\\tIC1187\\n      ,nvl(t7.IC1188,0)\\t\\t\\t\\t\\tIC1188\\n      ,nvl(t7.IC1189,0)\\t\\t\\t\\t\\tIC1189\\n      ,nvl(t7.IC1190,0)\\t\\t\\t\\t\\tIC1190\\n      ,nvl(t7.IC1191,0)\\t\\t\\t\\t\\tIC1191\\n      ,nvl(t7.IC1192,0)\\t\\t\\t\\t\\tIC1192\\n      ,nvl(t7.IC1193,0)\\t\\t\\t\\t\\tIC1193\\n      ,nvl(t7.IC1194,0)\\t\\t\\t\\t\\tIC1194\\n      ,nvl(t7.IC1200,0)\\t\\t\\t\\t\\tIC1200\\n      ,nvl(t7.IC1201,0)\\t\\t\\t\\t\\tIC1201\\n      ,nvl(t7.IC1202,0)\\t\\t\\t\\t\\tIC1202\\n      ,nvl(t7.IC1300,0)\\t\\t\\t\\t\\tIC1300\\n      ,nvl(t7.IC1301,0)\\t\\t\\t\\t\\tIC1301\\n      ,nvl(t7.IC1302,0)\\t\\t\\t\\t\\tIC1302\\n      ,nvl(t7.IC1303,0)\\t\\t\\t\\t\\tIC1303\\n      ,nvl(t7.IC1304,0)\\t\\t\\t\\t\\tIC1304\\n      ,nvl(t7.IC1305,0)\\t\\t\\t\\t\\tIC1305\\n      ,nvl(t7.IC1306,0)\\t\\t\\t\\t\\tIC1306\\n      ,nvl(t7.IC1307,0)\\t\\t\\t\\t\\tIC1307\\n      ,nvl(t7.IC1308,0)\\t\\t\\t\\t\\tIC1308\\n      ,nvl(t7.IC1309,0)\\t\\t\\t\\t\\tIC1309\\n      ,nvl(t7.IC1310,0)\\t\\t\\t\\t\\tIC1310\\n      ,nvl(t7.IC1311,0)\\t\\t\\t\\t\\tIC1311\\n      ,nvl(t7.IC1312,0)\\t\\t\\t\\t\\tIC1312\\n      ,nvl(t7.IC1313,0)\\t\\t\\t\\t\\tIC1313\\n      ,nvl(t7.IC1314,0)\\t\\t\\t\\t\\tIC1314\\n      ,nvl(t7.IC1315,0)\\t\\t\\t\\t\\tIC1315\\n      ,nvl(t7.IC1316,0)\\t\\t\\t\\t\\tIC1316\\n      ,nvl(t7.IC1317,0)\\t\\t\\t\\t\\tIC1317\\n      ,nvl(t7.IC1318,0)\\t\\t\\t\\t\\tIC1318\\n      ,nvl(t7.IC1319,0)\\t\\t\\t\\t\\tIC1319\\n      ,nvl(t7.IC1320,0)\\t\\t\\t\\t\\tIC1320\\n      ,nvl(t7.IC1400,0)\\t\\t\\t\\t\\tIC1400\\n      ,nvl(t7.IC1401,0)\\t\\t\\t\\t\\tIC1401\\n      ,nvl(t7.IC1402,0)\\t\\t\\t\\t\\tIC1402\\n      ,nvl(t7.IC1403,0)\\t\\t\\t\\t\\tIC1403\\n      ,nvl(t7.IC1404,0)\\t\\t\\t\\t\\tIC1404\\n      ,nvl(t7.IC1500,0)\\t\\t\\t\\t\\tIC1500\\n      ,nvl(t7.IC1501,0)\\t\\t\\t\\t\\tIC1501\\n      ,nvl(t7.IC1502,0)\\t\\t\\t\\t\\tIC1502\\n      ,nvl(t7.IC1503,0)\\t\\t\\t\\t\\tIC1503\\n      ,nvl(t7.IC1504,0)\\t\\t\\t\\t\\tIC1504\\n      ,nvl(t7.IC1505,0)\\t\\t\\t\\t\\tIC1505\\n      ,nvl(t7.IC1506,0)\\t\\t\\t\\t\\tIC1506\\n      ,nvl(t7.IC1507,0)\\t\\t\\t\\t\\tIC1507\\n      ,nvl(t7.IC1508,0)\\t\\t\\t\\t\\tIC1508\\n      ,nvl(t7.IC1600,0)\\t\\t\\t\\t\\tIC1600\\n      ,nvl(t7.IC1601,0)\\t\\t\\t\\t\\tIC1601\\n      ,nvl(t7.IC1602,0)\\t\\t\\t\\t\\tIC1602\\n      ,nvl(t7.IC1603,0)\\t\\t\\t\\t\\tIC1603\\n      ,nvl(t7.IC1604,0)\\t\\t\\t\\t\\tIC1604\\n      ,nvl(t7.IC1700,0)\\t\\t\\t\\t\\tIC1700\\n from ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} t1    /*用户资料小表月表*/\\n left join (select phone_no,count(distinct pay_recd_id)TOTAL_RCHRG_NUM,sum(pay_amt)*0.01 as TOTAL_RCHRG_FUND\\n            from gbasedwd.dwd_acc_rchrg_flag_new_ms_${monthid}\\n\\t\\t\\tgroup by phone_no) t2 on t1.PHONE_NO=t2.PHONE_NO\\n left join ${SOURCE_DWI_INCO_USERPAY_INDI_MS_YYYYMM} t4 on t1.user_id=trim(t4.user_id)        /*用户缴费指标月表*/\\n left join ${TARGET_TMP_DM_AUTORPT_ACCT} t6 on t1.PHONE_NO=t6.PRODUCT_NO\\n left join ${SOURCE_DM_PUB_SHOULD_YYYYMM} t7 on t1.PHONE_NO=t7.PRODUCT_NO\\nleft join ${TARGET_TMP_DM_AUTORPT_ACCT_1} t3 on t1.PHONE_NO=t3.PRODUCT_NO\\nwhere (t1.MONTH_ARRIVE_FLAG=1 or t1.MONTH_OFF_FLAG  =1) And t1.PROD_KIND_CODE='171000000001'\\n\\n\\n\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [272]-[index:420]-[账务信息--DM_AUTORPT_ACCT_YYYYMM]-[32]-['str' object has no attribute 'lfind']:{"name":"创建临时表2","nodeId":"32","dsName":"GbaseDM","sql":" create table ${TARGET_TMP_DM_AUTORPT_ACCT_1} \\n (\\tPRODUCT_NO\\t\\tVARCHAR(50),\\n     I0913             DECIMAL(13, 2)\\n    ,I0914             DECIMAL(13, 2)  )\\nDISTRIBUTED BY('product_no');\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [273]-[index:421]-[账务信息--DM_AUTORPT_ACCT_YYYYMM]-[27]-['str' object has no attribute 'lfind']:{"name":"创建临时表","nodeId":"27","dsName":"GbaseDM","sql":"create table ${TARGET_TMP_DM_AUTORPT_ACCT} \\n (\\tPRODUCT_NO\\t\\tVARCHAR(50),\\n\\tI0916 \\t\\t\\tINTEGER,          \\n\\tI0918 \\t\\t\\tINTEGER,     \\n\\tI0917 \\t\\t\\tDECIMAL(12,2),   \\n\\tI0915 \\t\\t\\tDECIMAL(12,2)   )\\nDISTRIBUTED BY('product_no');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [274]-[index:422]-[账务信息--DM_AUTORPT_ACCT_YYYYMM]-[36]-['str' object has no attribute 'lfind']:{"name":"36.插入临时表2","nodeId":"36","dsName":"GbaseDM","sql":"insert into ${TARGET_TMP_DM_AUTORPT_ACCT_1}\\n (\\tPRODUCT_NO,\\n    I0913,\\n    I0914 )\\nselect a.phone_No,\\n       c.acct_book_balance,   -- 主账户余额\\n       b.acct_book_balance-c.acct_book_balance -- 副账户余额\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (select acct_id,\\n                  sum(acct_book_balance)  acct_book_balance -- 账户余额\\n           from gbasedwd.dwd_acc_book_balanc_ds_${curmlastday} a \\n           group by a.acct_id\\n           ) b on a.acct_id=b.acct_id\\nleft join (select a.acct_id,\\n                  sum(a.acct_book_balance) acct_book_balance -- 主账户余额\\n           from gbasedwd.dwd_acc_book_balanc_ds_${curmlastday} a\\n           inner join  (\\n                        select acct_book_type -- 主账本\\n                        from gbasedwd.DWD_ACC_BOOK_CODE_FLAG_DS_${curmlastday}\\n                        where ACCT_BOOK_ATTR = '20' and WRTOF_WAY = '0'\\n                        ) b on a.acct_book_item_Id=b.acct_book_type\\n            group by a.acct_id\\n            ) c on a.acct_Id=c.acct_id \\nwhere (a.ONNET_USER_FLAG=1 or a.MONTH_OFF_FLAG =1) AND a.PROD_KIND_CODE='171000000001';\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [275]-[index:423]-[账务信息--DM_AUTORPT_ACCT_YYYYMM]-[33]-['str' object has no attribute 'lfind']:{"name":"插入数据到临时表","nodeId":"28","dsName":"GbaseDM","sql":"insert into ${TARGET_TMP_DM_AUTORPT_ACCT}\\n (\\tPRODUCT_NO,\\n    I0916,\\n    I0918,\\n    I0917,\\n    I0915\\t)\\nselect \\ta.PHONE_NO,\\t\\t\\t\\t\\t\\n\\t\\tb.FIRST_OWE_MONTH I0916,\\n\\t\\tb.OWE_MONTHS I0918,\\n\\t\\tb.ALL_OWE_FEE I0917,\\n\\t\\tb.MONTH_OWE_FEE  I0915\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM}  a   \\ninner join (select c.PHONE_NO,c.ACCT_ID,FIRST_OWE_MONTH,OWE_MONTHS,ALL_OWE_FEE,MONTH_OWE_FEE    \\n\\t\\t\\tfrom (select a.PHONE_NO,a.ACCT_ID,\\n\\t\\t\\t\\t\\t\\t min(a.CYCLE_DATE) as FIRST_OWE_MONTH,\\n\\t\\t\\t\\t\\t\\t count(a.CYCLE_DATE) as OWE_MONTHS,\\n\\t\\t\\t\\t\\t\\t sum(a.OWE_FEE) as ALL_OWE_FEE \\n\\t\\t\\t\\t  from (select PHONE_NO,ACCT_ID,BILL_CYCLE as CYCLE_DATE,sum(NOT_WRTOF_FEE) as OWE_FEE   \\n                        from ${SOURCE_DWD_ACC_BILLOWE_MS_YYYYMM} group by PHONE_NO,ACCT_ID,BILL_CYCLE) a \\n\\t\\t\\t\\t  group by a.PHONE_NO,a.ACCT_ID) c \\n\\t\\t\\tleft outer join (select aa.PHONE_NO,aa.ACCT_ID,aa.MONTH_OWE_FEE  \\n\\t\\t\\t\\t\\t\\t\\t from (select a.PHONE_NO,a.ACCT_ID,\\n                                         case when  CYCLE_DATE = '${pmonthid} ' then OWE_FEE else 0 end as MONTH_OWE_FEE\\n\\t\\t\\t\\t\\t\\t\\t\\t   from (select PHONE_NO,ACCT_ID,BILL_CYCLE as CYCLE_DATE,sum(NOT_WRTOF_FEE) as OWE_FEE\\n                                         from ${SOURCE_DWD_ACC_BILLOWE_MS_YYYYMM} \\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t group by PHONE_NO,ACCT_ID,CYCLE_DATE) a) aa where aa.MONTH_OWE_FEE != 0) d \\n                    on c.PHONE_NO = d.PHONE_NO and c.ACCT_ID = d.ACCT_ID)   b \\non a.PHONE_NO = b.PHONE_NO and a.ACCT_ID = b.ACCT_ID","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [276]-[index:426]-[账务信息--DM_AUTORPT_ACCT_YYYYMM]-[25]-['str' object has no attribute 'lfind']:{"name":"删除目标表","nodeId":"25","dsName":"GbaseDM","sql":"drop table  ${TARGET_DM_AUTORPT_ACCT_YYYYMM};\\ndrop table ${TARGET_TMP_DM_AUTORPT_ACCT};\\ndrop table ${TARGET_TMP_DM_AUTORPT_ACCT_1};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [277]-[index:428]-[流量出账年包、半年包、季包分摊表]-[61]-['str' object has no attribute 'lfind']:{"name":"插入目标表数据","nodeId":"61","dsName":"GbaseDM","sql":"insert into ${DM_PUB_GPRS_SHARE_DM}(\\n                OP_TIME\\n               ,START_12_DATE\\n               ,END_12_DATE\\n               ,START_6_DATE\\n               ,END_6_DATE\\n               ,START_3_DATE\\n               ,END_3_DATE\\n               ,PRODUCT_NO\\n               ,GPRS_12_SHARE\\n               ,GPRS_6_SHARE\\n               ,GPRS_3_SHARE\\n            ) select '${month_id}'\\n                    ,t1.START_12_DATE\\n                    ,t1.END_12_DATE\\n                    ,t2.START_6_DATE\\n                    ,t2.END_6_DATE\\n                    ,t3.START_3_DATE\\n                    ,t3.END_3_DATE\\n                    ,COALESCE(t1.PRODUCT_NO,t2.PRODUCT_NO,t3.PRODUCT_NO)\\n                    ,nvl(t1.GPRS_12_SHARE,0)\\n                    ,nvl(t2.GPRS_6_SHARE,0)\\n                    ,nvl(t3.GPRS_3_SHARE,0)\\n              from ${DM_PUB_GPRS_SHARE_DM_TMP01} t1\\n              full join ${DM_PUB_GPRS_SHARE_DM_TMP02} t2 on t1.PRODUCT_NO=t2.PRODUCT_NO\\n              full join ${DM_PUB_GPRS_SHARE_DM_TMP03} t3 on t1.PRODUCT_NO=t3.PRODUCT_NO;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [278]-[index:429]-[流量出账年包、半年包、季包分摊表]-[53]-['str' object has no attribute 'lfind']:{"name":"创建临时表3","nodeId":"53","dsName":"GbaseDM","sql":"create table  ${DM_PUB_GPRS_SHARE_DM_TMP03}\\n      (   START_3_DATE       VARCHAR(20)\\n         ,END_3_DATE         VARCHAR(20)\\n         ,PRODUCT_NO         VARCHAR(50)\\n         ,GPRS_3_SHARE       DECIMAL(16, 2)\\n      )distributed by ('PRODUCT_NO');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [279]-[index:430]-[流量出账年包、半年包、季包分摊表]-[25]-['str' object has no attribute 'lfind']:{"name":"创建临时表1","nodeId":"25","dsName":"GbaseDM","sql":"create table  ${DM_PUB_GPRS_SHARE_DM_TMP01}\\n      (   START_12_DATE      VARCHAR(20)\\n         ,END_12_DATE        VARCHAR(20)\\n         ,PRODUCT_NO         VARCHAR(50)\\n         ,GPRS_12_SHARE      DECIMAL(16,2)\\n      )distributed by ('PRODUCT_NO');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [280]-[index:431]-[流量出账年包、半年包、季包分摊表]-[52]-['str' object has no attribute 'lfind']:{"name":"删除临时表3","nodeId":"52","dsName":"GbaseDM","sql":"drop table ${DM_PUB_GPRS_SHARE_DM_TMP03};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [281]-[index:433]-[流量出账年包、半年包、季包分摊表]-[30]-['str' object has no attribute 'lfind']:{"name":"删除临时表2","nodeId":"30","dsName":"GbaseDM","sql":"drop table ${DM_PUB_GPRS_SHARE_DM_TMP02};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [282]-[index:435]-[流量出账年包、半年包、季包分摊表]-[64]-['str' object has no attribute 'lfind']:{"name":"删除临时表","nodeId":"64","dsName":"GbaseDM","sql":"drop table ${DM_PUB_GPRS_SHARE_DM_TMP01};\\ndrop table ${DM_PUB_GPRS_SHARE_DM_TMP02};\\ndrop table ${DM_PUB_GPRS_SHARE_DM_TMP03};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [283]-[index:436]-[流量出账年包、半年包、季包分摊表]-[31]-['str' object has no attribute 'lfind']:{"name":"创建临时表2","nodeId":"31","dsName":"GbaseDM","sql":"create table  ${DM_PUB_GPRS_SHARE_DM_TMP02}\\n      (   START_6_DATE       VARCHAR(20)\\n         ,END_6_DATE         VARCHAR(20)\\n         ,PRODUCT_NO         VARCHAR(50)\\n         ,GPRS_6_SHARE       DECIMAL(16,2)\\n      )distributed by ('PRODUCT_NO');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [284]-[index:437]-[流量出账年包、半年包、季包分摊表]-[24]-['str' object has no attribute 'lfind']:{"name":"删除临时表1","nodeId":"24","dsName":"GbaseDM","sql":"drop table ${DM_PUB_GPRS_SHARE_DM_TMP01};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [285]-[index:438]-[流量出账年包、半年包、季包分摊表]-[67]-['str' object has no attribute 'lfind']:{"name":"删除目标表当月数据","nodeId":"67","dsName":"GbaseDM","sql":"delete from  ${DM_PUB_GPRS_SHARE_DM} where op_time='${month_id}'","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [286]-[index:439]-[流量出账年包、半年包、季包分摊表]-[55]-['str' object has no attribute 'lfind']:{"name":"临时表3插入数据","nodeId":"55","dsName":"GbaseDM","sql":"insert into ${DM_PUB_GPRS_SHARE_DM_TMP03}\\n (\\t START_3_DATE\\n\\t,END_3_DATE\\n\\t,PRODUCT_NO\\n\\t,GPRS_3_SHARE\\t) \\nselect  '${monthid}'\\n\\t\\t,'${month_next_02_month}'\\n\\t\\t,PHONE_NO\\n\\t\\t,sum(cast(round((should_INCOME)/3,2) as decimal(16,2))) GPRS_3_SHARE\\nfrom ${DWI_INCO_BILL_ITEM_TOT_MS_MONTHID}\\nwhere ACCT_ITEM_ID in ('3045','3048','3099')\\ngroup by PHONE_NO;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [287]-[index:441]-[流量出账年包、半年包、季包分摊表]-[33]-['str' object has no attribute 'lfind']:{"name":"临时表2插入数据","nodeId":"33","dsName":"GbaseDM","sql":"insert into ${DM_PUB_GPRS_SHARE_DM_TMP02}\\n (\\t START_6_DATE\\n\\t,END_6_DATE\\n\\t,PRODUCT_NO\\n\\t,GPRS_6_SHARE\\t) \\nselect  '${monthid}'\\n\\t\\t,'${month_next_05_month}'\\n\\t\\t,PHONE_NO\\n\\t\\t,sum(cast(round((should_INCOME)/6,2)as decimal(16,2))) gprs_6_share\\nfrom ${DWI_INCO_BILL_ITEM_TOT_MS_MONTHID}\\nwhere ACCT_ITEM_ID in ('3070','3046','1221','2004','2046','1288')\\ngroup by PHONE_NO;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [288]-[index:443]-[流量出账年包、半年包、季包分摊表]-[27]-['str' object has no attribute 'lfind']:{"name":"临时表1插入数据","nodeId":"27","dsName":"GbaseDM","sql":"insert into ${DM_PUB_GPRS_SHARE_DM_TMP01}\\n (\\t START_12_DATE\\n\\t,END_12_DATE\\n\\t,PRODUCT_NO\\n\\t,GPRS_12_SHARE\\t) \\nselect   '${monthid}'\\n\\t\\t,'${month_next_11_month}'\\n\\t\\t,PHONE_NO\\n\\t\\t,sum(cast(round((should_INCOME)/12,2) as decimal(16,2))) gprs_12_share\\nfrom ${DWI_INCO_BILL_ITEM_TOT_MS_MONTHID}\\nwhere ACCT_ITEM_ID in ('3059','2063','2064','2065','1198','2096','3019','1530','1511','3107')\\ngroup by PHONE_NO;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [289]-[index:445]-[智能区域信息号码]-[6]-['str' object has no attribute 'lfind']:{"name":"6.生成智能区域号码结果表(1)","nodeId":"6","dsName":"GbaseODS","sql":" drop table if exists lop.lop_st_beh_intelligent_area_target_${minutId};\\n create table lop.lop_st_beh_intelligent_area_target_${minutId} ( \\n  \\"task_id\\" varchar(10) default null, \\n  \\"task_name\\" varchar(50) default null,  \\n  \\"phone_no\\" varchar(20) default null  \\n) compress(5, 5)  engine=express distributed by('phone_no') default charset=utf8 tablespace='sys_tablespace';","parentDsName":"GbaseODS"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [290]-[index:446]-[智能区域信息号码]-[7]-['str' object has no attribute 'lfind']:{"name":"7.关联维表导出号码集(3)","nodeId":"7","dsName":"GbaseODS","sql":"insert into lop.lop_st_beh_intelligent_area_target_${minutId}\\n select c.task_id,c.task_name,c.phone_no \\n from (select a.task_id ,a.task_name,b.phone_no \\n from gbaseods.ods_mm_f_zxpt_flow_msg_${minutId} a \\n inner join gbaserpt.dim_intelligent_area_zhixin b \\n on a.PHONE_NO_ENCRYPTED=b.md5phone_no) c \\ngroup by c.task_id,c.task_name,c.phone_no;","parentDsName":"GbaseODS"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [291]-[index:451]-[位置-特定地点下用户出现频次-月]-[6]-['str' object has no attribute 'lfind']:{"name":"建表（1）","nodeId":"6","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_beh_vgop_bass_area_${dayid};\\n\\ncreate table lop.lop_st_beh_vgop_bass_area_${dayid} (\\n  \\"area_id\\" varchar(4) default null,\\n  \\"md5_phone\\" varchar(40) default null,\\n  \\"md5_imsi\\" varchar(40) default null,\\n  \\"lac_id\\" varchar(20) default null,\\n  \\"cell_id\\" varchar(20) default null,\\n  \\"area_name\\" varchar(100) default null,\\n  \\"bts_num\\" int(4) default null,\\n  \\"bts_time\\" decimal(18,2) default null,\\n  \\"bts_day\\" int(4) default null,\\n  \\"is_local\\" int(2) default null\\n) compress(5, 5)  engine=express distributed by('md5_imsi') default charset=utf8 tablespace='sys_tablespace';\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [292]-[index:452]-[位置-特定地点下用户出现频次-月]-[7]-['str' object has no attribute 'lfind']:{"name":"向表中插入数据（3）","nodeId":"7","dsName":"BIGDB","sql":"insert into lop.lop_st_beh_vgop_bass_area_${dayid}  \\nselect b.area_id \\n      ,md5(c.phone_no) as md5_phone\\n      ,md5(a.imsi) as md5_phone \\n\\t  ,b.lac_id \\n\\t  ,b.cell_id_trans\\n\\t  ,b.area_name\\n\\t  ,a.bts_num\\n\\t  ,round(a.bts_time/3600,2)\\n\\t  ,a.bts_day\\n\\t  ,a.is_local\\nfrom (select d.phone_no \\n\\t  ,d.imsi \\n\\t  ,d.bts \\n\\t  ,count(d.bts) as bts_num \\n\\t  ,sum(d.bts_time) as bts_time \\n\\t  ,case when d.bts is null then 0 else 1 end as bts_day \\n\\t  ,d.is_local \\n\\tfrom \\n\\t(\\n\\t\\tselect phone_no \\n\\t\\t\\t  ,imsi \\n\\t\\t\\t  ,bts \\n\\t\\t\\t  ,timestampdiff(Second,in_cell_time,out_cell_time) as bts_time \\n\\t\\t\\t  ,case when phone_no is null then 1 else 2 end as is_local\\n\\t\\tfrom gbasedwd.dwd_evt_cdr_userloc_dtl_ds_${dayid} \\n\\t\\twhere out_cell_time is not null \\n\\t\\t  and in_cell_time is not null\\n\\t) d \\ngroup by d.phone_no,d.bts,d.imsi,d.is_local ) a \\ninner join lop.dim_lop_vgop_area b \\non a.bts= concat(trim(b.lac_id),'_',trim(b.cell_id_trans))\\nleft join lop.dim_intelligent_area c \\non a.imsi =c.imsi;","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [293]-[index:453]-[位置-特定地点下用户出现频次-月]-[11]-['str' object has no attribute 'lfind']:{"name":"建累计日表（5）","nodeId":"11","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_beh_vgop_bass_area_total_${dayid};\\n \\ncreate table lop.lop_st_beh_vgop_bass_area_total_${dayid} (\\n  \\"area_id\\" varchar(2) default null,\\n  \\"md5_phone\\" varchar(40) default null,\\n  \\"md5_imsi\\" varchar(40) default null,\\n  \\"lac_id\\" varchar(20) default null,\\n  \\"cell_id\\" varchar(20) default null,\\n  \\"area_name\\" varchar(100) default null,\\n  \\"bts_num\\" int(4) default null,\\n  \\"bts_time\\" decimal(18,2) default null,\\n  \\"bts_day\\" int(4) default null,\\n  \\"is_local\\" int(2) default null\\n) compress(5, 5)  engine=express distributed by('md5_imsi') default charset=utf8 tablespace='sys_tablespace';\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [294]-[index:454]-[位置-特定地点下用户出现频次-月]-[12]-['str' object has no attribute 'lfind']:{"name":"向累计表中插入第一天数据（7）","nodeId":"12","dsName":"BIGDB","sql":"insert into lop.lop_st_beh_vgop_bass_area_total_${dayid} \\nselect a.area_id\\n      ,a.md5_phone\\n\\t  ,a.md5_imsi\\n\\t  ,a.lac_id\\n\\t  ,a.cell_id\\n\\t  ,a.area_name\\n\\t  ,sum(a.bts_num)\\n\\t  ,sum(a.bts_time)\\n\\t  ,sum(a.bts_day) \\n\\t  ,a.is_local\\n\\tfrom (\\t  \\t\\t\\n\\t\\tselect * from lop.lop_st_beh_vgop_bass_area_${dayid} \\n\\t\\t) a\\n\\tgroup by a.area_id,a.md5_phone,a.md5_imsi,a.lac_id,a.cell_id,a.area_name,a.is_local;","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [295]-[index:457]-[位置-特定地点下用户出现频次-月]-[19]-['str' object has no attribute 'lfind']:{"name":"建累计日表（6）","nodeId":"19","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_beh_vgop_bass_area_total_${dayid};\\n \\ncreate table lop.lop_st_beh_vgop_bass_area_total_${dayid} (\\n  \\"area_id\\" varchar(2) default null,\\n  \\"md5_phone\\" varchar(40) default null,\\n  \\"md5_imsi\\" varchar(40) default null,\\n  \\"lac_id\\" varchar(20) default null,\\n  \\"cell_id\\" varchar(20) default null,\\n  \\"area_name\\" varchar(100) default null,\\n  \\"bts_num\\" int(4) default null,\\n  \\"bts_time\\" decimal(18,2) default null,\\n  \\"bts_day\\" int(4) default null,\\n  \\"is_local\\" int(2) default null\\n) compress(5, 5)  engine=express distributed by('md5_imsi') default charset=utf8 tablespace='sys_tablespace';\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [296]-[index:458]-[位置-特定地点下用户出现频次-月]-[20]-['str' object has no attribute 'lfind']:{"name":"向累计表中插入数据（8）","nodeId":"20","dsName":"BIGDB","sql":"insert into lop.lop_st_beh_vgop_bass_area_total_${dayid} \\nselect a.area_id\\n      ,a.md5_phone\\n\\t  ,a.md5_imsi\\n\\t  ,a.lac_id\\n\\t  ,a.cell_id\\n\\t  ,a.area_name\\n\\t  ,sum(a.bts_num)\\n\\t  ,sum(a.bts_time)\\n\\t  ,sum(a.bts_day) \\n\\t  ,a.is_local\\n\\tfrom (\\t  \\n\\t\\tselect * from lop.lop_st_beh_vgop_bass_area_total_${pdayid} \\n\\t\\tunion all \\n\\t\\tselect * from lop.lop_st_beh_vgop_bass_area_${dayid} \\n\\t\\t) a\\n\\tgroup by a.area_id,a.md5_phone,a.md5_imsi,a.lac_id,a.cell_id,a.area_name,a.is_local;","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [297]-[index:459]-[位置-特定地点下用户出现频次-月]-[25]-['str' object has no attribute 'lfind']:{"name":"删除前三天累计数据（9）","nodeId":"25","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_beh_vgop_bass_area_total_${p2dayid} ","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [298]-[index:460]-[位置-特定地点下用户出现频次-月]-[28]-['str' object has no attribute 'lfind']:{"name":"删除30天前日数据（4）","nodeId":"28","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_beh_vgop_bass_area_${p31day}  ","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [299]-[index:462]-[位置-特定地点下用户出现频次-月]-[36]-['str' object has no attribute 'lfind']:{"name":"建上月累计月表（11）","nodeId":"36","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_beh_vgop_bass_area_total_${pmonthid};\\n \\ncreate table lop.lop_st_beh_vgop_bass_area_total_${pmonthid} (\\n  \\"area_id\\" varchar(4) default null,\\n  \\"md5_phone\\" varchar(40) default null,\\n  \\"md5_imsi\\" varchar(40) default null,\\n  \\"lac_id\\" varchar(20) default null,\\n  \\"cell_id\\" varchar(20) default null,\\n  \\"area_name\\" varchar(100) default null,\\n  \\"bts_num\\" int(4) default null,\\n  \\"bts_time\\" decimal(18,2) default null,\\n  \\"bts_day\\" int(4) default null,\\n  \\"is_local\\" int(2) default null\\n) compress(5, 5)  engine=express distributed by('md5_imsi') default charset=utf8 tablespace='sys_tablespace';\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [300]-[index:463]-[位置-特定地点下用户出现频次-月]-[40]-['str' object has no attribute 'lfind']:{"name":"向上月累计月表中插入上月累计数据（12）","nodeId":"40","dsName":"BIGDB","sql":"insert into lop.lop_st_beh_vgop_bass_area_total_${pmonthid} \\nselect * from lop.lop_st_beh_vgop_bass_area_total_${pdayid}","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [301]-[index:464]-[位置-特定地点下用户出现频次-月]-[43]-['str' object has no attribute 'lfind']:{"name":"删除3月前累计数据（13）","nodeId":"43","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_beh_vgop_bass_area_total_${p4monthid} ","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [302]-[index:468]-[自助累计S11数据]-[14]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"14.SQL语句","nodeId":"14","sql":"drop table dm.dm_pub_gbase_s11_dm_${monthid};\\ncreate table dm.dm_pub_gbase_s11_dm_${monthid}\\n(op_time  date,\\nmsisdn  varchar(30),\\nis_5g_open  int\\n)distributed by ('msisdn');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [303]-[index:469]-[自助累计S11数据]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"8.SQL语句","nodeId":"8","sql":"delete from dm.dm_pub_gbase_s11_dm_${monthid} where op_time='${day_id}';\\ninsert into dm.dm_pub_gbase_s11_dm_${monthid}\\nselect distinct '${day_id}',msisdn,max(dual_connectivity_with_nr)\\nfrom dm.dm_pub_gbase_s11_ds_${dayid} a\\ninner join (select distinct tac_no from gbasedwd.dwd_res_svc_term_brand_obass_ms_${pmonthid}\\n            where g5_flag=1)b on left(a.imei,8)=b.tac_no\\ngroup by msisdn\\n;\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [304]-[index:470]-[自助累计S11数据]-[4]-['str' object has no attribute 'lfind']:{"parentDsName":"hiverpt_HS19","dsName":"hiverpt_HS19","schema_union":"hiverpt","schema_dev":"hiverpt","schema_prod":"hiverpt","queue_union":"","queue_dev":"","queue_prod":"","name":"4.建表","nodeId":"4","sql":"drop table tmp_pub_hive_s11_ds;\\ncreate table tmp_pub_hive_s11_ds\\n(imei string,\\nmsisdn string,\\ndual_connectivity_with_nr  int\\n)row format delimited fields terminated by ',' stored as textfile;\\ninsert into tmp_pub_hive_s11_ds\\nselect imei,msisdn,max(dual_connectivity_with_nr) from hiveods.ods_o_rt_s11_sj_yyyymmdd_enc\\nwhere dual_connectivity_with_nr in (1,0) and day_id='${dayid}'\\ngroup by imei,msisdn\\n;\\n\\ndrop table dm_pub_hive_s11_ds;\\ncreate table dm_pub_hive_s11_ds\\n(imei string,\\nmsisdn string,\\ndual_connectivity_with_nr  int\\n)row format delimited fields terminated by ',' stored as textfile;\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [305]-[index:471]-[自助累计S11数据]-[10]-['str' object has no attribute 'lfind']:{"sql":"insert overwrite table dm_pub_hive_s11_ds select default.hiveaesdecrypt(imei,'IMEI') ,default.hiveaesdecrypt(msisdn,'PHONENO') ,dual_connectivity_with_nr from tmp_pub_hive_s11_ds","from":"from tmp_pub_hive_s11_ds","name":"10.数据加密","column":[{"idx":1,"enColumnName":"imei","enTableLabel":"imei","enType":"decrypt","enObj":"IMEI"},{"idx":2,"enColumnName":"msisdn","enTableLabel":"msisdn","enType":"decrypt","enObj":"PHONENO"},{"idx":3,"enColumnName":"dual_connectivity_with_nr","enTableLabel":"dual_connectivity_with_nr","enType":"noEncrypt","enObj":null}],"dsName":"hiverpt_HS19","nodeId":"10","message":"insert overwrite table dm_pub_hive_s11_ds","tabName":"undefined"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [306]-[index:472]-[渠道酬金020503日调度传输]-[5]-['str' object has no attribute 'lfind']:{"name":"创建表数据","nodeId":"5","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CHANNEL_020503_${dayid};\\nCREATE TABLE DM_PUB_CHANNEL_020503_${dayid} distributed by('channel_code')  as select * from DM_PUB_CHANNEL_020503_YYYYMMDD\\t;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [307]-[index:474]-[渠道酬金020503日调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"7","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CHANNEL_020503_${dayid} \\n(select * from   \\n ODS_D_F_OTR_020503_SOCIAL_CHA_SALE_${dayid}@dblink_ods);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [308]-[index:476]-[宽带信息月视图]-[82]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"82.临时表04","nodeId":"82","sql":"drop table if exists tmp_dm_pub_broadband_msg_04_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_04_${monthid}\\n (\\n  LAN_NO varchar(120) ,\\n  net_bill_dur decimal(42,0) ,  -- 当月上网时长（分钟）\\n  channel_name_all varchar(100) -- 宽带报装渠道\\n) distributed by ('LAN_NO');\\ninsert into tmp_dm_pub_broadband_msg_04_${monthid}\\nselect a.LAN_NO,\\n       b.net_bill_dur,\\n       c.channel_name_all\\nfrom gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} a \\nleft join (\\n          select phone_no,\\n                 sum(net_bill_dur) net_bill_dur -- 上网时长\\n          from gbasedwi.dwi_beh_use_lanuser_gprs_dm_${monthid}\\n          group by phone_no\\n         ) b on a.LAN_NO=b.phone_no\\nleft join (\\n           select lan_bill_no,\\n                  channel_name_all-- 宽带报装渠道\\n           from gbasedwi.dwi_usr_pesn_lan_ds_${curmlastday}\\n           ) c on a.lan_NO=c.lan_bill_no\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [309]-[index:479]-[宽带信息月视图]-[15]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"15.插入目标表数据","nodeId":"15","sql":"insert into dm.DM_PUB_BROADBAND_MSG_${monthid}\\n(\\n                OP_TIME\\n               ,LOGIN_ID\\n               ,CUST_TYPE\\n               ,DEPT_COUNTY_NAME\\n               ,COMMUNITY_NAME\\n               ,USEROPEN_TIME\\n               ,USERACTIVE_TIME\\n               ,USEROFF_TIME\\n               ,USER_STATUS\\n               ,SUBS_ID\\n               ,CUST_ADDRESS\\n               ,RENEW_TIME\\n               ,APPLY_DATE\\n               ,END_DATE\\n               ,OFFER_ID\\n               ,ORDER_NAME\\n               ,PAY_AMOUNT\\n               ,YEAR_FEE\\n               ,MONTH_FEE\\n\\t\\t\\t   ,SHARE_FEE\\n               ,RENEW_ORDER_ID\\n               ,RENEW_ORDER_NAME\\n               ,RENEW_FEE\\n               ,MONTH_TOTAL_FLOW\\n               ,DAY_NEW_MARK\\n               ,DAY_OFF_MARK\\n               ,COMMUNITY_ID\\n               ,MONTH_ACTIVE_DAYS\\n\\t\\t\\t   ,user_id\\n\\t\\t\\t   ,net_bill_dur   -- 当月上网时长（分钟）  20190929日新增\\n               ,channel_name_all  -- 宽带报装渠道\\n\\t\\t\\t   ,REGION_CNTR  -- 社区归属经营网格\\n\\t\\t       ,GRID_NAME    -- 社区归属经分网格\\n\\t\\t       ,micro_name   -- 社区归属微格\\n\\t\\t\\t   ,lan_rh_phone_no,\\n\\t\\t\\t   lan_rh_phone_no_type,cert_type,IS_TRUTH_NAME,IS_TRUTH_STATE,kskdgs_name,kskdld_name,\\n               TOTAL_RCHRG_FUND,DEPT_COUNTY_ID_NEW,REGION_CNTR_NEW,GRID_NAME_NEW,\\n               expire_channel_type_03,         -- 用户报装渠道三级分类     \\n               expire_channel_type_04,         -- 用户报装渠道四级分类     \\n               expire_channel_name_all,        -- 报装渠道名称         \\n               expire_channel_name_full,       -- 报装渠道名称全称       \\n               channel_divide,                 -- 报装渠道划分         \\n               channel_divide_new,             -- 渠道划分（新)        \\n               bz_channel_com_id,              -- 宽带报装渠道归属分公司  \\n               arpu_3avg,                      -- 前三个月实际出账的平均值 \\n               SHOULD_INCOME,                  -- 当月ARPU       \\n               innet_date,                     -- 入网日期         \\n               plan_name,                      -- 全家享折扣产品名称\\n               plan_cost_lvl,                  -- 全家享手机套餐档位，202403月新增指标需求 \\n               FEATURE_VALUE,                  -- 套餐承诺档位       \\n               is_1000M_plan,                  -- 是否千兆套餐  \\n               BDWIDTH ,                       -- 业务宽带\\n              mt_should_fee,\\n              should_fee_01,\\n              should_fee_02,\\n              should_fee_03,\\n              should_fee_04,\\n              should_fee_05,                  -- 宽带应收使用费（不含提速包）（当月），根据202403月需求增加指标\\n              should_fee_06,                  -- 宽带应收使用费（不含提速包）（年累计），根据202403月需求增加指标\\n              fact_amt_01,\\n              fact_amt_02,\\n              fact_amt_03,\\n              fact_amt_04,\\n              fact_amt_05,                    -- 宽带实收使用费（不含提速包）（当月）,根据202403月需求增加指标\\n              fact_amt_06,                    -- 宽带实收使用费（不含提速包）（年累计）,根据202403月需求增加指标 \\n              yy_should_fee,\\n              is_myd_user, -- 是否满意度重点关注客户-固定上网\\n              ROOM_NO,\\n              is_ysf_user,  -- 是否宽带易受访客户\\n              IS_BROADBAND_SHARE -- 是否宽带分摊出账客户（根据202403月需求增加指标），1 是 0 否\\n )\\n select    distinct '${curm_last_day}'                 OP_TIME\\n                    ,t1.LAN_NO                                  LOGIN_ID\\n                    ,t1.LAN_CUST_TYPE                           CUST_TYPE\\n                    ,t1.DEPT_COUNTY_ID                          DEPT_COUNTY_NAME\\n                    ,t1.LAN_LAC_NAME                            COMMUNITY_NAME\\n                    ,cast(t1.CREATE_TIME as date)               USEROPEN_TIME  \\n                    ,t1.ACTIVE_TIME                             USERACTIVE_TIME\\n                    ,cast(t1.LAN_EXP_TIME as date)              USEROFF_TIME\\n                    ,t1.USER_STATE                              USER_STATUS\\n                    ,t1.LINK_NO                                 SUBS_ID\\n                    ,t1.INSTL_ADDR                              CUST_ADDRESS\\n                    ,cast(t1.LTLY_FIRST_RENEW_TIME as date)     RENEW_TIME\\n                    ,t1.EFF_DATE                                APPLY_DATE\\n                    ,t1.EXP_DATE                                END_DATE\\n                    ,t1.MAIN_PLAN_ID                            OFFER_ID\\n                    ,t1.MAIN_PLAN_NAME                          ORDER_NAME\\n                    ,t1.PAY_AMT                                 PAY_AMOUNT\\n                    ,0                                          YEAR_FEE\\n                    ,0                                          MONTH_FEE\\n\\t\\t\\t\\t\\t,t1.SHARE_FEE                              SHARE_FEE\\n                    ,t1.RENEW_PLAN_ID                          RENEW_ORDER_ID\\n                    ,t1.RENEW_PLAN_NAME                        RENEW_ORDER_NAME\\n                    ,t1.LTLY_FIRST_RENEW_AMT                   RENEW_FEE\\n                    ,nvl(T3.MONTH_TOTAL_FLOW,0)                MONTH_TOTAL_FLOW\\n                    ,T5.MONTH_NEW_USER_FLAG                  -- MONTH_NEW_USER_FLAG -- T2.DAY_NEW_USER_FLAG 20180917日调整\\n                    ,T2.DAY_LOST_USER_FLAG\\n                    ,t1.LAN_LAC_NO                              COMMUNITY_ID\\n\\t\\t            ,T3.MONTH_ACTIVE_DAYS\\n\\t\\t\\t\\t\\t,t4.user_id\\n\\t\\t\\t\\t\\t,t6.net_bill_dur   -- 当月上网时长（分钟）  20190929日新增\\n                    ,t6.channel_name_all  -- 宽带报装渠道\\n\\t\\t\\t\\t\\t,g.REGION_CNTR  -- 社区归属经营网格\\n\\t\\t            ,g.GRID_NAME    -- 社区归属经分网格\\n\\t\\t            ,g1.micro_name   -- 社区归属微格\\n\\t\\t\\t\\t\\t,f.phone_no      -- 宽带融合号码\\n\\t\\t\\t\\t\\t,nvl(f.phone_no_type,5)   ##宽带融合号码属性\\n                    ,i.type,nvl(IS_TRUTH_NAME,0),nvl(IS_TRUTH_STATE,0),\\n                    t7.kskdgs_name, -- 跨省宽带归属省\\n                    t7.kskdld_name, -- 跨省宽带落地省\\n                    nvl(k.TOTAL_RCHRG_FUND,0) TOTAL_RCHRG_FUND, -- 当月充值金额（同个人月视图‘总充值额度’）  \\n                    t8.DEPT_COUNTY_ID_NEW, -- 2022年底新牌照分公司\\n                    t8.REGION_CNTR_NEW,  -- 2022年底新牌照经营网咯\\n                    t8.GRID_NAME_NEW ,  -- 2022年底新牌照经分网格\\n                    t9.expire_channel_type_03,         -- 用户报装渠道三级分类     \\n                    t9.expire_channel_type_04,         -- 用户报装渠道四级分类     \\n                    t9.expire_channel_name_all,        -- 报装渠道名称         \\n                    t9.expire_channel_name_full,       -- 报装渠道名称全称       \\n                    t9.channel_divide,                 -- 报装渠道划分         \\n                    t9.channel_divide_new,             -- 渠道划分（新)        \\n                    t9.bz_channel_com_id,              -- 宽带报装渠道归属分公司  \\n                    t12.arpu_3avg,                      -- 前三个月实际出账的平均值 \\n                    t12.SHOULD_INCOME,                  -- 当月ARPU       \\n                    t12.innet_date,                     -- 入网日期         \\n                    t12.plan_name,                      -- 全家享折扣产品名称\\n                    t12.plan_cost_lvl,                  -- 全家享手机套餐档位，202403月新增指标需求\\n                    t12.FEATURE_VALUE,                  -- 套餐承诺档位       \\n                    t12.is_1000M_plan ,                 -- 是否千兆套餐\\n                    case when t2.BDWIDTH is not null then t2.BDWIDTH else '空' end BDWIDTH,                         -- 业务宽带\\n                    t10.mt_should_fee,  -- 装移机费（同指标魔方）\\n                    t10.should_fee_01,  -- 宽带应收使用费（当月）\\n                    t10.should_fee_02,  -- 宽带应收使用费（年累计）\\n                    t10.should_fee_03,  -- 提速包应收收入（当月）\\n                    t10.should_fee_04,  -- 提速包应收收入（年累计）\\n                    t10.should_fee_05,  -- 宽带应收使用费（不含提速包）（当月），根据202403月需求增加指标\\n                    t10.should_fee_06,  -- 宽带应收使用费（不含提速包）（年累计），根据202403月需求增加指标\\n                    t10.fact_amt_01,  -- 宽带实收使用费（当月）\\n                    t10.fact_amt_02,  -- 宽带实收使用费（年累计）\\n                    t10.fact_amt_03,  -- 提速包实收收入（当月）\\n                    t10.fact_amt_04,  -- 提速包实收收入（年累计）\\n                    t10.fact_amt_05,  -- 宽带实收使用费（不含提速包）（当月）,根据202403月需求增加指标\\n                    t10.fact_amt_06,  -- 宽带实收使用费（不含提速包）（年累计）,根据202403月需求增加指标 \\n                    t10.yy_should_fee,  -- 年累计装移机费（同指标魔方）\\n                    case when t11.phone_no is not null then 1 else 0 end is_myd_user, -- 是否满意度重点关注客户-固定上网\\n                    substr(t2.ROOM_NO,1,instr(t2.ROOM_NO,'-',1)-1) ROOM_NO, -- 房号ID\\n                    t10.is_ysf_user,  -- 是否宽带易受访客户\\n                    case when t13.LOGIN_ID is not null then 1 else 0 end IS_BROADBAND_SHARE -- 是否宽带分摊出账客户（根据202403月需求增加指标），1 是 0 否\\n             from gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} t1\\n             left join gbasedwi.DWI_USR_PESN_LAN_MS_${monthid} t2 on t1.LAN_NO=t2.LAN_BILL_NO\\n\\t\\t\\t left join tmp_dm_pub_broadband_msg_01_${monthid}  T5 on t1.LAN_NO=t5.LAN_BILL_NO\\n\\t         left join tmp_dm_pub_broadband_msg_02_${monthid} t3 on t1.LAN_NO=t3.PHONE_NO\\n\\t\\t\\t left join tmp_dm_pub_broadband_msg_03_${monthid} t4 on t1.LAN_NO=t4.LAN_BILL_NO\\n\\t\\t\\t left join tmp_dm_pub_broadband_msg_04_${monthid} t6 on t1.LAN_NO=t6.LAN_NO\\n\\t\\t\\t left join gbasedwd.dim_broadband_community_relate_all g on t1.LAN_LAC_NO=g.BI_COMMUNITY_ID\\n             left join dm.dim_micro_broadband g1 on t1.LAN_LAC_NO=g1.COMMUNITY_ID\\n\\t\\t\\t left join tmp_dm_pub_broadband_msg_05_${monthid} f on t1.LAN_NO=f.LAN_BILL_NO\\n\\t\\t\\t left join (select a.phone_no,b.type from gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\n                        left join gbasedwd.dim_cert_type b on a.cert_catagory=b.cert_type\\n                       )i on t1.LAN_NO=i.phone_no\\n\\t\\t\\t left join gbasedwi.dwi_usr_pesn_realname_base_ds_${curmlastday} j on t2.cust_id=j.cust_id\\n             left join (select phone_no,sum(pay_amt)*0.01 as TOTAL_RCHRG_FUND\\n                        from gbasedwd.dwd_acc_rchrg_flag_new_ms_${monthid}\\n                        group by phone_no) k on t1.LAN_NO=k.phone_no\\n             left join tmp_dm_pub_broadband_msg_06_${monthid} t7 on t1.LAN_NO=t7.LAN_BILL_NO\\n             left join (select distinct LAN_BILL_NO,DEPT_COUNTY_ID_NEW,nvl(b.REGIONAL_CENTER_NAME,a.REGION_CNTR_NEW) REGION_CNTR_NEW,nvl(b.GRID_NAME,a.GRID_NAME_NEW) GRID_NAME_NEW\\n                        from (select distinct LAN_BILL_NO,REGION_CNTR_NEW,GRID_NAME_NEW,GRID_ID_NEW,DEPT_COUNTY_ID_NEW from dim_dwi_usr_pesn_lan_dt_2022_y@dblink_dm) a\\n                        left join (select distinct REGIONAL_CENTER_ID,REGIONAL_CENTER_name,GRID_ID,GRID_name from gbasedwd.dim_pub_cell\\n                                  ) b on a.GRID_ID_NEW=b.GRID_ID\\n                       ) t8 on t1.LAN_NO=t8.LAN_BILL_NO\\n             left join dm.tmp_dm_pub_broadband_msg_07_${monthid} t9 on t1.LAN_NO=t9.LAN_NO\\n             left join dm.tmp_dm_pub_broadband_msg_08_${monthid} t10 on t1.LAN_NO=t10.LAN_NO\\n             left join (select distinct phone_no from dm.dim_rpt_nq20230505_gxb_kd_result) t11 on f.phone_no=t11.phone_no\\n             left join dm.tmp_dm_pub_broadband_msg_09_${monthid} t12 on t1.LAN_NO=t12.LAN_NO \\n-- 以下，根据202403月需求增加“是否宽带分摊出账客户”指标\\n             left join (select LOGIN_ID from GBASEDWD.DWD_ACCT_BROADBAND_SHARE_${monthid} a \\n                                         left outer join GBASEDWD.DIM_OFFER_BROADBAND_SHARE_LIST b \\n                                           on a.offer_id = b.offer_id \\n                                        where b.offer_id is not null\\n                       ) t13 on t1.LAN_NO = t13.LOGIN_ID    \\n-- 以上，根据202403月需求增加“是否宽带分摊出账客户”指标\\n-- create table dm.dim_rpt_nq20230505_gxb_kd_result distributed by ('phone_no') as \\n-- select * from gbaserpt.rpt_nq20230505_gxb_kd_result_202305\\n;\\n\\n\\t\\t\\t \\n\\t\\t\\t \\n\\t\\t\\t "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [310]-[index:482]-[宽带信息月视图]-[128]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists tmp_dm_pub_broadband_msg_0901_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_0901_${monthid} distributed by ('PHONE_NO')\\nselect phone_no,arpu_avg from \\n       (select phone_no,arpu_avg,row_number()over(partition by phone_no order by plan_fee) rn\\n          from gbaserpt.rpt_nq201912676_result_ms_${monthid}\\n          where plan_id in (111603002553,111603002554,111603002556,111603002557,111603002558)\\n       ) w where rn = 1;\\ndrop table if exists tmp_dm_pub_broadband_msg_0902_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_0902_${monthid} distributed by ('PHONE_NO') \\nselect phone_no,arpu_avg from \\n       (select phone_no,arpu_avg,row_number()over(partition by phone_no order by plan_fee) rn\\n          from gbaserpt.rpt_nq201912676_result_ms_${monthid}\\n          where plan_id in (111603007141,111603002924,111603002925,111603002926,111603003847,111603003848,111603004041,111603004042)\\n       ) w where rn = 1;\\ndrop table if exists tmp_dm_pub_broadband_msg_0903_${monthid};       \\nCREATE TABLE tmp_dm_pub_broadband_msg_0903_${monthid} distributed by ('LOGIN_ID') \\nselect LOGIN_ID,phone_no,plan_id,plan_name from \\n       (select distinct a.LOGIN_ID,a.phone_no,b.plan_id,c.plan_name,row_number()over(partition by a.LOGIN_ID,a.phone_no order by EXP_TIME desc) rn\\n           from (select a.LAN_NO LOGIN_ID,b.phone_no\\n                 from gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} a\\n                 left join dm.tmp_dm_pub_broadband_msg_05_${monthid} b on a.LAN_NO=b.lan_bill_no\\n                 left join dm.dim_bandbrand_plan_id c on a.MAIN_PLAN_ID=c.plan_id\\n                 where phone_no_type in (1,2,3) and plan_name_type='全家享套餐ID'\\n                ) a\\n           left join gbasedwi.dwi_inst_asset_ms_${monthid} b on a.phone_no=b.phone_no\\n           left join dm.dim_bandbrand_plan_id c on b.plan_id=c.plan_id\\n           where b.CUR_CYCLE_STATE in (1,104) and c.plan_name_type='全家享折扣产品策划ID'\\n       ) w where rn = 1;\\n-- 全家享手机套餐档位，202403月新增指标需求\\ndrop table if exists tmp_dm_pub_broadband_msg_0904_${monthid};       \\nCREATE TABLE tmp_dm_pub_broadband_msg_0904_${monthid} distributed by ('LOGIN_ID') \\nselect LOGIN_ID,phone_no,plan_id,plan_cost_lvl from \\n       (select distinct a.LOGIN_ID,a.phone_no,b.plan_id,c.plan_cost_lvl,row_number()over(partition by a.LOGIN_ID,a.phone_no order by EXP_TIME desc) rn\\n           from (select a.LAN_NO LOGIN_ID,b.phone_no\\n                 from gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} a\\n                 left join dm.tmp_dm_pub_broadband_msg_05_${monthid} b on a.LAN_NO=b.lan_bill_no\\n                 left join dm.dim_bandbrand_plan_id c on a.MAIN_PLAN_ID=c.plan_id\\n                 where phone_no_type in (1,2,3) and plan_name_type='全家享套餐ID'\\n                ) a\\n           left join gbasedwi.dwi_inst_asset_ms_${monthid} b on a.phone_no=b.phone_no\\n           left join dm.dim_bandbrand_plan_id c on b.plan_id=c.plan_id\\n           where b.CUR_CYCLE_STATE in (1,104) and plan_name_type='全家享手机主套餐策划ID'\\n       ) w where rn = 1;\\n       \\ndrop table if exists tmp_dm_pub_broadband_msg_09_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_09_${monthid} distributed by ('LAN_NO')\\nselect distinct \\n       a.LAN_NO,\\n       nvl(e.arpu_avg,f.arpu_avg) arpu_3avg,  -- 前三个月实际出账的平均值\\n       nvl(g.SHOULD_INCOME,0) SHOULD_INCOME,  -- 当月ARPU\\n       h.innet_date,                            -- 入网日期\\n       i.plan_name,           -- 全家享折扣产品名称\\n       l.plan_cost_lvl,       -- 全家享手机套餐档位，202403月新增指标需求\\n       nvl(j.FEATURE_VALUE,0) FEATURE_VALUE,    -- 套餐承诺档位\\n       case when k.plan_id is not null or a.MAIN_PLAN_NAME like '%1000M%' then 1 else 0 end is_1000M_plan -- 是否千兆套餐\\nfrom gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} a\\nleft join dm.tmp_dm_pub_broadband_msg_05_${monthid} b on a.LAN_NO=b.lan_bill_no\\nleft join dm.tmp_dm_pub_broadband_msg_0901_${monthid} e on b.phone_no=e.phone_no\\nleft join dm.tmp_dm_pub_broadband_msg_0902_${monthid} f on b.phone_no=f.phone_no  \\nleft join (select phone_no,sum(SHOULD_INCOME) SHOULD_INCOME  -- 当月ARPU\\n\\t\\t       from gbasedwi.DWI_INCO_BILL_USER_MS_${monthid} \\n\\t\\t       group by phone_no) g on b.phone_no=g.phone_no\\nleft join gbasedwi.DWI_USR_PESN_PARTINFO_MS_${monthid}  h on b.phone_no=h.phone_no\\nleft join dm.tmp_dm_pub_broadband_msg_0903_${monthid} i on a.LAN_NO=i.LOGIN_ID and b.phone_no=i.phone_no \\nleft join (select PROD_UNIT_ID,max(ATTR_VAL) FEATURE_VALUE\\n           from (select distinct PROD_UNIT_ID,ATTR_VAL from gbasedwd.DWD_SVC_OFF_PRODUNIT_ATTR_ms_${monthid} \\n                 where ATTR_ID in (10000106,3000110284) and DELID=1 -- 生效\\n                 ) a group by 1\\n           ) j on a.MAIN_PLAN_ID=j.PROD_UNIT_ID\\nleft join (select * from dm.dim_bandbrand_plan_id where plan_name_type='千兆套餐ID') k on a.MAIN_PLAN_ID=k.plan_id \\nleft join dm.tmp_dm_pub_broadband_msg_0904_${monthid} l on a.LAN_NO=l.LOGIN_ID and b.phone_no=l.phone_no   -- 全家享手机套餐档位，202403月新增指标需求"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [311]-[index:483]-[宽带信息月视图]-[94]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists tmp_dm_pub_broadband_msg_06_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_06_${monthid}\\n (\\n  LAN_BILL_NO varchar(20),\\n  kskdgs_name varchar(300) , -- 跨省宽带归属省\\n  kskdld_name varchar(300)   -- 跨省宽带落地省\\n) distributed by ('LAN_BILL_NO');\\ninsert into tmp_dm_pub_broadband_msg_06_${monthid}\\nselect a.LAN_BILL_NO,\\n       case when b.CODE_name is not null then b.CODE_name else d.kskdgs_name end kskdgs_name, -- 跨省宽带归属省\\n       case when c.CODE_name is not null then c.CODE_name else d.kskdld_name end kskdld_name  -- 跨省宽带落地省\\nfrom gbasedwi.DWI_USR_PESN_LAN_MS_${monthid} a\\nleft join \\n(select a.user_id,b.ATTR_VALUE,c.CODE_name  -- 跨省宽带归属省\\n from gbasedwd.DWD_SVC_INST_PRE_01533_OFFER_DS_${curmlastday} a   -- ins_offer表\\n left join gbasedwd.DWD_SVC_INST_PRE_01539_ATTR_DS_${curmlastday} b on a.USER_ID=b.USER_ID and a.done_code=b.done_code  -- ins_srv_attr表\\n left join (select * from gbaseods.ods_d_f_crm_02540_static_${curmlastday} where CODE_TYPE='CM_PROVINCE') c on b.ATTR_VALUE=c.CODE_VALUE -- BASE.BS_STATIC_DATA@DBLINK_YYDB\\n where a.offer_id in (111601004221,111601004284,111601004285,111601004286,111601004287) \\n   and a.EXPIRE_DATE>'${curm_last_day}'\\n   and b.SERVICE_ID=141600009917 and b.ATTR_ID=151600003142\\n) b on a.user_id=b.user_id\\nleft join\\n(select a.user_id,b.ATTR_VALUE,c.CODE_name -- 跨省宽带落地省\\n from gbasedwd.DWD_SVC_INST_PRE_01533_OFFER_DS_${curmlastday} a   -- ins_offer表\\n left join gbasedwd.DWD_SVC_INST_PRE_01539_ATTR_DS_${curmlastday} b on a.USER_ID=b.USER_ID and a.done_code=b.done_code -- ins_srv_attr表\\n left join (select * from gbaseods.ods_d_f_crm_02540_static_${curmlastday} where CODE_TYPE='CM_PROVINCE') c on b.ATTR_VALUE=c.CODE_VALUE -- BASE.BS_STATIC_DATA@DBLINK_YYDB\\n where a.offer_id in (111601004222,111601004261,111601004262,111601004263,111601004264)\\n   and a.EXPIRE_DATE>'${curm_last_day}'\\n   and b.SERVICE_ID=141600009918 and b.ATTR_ID=151600003147\\n) c on a.user_id=c.user_id\\nleft join \\n(select distinct \\n       a.user_id,\\n       max(case when a.plan_id in (111601004221,111601004284,111601004285,111601004286,111601004287) and b.SERVICE_ID=141600009917 and b.ATTR_ID=151600003142 then b.ATTR_VALUE end) kskdgs_VALUE,\\n       max(case when a.plan_id in (111601004221,111601004284,111601004285,111601004286,111601004287) and b.SERVICE_ID=141600009917 and b.ATTR_ID=151600003142 then c.CODE_name end) kskdgs_name,\\n       max(case when a.plan_id in (111601004222,111601004261,111601004262,111601004263,111601004264) and b.SERVICE_ID=141600009918 and b.ATTR_ID=151600003147 then b.ATTR_VALUE end) kskdld_VALUE,\\n       max(case when a.plan_id in (111601004222,111601004261,111601004262,111601004263,111601004264) and b.SERVICE_ID=141600009918 and b.ATTR_ID=151600003147 then c.CODE_name end) kskdld_name\\nfrom \\n(select * from gbasedwd.DWD_SVC_INST_EXP_PLAN_DS_${curmlastday}\\nwhere plan_id in (111601004221,111601004284,111601004285,111601004286,111601004287)\\nunion all\\nselect * from gbasedwd.DWD_SVC_INST_EXP_PLAN_DS_${curmlastday}\\nwhere plan_id in (111601004222,111601004261,111601004262,111601004263,111601004264)\\n) a\\nleft join gbasedwd.DWD_SVC_INST_exp_plan_attr_ds_${curmlastday} b on a.user_id=b.user_id\\nleft join (select * from gbaseods.ods_d_f_crm_02540_static_${curmlastday} where CODE_TYPE='CM_PROVINCE') c on b.ATTR_VALUE=c.CODE_VALUE\\ngroup by a.user_id\\n) d on a.user_id=d.user_id"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [312]-[index:485]-[宽带信息月视图]-[76]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"76.临时表03","nodeId":"76","sql":"drop table tmp_dm_pub_broadband_msg_03_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_03_${monthid}\\n (\\n  lan_bill_no varchar(50) ,\\n  user_id varchar(50) -- 宽带用户标识\\n) distributed by ('lan_bill_no');\\ninsert into tmp_dm_pub_broadband_msg_03_${monthid}\\nselect lan_bill_no,\\n       user_id -- 宽带用户标识\\nfrom gbasedwi.dwi_usr_pesn_lan_ms_${monthid}"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [313]-[index:486]-[宽带信息月视图]-[77]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"77.临时表02","nodeId":"77","sql":"drop table if exists tmp_dm_pub_broadband_msg_02_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_02_${monthid}\\n (\\n  phone_no varchar(20),\\n  MONTH_ACTIVE_DAYS bigint(21) ,\\n  MONTH_TOTAL_FLOW decimal(50,10)\\n) distributed by ('phone_no');\\ninsert into tmp_dm_pub_broadband_msg_02_${monthid}\\nselect  phone_no,\\n        count(distinct case when flow>0 then STAT_DATE end )    MONTH_ACTIVE_DAYS,  /*--活跃天数*/\\n        sum(flow)/1024/1024                     MONTH_TOTAL_FLOW               /* --当月使用流量 （M）*/ \\nfrom gbasedwi.DWI_BEH_USE_LANUSER_GPRS_DM_${monthid}\\ngroup by phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [314]-[index:488]-[宽带信息月视图]-[106]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"-- 应收\\ndelete from DM.DM_PUB_SHOULD_KUANDAI_YINGSHOU_YY_${year} WHERE STAT_MON='${monthid}';\\n/*  宽带应收使用费-年累计（根据202403月需求增加指标进行删除）\\nINSERT INTO DM.DM_PUB_SHOULD_KUANDAI_YINGSHOU_YY_${year}\\nSELECT a.STAT_MON,\\n       a.lan_no,\\n       ACCT_ITEM_ID,\\n       SUM(should_income)\\nFROM gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} a\\nLEFT JOIN (select STAT_MON,\\n                  user_id,\\n                  phone_No,\\n                  ACCT_ITEM_ID,\\n                  sum(should_income) should_income -- 应收\\n           from gbasedwi.dwi_inco_bill_item_tot_ms_${monthid} \\n           where ACCT_ITEM_ID in ('3090','1391','896','3134','3161','3241','3243','3556','20327','60493')\\n           group by 1,2,3,4\\n          ) b on a.lan_no=b.phone_No\\ngroup by 1,2,3\\n*/\\n-- 宽带应收使用费-年累计（根据202403月需求增加指标进行增加）\\ninsert into DM.DM_PUB_SHOULD_KUANDAI_YINGSHOU_YY_${year}\\nselect '${monthid}' STAT_MON,phone_no,ACCT_ITEM_ID,sum(should_income) should_income -- 应收\\nfrom gbasemsm.msm_dw_basekpi_10971_detail_${monthid}\\ngroup by 1,2,3\\n;\\n\\n-- 实收\\ndelete from DM.DM_PUB_SHOULD_KUANDAI_SHISHOU_YY_${year} WHERE STAT_MON='${monthid}';\\nINSERT INTO DM.DM_PUB_SHOULD_KUANDAI_SHISHOU_YY_${year}\\nSELECT a.STAT_MON,\\n       a.lan_no,\\n       ACCT_ITEM_ID,\\n       SUM(fact_amt)\\nFROM gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} a\\nLEFT JOIN (select STAT_MON,\\n                  USER_ID,\\n                  PHONE_NO,\\n                  ACCT_ITEM_ID,\\n                  sum(fact_amt)  fact_amt-- 实收\\n           from gbasedwi.dwi_inco_bill_fact_tot_ms_${monthid} \\n           where ACCT_ITEM_ID in ('3090','1391','896','3134','3161','3241','3243','3556','20327','60493')\\n           group by 1,2,3,4\\n          ) b on a.lan_no=b.phone_No\\ngroup by 1,2,3;\\n\\n-- 装移机费-年累计\\ndelete from dm.dm_pub_111036_zyj_fee_yy_${year} where op_time='${monthid}';\\ninsert into dm.dm_pub_111036_zyj_fee_yy_${year}\\nselect '${monthid}' op_time,phone_no,sum(mt_should_fee) mt_should_fee\\nfrom gbasemsm.msm_dw_basekpi_111036_detail_${curmlastday} \\ngroup by 1,2\\n;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [315]-[index:490]-[宽带信息月视图]-[99]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"/*\\n202403月需求：\\n一、报装渠道划分字段枚举值：营业厅、社会渠道(含直随销)、10086在线、电子渠道\\n1、社会渠道(含直随销)：包含连锁渠道+零售渠道\\n2、10086在线：外呼渠道改名\\n3、电子渠道：包含自有电子渠道+社会电子渠道\\n二、报装渠道划分（新）字段枚举值：营业厅、社会渠道连锁、社会渠道零售、社会渠道铁通、社会渠道内部直销、社会渠道外部直销、社会渠道随销、在线呼入、在线呼出、自由电子渠道、社会电子渠道、不详\\n1、社会渠道内部直销：原报装渠道划分（新）社会渠道直销且用户报装渠道四级分类为大众自营直销\\n2、社会渠道外部直销：原报装渠道划分（新）社会渠道直销且用户报装渠道四级分类为大众外部直销\\n3、社会渠道随销：原报装渠道划分（新）社会渠道连锁且用户报装渠道四级分类为随销渠道\\n4、自有电子渠道：同“报装渠道划分”中对应字段\\n5、社会电子渠道：同“报装渠道划分”中对应字段\\n*/\\ndrop table if exists tmp_dm_pub_broadband_msg_07_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_07_${monthid} distributed by ('LAN_NO') \\n-- 202403月需求增加begin\\nselect LAN_NO,\\n       expire_channel_type_03,      -- 用户报装渠道三级分类\\n       expire_channel_type_04,      -- 用户报装渠道四级分类\\n       expire_channel_name_all,     -- 报装渠道名称\\n       expire_channel_name_full,    -- 报装渠道名称全称\\n       case when channel_divide in ('连锁渠道','零售渠道') then '社会渠道(含直随销)'\\n            when channel_divide = '外呼渠道' then '10086在线'\\n            when channel_divide in ('自有电子渠道','社会电子渠道') then '电子渠道' \\n            else channel_divide end channel_divide,    -- 报装渠道划分\\n       case when channel_divide_new = '社会渠道直销' and expire_channel_type_04 = '大众自营直销' then '社会渠道内部直销' \\n            when channel_divide_new = '社会渠道直销' and expire_channel_type_04 = '大众外部直销' then '社会渠道外部直销'\\n            when channel_divide_new = '社会渠道连锁' and expire_channel_type_04 = '随销渠道' then '社会渠道随销'\\n            when channel_divide_new = '电商' then channel_divide  \\n            else channel_divide_new end channel_divide_new, -- 渠道划分（新)\\n       bz_channel_com_id           -- 宽带报装渠道归属分公司\\nfrom (\\n-- 202403月需求增加end\\nselect distinct \\n       a.LAN_NO,\\n       nvl(c.expire_channel_type_03,'不详') expire_channel_type_03,      -- 用户报装渠道三级分类       \\n       nvl(c.expire_channel_type_04,'不详') expire_channel_type_04,      -- 用户报装渠道四级分类       \\n       nvl(c.expire_channel_name_all,'不详') expire_channel_name_all,     -- 报装渠道名称           \\n       nvl(c.expire_channel_name_full,'不详') expire_channel_name_full,    -- 报装渠道名称全称         \\n       nvl(c.channel_divide,'不详') channel_divide,              -- 报装渠道划分           \\n       nvl(c.channel_divide_new,'不详') channel_divide_new,          -- 渠道划分（新)\\n       nvl(d.bz_channel_com_id,0) bz_channel_com_id           -- 宽带报装渠道归属分公司\\nfrom gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} a\\nleft join dm.tmp_dm_pub_broadband_msg_05_${monthid} b on a.LAN_NO=b.lan_bill_no\\nleft join (select distinct \\n                  login_id,\\n                  max(expire_channel_type_03) expire_channel_type_03,      -- 用户报装渠道三级分类       \\n                  max(expire_channel_type_04) expire_channel_type_04,      -- 用户报装渠道四级分类       \\n                  max(expire_channel_name_all) expire_channel_name_all,     -- 报装渠道名称           \\n                  max(expire_channel_name_full) expire_channel_name_full,    -- 报装渠道名称全称         \\n                  max(channel_divide) channel_divide,              -- 报装渠道划分           \\n                  max(channel_divide_new) channel_divide_new          -- 渠道划分（新）           \\n           from gbaseftt.dw_broadband_user_channel_newadd_${curmlastday}\\n           where acct_should_year='${year}'  group by 1) c on a.LAN_NO=c.login_id\\nleft join (select distinct lan_bill_no,bz_channel_com_id,row_number()over(partition by lan_bill_no order by baozhuang_date desc) rn  -- 宽带报装渠道归属分公司\\n           from gbaseftt.st_installed_delivery_self_fetch_ds_${curmlastday}) d on a.LAN_NO=d.lan_bill_no and d.rn=1\\n-- 202403月需求增加begin\\n     )e\\n-- 202403月需求增加end\\n;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [316]-[index:492]-[宽带信息月视图]-[78]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"78.临时表01","nodeId":"78","sql":"drop table if exists tmp_dm_pub_broadband_msg_01_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_01_${monthid}\\n(\\n  lan_bill_no varchar(50) ,\\n  MONTH_NEW_USER_FLAG smallint(6) \\n) distributed by ('lan_bill_no');\\ninsert into tmp_dm_pub_broadband_msg_01_${monthid}\\nselect lan_bill_no,\\n       MONTH_NEW_USER_FLAG \\nfrom gbasedwi.dwi_broadband_user_newadd_dt\\nwhere substr(stat_date,1,7)='${month_id}'\\ngroup by lan_bill_no,\\n\\t     MONTH_NEW_USER_FLAG"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [317]-[index:493]-[宽带信息月视图]-[92]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"92.SQL语句","nodeId":"92","sql":"###临时表1\\ndrop table if exists dm.tmp_broadband_recom_phone_no_${monthid};\\ncreate table dm.tmp_broadband_recom_phone_no_${monthid}\\n( phone_no   varchar(20),\\n  bass_user_state varchar(10)\\n  ) distributed by ('phone_no');\\ninsert into dm.tmp_broadband_recom_phone_no_${monthid}\\nselect phone_no,bass_user_state \\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid}\\nwhere prod_kind_code='171000000001' \\nand length(phone_no)='11';\\n\\n###临时表2\\ndrop table if exists dm.tmp_broadband_phone_lan_${monthid};\\ncreate table dm.tmp_broadband_phone_lan_${monthid}\\n( user_id   bigint(20),              ##用户号码\\n  lan_bill_no varchar(20),           ##宽带账号\\n  bind_crm_num  varchar(20),         ##代付手机号\\n  bind_crm_num_state  smallint(6),   ##代付手机号状态\\n  net_phone_no   varchar(20),        ##NET共用账号手机号\\n  net_phone_no_state smallint(6),    ##NET共用账号手机号状态\\n  family_main_no varchar(20),        ##主卡手机号\\n  family_main_no_state smallint(6),  ##主卡手机号状态\\n  link_phone_yd varchar(80),         ##联系号码(移动)\\n  link_phone_yd_state smallint(6)    ##联系号码(移动)状态\\n  ) distributed by ('user_id');\\ninsert into dm.tmp_broadband_phone_lan_${monthid}\\nselect \\na.user_id,\\na.lan_bill_no,\\na.bind_crm_num,\\nb.bass_user_state,\\nd.phone_no,\\nd.bass_user_state,\\ne.phone_no,\\ne.bass_user_state,\\nc.phone_no,\\nc.bass_user_state\\nfrom\\n(\\nselect a.*,\\n      case when lan_bill_no like '%NET' then substr(lan_bill_no,1,11) end as phone_no\\n     from gbasedwi.dwi_usr_pesn_lan_ms_${monthid} a\\n     where arrv_user_flag=1 and lan_cust_type='01'\\n     ) a\\nleft join dm.tmp_broadband_recom_phone_no_${monthid} b on a.bind_crm_num=b.phone_no\\nleft join dm.tmp_broadband_recom_phone_no_${monthid} c on a.link_phone=c.phone_no\\nleft join dm.tmp_broadband_recom_phone_no_${monthid} d on a.phone_no=d.phone_no\\nleft join dm.tmp_broadband_recom_phone_no_${monthid} e on a.family_main_no=e.phone_no;\\n\\n###结果临时表\\ndrop table tmp_dm_pub_broadband_msg_05_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_05_${monthid}\\n (\\n  lan_bill_no varchar(50) , -- 宽带账号\\n  user_id varchar(50), -- 宽带用户标识\\n  phone_no varchar(20),  -- 宽带融合号码\\n  phone_no_type int ##宽带融合号码属性    \\n)distributed by ('user_id') ;\\ninsert into tmp_dm_pub_broadband_msg_05_${monthid}\\nselect\\na.lan_bill_no,  ##宽带账号\\na.user_id,  ##用户号码\\na.phone_no,     ##宽带融合号码\\nnvl(a.phone_no_type,5) ##宽带融合号码属性\\nfrom\\n( \\n  select a.*,\\n         coalesce(case when bind_crm_num_state<>16 then bind_crm_num end,\\n                  case when net_phone_no_state<>16 then net_phone_no end,\\n                  case when family_main_no_state<>16 then family_main_no end,\\n                  case when link_phone_yd_state<>16 then link_phone_yd end\\n                  ) as phone_no,\\n         coalesce(case when bind_crm_num_state<>16 and bind_crm_num is not null then 1 end,\\n                  case when net_phone_no_state<>16 and net_phone_no is not null then 2 end,\\n                  case when family_main_no_state<>16 and family_main_no is not null then 3 end,\\n                  case when link_phone_yd_state<>16 and link_phone_yd is not null then 4 end,\\n                  5 ) as phone_no_type\\n   from dm.tmp_broadband_phone_lan_${monthid} a\\n   ) a"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [318]-[index:494]-[宽带信息月视图]-[122]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists tmp_dm_pub_broadband_msg_08_${monthid};\\nCREATE TABLE tmp_dm_pub_broadband_msg_08_${monthid} distributed by ('LAN_NO')\\nselect a.LAN_NO,\\n       nvl(b.mt_should_fee,0) mt_should_fee, -- 宽带装移机费（月累计）\\n       nvl(c.should_fee_01,0) should_fee_01,  -- 宽带应收使用费（当月）\\n       nvl(c.should_fee_02,0) should_fee_02,  -- 宽带应收使用费（年累计）\\n       nvl(c.should_fee_03,0) should_fee_03,  -- 提速包应收收入（当月）\\n       nvl(c.should_fee_04,0) should_fee_04,  -- 提速包应收收入（年累计） \\n       nvl(c.should_fee_05,0) should_fee_05,  -- 宽带应收使用费（不含提速包）（当月），根据202403月需求增加指标\\n       nvl(c.should_fee_06,0) should_fee_06,  -- 宽带应收使用费（不含提速包）（年累计），根据202403月需求增加指标\\n       nvl(d.fact_amt_01,0) fact_amt_01,  -- 宽带实收使用费（当月）\\n       nvl(d.fact_amt_02,0) fact_amt_02,  -- 宽带实收使用费（年累计）\\n       nvl(d.fact_amt_03,0) fact_amt_03,  -- 提速包实收收入（当月）\\n       nvl(d.fact_amt_04,0) fact_amt_04,  -- 提速包实收收入（年累计）\\n       nvl(d.fact_amt_05,0) fact_amt_05,  -- 宽带实收使用费（不含提速包）（当月）,根据202403月需求增加指标\\n       nvl(d.fact_amt_06,0) fact_amt_06,  -- 宽带实收使用费（不含提速包）（年累计）,根据202403月需求增加指标 \\n       nvl(e.mt_should_fee,0) yy_should_fee,  -- 宽带装移机费（年累计）\\n       case when f.login_id is not null then 1 else 0 end is_ysf_user  -- 是否宽带易受访客户\\nfrom gbasedwa.DWA_UV_LAN_INFO_MS_${monthid} a\\nleft join (select phone_no,sum(mt_should_fee) mt_should_fee\\n           from gbasemsm.msm_dw_basekpi_111036_detail_${curmlastday} group by phone_no\\n          ) b on a.LAN_NO=b.phone_no\\nleft join (select phone_no,\\n                  sum(case when STAT_MON='${monthid}' then should_income else 0 end) should_fee_01, -- 宽带应收使用费（当月）\\n                  sum(case when STAT_MON between '${curyfirstmonth}' and '${monthid}' then should_income else 0 end) should_fee_02, -- 宽带应收使用费（年累计）\\n                  sum(case when STAT_MON='${monthid}' and ACCT_ITEM_ID='3134' then should_income else 0 end) should_fee_03, -- 提速包应收收入（当月）\\n                  sum(case when (STAT_MON between '${curyfirstmonth}' and '${monthid}') and ACCT_ITEM_ID='3134' then should_income else 0 end) should_fee_04, -- 提速包应收收入（年累计）\\n                  sum(case when STAT_MON='${monthid}' and ACCT_ITEM_ID != '3134' then should_income else 0 end) should_fee_05, -- 宽带应收使用费（不含提速包）（当月）,根据202403月需求增加指标\\n                  sum(case when (STAT_MON between '${curyfirstmonth}' and '${monthid}') and ACCT_ITEM_ID != '3134' then should_income else 0 end) should_fee_06 -- 宽带应收使用费（不含提速包）（年累计）,根据202403月需求增加指标\\n           from DM.DM_PUB_SHOULD_KUANDAI_YINGSHOU_YY_${year} group by phone_no\\n           ) c on a.LAN_NO=c.phone_no\\nleft join (select phone_no,\\n                  sum(case when STAT_MON='${monthid}' then fact_amt else 0 end) fact_amt_01, -- 宽带实收使用费（当月）\\n                  sum(case when STAT_MON between '${curyfirstmonth}' and '${monthid}' then fact_amt else 0 end) fact_amt_02, -- 宽带实收使用费（年累计）\\n                  sum(case when STAT_MON='${monthid}' and ACCT_ITEM_ID='3134' then fact_amt else 0 end) fact_amt_03, -- 提速包实收收入（当月）\\n                  sum(case when (STAT_MON between '${curyfirstmonth}' and '${monthid}') and ACCT_ITEM_ID='3134' then fact_amt else 0 end) fact_amt_04, -- 提速包实收收入（年累计） \\n                  sum(case when STAT_MON='${monthid}' and ACCT_ITEM_ID != '3134' then fact_amt else 0 end) fact_amt_05, -- 宽带实收使用费（不含提速包）（当月）,根据202403月需求增加指标\\n                  sum(case when (STAT_MON between '${curyfirstmonth}' and '${monthid}') and ACCT_ITEM_ID != '3134' then fact_amt else 0 end) fact_amt_06 -- 宽带实收使用费（不含提速包）（年累计）,根据202403月需求增加指标\\n           from DM.DM_PUB_SHOULD_KUANDAI_SHISHOU_YY_${year} group by phone_no\\n           ) d on a.LAN_NO=d.phone_no\\nleft join (select phone_no,sum(mt_should_fee) mt_should_fee\\n           from dm.dm_pub_111036_zyj_fee_yy_${year} \\n           where op_time between '${curyfirstmonth}' and '${monthid}'\\n           group by phone_no\\n          ) e on a.LAN_NO=e.phone_no\\nleft join gbaserpt.rpt_ti_yan_kuandai_user_2024 f on a.LAN_NO=f.login_id;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [319]-[index:495]-[2015年5月新增日累计指标]-[53]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"创建临时表TEST13","nodeId":"53","sql":"drop table ${SOURCE_TMP_DM_20150512_TEST13};\\ncreate table  ${SOURCE_TMP_DM_20150512_TEST13}\\n (\\tPRODUCT_NO         \\tVARCHAR(20),\\n\\tCUST_ID            \\tVARCHAR(20)  ,\\n\\tIS_REAL_NAME        SMALLINT,            /*是否实名登记*/\\n\\tSN                 \\tVARCHAR(30),           /*卡序列号*/\\n\\tOUT_CALL_DURATION_M BIGINT     ,         /*本地主叫网内分钟数*/\\n\\tPLAN_ID          \\tVARCHAR(30) ,            /*主套餐*/\\n\\tTRUTH_NAME       \\tVARCHAR(30) ,            /*是否实名制客户*/\\n\\tDONE_DATE         \\tdatetime)         /*实名登记日期*/\\nDISTRIBUTED BY ('PRODUCT_NO') nolock;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [320]-[index:496]-[2015年5月新增日累计指标]-[252]-['str' object has no attribute 'lfind']:{"name":"252.临时表23","nodeId":"252","dsName":"GbaseDM","sql":"drop table tmp_dm_20150512_test23_${dayid};\\ncreate table tmp_dm_20150512_test23_${dayid}\\n(\\nphone_no varchar(50),\\naction_id int -- 欠费停机用户状态\\n)distributed by ('phone_no');\\ninsert into tmp_dm_20150512_test23_${dayid}\\nselect a.phone_No,\\n       b.action_id      -- 欠费停机用户状态\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (\\nselect phone_id phone_no,\\n       action_id      -- 欠费停机用户状态\\nfrom gbasedwd.DWD_ACCT_IMS_NTF_STS_HIS_DS_${dayid}\\nwhere action_id in (\\n                    31,-- 预付费双停 \\n                    98,-- 预付费单停\\n                    83,-- 后付费单停\\n                    89 -- 后付费双停\\n                    )\\ngroup by phone_id,\\n         action_id\\n) b on a.phone_no=b.phone_No\\n\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [321]-[index:498]-[2015年5月新增日累计指标]-[221]-['str' object has no attribute 'lfind']:{"name":"221.月初一号停机用户","nodeId":"221","dsName":"GbaseDM","sql":"-- 月初创建整月停机用户表\\ndrop table if exists dm.dm_pub_20150512_stopphone_user_${dayid};\\ncreate table dm.dm_pub_20150512_stopphone_user_${dayid}\\n(\\n stat_Date varchar(10),\\n phone_no varchar(50)\\n)distributed by ('phone_no');\\ninsert into dm.dm_pub_20150512_stopphone_user_${dayid}\\nselect stat_Date,phone_no\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}\\nwhere bass_user_state=12 -- 取停机用户\\ngroup by stat_date,phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [322]-[index:499]-[2015年5月新增日累计指标]-[31]-['str' object has no attribute 'lfind']:{"name":"31.插入临时表TEST8数据","nodeId":"31","dsName":"GbaseDM","sql":"insert into  ${SOURCE_TMP_DM_20150512_TEST8}\\nselect cust_id,0\\n--        case when (b.iden_id='101' and length(trim(b.iden_no))=18 and length(trim(b.cust_name))>=4 and length(trim(b.iden_address))<>0) then 1 \\n--       when (b.iden_id like '1%' and b.iden_id<>'199' and b.iden_id<>'101' and length(trim(b.iden_no))<>0 and length(trim(b.cust_name))<>0 and length(trim(b.iden_address))<>0) then 1 \\n--    when (\\n--           ( b.iden_id like '2%' and \\n--          (\\n--            (b.iden_id='201' and  length(trim(b.iden_no))=15 and length(trim(b.cust_name))<>0 and length(trim(b.iden_address))<>0) /*营业执照*/\\n--            or\\n--            (b.iden_id='205' and  length(trim(iden_no))=10 and length(trim(b.cust_name))<>0 and length(trim(b.iden_address))<>0 and substr(trim(b.iden_no),9,1)='-') /*组织机构代码证*/\\n--            or \\n--                (b.iden_id='202' and  length(trim(b.iden_no))=12 and length(trim(b.cust_name))<>0 and length(trim(b.iden_address))<>0 ) /*事业单位法人登记证书*/\\n--            or  \\n--             (b.iden_id in ('206','204') and  length(trim(b.cust_name))<>0 and length(trim(b.iden_address))<>0) /*社会团体法人登记证书、单位证明*/\\n--          ) )\\n--      and (( b.party_iden_id='101' and length(trim(b.party_iden_no))=18 and length(trim(b.party_cust_name))>=4 and length(trim(b.party_iden_address))<>0 ) \\n--        or\\n--        ( b.party_iden_id not in ('101','199') and b.party_iden_id not like '2%'  and length(trim(b.party_iden_no))<>0 and length(trim(b.party_cust_name))<>0 and length(trim(b.party_iden_address))<>0 ) ) ) then 1 else 0 end flag\\nfrom ${SOURCE_TB_STAT_01002} b\\nwhere eff_dt<='${day_id}' and end_dt>'${day_id}';","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [323]-[index:500]-[2015年5月新增日累计指标]-[47]-['str' object has no attribute 'lfind']:{"name":"插入临时表TEST11","nodeId":"47","dsName":"GbaseDM","sql":"insert into  ${SOURCE_TMP_DM_20150512_TEST11}\\nselect product_no,sms_type  \\nfrom (select row_number () over(PARTITION by product_no order by id  desc ) as id,\\n\\t\\t\\t product_no,sms_type \\n\\t  from (select product_no,sms_type,\\n\\t\\t\\t\\t   case when sms_type='套餐客户-超套达到100元' then 6   \\n\\t\\t\\t\\t\\t\\twhen sms_type='套餐客户-超套达到30元' then 5\\n\\t\\t\\t\\t\\t\\twhen sms_type='套餐客户-超套达到5元' then 4\\n\\t\\t\\t\\t\\t\\twhen sms_type='无套餐客户-流量费用达到100元' then 3\\n\\t\\t\\t\\t\\t\\twhen sms_type='无套餐客户-流量费用达到5元' then 2\\n\\t\\t\\t\\t\\t\\twhen sms_type='无套餐客户-首次使用提醒' then 1  end id    \\n\\t\\t\\tfrom ${SOURCE_TMP_DM_20150512_TEST11_1} where sms_type is not null  \\n\\t\\t\\tgroup by product_no,sms_type ) a ) a where id ='1'","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [324]-[index:502]-[2015年5月新增日累计指标]-[57]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"57.创建临时表TEST14","nodeId":"57","sql":"drop table ${SOURCE_TMP_DM_20150512_TEST14};\\ncreate table  ${SOURCE_TMP_DM_20150512_TEST14}\\n (\\t\\n  product_no         varchar(20),\\n\\ttotal_value        bigint,\\nlocal_total_value  bigint,\\n  hdzs_total_flow    bigint,\\n  xscj_total_flow    bigint,\\n  llhb_total_flow    bigint,\\n  hdzs_use_flow      bigint,\\n  xscj_use_flow      bigint,\\n  llhb_use_flow      bigint,\\n  zsbd_total_flow    bigint,\\n  zsbd_use_flow      bigint,\\n  zsqg_total_flow    bigint,\\n  zsqg_use_flow      bigint,\\n\\tcall_total_value   bigint,\\n\\tcall_used_value    bigint\\n\\t) /*语音资源使用量*/\\nDISTRIBUTED BY ('PRODUCT_NO');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [325]-[index:503]-[2015年5月新增日累计指标]-[63]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入临时表IS_OFFER数据","nodeId":"63","sql":"insert into ${SOURCE_DM_PUB_IS_OFFER_YYYYMMDD}\\nselect \\tnvl(a.stat_date,b.op_time),nvl(a.phone_no,b.product_no),\\n\\t\\tnvl(a.plan_id,b.offer_id) \\nfrom (select stat_date,phone_no,plan_id from ${SOURCE_DWI_INST_ASSET_DS_YYYYMMDD} \\n\\t  where plan_id in ('111002004476', '111002006808','111002006809','111002005415'))  a  \\nfull join ${SOURCE_DM_PUB_IS_OFFER_PYYYYMMDD} b \\n\\ton a.phone_no=b.product_no and a.plan_id=b.offer_id\\nwhere b.op_time>=date('${p13monthid}01')"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [326]-[index:504]-[2015年5月新增日累计指标]-[41]-['str' object has no attribute 'lfind']:{"name":"创建临时表TEST11_1","nodeId":"41","dsName":"GbaseDM","sql":"create table  ${SOURCE_TMP_DM_20150512_TEST11_1}\\n (\\tPRODUCT_NO         VARCHAR(20),\\n\\tUSER_ID            VARCHAR(20),\\n\\tSMS_TYPE           VARCHAR(100)\\t)\\nDISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [327]-[index:505]-[2015年5月新增日累计指标]-[49]-['str' object has no attribute 'lfind']:{"name":"创建临时表TEST12","nodeId":"49","dsName":"GbaseDM","sql":"create table  ${SOURCE_TMP_DM_20150512_TEST12}\\n (\\tPRODUCT_NO         VARCHAR(20),\\n\\tGPRS_DAYS         VARCHAR(20),\\n\\tGPRS_DOMESTIC      BIGINT\\t)\\nDISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [328]-[index:506]-[2015年5月新增日累计指标]-[231]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"231.临时表21","nodeId":"231","sql":"drop table if exists tmp_dm_20150512_test21_${dayid};\\nCREATE TABLE tmp_dm_20150512_test21_${dayid}\\n (\\n  phone_No varchar(20) ,     \\n  is_group_plan_user bigint(1) , -- 是否集团套餐用户\\n  is_groupplan_newuser bigint(1) , -- 是否集团套餐新增用户\\n  total_Fee decimal(33,2) ,        -- 套餐外语音费\\n  is_month_stopuser bigint(1)     -- 是否整月停机\\n ) distributed by ('phone_no');\\ninsert into tmp_dm_20150512_test21_${dayid}\\nselect \\n      a.phone_No,\\n      case when b.phone_no is not null then 1 else 0 end  is_group_plan_user, -- 是否集团套餐用户\\n      case when c.phone_no is not null then 1 else 0 end  is_groupplan_newuser, -- 是否集团套餐新增用户\\n      nvl(d.total_Fee,0)  total_Fee, -- 套餐外语音费\\n      case when e.phone_no is not null then 1 else 0 end  is_month_stopuser -- 是否整月停机\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (\\n          select a.phone_No -- 集团套餐用户\\n          from (\\n                select PRODUCT_NO phone_no, \\n                       OFFER_ID\\n                from dm.DM_PRODUCT_OFFER_DD\\n                where SVC_STATUS_ID = '1' \\n                and op_time='${day_id}'\\n               ) a\\n          left join dm.dim_group_offerid b on a.offer_Id=b.offer_Id\\n          where b.offer_Id is not null\\n          group by a.phone_No\\n          ) b on a.phone_No=b.phone_No\\nleft join (\\n           select a.phone_No\\n           from (\\n                 select PRODUCT_NO phone_no,\\n                        OFFER_ID,START_DATE \\n                 from dm.DM_PRODUCT_OFFER_DD\\n                 where SVC_STATUS_ID = '1' \\n                 and op_time='${day_id}'\\n                and START_DATE='${curm_first_day}'\\n                ) a\\n           left join dm.dim_group_offerid b on a.offer_Id=b.offer_Id\\n           where b.offer_Id is not null\\n           group by a.phone_No\\n           ) c on a.phone_No=c.phone_no\\nleft join (\\n           select phone_No,\\n                  sum(truncate(total_Fee,2)) total_Fee -- 套餐外语音费\\n           from gbasedwd.dwd_evt_cdr_voc_basetot_dm_${monthid}    \\n\\t\\t   where OUT_PROD_FLAG=1 and stat_date<='${day_id}'\\n           group by phone_No  \\n          ) d on a.phone_no=d.phone_no\\nleft join dm.dm_pub_20150512_stopphone_user_${dayid} e on a.phone_no=e.phone_no         \\n          \\n\\n          \\n          \\n          \\n          \\n          \\n          "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [329]-[index:507]-[2015年5月新增日累计指标]-[248]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"248.入网后首次充值金额 累计","nodeId":"248","sql":"## 入网后首次充值金额 累计 从20190701起入网的用户的首次充值金额\\ndrop table dm.tmp_pub_first_pay_amt_${dayid};\\ncreate table dm.tmp_pub_first_pay_amt_${dayid} distributed by ('phone_no')\\nselect '${day_id}' op_time , -- 数据时间\\n\\t\\ta.phone_no,\\n\\t\\ta.innet_date,        -- 入网日期\\n\\t\\tb.op_time first_op_time,-- 充值时间\\n\\t\\tb.pay_amt -- 充值金额\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join      \\n       (\\n\\t\\tselect user_no phone_no,date(op_time) op_time,\\n                sum(pay_amt/100)  pay_amt\\n        from gbasedwd.dwd_acc_pay_rec_ds_${dayid}\\n\\t\\twhere pay_Type not in ('4590','4591','4592','4621','4515')\\n\\t \\tgroup by user_no,date(op_time)\\n\\t \\t) b on a.phone_no=b.phone_No\\nleft join dm.dm_pub_first_pay_amt_dt_${pdayid} c on a.phone_No=c.phone_No\\nleft join gbasedwi.dwi_usr_pesn_thinginter_ds_${dayid} d on a.phone_NO=d.user_No \\nwhere a.innet_date>='20190701' and b.op_time>=date(a.innet_date)\\n      and b.phone_no is not null \\n      and c.phone_no is null\\n\\t  and d.user_No is null\\n\\t  ;\\n\\n\\n##累计表\\n##备份表\\ndrop table dm_pub_first_pay_amt_dt_${pdayid}_bak${dayid};\\ncreate table dm_pub_first_pay_amt_dt_${pdayid}_bak${dayid} distributed by ('phone_no') select * from dm_pub_first_pay_amt_dt_${pdayid};\\n##正式表\\ndrop table dm_pub_first_pay_amt_dt_${dayid};    \\nCREATE TABLE dm_pub_first_pay_amt_dt_${dayid}\\n (\\n  op_time varchar(10),\\n  phone_no varchar(20) ,\\n  innet_date varchar(10) ,-- 入网日期\\n  first_op_time date ,   -- 入网后首次充值时间\\n  pay_amt decimal(42,3)  -- 入网后首次充值金额\\n) distributed by ('phone_no') ;\\n\\n##插入当天数据\\ninsert into dm_pub_first_pay_amt_dt_${dayid}\\nselect * from dm.tmp_pub_first_pay_amt_${dayid};\\n##插入历史数据\\ninsert into dm_pub_first_pay_amt_dt_${dayid}\\nselect * from dm.dm_pub_first_pay_amt_dt_${pdayid};\\n\\n\\n\\n\\n\\n\\n\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [330]-[index:508]-[2015年5月新增日累计指标]-[165]-['str' object has no attribute 'lfind']:{"name":"165.插入临时表TEST17","nodeId":"165","dsName":"GbaseDM","sql":"insert into dm.tmp_dm_20150512_test17\\n(\\nphone_no,\\nhaoma_zhuanqu,\\nkuandai_zhuanqu,\\nshouji_zhuanqu,\\nliuliang_zhuanqu,\\nxinyewu_zhuanqu,\\nliuliang_yue,\\ntaocan_yuliang,\\nwode_zhangdan\\n)\\nselect\\n    wt_mobile,\\n    sum(case when wt_event in('sy_hkzq_xhrw','sy_hkzq_4grzk','sy_hkzq_cjllwk')then 1 else 0 end) haoma_zhuanqu, -- 号码专区\\n    sum(case when wt_event in('sy_kdzq_ydgkd','sy_kdzq_zzfw','sy_kdzq_kdxf') then 1 else 0 end) kuandai_zhuanqu,  -- 宽带专区\\n    sum(case when wt_event in('sy_sjsc_iphone7','sy_sjsc_hwp10','sy_sjsc_oppo r11','sy_sjsc_sjscgd')then 1 else 0 end) shouji_zhuanqu, -- 手机专区\\n    sum(case when wt_event in('sy_llzq_rwkllb','sy_llzq_wdll','sy_llzq_rwxllhbqg','sy_llzq_rwxllhb') then 1 else 0 end) liuliang_zhuanqu, -- 流量专区\\n    0 xinyewu_zhuanqu,-- 新业务专区（目前未上线）\\n    sum(case when wt_event ='sy_llzq_wdll' then 1 else 0 end) liuliang_yue,-- 流量查询\\n    sum(case when wt_event ='sy_sytjw_tcyl' then 1 else 0 end) taocan_yuliang,-- 套餐余量\\n    sum(case when wt_event ='sy_sytjw_wdzd' then 1 else 0 end) wode_zhangdan -- 我的账单\\n  from (\\n        select wt_mobile,wt_event from gbasedwd.dwd_chl_app_hand_office_ios_dm_${monthid} where substr(stat_date,1,8)<='${dayid}'\\n        union all\\n        select wt_mobile,wt_event from gbasedwd.dwd_chl_app_hand_office_android_dm_${monthid} where substr(stat_date,1,8)<='${dayid}'\\n        ) a group by wt_mobile;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [331]-[index:509]-[2015年5月新增日累计指标]-[215]-['str' object has no attribute 'lfind']:{"name":"215.临时表18","nodeId":"215","dsName":"GbaseDM","sql":"drop table if exists tmp_dm_20150512_test18_${dayid};    \\nCREATE TABLE tmp_dm_20150512_test18_${dayid}\\n(\\n  phone_no varchar(20),\\n  is_yj_4Gnet_user bigint(1), -- 是否为4G网络客户数（一经口径）\\n  passport_n varchar(6),      -- 护照国籍\\n  hmt_cust_type varchar(6)    -- 港澳台客户类型\\n)distributed by ('phone_no');\\ninsert into tmp_dm_20150512_test18_${dayid}\\nselect a.phone_no,\\n       case when b.phone_no is not null then 1 else 0 end is_yj_4Gnet_user, -- 是否为4G网络客户数（一经口径）\\n       nvl(substr(case when c.cust_type='护照' then c.CUST_ADDRESS end,1,6),'不详') passport_n,  -- 护照国籍\\n       nvl(substr(case when c.cust_type in('台胞证','港澳证') then c.CUST_ADDRESS end,1,6),'不详') hmt_cust_type -- 港澳台客户类型\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join (\\n           select phone_no \\n           from gbasemsm.msm_dw_basekpi_110676_detail_${dayid}\\n           group by phone_No\\n          ) b on a.phone_No=b.phone_No\\nleft join (\\n          select phone_No,\\n                 cust_type,\\n                 CUST_ADDRESS \\n          from gbasedwi.dwi_usr_pesn_realname_base_ds_${dayid}\\n          group by phone_No,cust_type,CUST_ADDRESS\\n          ) c on a.phone_no=c.phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [332]-[index:510]-[2015年5月新增日累计指标]-[71]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"71.插入最终表","nodeId":"71","sql":"insert into ${TARGET_DM_PUB_20150512_YYYYMMDD}\\nselect '${day_id}',\\n\\t   '${monthid}',\\n\\t\\ta.product_no,\\n\\t\\tnull /*case when b.IDEN_NO is not null then 1 else 0 end*/,\\t/*是否一证多号（一经口径）*/\\n\\t\\tnull /*case when T.IS_ONETOFIVE>1 then 1 else 0 end IS_LOCAL_PAPER*/,\\t/*是否一证多号（本地口径）*/ -- 20181205日下线\\n\\t    nvl(d.IS_GROUP_NORMS,0) ,\\t\\t\\t\\t\\t\\t\\t\\t/*证件信息是否符合集团规范*/\\n\\t\\tcase when e.product_no is not null then 1 else 0 end,\\t/*当月更换usim卡用户*/\\n\\t    nvl(e.IS_FRIST_CHECK,0) ,\\t\\t\\t\\t\\t\\t\\t\\t/*是否首次更换USIM卡*/\\n\\t\\ta.truth_name   ,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*是否实名制客户*/\\n\\t\\ta.IS_REAL_NAME   ,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*是否实名登记*/\\n\\t    NULL ,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*通用营销短信当月累计接触频次*/\\n\\t    NULL,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*场景营销短信当月累计接触频次*/\\n\\t    a.sn,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*卡序列号*/\\n\\t    a.OUT_CALL_DURATION_M,\\t\\t\\t\\t\\t\\t\\t\\t\\t/*本地主叫网内分钟数*/\\n\\t    k.gprs_days,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*GPRS上网天数*/\\n\\t    a.plan_id ,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*主套餐*/\\n\\t    a.plan_id as plan_id1,\\t\\t\\t\\t\\t\\t            /*主套餐策划ID*/\\n\\t    f.CO_CODE ,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*CO编码*/\\n\\t    g.sms_type ,                                           \\t/*流量提醒短信类型*/\\n\\t    i.TOTAL_VALUE ,\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*GRPS国内资源总量*/\\n\\t\\ti.LOCAL_TOTAL_VALUE ,\\t\\t\\t\\t\\t\\t\\t\\t\\t/*GRPS本地资源总量*/\\n\\t\\ti.CALL_TOTAL_VALUE ,                            \\t\\t/*语音资源总量*/\\n\\t\\tk.GPRS_DOMESTIC ,                                \\t\\t/*国内gprs流量*/\\n\\t\\ta.DONE_DATE,                      /*实名登记日期  */\\n\\t\\tl.IS_5_OFFER,                                   \\t\\t/*能否订购5元体验30元 */\\n\\t\\tl.IS_10_OFFER,                                  \\t\\t/*能否订购10元体验30元, */\\n\\t\\tl.IS_20_OFFER,                                  \\t\\t/*能否订购20元体验40元 */\\n\\t\\tl.IS_0_OFFER,                                   \\t\\t/*能否订购0元体验30元 */\\n\\t\\ti.call_used_value,                              \\t\\t/*语音资源使用量  */\\n    m.is_shouting,         -- 是否手厅注册用户\\n    m.is_weiting,          -- 是否微厅绑定用户\\n    m.liuliang_counts,     -- 当月互联网渠道流量业务办理次数\\n    m.xinyewu_counts   ,   -- 当月互联网渠道新业务办理次数\\n    n.haoma_zhuanqu    ,   -- 当月访问手厅号码专区次数\\n    n.kuandai_zhuanqu  ,   -- 当月访问手厅宽带专区次数\\n    n.shouji_zhuanqu   ,   -- 当月访问手厅手机专区次数\\n    n.liuliang_zhuanqu ,   -- 当月访问手厅流量专区次数\\n    n.xinyewu_zhuanqu  ,   -- 当月访问手厅新业务专区次数\\n    n.liuliang_yue     ,   -- 当月手厅查询流量余额次数\\n    n.taocan_yuliang   ,   -- 当月手厅查询套餐余量次数\\n    n.wode_zhangdan\\t   ,   -- 当月手厅查询我的账单次数\\n    m.is_real_liststop ,   -- 是否非实名单停\\n\\t  m.is_real_doulestop,   -- 是否非实名双停\\n\\t  i.hdzs_total_flow  ,   -- 线上赠送资源总量-活动赠送套外本地流量\\n    i.xscj_total_flow  ,   -- 线上赠送资源总量-线上抽奖本地通用流量\\n    i.llhb_total_flow  ,   -- 线上赠送资源总量-流量红包\\n    i.hdzs_use_flow    ,   -- 线上赠送资源使用量-活动赠送套外本地流量\\n    i.xscj_use_flow    ,   -- 线上赠送资源使用量-线上抽奖本地通用流量\\n    i.llhb_use_flow    ,   -- 线上赠送资源使用量-流量红包\\n    i.zsbd_total_flow  ,   -- 线上赠送资源总量-本地流量直充单位KB\\n    i.zsbd_use_flow    ,   -- 线上赠送资源使用量-本地流量直充单位KB\\n    i.zsqg_total_flow  ,   -- 线上赠送资源总量-全国流量直充单位KB\\n    i.zsqg_use_flow,       -- 线上赠送资源使用量-全国流量直充单位KB\\n\\t  p.m_p_total_flow ,     -- GPRS流量—较上月同期增量       以下20181228日新增\\n    p.m_p_should_income ,  -- 月累计消费金额—较上月同期增量\\n    p.m_p_call_dur,         -- 语音通话时长—较上月同期增量             \\n\\t  t1.user_level,          -- 全球通档位（前台配置维度表）\\n\\t  case when t1.user_level=0 then 6 else t1.user_level end,   -- 全球通档位（数值） 201902220日调整    \\n\\t  t2.dg_USE_RES_NUM,    -- 订购定向流量资源使用量\\n    t2.dg_TOTAL_RES_NUM,  -- 订购定向流量资源总量\\n    t2.zs_USE_RES_NUM,    -- 赠送定向流量资源使用量\\n    t2.zs_TOTAL_RES_NUM ,   -- 赠送定向流量资源总量\\n    t2.gprs_USE_RES_NUM,   -- GPRS国内资源使用量\\n    t2.is_4G_valid_user, -- 是否为4G有效客户（集团口径）\\n\\tt3.is_yj_4Gnet_user, -- 是否为4G网络客户数（一经口径）以下20190328日新增\\n    t3.passport_n,      -- 护照国籍\\n    t3.hmt_cust_type,    -- 港澳台客户类型\\n\\tt4.is_2019_user,    -- 是否2019年拍照价值客户 以下指标20190411日添加\\n    t4.is_top25_user,    -- 是否重点客户保拓（TOP25%拍照客户）\\n    t4.is_other75_user,    -- 是否重点客户保拓（其他75%拍照客户）\\n    t4.is_top25_by_user,    -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n    t4.is_other75_tz_user,    -- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n    t4.is_2018_zerocall_user,    -- 是否重点客户保拓（2018年拍照期末0通信客户）     \\n    t4.is_2018_zerocall_tz_user,    -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n    t4.is_2019_newnet_user,    -- 是否重点客户保拓（2019年新入网客户拓展客户）\\n    t4.is_bxl_arriveduser,    -- 是否不限量渗透率（中高端不限量套餐到达客户数）\\n    t4.is_2019_q1_user,    -- 是否不限量渗透率（2019一季度中高端拍照客户）\\n    t4.is_2019_q2_user,    -- 是否不限量渗透率（2019二季度中高端拍照客户）\\n\\tt5.is_4gnet_newuser  ,-- 是否为4G网络客户（新）\\n    t5.is_4g_arrieduser,   -- 是否为4G到达（份额考核新）\\n\\tt6.is_group_plan_user , -- 是否集团套餐用户 -- 20190418\\n    t6.is_groupplan_newuser , -- 是否集团套餐新增用户\\n    t6.total_Fee ,        -- 套餐外语音费\\n    t6.is_month_stopuser,     -- 是否整月停机\\n    t7.bhd_lgprs_res, -- 饱和度国内流量资源  以下 20190531新增\\n    t7.c_stopdays ,   -- 连续停机天数（不含物联网号码）\\n    t7.is_offnet_user, -- 是否为离网客户（不含物联网）\\n\\tt7.is_4Gvalid_user_bd ,   -- 是否为4G有效客户（本地2019当月 -- 以下20190704日添加\\n    t7.is_4Gvalid_user_jt ,    -- 是否为4G有效客户（集团2019当月）\\n\\tt4.is_2019_q3_user   ,        -- 是否不限量渗透率（2019三季度中高端拍照客户） 20190712日新增\\n\\tt7.pay_amt,   -- 入网后首次充值金额\\n    t7.is_zero_user, -- 是否零预零押用户 20190717\\n\\tnull, -- t8.action_id  -- 欠费停机用户状态\\n\\tt24.is_5gpuls\\nfrom ${SOURCE_TMP_DM_20150512_TEST13}  a\\n/*left join tmp_dm_20150512_test3  b on a.IDEN_NO=b.IDEN_NO\\nleft join tmp_dm_20150512_test6  c on a.IDEN_NO=c.IDEN_NO*/\\nleft join ${SOURCE_TMP_DM_20150512_TEST9}  d on a.product_no=d.user_id\\nleft join ${SOURCE_TMP_DM_20150512_TEST10} e on a.product_no=e.product_no\\nleft join ${SOURCE_TMP_DM_20150512_TEST11} g on a.product_no=g.product_no\\nleft join ${SOURCE_TMP_DM_20150512_TEST12} k on  a.product_no=k.product_no\\nleft join gbasedwi.DWI_USR_GRP_MEB_DS_${dayid} f on\\ta.product_no=f.MEMB_NO\\nleft join ${SOURCE_TMP_DM_20150512_TEST14} i on a.product_no=i.product_no\\nleft join ${SOURCE_TMP_DM_20150512_TEST15} l on\\ta.product_no=l.product_no\\nleft join dm.tmp_dm_20150512_test16 m ON A.PRODUCT_NO=m.PHONE_NO\\nleft join dm.tmp_dm_20150512_test17 n ON A.PRODUCT_NO=n.PHONE_NO\\nleft join tmp_dm_20150512_gvs_${dayid} p on a.product_no=p.phone_no\\nleft join dm.tmp_20150512_user_level_${dayid} t1 on a.product_no=t1.phone_no \\nleft join dm.tmp_20150512_gprs_${dayid} t2 on a.product_no=t2.phone_no \\nleft join tmp_dm_20150512_test18_${dayid} t3 on a.product_no=t3.phone_no \\nleft join tmp_dm_20150512_test19_${dayid} t4 on a.product_no=t4.phone_no\\nleft join tmp_dm_20150512_test20_${dayid} t5 on a.product_no=t5.phone_no\\nleft join tmp_dm_20150512_test21_${dayid} t6 on a.product_no=t6.phone_no\\nleft join tmp_dm_20150512_test22_${dayid} t7 on a.product_no=t7.phone_no\\nleft join tmp_dm_20150512_test24_${dayid} t24 on a.product_no=t24.phone_no\\n\\n-- left join tmp_dm_20150512_test23_${dayid} t8 on a.product_no=t8.phone_no\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [333]-[index:511]-[2015年5月新增日累计指标]-[178]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"178.创建临时表","nodeId":"178","sql":"###删除表\\ndrop table tmp_dm_20150512_gvs_${dayid};\\n##创建表\\nCREATE TABLE tmp_dm_20150512_gvs_${dayid}\\n(\\n  phone_no varchar(20),\\n  m_p_total_flow bigint,\\n  m_p_should_income bigint,\\n  m_p_call_dur bigint\\n) distributed by ('phone_no');\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [334]-[index:513]-[2015年5月新增日累计指标]-[219]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"219.临时表20","nodeId":"219","sql":"drop table if exists tmp_dm_20150512_test20_${dayid};\\nCREATE TABLE tmp_dm_20150512_test20_${dayid}\\n(\\n  phone_no varchar(20),\\n  is_4gnet_newuser bigint(1) ,-- 是否为4G网络客户（新）\\n  is_4g_arrieduser bigint(1)  -- 是否为4G到达（份额考核新\\n)distributed by ('phone_no');\\ninsert into tmp_dm_20150512_test20_${dayid}\\nselect a.phone_no,\\n      case when b.phone_No is not null then 1 else 0 end is_4gnet_newuser, -- 是否为4G网络客户（新）\\n      '0' is_4g_arrieduser  -- 是否为4G到达（份额考核新）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (\\n           select phone_no \\n           from gbasemsm.msm_dw_basekpi_110725_deteil_${dayid}\\n           group by phone_No\\n           ) b on a.phone_no=b.phone_No\\n-- left join (\\n--            select phone_no \\n--            from gbasemsm.msm_dw_basekpi_110726_deteil_${dayid}\\n--            group by phone_No\\n--            ) c on a.phone_no=c.phone_No\\n           "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [335]-[index:514]-[2015年5月新增日累计指标]-[198]-['str' object has no attribute 'lfind']:{"name":"198.全球通用户档位","nodeId":"198","dsName":"GbaseDM","sql":" ##删除表\\ndrop table if exists dm.tmp_20150512_user_level_${dayid};  \\n##创建表\\ncreate table dm.tmp_20150512_user_level_${dayid}\\n(\\nphone_no varchar(50),\\nuser_level int,\\nuser_level_name varchar(20) \\n)distributed by ('phone_no');\\n##插入数据\\ninsert into dm.tmp_20150512_user_level_${dayid}\\nselect phone_no,\\n       user_level,\\n       user_level_name \\nfrom gbasedwd.dwd_svc_inst_gotone_ds_${dayid} -- 20190731 日 调整月表为日表\\ngroup by phone_no,\\n         user_level,\\n         user_level_name\\n ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [336]-[index:515]-[2015年5月新增日累计指标]-[51]-['str' object has no attribute 'lfind']:{"name":"插入临时表TEST12","nodeId":"51","dsName":"GbaseDM","sql":"insert into  ${SOURCE_TMP_DM_20150512_TEST12}\\nselect phone_no,count(STAT_DATE),sum(total_flow)\\nfrom (select phone_no,STAT_DATE,\\n\\t\\t\\t nvl(sum(case when ROAM_TYPE in (0 ,1,3,5,7) then nvl(BUSY_UP_FLOW,0)+nvl(IDLE_UP_FLOW,0)+nvl(BUSY_DOWN_FLOW,0)+nvl(IDLE_DOWN_FLOW,0)end)/1024,0) total_flow\\n\\t  from ${SOURCE_DWD_EVT_CDR_GPRS_BUSITYPETOT_DM_YYYYMM}\\n\\t  where /*BUSI_DTL_TYPE ='BI240000' and */STAT_DATE<'${n_day_id}'\\n\\t  group by phone_no,STAT_DATE) a\\nwhere total_flow>'0' group by phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [337]-[index:516]-[2015年5月新增日累计指标]-[45]-['str' object has no attribute 'lfind']:{"name":"创建临时表TEST11","nodeId":"45","dsName":"GbaseDM","sql":"create table  ${SOURCE_TMP_DM_20150512_TEST11}\\n (\\tPRODUCT_NO\\tVARCHAR(20),\\n\\tSMS_TYPE\\tVARCHAR(100)\\t)\\nDISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [338]-[index:517]-[2015年5月新增日累计指标]-[33]-['str' object has no attribute 'lfind']:{"name":"创建临时表TEST10","nodeId":"33","dsName":"GbaseDM","sql":"create table  ${SOURCE_TMP_DM_20150512_TEST10}\\n (\\tPRODUCT_NO         VARCHAR(20),\\n\\tIS_FRIST_CHECK        SMALLINT\\t)\\nDISTRIBUTED BY ('PRODUCT_NO') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [339]-[index:518]-[2015年5月新增日累计指标]-[69]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"69.创建最终表","nodeId":"69","sql":"drop table ${TARGET_DM_PUB_20150512_YYYYMMDD};\\ncreate table ${TARGET_DM_PUB_20150512_YYYYMMDD}\\n (\\tOP_TIME           \\t DATE,\\n\\tSTATIS_MONTH         INTEGER,\\n\\tPRODUCT_NO           VARCHAR(20),\\n\\tIS_YIJING_PAPER      SMALLINT,             /*是否一证多号（一经口径）*/\\n\\tIS_LOCAL_PAPER       INTEGER,             /*是否一证多号（本地口径）*/\\n\\tIS_GROUP_NORMS       SMALLINT,             /*证件信息是否符合集团规范*/\\n\\tIS_CHANGE_USIM       SMALLINT,             /*当月更换usim卡用户*/\\n\\tIS_FRIST_CHECK       SMALLINT,             /*是否首次更换USIM卡*/\\n\\tTRUTH_NAME           VARCHAR(30),          /*是否实名制客户  */\\n\\tIS_REAL_NAME         SMALLINT,             /*是否实名登记*/\\n\\tMON_CONTACT_COUNT1   INTEGER,              /*通用营销短信当月累计接触频次*/\\n\\tMON_CONTACT_COUNT2   INTEGER,              /*场景营销短信当月累计接触频次*/\\n\\tSN                   VARCHAR(30),          /*卡序列号*/\\n\\tOUT_CALL_DURATION_M  BIGINT     ,          /*本地主叫网内分钟数*/\\n\\tGPRS_DAYS            INTEGER         ,     /*GPRS上网天数*/\\n\\tPLAN_ID              VARCHAR(30)     ,     /*主套餐*/\\n\\tPLAN_ID1             VARCHAR(30)     ,     /*主套餐策划ID*/\\n\\tENTERPRISE_ID        VARCHAR(50)     ,     /*CO编码*/\\n\\tSMS_TYPE             VARCHAR(100)  ,       /*流量提醒短信类型*/\\n\\tTOTAL_VALUE          BIGINT,               /*GRPS国内资源总量 */\\n\\tLOCAL_TOTAL_VALUE    BIGINT,               /*GRPS本地资源总量*/\\n\\tCALL_TOTAL_VALUE     BIGINT ,              /*语音资源总量*/\\n\\tGPRS_DOMESTIC        BIGINT     ,\\n\\tDONE_DATE            datetime,\\n\\tIS_5_OFFER           SMALLINT,             /*能否订购5元体验30元 */\\n\\tIS_10_OFFER          SMALLINT,             /*能否订购10元体验30元,*/\\n\\tIS_20_OFFER          SMALLINT,             /*能否订购20元体验40元*/\\n\\tIS_0_OFFER           SMALLINT,             /*能否订购0元体验30元*/\\n\\tCALL_USED_VALUE      BIGINT,               /*语音资源使用量*/\\n\\tis_shouting          smallint,             -- 当月是否是手厅注册用户\\n\\tis_weiting           smallint,             -- 当月是否是微厅的绑定用户\\n\\tliuliang_counts      bigint,               -- 当月互联网渠道流量业务办理次数\\n\\txinyewu_counts       bigint,               -- 当月互联网渠道新业务办理次数\\n\\thaoma_zhuanqu        bigint,               -- 当月访问手厅号码专区次数\\n  kuandai_zhuanqu      bigint,               -- 当月访问手厅宽带专区次数   \\n  shouji_zhuanqu       bigint,               -- 当月访问手厅手机专区次数\\n  liuliang_zhuanqu     bigint,               -- 当月访问手厅流量专区次数      \\n  xinyewu_zhuanqu      bigint,               -- 当月访问手厅新业务专区次数\\n  liuliang_yue         bigint,               -- 当月手厅查询流量余额次数\\n  taocan_yuliang       bigint,               -- 当月手厅查询套餐余量次数\\n  wode_zhangdan\\t       bigint,               -- 当月手厅查询我的账单次数\\n  is_real_liststop     smallint,             -- 是否非实名单停\\n\\tis_real_doulestop    smallint,             -- 是否非实名双停   \\n\\thdzs_total_flow      bigint,               -- 线上赠送资源总量-活动赠送套外本地流量\\n  xscj_total_flow      bigint,               -- 线上赠送资源总量-线上抽奖本地通用流量\\n  llhb_total_flow      bigint,               -- 线上赠送资源总量-流量红包\\n  hdzs_use_flow        bigint,               -- 线上赠送资源使用量-活动赠送套外本地流量\\n  xscj_use_flow        bigint,               -- 线上赠送资源使用量-线上抽奖本地通用流量\\n  llhb_use_flow        bigint,               -- 线上赠送资源使用量-流量红包\\n  zsbd_total_flow      bigint,               -- 线上赠送资源总量-本地流量直充单位KB\\n  zsbd_use_flow        bigint,               -- 线上赠送资源使用量-本地流量直充单位KB\\n  zsqg_total_flow      bigint,               -- 线上赠送资源总量-全国流量直充单位KB\\n  zsqg_use_flow        bigint,               -- 线上赠送资源使用量-全国流量直充单位KB\\n  m_p_total_flow       bigint,       -- GPRS流量—较上月同期增量 以下20181228日新增\\n  m_p_should_income    bigint,        -- 月累计消费金额—较上月同期增量\\n  m_p_call_dur         bigint,         -- 语音通话时长—较上月同期增量\\n  user_level           int,           --  全球通档位（前台配置维度表）\\n  user_level_id        int,            --  全球通档位（数值）\\n  dg_USE_RES_NUM bigint , -- 订购定向流量资源使用量\\n  dg_TOTAL_RES_NUM bigint, -- 订购定向流量资源总量\\n  zs_USE_RES_NUM bigint,  -- 赠送定向流量资源使用量\\n  zs_TOTAL_RES_NUM bigint, -- 赠送定向流量资源总量\\n  gprs_USE_RES_NUM bigint ,-- GPRS国内资源使用量       \\n  is_4G_valid_user bigint(1),     -- 是否为4G有效客户（集团口径）\\n  is_yj_4Gnet_user bigint(1), -- 是否为4G网络客户数（一经口径） 以下20190328日添加    \\n  passport_n varchar(6),      -- 护照国籍   \\n  hmt_cust_type varchar(6),    -- 港澳台客户类型\\n  is_2019_user bigint(1), -- 是否2019年拍照价值客户 -- 以下指标20190411日添加\\n  is_top25_user bigint(1), -- 是否重点客户保拓（TOP25%拍照客户）\\n  is_other75_user bigint(1), -- 是否重点客户保拓（其他75%拍照客户）\\n  is_top25_by_user bigint(1),  -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n  is_other75_tz_user bigint(1),-- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n  is_2018_zerocall_user bigint(1),-- 是否重点客户保拓（2018年拍照期末0通信客户）\\n  is_2018_zerocall_tz_user bigint(1), -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n  is_2019_newnet_user bigint(1),-- 是否重点客户保拓（2019年新入网客户拓展客户）\\n  is_bxl_arriveduser bigint(1), -- 是否不限量渗透率（中高端不限量套餐到达客户数）\\n  is_2019_q1_user bigint(1),-- 是否不限量渗透率（2019一季度中高端拍照客户）\\n  is_2019_q2_user bigint(1), -- 是否不限量渗透率（2019二季度中高端拍照客户）\\n  is_4gnet_newuser bigint(1),-- 是否为4G网络客户（新） 以下20190412日添加\\n  is_4g_arrieduser bigint(1),  -- 是否为4G到达（份额考核新) \\n  is_group_plan_user bigint(1) , -- 是否集团套餐用户 -- 以下20190418日新增\\n  is_groupplan_newuser bigint(1) , -- 是否集团套餐新增用户\\n  total_Fee decimal(33,2) ,        -- 套餐外语音费\\n  is_month_stopuser bigint(1) ,    -- 是否整月停机\\n  bhd_lgprs_res double(19,2) , -- 饱和度国内流量资源 以下20190531日添加\\n  c_stopdays bigint(21) ,   -- 连续停机天数（不含物联网号码）\\n  is_offnet_user bigint(1),  -- 是否为离网客户（不含物联网）\\n  is_4Gvalid_user_bd bigint(1),   -- 是否为4G有效客户（本地2019当月 -- 以下20190704日添加\\n  is_4Gvalid_user_jt bigint(1),   -- 是否为4G有效客户（集团2019当月）  \\n  is_2019_q3_user bigint(1) ,     -- 是否不限量渗透率（2019三季度中高端拍照客户） 20190712日新增\\n  pay_amt decimal(42,3),          -- 入网后首次充值金额  20190715\\n  is_zero_user bigint(1) ,         -- 是否零预零押用户 20190717\\n  action_id int, -- 欠费停机用户状态 20190930 new add \\n  is_5gpuls int  -- 是否5G终端用户 20191129\\n)\\nDISTRIBUTED BY ('PRODUCT_NO');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [340]-[index:519]-[2015年5月新增日累计指标]-[29]-['str' object has no attribute 'lfind']:{"name":"创建临时表TEST8","nodeId":"29","dsName":"GbaseDM","sql":"create table  ${SOURCE_TMP_DM_20150512_TEST8}\\n (\\tCUST_ID         VARCHAR(20),\\n\\tIS_GROUP_NORMS  SMALLINT\\t)\\nDISTRIBUTED BY ('CUST_ID') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [341]-[index:520]-[2015年5月新增日累计指标]-[226]-['str' object has no attribute 'lfind']:{"name":"226.非一号数据","nodeId":"226","dsName":"GbaseDM","sql":"drop table if exists dm.dm_pub_20150512_stopphone_user_${dayid};\\ncreate table dm.dm_pub_20150512_stopphone_user_${dayid}\\n(\\n stat_Date varchar(10),\\n phone_no varchar(50)\\n)distributed by ('phone_no');\\ninsert into dm.dm_pub_20150512_stopphone_user_${dayid}\\nselect a.stat_date,a.phone_NO\\nfrom \\n(\\nselect stat_Date,\\n       phone_no\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid}\\nwhere bass_user_state=12\\ngroup by stat_date,phone_no\\n) a\\ninner join dm.dm_pub_20150512_stopphone_user_${pdayid} b on a.phone_No=b.phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [342]-[index:521]-[2015年5月新增日累计指标]-[217]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"217.临时表19","nodeId":"217","sql":"drop table if exists tmp_dm_20150512_test19_${dayid};\\nCREATE TABLE tmp_dm_20150512_test19_${dayid}      \\n(\\n  phone_No varchar(20),\\n  is_2019_user bigint(1), -- 是否2019年拍照价值客户\\n  is_top25_user bigint(1), -- 是否重点客户保拓（TOP25%拍照客户）\\n  is_other75_user bigint(1), -- 是否重点客户保拓（其他75%拍照客户）\\n  is_top25_by_user bigint(1),  -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n  is_other75_tz_user bigint(1),-- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n  is_2018_zerocall_user bigint(1),-- 是否重点客户保拓（2018年拍照期末0通信客户）\\n  is_2018_zerocall_tz_user bigint(1), -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n  is_2019_newnet_user bigint(1),-- 是否重点客户保拓（2019年新入网客户拓展客户）\\n  is_bxl_arriveduser bigint(1), -- 是否不限量渗透率（中高端不限量套餐到达客户数）\\n  is_2019_q1_user bigint(1),-- 是否不限量渗透率（2019一季度中高端拍照客户）\\n  is_2019_q2_user bigint(1), -- 是否不限量渗透率（2019二季度中高端拍照客户）\\n  is_2019_q3_user bigint(1) -- 是否不限量渗透率（2019三季度中高端拍照客户） 20190712日新增\\n)distributed by ('phone_no');\\ninsert into tmp_dm_20150512_test19_${dayid}\\nselect a.phone_No,\\n       case when b.phone_No is not null then 1 else 0 end is_2019_user,    -- 是否2019年拍照价值客户\\n       case when c.phone_No is not null then 1 else 0 end is_top25_user,    -- 是否重点客户保拓（TOP25%拍照客户）\\n       case when d.phone_no is not null then 1 else 0 end is_other75_user,    -- 是否重点客户保拓（其他75%拍照客户）\\n       case when e.phone_no is not null then 1 else 0 end is_top25_by_user,    -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n       case when f.phone_No is not null then 1 else 0 end is_other75_tz_user,    -- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n       case when g.phone_No is not null then 1 else 0 end is_2018_zerocall_user,    -- 是否重点客户保拓（2018年拍照期末0通信客户）\\n       case when h.phone_no is not null then 1 else 0 end is_2018_zerocall_tz_user,    -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n       case when i.phone_no is not null then 1 else 0 end is_2019_newnet_user,    -- 是否重点客户保拓（2019年新入网客户拓展客户）\\n       case when j.phone_no is not null then 1 else 0 end is_bxl_arriveduser,    -- 是否不限量渗透率（中高端不限量套餐到达客户数）\\n       0 is_2019_q1_user,    -- 是否不限量渗透率（2019一季度中高端拍照客户）\\n       0 is_2019_q2_user,    -- 是否不限量渗透率（2019二季度中高端拍照客户）\\n\\t   0 is_2019_q3_user     -- 是否不限量渗透率（2019三季度中高端拍照客户）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join ( \\n          select phone_no from gbasemsm.msm_dw_basekpi_110705_snapshot_yyyymmdd \\n          group by phone_no\\n          ) b on a.phone_No=b.phone_no\\nleft join (\\n          select phone_no from gbasemsm.${table_name.name110705}\\n          where hold_flag = 1\\n          group by phone_No\\n          ) c on a.phone_No=c.phone_no\\nleft join (\\n          select phone_no from gbasemsm.${table_name.name110705}\\n          where hold_flag = 2\\n          group by phone_No\\n          ) d on a.phone_No=d.phone_no\\nleft join (\\n          select phone_no from gbasemsm.${table_name.name110705}\\n          where hold_flag = 1 and flag = 1\\n          group by phone_No\\n          ) e on a.phone_No=e.phone_no\\nleft join (\\n          select phone_no from gbasemsm.${table_name.name110705}\\n          where hold_flag = 2 and flag = 1\\n          group by phone_No\\n          ) f on a.phone_No=f.phone_no       \\nleft join (\\n          select phone_no from gbasemsm.${table_name.name110705}\\n          where hold_flag = 3\\n          group by phone_No\\n          ) g on a.phone_No=g.phone_no\\nleft join (\\n          select phone_no from gbasemsm.${table_name.name110705}\\n          where hold_flag = 3 and flag = 1\\n          group by phone_No\\n          ) h on a.phone_No=h.phone_no        \\nleft join (\\n          select phone_no from gbasemsm.${table_name.name110705}\\n          where hold_flag = 4 and flag = 1\\n          group by phone_No\\n          ) i on a.phone_No=i.phone_no \\nleft join (\\n           select phone_No from gbasemsm.msm_dw_basekpi_110703_detail_${dayid}\\n           where flag = 1\\n           group by phone_no\\n           ) j on a.phone_No=j.phone_no  \\n \\t\\t   \\n\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [343]-[index:522]-[2015年5月新增日累计指标]-[206]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"206.流量资源","nodeId":"206","sql":"drop table tmp_20150512_gprs_${dayid};\\nCREATE TABLE tmp_20150512_gprs_${dayid}     \\n(     \\n  phone_no varchar(20) ,\\n  dg_USE_RES_NUM int , -- 订购定向流量资源使用量(MB)\\n  dg_TOTAL_RES_NUM bigint , -- 订购定向流量资源总量(MB)\\n  zs_USE_RES_NUM bigint ,  -- 赠送定向流量资源使用量(MB)\\n  zs_TOTAL_RES_NUM bigint , -- 赠送定向流量资源总量(MB)\\n  gprs_USE_RES_NUM bigint ,-- GPRS国内资源使用量(kb)\\n  is_4G_valid_user bigint(1)      -- 是否为4G有效客户（集团口径）\\n) distributed by ('phone_no');\\ninsert into tmp_20150512_gprs_${dayid}\\nselect a.phone_no,\\n       b.dg_USE_RES_NUM,    -- 订购定向流量资源使用量\\n       b.dg_TOTAL_RES_NUM,  -- 订购定向流量资源总量\\n       c.zs_USE_RES_NUM,    -- 赠送定向流量资源使用量\\n       c.zs_TOTAL_RES_NUM ,   -- 赠送定向流量资源总量\\n       d.RES_USE_NUM,   -- GPRS国内资源使用量    20190523日调整口径\\n       case when e.phone_no is not null then 1 else 0 end is_4G_valid_user -- 是否为4G有效客户（集团口径）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a        \\nleft join (select  b.phone_no,\\n                   sum(b.USE_RES_NUM/1024/1024) dg_USE_RES_NUM,\\n                   sum(b.TOTAL_RES_NUM/1024/1024) dg_TOTAL_RES_NUM \\n           from dm.dim_dx_flow a\\n           left join gbasedwi.${table_name.name1} b on a.plan_id=b.plan_id and a.use_type=b.use_type \\n           group by phone_no\\n           ) b on a.phone_no=b.phone_no\\nleft join ( \\n           select  phone_no,\\n                   sum(USE_RES_NUM/1024/1024) zs_USE_RES_NUM, -- 赠送定向流量资源使用量\\n                   sum(TOTAL_RES_NUM/1024/1024) zs_TOTAL_RES_NUM -- 赠送定向流量资源总量\\n          from gbasedwi.${table_name.name1} \\n          where plan_id='111002069417'\\n          group by phone_no    \\n          ) c on a.phone_no=c.phone_no\\nleft join (\\n          select phone_no,\\n                sum(case when b.item_code is not null then a.FREE_RES_USE_NUM else 0 end)/1024 RES_USE_NUM    -- GPRS国内资源使用量 \\n          from gbasedwd.${tablename.dwdfreeres1} a\\n          left join (\\n                    select item_code from dm.dim_pub_freeres_lty_itemcode group by item_code\\n                    ) b on a.item_code=b.item_code\\n\\t\\t  where boss_prod_id not in ('54001105','53005095','50002352','54001809')\\n\\t\\t  and to_number(FREE_RES_TOTAL_NUM)<1000000000000000000\\n          group by a.phone_no\\n           ) d on a.phone_no=d.phone_no\\nleft join (\\n            select phone_no from gbasemsm.msm_dw_basekpi_110673_detail_${dayid} group by phone_no\\n          ) e on a.phone_no=e.phone_no\\nwhere a.PROD_KIND_CODE='171000000001'  And (a.MONTH_ARRIVE_FLAG = 1 Or a.MONTH_OFF_FLAG = 1 or a.MONTH_NEW_FLAG = 1);\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [344]-[index:524]-[2015年5月新增日累计指标]-[27]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"临时表","nodeId":"27","sql":"DROP TABLE ${SOURCE_TMP_DM_20150512_TEST8};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST9};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST10};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST11_1};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST11};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST12};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST13};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST14};\\nDROP TABLE ${SOURCE_DM_PUB_IS_OFFER_YYYYMMDD};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST15};\\nDROP TABLE ${TARGET_DM_PUB_20150512_YYYYMMDD};"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [345]-[index:525]-[2015年5月新增日累计指标]-[151]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"151.插入临时表TEST16","nodeId":"151","sql":"insert into dm.tmp_dm_20150512_test16\\nselect\\n    t1.phone_no,\\n    case when t3.phone_no is not null then 1 else 0 end as is_shouting,  -- 是否手厅注册用户\\n    case when t4.product_no is not null then 1 else 0 end as is_weiting, -- 是否微厅绑定用户\\n    t5.liuliang_counts, -- 当月互联网渠道流量业务办理次数\\n    t5.xinyewu_counts,  -- 当月互联网渠道流量业务办理次数\\n    nvl(t6.is_real_liststop,0), -- 是否非实名单停 \\n    nvl(t6.is_real_doulestop,0) -- 是否非实名双停\\n from ${SOURCE_DWI_USR_PESN_PARTINFO_DS_YYYYMMDD} t1\\n left join (select phone_no from gbasedwd.dwd_evt_log_vgop_userall_dreman_ds_${dayid}\\n             group by phone_no) t3 on t1.phone_no=t3.phone_no\\n left join (select product_no from gbasedwi.dwi_weixin_follow_bind_dt\\n             where follow_status=1  and binding_status=1\\n             group by product_no) t4 on t1.phone_no=t4.product_no\\n left join (select   \\n                phone_no,\\n                sum(case when type_id=1 then 1 else 0 end) as liuliang_counts,   -- 流量业务次数\\n                sum(case when type_id=2 then 1 else 0 end) as xinyewu_counts     -- 新业务次数\\n              from gbasedwi.dwi_inst_ord_list_dm_${monthid} a\\n             inner join gbasemcd.dim_cocnew_sz_offer b on a.plan_id=b.offer_id\\n             where stat_date<='${day_id}'\\n               and (\\n                    chl_lvl4_cls in ('一级电渠','VGOP平台','电商平台自有电子渠道（BJCRMEC）','综合网关','门户网站','服务客户端')\\n                    or staff_busi_id like 'OP_%' \\n                    or staff_busi_id like 'BJCRMJT-%'\\n                   )\\n               and action_type in ('创建','变更')\\n             group by phone_no) t5 on t1.phone_no=t5.phone_no \\n left join (select\\n                user_id,\\n                max(case when substr(os_status,43,1)=1 then 1 else 0 end) as is_real_liststop,\\n                max(case when substr(os_status,44,1)=1 then 1 else 0 end) as is_real_doulestop\\n              from (\\n\\t\\t\\t  \\t\\tselect user_id,os_status from gbaseods.ods_d_f_crm_01541_ins_user_os_state_d_${dayid}\\n                    union all\\n                    select user_id,os_status from gbaseods.ods_d_f_crm_01541_ins_user_os_state_w_${dayid}\\n\\t\\t\\t       ) a \\n             group by user_id\\n\\t\\t\\t ) t6 on t1.user_id=t6.user_id             \\nwhere (t1.ONNET_USER_FLAG=1 AND t1.PROD_KIND_CODE='171000000001') or t1.MONTH_OFF_FLAG =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [346]-[index:526]-[2015年5月新增日累计指标]-[61]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"61.创建临时表IS_OFFER","nodeId":"61","sql":"create table ${SOURCE_DM_PUB_IS_OFFER_YYYYMMDD}\\n (\\tOP_TIME    DATE,\\n\\tPRODUCT_NO  VARCHAR(20),\\n\\tOFFER_ID   VARCHAR(20)    )\\nDISTRIBUTED BY ('PRODUCT_NO') nolock;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [347]-[index:527]-[2015年5月新增日累计指标]-[59]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"59.插入临时表TEST14","nodeId":"59","sql":"insert into ${SOURCE_TMP_DM_20150512_TEST14}   \\nselect \\n       a.phone_no,\\n\\t   c.RES_TOTAL_NUM, \\n b.local_total_value,\\nb.hdzs_total_flow, -- 线上赠送资源总量-活动赠送套外本地流量\\nb.xscj_total_flow, -- 线上赠送资源总量-线上抽奖本地通用流量\\nb.llhb_total_flow, -- 线上赠送资源总量-流量红包\\nb.hdzs_use_flow,     -- 线上赠送资源使用量-活动赠送套外本地流量\\nb.xscj_use_flow,     -- 线上赠送资源使用量-线上抽奖本地通用流量\\nb.llhb_use_flow,     -- 线上赠送资源使用量-流量红包\\nb.zsbd_total_flow, -- 线上赠送资源总量-本地流量直充单位KB\\nb.zsbd_use_flow,     -- 线上赠送资源使用量-本地流量直充单位KB\\nb.zsqg_total_flow, -- 线上赠送资源总量-全国流量直充单位KB\\nb.zsqg_use_flow,     -- 线上赠送资源使用量-全国流量直充单位KB\\nb.call_TOTAL_RES_NUM,\\nb.call_USE_RES_NUM\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join ( select\\n          phone_no,\\n\\t\\tsum(nvl(case when use_type in('本地4G流量直充赠送','本地4G网络流量','本地GPRS','本地年包/卡流量',\\n\\t\\t'季包/卡本地流量','流量起飞计划赠送本地','数据流量本地','移动本地通用流量') \\n\\t\\tthen TOTAL_RES_NUM end,0))/1024*1.0 local_total_value,\\n \\t\\tsum(case when plan_id=111002040001 then total_res_num else 0 end)/1024 as hdzs_total_flow, -- 线上赠送资源总量-活动赠送套外本地流量\\n    sum(case when plan_id=111002043418 then total_res_num else 0 end)/1024 as xscj_total_flow, -- 线上赠送资源总量-线上抽奖本地通用流量\\n    sum(case when plan_id=111002042603 then total_res_num else 0 end)/1024 as llhb_total_flow, -- 线上赠送资源总量-流量红包\\n    sum(case when plan_id=111002040001 then use_res_num else 0 end)/1024 as hdzs_use_flow,     -- 线上赠送资源使用量-活动赠送套外本地流量\\n    sum(case when plan_id=111002043418 then use_res_num else 0 end)/1024 as xscj_use_flow,     -- 线上赠送资源使用量-线上抽奖本地通用流量\\n    sum(case when plan_id=111002042603 then use_res_num else 0 end)/1024 as llhb_use_flow,     -- 线上赠送资源使用量-流量红包\\n\\t\\tsum(case when plan_id=111002051814 then total_res_num else 0 end)/1024 as zsbd_total_flow, -- 线上赠送资源总量-本地流量直充单位KB\\n    sum(case when plan_id=111002051814 then use_res_num else 0 end)/1024 as zsbd_use_flow,     -- 线上赠送资源使用量-本地流量直充单位KB\\n    sum(case when plan_id=111002051816 then total_res_num else 0 end)/1024 as zsqg_total_flow, -- 线上赠送资源总量-全国流量直充单位KB\\n    sum(case when plan_id=111002051816 then use_res_num else 0 end)/1024 as zsqg_use_flow,     -- 线上赠送资源使用量-全国流量直充单位KB\\n\\t\\tsum(nvl(case when USE_TYPE like '%通话%' or USE_TYPE like '%语音%' then TOTAL_RES_NUM end,0))/60 call_TOTAL_RES_NUM,\\n\\t\\tsum(nvl(case when USE_TYPE like '%通话%' or USE_TYPE like '%语音%' then USE_RES_NUM end,0))/60   call_USE_RES_NUM\\n  from gbasedwi.${table_name.name1}\\n  group by phone_no\\n  ) b on a.phone_no=b.phone_no\\n left join (\\n            select phone_no,\\n                  sum(case when b.item_code is not null \\n\\t\\t\\t\\t  then a.FREE_RES_TOTAL_NUM else 0 end)/1024 RES_TOTAL_NUM  -- GPRS国内资源总量          \\n\\t\\t\\t\\t  from gbasedwd.${tablename.dwdfreeres1} a\\n           left join (\\n                    select item_code from dm.dim_pub_freeres_lty_itemcode group by item_code\\n                    ) b on a.item_code=b.item_code \\n\\t\\t  where boss_prod_id not in ('54001105','53005095','50002352','54001809')\\n\\t\\t  and to_number(FREE_RES_TOTAL_NUM)<1000000000000000000\\n           group by a.phone_no\\n           ) c on a.phone_no=c.phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [348]-[index:529]-[2015年5月新增日累计指标]-[164]-['str' object has no attribute 'lfind']:{"name":"创建临时表TEST17","nodeId":"164","dsName":"GbaseDM","sql":"drop table dm.tmp_dm_20150512_test17;\\ncreate table dm.tmp_dm_20150512_test17\\n(\\t\\n  phone_no\\t\\t\\t      varchar(20),\\n\\thaoma_zhuanqu       bigint,\\n  kuandai_zhuanqu     bigint,\\n  shouji_zhuanqu      bigint,\\n  liuliang_zhuanqu    bigint,\\n  xinyewu_zhuanqu     bigint,\\n  liuliang_yue        bigint,\\n  taocan_yuliang      bigint,\\n  wode_zhangdan\\t      bigint\\n) distributed by ('phone_no');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [349]-[index:530]-[2015年5月新增日累计指标]-[174]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"174.大于上月最后一天","nodeId":"174","sql":"  insert into tmp_dm_20150512_gvs_${dayid}       \\n select a.phone_no,\\n       nvl(b.m_total_flow,0)-nvl(c.p_total_flow,0) m_p_total_flow, -- GPRS流量—较上月同期增量\\t\\n       nvl(d.m_should_income,0)-nvl(e.p_should_income,0) m_p_should_income, -- 月累计消费金额—较上月同期增量\\n       nvl(f.m_call_dur,0)-nvl(g.p_call_dur,0) m_p_call_dur -- 语音通话时长—较上月同期增量\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (select phone_No,\\n                 sum(total_flow)/1024 m_total_flow -- 当月GPRS流量   \\n           from gbasedwd.dwd_evt_cdr_gprs_busitypetot_dt_${dayid}\\n           group by phone_No\\n           ) b on a.phone_no=b.phone_no\\nleft join (select phone_No,\\n                  sum(total_flow)/1024 p_total_flow -- 上月GPRS流量\\n           from gbasedwd.dwd_evt_cdr_gprs_busitypetot_dt_${premlastday}\\n           group by phone_No\\n           ) c on a.phone_no=c.phone_no\\nleft join (select phone_no,\\n                  sum(mt_should_income) m_should_income -- 当月当日累计消费金额\\n           from gbasedwi.DWI_INCO_BILL_ITEM_TOT_DS_${dayid}\\n           group by phone_No\\n           ) d on a.phone_no=d.phone_no\\nleft join (select phone_no,\\n                  sum(mt_should_income) p_should_income -- 上月当日累计消费金额\\n           from gbasedwi.DWI_INCO_BILL_ITEM_TOT_DS_${premlastday}\\n           group by phone_No\\n           ) e on a.phone_no=e.phone_no\\nleft join (select phone_no,\\n                   sum(call_dur) m_call_dur  -- 当月语音通话时长\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_dt_${dayid}\\n            group by phone_no \\n           ) f on a.phone_no=f.phone_no\\nleft join (select phone_no,\\n                  sum(call_dur) p_call_dur   -- 上月语音通话时长\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_dt_${premlastday}\\n            group by phone_no \\n           ) g on a.phone_no=g.phone_no\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [350]-[index:531]-[2015年5月新增日累计指标]-[242]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"242.临时表22","nodeId":"242","sql":"drop table tmp_dm_20150512_test22_${dayid};\\ncreate table tmp_dm_20150512_test22_${dayid}    \\n (       \\n  phone_no varchar(20) , \\n  bhd_lgprs_res double(19,2) , -- 饱和度国内流量资源\\n  c_stopdays bigint(21) ,   -- 连续停机天数（不含物联网号码）\\n  is_offnet_user bigint(1),  -- 是否为离网客户（不含物联网）\\n  is_4Gvalid_user_bd bigint(1),   -- 是否为4G有效客户（本地2019当月 -- 以下20190704日添加\\n  is_4Gvalid_user_jt bigint(1),   -- 是否为4G有效客户（集团2019当月）\\n  pay_amt decimal(42,3) , -- 入网后首次充值金额  20190715\\n  is_zero_user bigint(1) -- 是否零预零押用户 20190717\\n) distributed by ('phone_no');  \\ninsert into tmp_dm_20150512_test22_${dayid}\\nselect \\n      a.phone_no,\\n      round(nvl(b.RES_USE_NUM/b.RES_TOTAL_NUM,0),2) bhd_lgprs_res, -- 饱和度国内流量资源\\n      nvl(c.c_stopdays,0) c_stopdays ,                             -- 连续停机天数（不含物联网号码）\\n      case when d.phone_no is not null then 1 else 0 end  is_offnet_user,       -- 是否为离网客户（不含物联网）\\n\\t  case when e.phone_no is not null then 1 else 0 end  is_4Gvalid_user_bd,   -- 是否为4G有效客户（本地2019当月）\\n\\t  case when f.phone_no is not null then 1 else 0 end  is_4Gvalid_user_jt,    -- 是否为4G有效客户（集团2019当月）\\n\\t  round(g.pay_amt,2) pay_amt ,  -- 入网后首次充值金额  20190715\\n\\t  case when h.phone_no is not null then 1 else 0 end  is_zero_user -- 是否零预零押用户 20190717\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join \\n     (   \\n       select phone_no,\\n            sum(case when b.item_code is not null then a.FREE_RES_USE_NUM else 0 end)/1024 RES_USE_NUM,    -- GPRS国内资源使用量 \\n            sum(case when b.item_code is not null then a.FREE_RES_TOTAL_NUM else 0 end)/1024 RES_TOTAL_NUM -- GPRS国内资源总量\\n       from gbasedwd.${tablename.dwdfreeres1} a\\n            -- gbasedwd.dwd_acc_offer_freeres_ds_${dayid} a\\n       left join (\\n                   select item_code from dm.dim_pub_freeres_lty_itemcode group by item_code\\n                  ) b on a.item_code=b.item_code \\n\\t\\twhere boss_prod_id not in ('54001105','53005095','50002352','54001809')\\n\\t\\tand to_number(FREE_RES_TOTAL_NUM)<1000000000000000000\\n        group by a.phone_no\\n       ) b on a.phone_no=b.phone_no\\nleft join ( \\n           select phone_No,c_stopdays from dm.dm_20150512_cstopphone_${dayid}\\n           group by phone_No,c_stopdays \\n          ) c on a.phone_no=c.phone_no\\nleft join (\\n           SELECT A.msisdn phone_no \\n           FROM gbasedwi.dwi_int_02004_di_${dayid} A\\n           LEFT JOIN GBASEDWI.DWI_USR_PESN_THINGINTER_DS_${dayid}  B ON A.msisdn=B.USER_NO\\n           WHERE A.USER_TYPE<>'3' AND A.STS_UPDATE='${dayid}'\\n               AND A.USER_STATUS IN ('2010','2020','2030','9000')\\n               AND B.USER_NO IS NULL\\n           ) d on a.phone_no=d.phone_no\\nleft join (select phone_no \\n           from gbasemsm.msm_dw_basekpi_110785_deteil_${dayid} -- 4G有效客户（本地2019当月）\\n           group by phone_no\\n           ) e on a.phone_no=e.phone_no\\t   \\nleft join (select phone_no \\n           from gbasemsm.msm_dw_basekpi_110786_detail_${dayid} -- 4G有效客户（集团2019当月）\\n           group by phone_no \\n           ) f on a.phone_no=f.phone_no\\nleft join dm_pub_first_pay_amt_dt_${dayid} g on a.phone_no=g.phone_no\\nleft join (\\n\\t\\t   select b.phone_NO  phone_NO  -- 零预零押用户\\n           from (\\n                 select user_id from gbasedwd.dwd_svc_inst_pre_01539_attr_ds_${dayid}\\n                 where (ATTR_ID=151000031914  and ATTR_VALUE=0 ) \\n                 or (ATTR_ID=151000031915 and  ATTR_VALUE=0)\\n           group by user_id ) a \\n           left join gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} b on a.user_id=b.user_id\\n\\t\\t  ) h on a.phone_no=h.phone_no\\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   \\n\\t\\t   "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [351]-[index:532]-[2015年5月新增日累计指标]-[243]-['str' object has no attribute 'lfind']:{"name":"243.统计连续停机天数","nodeId":"243","dsName":"GbaseDM","sql":" #从20190301日起统计连续停机天数\\ndrop table dm.dm_20150512_cstopphone_${dayid};\\ncreate table dm.dm_20150512_cstopphone_${dayid} distributed by ('phone_no')\\nselect \\n a.phone_no,\\n case when b.phone_no is not null then b.c_stopdays+1 else 1 end  c_stopdays\\nfrom  ( \\n      select \\n\\t      a.phone_no\\n     from gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\n     left join gbasedwi.dwi_usr_pesn_thinginter_ds_${dayid} b on a.phone_no=b.user_no\\n      where a.bass_user_state=12 \\n      and b.user_no is null\\n      and ((a.ONNET_USER_FLAG=1 AND a.PROD_KIND_CODE='171000000001') or a.MONTH_OFF_FLAG =1)\\n      group by phone_no\\n     ) a \\nleft join ( select phone_no,c_stopdays\\n           from dm.dm_20150512_cstopphone_${pdayid}\\n           group by phone_No,c_stopdays) b on a.phone_no=b.phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [352]-[index:533]-[2015年5月新增日累计指标]-[65]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"创建临时表TEST15","nodeId":"65","sql":"create table  ${SOURCE_TMP_DM_20150512_TEST15}\\n (\\tPRODUCT_NO          VARCHAR(20),\\n\\tIS_5_OFFER          SMALLINT,\\n\\tIS_10_OFFER         SMALLINT,\\n\\tIS_20_OFFER         SMALLINT,\\n\\tIS_0_OFFER          SMALLINT\\t\\t)\\nDISTRIBUTED BY ('PRODUCT_NO') nolock;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [353]-[index:534]-[2015年5月新增日累计指标]-[254]-['str' object has no attribute 'lfind']:{"name":"254.临时表24","nodeId":"254","dsName":"GbaseDM","sql":"drop table tmp_dm_20150512_test24_${dayid};\\ncreate table tmp_dm_20150512_test24_${dayid}\\n(\\nphone_no varchar(50),\\nis_5gpuls int -- 是否5G终端用户\\n)distributed by ('phone_no');\\ninsert into tmp_dm_20150512_test24_${dayid}\\nselect a.phone_No,\\n       case when b.phone_No is not null then 1 else 0 end      -- 是否5G终端用户\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (select \\n               a.phone_no\\n\\t\\t         from gbasedwi.dwi_beh_use_steadyimei_ds_${dayid} a /*稳定终端信息月表月表*/\\n\\t\\t         inner join (select tac_no tac from gbasedwd.dwd_res_svc_term_brand_obass_ms_${pmonthid}\\nwhere G5_FLAG = 1 group by tac_no) c on a.tac=c.tac\\n) b on a.phone_no=b.phone_No\\n\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [354]-[index:536]-[2015年5月新增日累计指标]-[43]-['str' object has no attribute 'lfind']:{"name":"插入临时表TEST11_1数据","nodeId":"43","dsName":"GbaseDM","sql":"insert into  ${SOURCE_TMP_DM_20150512_TEST11_1}\\nselect phone_no,user_id,\\n       case when sms_content like '%套餐内国内流量已用完，超出套餐外流量费用已达100元%' then '套餐客户-超套达到100元'\\n\\t\\t\\twhen sms_content like '%套餐内国内流量已用完，超出套餐外流量费用已达30元%' then '套餐客户-超套达到30元' \\n\\t\\t\\twhen sms_content like '%套餐内国内流量已用完，超出套餐外流量费用已达5元%' then '套餐客户-超套达到5元'\\n\\t\\t\\twhen sms_content like '%套餐内国内流量已用完%' then '套餐客户-剩余0M' \\n\\t\\t\\twhen sms_content like '%流量费用已达100元%' then '无套餐客户-流量费用达到100元'\\n\\t\\t\\twhen sms_content like '%流量费用已达5元%' then '无套餐客户-流量费用达到5元' \\n\\t\\t\\twhen sms_content like '%您本月已产生上网数据流量，资费为1元/M%' then '无套餐客户-首次使用提醒'  end as 提醒短信类型 \\nfrom ${SOURCE_DWD_ACC_SMSSEND_REC_MS_YYYYMM}\\nwhere busi_type in (2243,4566,2244,2240,60000,60001) and sms_type <> 1 \\n  and sms_content not like '%Centrex总机%' and sms_content not like '%WLAN%' \\n  and STAT_DATE <= '${day_id}' \\ngroup by phone_no,user_id,\\n\\t\\t case when sms_content like '%套餐内国内流量已用完，超出套餐外流量费用已达100元%' then '套餐客户-超套达到100元'\\n\\t\\t\\t  when sms_content like '%套餐内国内流量已用完，超出套餐外流量费用已达30元%' then '套餐客户-超套达到30元' \\n\\t\\t\\t  when sms_content like '%套餐内国内流量已用完，超出套餐外流量费用已达5元%' then '套餐客户-超套达到5元'\\n\\t\\t\\t  when sms_content like '%套餐内国内流量已用完%' then '套餐客户-剩余0M' \\n\\t\\t\\t  when sms_content like '%流量费用已达100元%' then '无套餐客户-流量费用达到100元'\\n\\t\\t\\t  when sms_content like '%流量费用已达5元%' then '无套餐客户-流量费用达到5元' \\n\\t\\t\\t  when sms_content like '%您本月已产生上网数据流量，资费为1元/M%' then '无套餐客户-首次使用提醒' end","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [355]-[index:537]-[2015年5月新增日累计指标]-[150]-['str' object has no attribute 'lfind']:{"name":"创建临时表TEST16","nodeId":"150","dsName":"GbaseDM","sql":"drop table dm.tmp_dm_20150512_test16;\\ncreate table dm.tmp_dm_20150512_test16\\n(\\t\\n  phone_no          varchar(20),\\n\\tis_shouting       smallint,\\n\\tis_weiting        smallint,\\n\\tliuliang_counts   bigint,\\n\\txinyewu_counts    bigint,\\n\\tis_real_liststop  smallint,\\n\\tis_real_doulestop smallint\\n) distributed by ('phone_no');","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [356]-[index:538]-[2015年5月新增日累计指标]-[188]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"188.小于等于上月当天","nodeId":"188","sql":" insert into tmp_dm_20150512_gvs_${dayid}         \\n select a.phone_no,\\n       nvl(b.m_total_flow,0)-nvl(c.p_total_flow,0) m_p_total_flow, -- GPRS流量—较上月同期增量\\t\\n       nvl(d.m_should_income,0)-nvl(e.p_should_income,0) m_p_should_income, -- 月累计消费金额—较上月同期增量\\n       nvl(f.m_call_dur,0)-nvl(g.p_call_dur,0) m_p_call_dur -- 语音通话时长—较上月同期增量\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (select phone_No,\\n                 sum(total_flow)/1024 m_total_flow -- 当月GPRS流量\\n           from gbasedwd.dwd_evt_cdr_gprs_busitypetot_dt_${dayid}\\n           group by phone_No\\n           ) b on a.phone_no=b.phone_no\\nleft join (select phone_No,\\n                  sum(total_flow)/1024 p_total_flow -- 上月GPRS流量\\n           from gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${pmonthid}\\n           where stat_date<=date(${p1month})\\n           group by phone_No\\n           ) c on a.phone_no=c.phone_no\\nleft join (select phone_no,\\n                  sum(mt_should_income) m_should_income -- 当月当日累计消费金额\\n           from gbasedwi.DWI_INCO_BILL_ITEM_TOT_DS_${dayid}   \\n           group by phone_No\\n           ) d on a.phone_no=d.phone_no\\nleft join (select phone_no,\\n                  sum(mt_should_income) p_should_income -- 上月当日累计消费金额\\n           from gbasedwi.DWI_INCO_BILL_ITEM_TOT_DS_${p1month}   \\n           group by phone_No\\n           ) e on a.phone_no=e.phone_no\\nleft join (select phone_no,\\n                   sum(call_dur) m_call_dur  -- 当月语音通话时长\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_dt_${dayid}\\n            group by phone_no \\n           ) f on a.phone_no=f.phone_no\\nleft join (select phone_no,\\n                  sum(call_dur) p_call_dur   -- 上月语音通话时长\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_dm_${pmonthid} \\n            where stat_date<=date(${p1month})\\n            group by phone_no \\n           ) g on a.phone_no=g.phone_no\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [357]-[index:539]-[2015年5月新增日累计指标]-[67]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入临时表TEST15数据","nodeId":"67","sql":"insert into  ${SOURCE_TMP_DM_20150512_TEST15}\\nselect distinct a.phone_no,\\n     min(case when a.plan_id in ('111002000132','111002000133') and b.offer_id<>'111002004476' then 1 else 0 end) IS_5_OFFER ,\\n\\t min(case when a.plan_id in ('111002000113','111002000114') and b.offer_id<>'111002006808' then 1 else 0 end)  IS_10_OFFER,\\n\\t min(case when a.plan_id in ('111002000121','111002000122') and b.offer_id<>'111002006809' then 1 else 0 end)  IS_20_OFFER,\\n\\t min (case when c.OFFER_ID is null  and b.offer_id<>'111002005415' then 1 else 0 end)  IS_0_OFFER\\nfrom (select distinct a.phone_no,a.plan_id from ${SOURCE_DWI_INST_ASSET_DS_YYYYMMDD} a \\n\\t  where plan_type='OFFER_VAS_OTHER' ) a  \\nleft join (select distinct product_no,offer_id from ${SOURCE_DM_PUB_IS_OFFER_YYYYMMDD} \\n\\t\\t   where op_time>=date('${p13monthid}01'))  b on a.phone_no=b.product_no\\nleft join DIM_PUB_OFFER_GPRS_BACKGE c on a.plan_id=c.offer_id\\ngroup by a.phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [358]-[index:542]-[2015年5月新增日累计指标]-[39]-['str' object has no attribute 'lfind']:{"name":"插入临时表TEST9","nodeId":"39","dsName":"GbaseDM","sql":"insert into  ${SOURCE_TMP_DM_20150512_TEST9}\\nselect  a.user_id ,b.IS_GROUP_NORMS  \\nfrom (select a.user_id,a.cust_id,a.user_status \\n\\t  from ${SOURCE_int_02004_di_YYYYMMDD} a where a.user_status<2000)  a\\nleft join  ${SOURCE_TMP_DM_20150512_TEST8}  b  on  a.cust_id=b.cust_id ","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [359]-[index:544]-[2015年5月新增日累计指标]-[73]-['str' object has no attribute 'lfind']:{"name":"73.删除临时表","nodeId":"73","dsName":"GbaseDM","sql":"DROP TABLE ${SOURCE_TMP_DM_20150512_TEST8};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST9};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST10};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST11_1};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST11};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST12};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST13};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST14};\\nDROP TABLE ${SOURCE_TMP_DM_20150512_TEST15};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [360]-[index:545]-[2015年5月新增日累计指标]-[37]-['str' object has no attribute 'lfind']:{"name":"创建临时表TEST9","nodeId":"37","dsName":"GbaseDM","sql":"create table  ${SOURCE_TMP_DM_20150512_TEST9}\\n (\\tUSER_ID         VARCHAR(20),\\n\\tIS_GROUP_NORMS  SMALLINT\\t)\\nDISTRIBUTED BY ('USER_ID') nolock;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [361]-[index:546]-[2015年5月新增日累计指标]-[55]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"55.插入临时表TEST13数据","nodeId":"55","sql":"insert into ${SOURCE_TMP_DM_20150512_TEST13}      \\nselect\\tdistinct \\n        a.phone_no,\\n\\t\\ta.CUST_ID,\\n\\t\\tcase when f.cust_id is not null then 1 else 0 end,\\n\\t    i.EMPTY_CRAD_SEQ_NO,\\n\\t    nvl(j.call_duration_m,0),\\n\\t    nvl(l.PLAN_ID,0),\\n\\t    m.REALNAME_FLAG,\\n\\t    n.DONE_DATE\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_DS_YYYYMMDD} a\\nleft join (select distinct cust_id,ACPT_DATE done_date\\n\\t\\t   from gbasedwd.DWD_PRTY_CUST_EXTEN_DS_${dayid}\\n\\t\\t   where ATTRDEF_ID='10' and CUST_ATTR_VAL='Y') f  on a.cust_id=f.cust_id\\nleft join (select phone_no,EMPTY_CRAD_SEQ_NO\\n\\t\\t   from (select row_number() over(PARTITION by PHONE_NO order by ACPT_DATE desc) aa,\\n\\t\\t\\t\\t\\t\\tphone_no,EMPTY_CRAD_SEQ_NO from ${SOURCE_DWD_RES_SVC_SIM_DS_YYYYMMDD} a\\n\\t\\t\\t\\t where MANG_STATE='5' and IS_USE='1') aa where aa='1') i\\n\\ton a.phone_no=i.phone_no\\nleft join (select phone_no,sum(CALL_DUR) call_duration_m\\n\\t\\t   from ${SOURCE_DWD_EVT_CDR_VOC_BASETOT_DM_YYYYMM}\\n\\t\\t   where OPP_CARR_ID = '01' and ROAM_TYPE in (1,7) and CALL_TYPE = 1\\n\\t\\t     and TOLL_TYPE in (1,7) and STAT_DATE<='${day_id}' group by phone_no ) j\\n\\ton  a.phone_no=j.phone_no\\nleft join (select phone_no,\\n\\t\\t\\t\\t  max(case when EFF_TIME <= '${day_id}' then a.PLAN_ID end) as plan_id\\n           from ${SOURCE_DWI_INST_OFFER_PLAN_DS_YYYYMMDD} a \\n\\t\\t   group by phone_no\\n\\t\\t   ) l\\n\\ton a.phone_no=l.phone_no\\nleft join ${SOURCE_DWI_USR_PESN_ALLCUST_DS_YYYYMMDD} M ON A.CUST_ID = M.CUST_ID\\nLEFT JOIN (select distinct bill_id,max(done_date) done_date \\n           from gbaseods.ods_d_f_crm_02611_user_contact_info_${dayid} group by 1) n ON A.PHONE_NO=n.bill_id\\nwhere (a.ONNET_USER_FLAG=1 AND a.PROD_KIND_CODE='171000000001') or a.MONTH_OFF_FLAG =1"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [362]-[index:547]-[2015年5月新增日累计指标]-[35]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"35.插入临时表TEST10","nodeId":"35","sql":"insert into  ${SOURCE_TMP_DM_20150512_TEST10}\\nselect \\ta.phone_no,\\n\\t\\tcase when b.phone_no is null and create_time='${day_id}' then 1 else 0 end\\nfrom (select row_number () over(PARTITION by a.phone_no order by CREATE_BILL_TIME desc) aa,\\n\\t\\t\\t a.phone_no,date(a.CREATE_BILL_TIME) create_time\\n\\t  from ${SOURCE_DWI_INST_ORD_LIST_DM_YYYYMM} a\\n      inner join (select distinct a.phone_no\\n\\t\\t\\t\\t  from ${SOURCE_DWD_RES_SVC_SIM_DS_YYYYMMDD}  a\\n\\t\\t\\t\\t  left join ${SOURCE_DWD_RES_SVC_MKT_SPEC_DS_YYYYMMDD} b\\n\\t\\t\\t\\t\\t\\ton  a.RES_SPEC_ID =b.res_spec_id\\n\\t\\t\\t\\t  where b.RES_NAME like '%USIM%' and MANG_STATE =5 and IS_USE=1) b\\n\\t\\t on a.phone_no=b.phone_no where a.ORD_TYPE in('补卡','换卡') \\n\\t\\t) a\\nleft join (select distinct a.phone_no from ${SOURCE_DWD_RES_SVC_SIM_DS_PYYYYMMDD}  a\\n\\t\\t   left join ${SOURCE_DWD_RES_SVC_MKT_SPEC_DS_PYYYYMMDD}  b\\n\\t\\t\\t\\ton a.RES_SPEC_ID =b.RES_SPEC_ID\\n\\t\\t   where b.RES_NAME like '%USIM%' and MANG_STATE =5 and IS_USE=1) b\\n\\ton a.phone_no=b.phone_no\\nwhere aa='1'"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [363]-[index:551]-[newbusi个人客户月视图自动生成程序月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_NEWBUSI_${monthid};\\ncreate table DM_AUTORPT_NEWBUSI_${monthid} distributed by ('PRODUCT_NO') as select * from  DM_AUTORPT_NEWBUSI_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [364]-[index:552]-[newbusi个人客户月视图自动生成程序月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_NEWBUSI_${monthid} select * from DM_AUTORPT_NEWBUSI_${monthid}@dblink_dm;\\n","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [365]-[index:558]-[校园用户视图]-[9]-['str' object has no attribute 'lfind']:{"name":"9.SQL语句","nodeId":"9","dsName":"GbaseDM","sql":"insert into  ${DM_PUB_SCHOOL_INFO_YYYYMMDD}\\n(  OP_TIME        ,\\n   PRODUCT_NO     ,\\n   ADVERSARY_ID   ,\\n   JOIN_DATE      ,\\n   COUNTY_NAME    ,\\n   CAMPUS_NAME  )\\nselect\\n   '${day_id}',\\n   a.product_no    ,\\n   case when a.adversary_id=1 then '01'\\n        when a.adversary_id=2 then '02'\\n        when a.adversary_id=3 then '03'\\n    end adversary_id,\\n   a.JOIN_DATE,\\n   case when a.county_name='城区二分公司' then 1\\n        when a.county_name='城区一分公司' then  4\\n        when a.county_name='昌平分公司'  then  5\\n        when a.county_name='顺义分公司'  then  6\\n        when a.county_name='通州分公司'  then  7\\n        when a.county_name='房山分公司'  then  8\\n        when a.county_name='大兴分公司'  then  9\\n        when a.county_name='平谷分公司'  then  10\\n        when a.county_name='延庆分公司'  then  11\\n        when a.county_name='密云分公司'  then  12\\n        when a.county_name='怀柔分公司'  then  13\\n        when a.county_name='城区三分公司' then 14\\n        else 0 end county_name,\\n   a.campus_name\\nfrom (select product_no,date(join_date) join_date,date(newest_join_date) newest_join_date,\\n             1 adversary_id,\\n             county_name ,\\n             campus_name\\n        from gbasedwd.dwd_svc_usr_jiangxi_campus_ds_${dayid}\\n        union all\\n      select product_no,date(join_date) join_date,date(newest_join_time) newest_join_date,\\n             case when adversary_id ='03' then 2 else 3 end adversary_id,\\n             county_name,\\n             campus_name\\n        from gbasedwd.dwd_svc_usr_jiangxi_comp_campus_ds_${dayid}) a;\\n\\n# gbasedwd.dwd_cell_all_campus_product_${dayid} a\\n#\\tselect   a.STAT_DATE ,\\n#             a.PHONE_NO    ,\\n#             a.adversary_id   ,\\n#             trim(case when b.product_no is null then '${day_id}' else b.join_date end) as JOIN_DATE,\\n#             a.FIR_STU_COUNTY_NAME    ,\\n#             a.FIR_STU_SCH_NAME\\n#   from (\\tselect  STAT_DATE,PHONE_NO  ,'01' as adversary_id ,FIR_STU_DATE ,\\n#          case when FIR_STU_COUNTY_NAME='城区二分公司' then 1\\n#          when FIR_STU_COUNTY_NAME='城区一分公司'  then  4\\n#\\t        when FIR_STU_COUNTY_NAME='昌平分公司'  then  5\\n#\\t        when FIR_STU_COUNTY_NAME='顺义分公司'  then  6\\n#\\t        when FIR_STU_COUNTY_NAME='通州分公司'  then  7\\n#\\t        when FIR_STU_COUNTY_NAME='房山分公司'  then  8\\n#\\t        when FIR_STU_COUNTY_NAME='大兴分公司'  then  9\\n#\\t        when FIR_STU_COUNTY_NAME ='平谷分公司'  then  10\\n#\\t        when FIR_STU_COUNTY_NAME='延庆分公司'  then  11\\n#\\t        when FIR_STU_COUNTY_NAME='密云分公司'  then  12\\n#\\t        when FIR_STU_COUNTY_NAME='怀柔分公司'  then  13\\n#\\t        when FIR_STU_COUNTY_NAME='城区三分公司' then 14 else 0 end FIR_STU_COUNTY_NAME ,\\n#\\t        FIR_STU_SCH_NAME\\n#\\t   from gbasedwi.DWI_TMT_SCH_LOCALNET_DS_${dayid}\\n#\\t    union all\\n#\\t    select STAT_DATE,PHONE_NO,CARR,FIR_STU_DATE as  adversary_id         ,\\n#             case when FIR_STU_COUNTY_NAME='城区二分公司' then 1\\n#             when FIR_STU_COUNTY_NAME='城区一分公司'  then  4\\n#             when FIR_STU_COUNTY_NAME='昌平分公司'  then  5\\n#             when FIR_STU_COUNTY_NAME='顺义分公司'  then  6\\n#             when FIR_STU_COUNTY_NAME='通州分公司'  then  7\\n#             when FIR_STU_COUNTY_NAME='房山分公司'  then  8\\n#             when FIR_STU_COUNTY_NAME='大兴分公司'  then  9\\n#             when FIR_STU_COUNTY_NAME ='平谷分公司'  then  10\\n#             when FIR_STU_COUNTY_NAME='延庆分公司'  then  11\\n#             when FIR_STU_COUNTY_NAME='密云分公司'  then  12\\n#             when FIR_STU_COUNTY_NAME='怀柔分公司'  then  13\\n#             when FIR_STU_COUNTY_NAME='城区三分公司' then 14 else 0 end FIR_STU_COUNTY_NAME ,\\n#             FIR_STU_SCH_NAME\\n#       from gbasedwi.DWI_TMT_SCH_COMPETITOR_DS_${dayid}    ) a\\n#left join DM_PUB_SCHOOL_INFO_${pdayid}  b  on a.phone_no=b.product_no\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [366]-[index:562]-[用户资料--DM_AUTORPT_BASE_INFO_YYYYMM]-[9]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"9.插入目标表数据","nodeId":"9","sql":"INSERT INTO ${TARGET_DM_AUTORPT_BASE_INFO_YYYYMM}\\n(\\t OP_TIME\\n\\t,STATIS_MONTH\\n\\t,USER_ID\\n\\t,PRODUCT_NO\\n\\t,I0414\\n\\t,I0415\\n\\t,I0416\\n\\t,I0417\\n\\t,I0418\\n\\t,I0419\\n\\t,I0420\\n\\t,I0421\\n\\t,I0422\\n\\t,I0423\\n\\t,I0424\\n\\t,I0425\\n\\t,I0426\\n\\t,I0427\\n\\t,I0428\\n\\t,I0429\\n\\t,I0430\\n\\t,I0431\\n\\t,I0432\\n\\t,I0433\\n\\t,I0434\\n\\t,I0435\\n\\t,I0437\\n\\t,I0438\\n\\t,I0439\\n\\t,I0440\\n\\t,I0441\\n\\t,I0442\\n\\t,I0443\\n\\t,I0444\\n\\t,I0968\\n\\t,I2001\\t)\\nSELECT '${curm_first_day}'         OP_TIME\\n       ,'${monthid}'              STATIS_MONTH\\n       ,A.USER_ID\\n       ,A.PHONE_NO             PRODUCT_NO\\n\\t   ,NULL\\t\\t\\t\\t\\tI0414\\n\\t   ,NVL(B.CUR_SCORE_BALANCE,0)\\tI0415\\n\\t   ,A.SUB_BRAND_ID\\t\\t\\t\\tI0416\\n\\t   ,NVL(C.DEPT_COUNTY_ID,0)\\t\\tI0417\\n\\t   ,NVL(C.DEPT_SUBAREA_ID,0)\\tI0418\\n\\t   ,NVL(D.SUB_BRAND_ID1,0)\\t\\tI0419\\n\\t   ,NVL(E.USER_STATE,0)\\t\\t\\tI0420\\n\\t   ,to_char(date('${curm_first_day}'),'yyyy')*12 + to_char(date('${curm_first_day}'),'mm')-TO_CHAR(nvl(DATE(a.INNET_DATE),DATE('2001-01-01')),'YYYY')*12-to_char(nvl(DATE(a.INNET_DATE),DATE('2001-01-01')),'mm')+1  I0421\\n\\t   ,trim(t.cust_type)\\t\\t\\tI0422\\n\\t   ,NULL\\t\\t\\t\\t\\t\\tI0423\\n\\t   ,NVL(A.MONTH_NEW_FLAG,0)\\t\\tI0424\\n\\t   ,DATE(A.INNET_DATE)\\t\\t\\tI0425\\n\\t   ,null\\t\\t\\t\\t\\t\\tI0426\\t\\t/*first_valid_calltime*/\\n\\t   ,F.ACTIVE_TIME\\t\\t\\t\\tI0427\\n\\t   ,NULL\\t\\t\\t\\t\\t\\tI0428\\n\\t   ,E.LTLY_CHG_TIME\\t\\t\\t\\tI0429\\n\\t   ,NULL\\t\\t\\t\\t\\t\\tI0430\\n\\t   ,NULL\\t\\t\\t\\t\\t\\tI0431\\n\\t   ,NULL\\t\\t\\t\\t\\t\\tI0432\\n\\t   ,NVL(D.SUB_BRAND_ID1,0)\\t\\tI0433\\n\\t   ,CASE WHEN NVL(H.SHOULD_INCOME,0)>0 THEN 1 ELSE 0 END\\tI0434\\n\\t   ,NVL(C.DEPT_AREA_ID,0)\\t\\tI0435\\n\\t   ,NULL\\t\\t\\t\\t\\t\\tI0437\\n\\t   ,NULL                        I0438\\n\\t   ,NULL                        I0439\\n\\t   ,case when a.bass_user_state=12 then 1 else 0 end   I0440 -- 当月是否有过停机\\n\\t   ,NULL\\t\\t\\t\\t\\t\\tI0441\\n\\t   ,NVL(G.TD_INFOPHONE_FLG,0)\\tI0442\\n\\t   ,NVL(G.TD_BOOK_FLG,0)\\t\\tI0443\\n\\t   ,NVL(G.TD_MOBILE_FLG,0)\\t\\tI0444\\n\\t   ,NVL(G.TD_CRD_FLG,0)\\t\\t\\tI0968\\n\\t   ,NVL(A.MONTH_ARRIVE_FLAG,0)\\tI2001\\nFROM ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} A\\nLEFT JOIN (SELECT PHONE_NO,MAX(NVL(CUR_SCORE_BALANCE,0)) CUR_SCORE_BALANCE \\n\\t\\t   FROM ${SOURCE_DWI_INCO_BILL_USER_SCORE_DT_YYYYMMDD} GROUP BY PHONE_NO) B \\n\\tON A.PHONE_NO=B.PHONE_NO\\nLEFT JOIN ${SOURCE_DWI_USR_PESN_PERSN_LOC_MS_YYYYMM} C\\tON A.PHONE_NO=C.PHONE_NO\\nLEFT JOIN ${SOURCE_DIM_PRODUCT_SUBBRAND} D ON A.SUB_BRAND_ID=D.SUB_BRAND_ID\\nLEFT JOIN ${SOURCE_DWA_UV_USER_BASEINFO_MS_YYYYMM} E ON A.PHONE_NO = E.PHONE_NO\\nLEFT JOIN ${SOURCE_DWI_RES_NAC_CODE_NUM_DT_YYYYMMDD} F ON A.PHONE_NO=F.PHONE_NO\\nLEFT JOIN ${SOURCE_DW_TD_PRODUCT_MSG_CYCLE03_YYYYMM} G ON G.SUBS_ID=A.PHONE_NO\\n/*left join (select distinct phone_no from gbasedwd.DWD_ACC_OWE_REMD_MS_${monthid}\\n\\t\\t   where CREDIT_PLAN_ID = 100 and DEAL_RESULT = '000' \\n\\t\\t     and CUR_WARN_LVL in (11,14,12,15,13,16,17,83,85)\\n\\t\\t\\t ) z on a.phone_no=z.phone_no*/\\nLEFT JOIN (SELECT PHONE_NO,SUM(SHOULD_INCOME) SHOULD_INCOME \\n\\t\\t   FROM ${SOURCE_DWI_INCO_BILL_ITEM_TOT_MS_YYYYMM} GROUP BY PHONE_NO) H ON A.PHONE_NO=H.PHONE_NO\\nleft join (select product_no,swb||sj||sjk||wxzj as cust_type\\n\\t\\t   from (select product_no,max(swb) as swb,max(sj) as sj,max(sjk) as sjk,max(wxzj) as wxzj \\n\\t\\t\\t\\t from  (select MSISDN product_no,\\n\\t\\t\\t\\t\\t\\t\\t   case when TD_BOOK_FLG=1 then 'G3上网本客户' else '' end as swb,\\n\\t\\t\\t\\t\\t\\t\\t   case when b.td_mobile_flg=1 and b.tac_id not in ('86006100','86010300','86015000','86035600') then 'G3手机客户' else '' end as sj,\\n\\t\\t\\t\\t\\t\\t\\t   case when b.TD_CRD_FLG = 1 then 'G3数据卡客户' else '' end as sjk,\\n\\t\\t\\t\\t\\t\\t\\t   case when b.TD_INFOPHONE_FLG=1 then 'G3无线座机客户' else '' end as wxzj\\n\\t\\t\\t\\t\\t\\tfrom gbasebas.DW_TD_PRODUCT_MSG_CYCLE03_${monthid} b) aa \\n\\t\\t\\t\\t\\t\\tgroup by product_no) bb) t ON A.PHONE_NO=T.PRODUCT_NO\\nWHERE (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001\\n-- (A.ONNET_USER_FLAG=1 AND A.PROD_KIND_CODE='171000000001') or A.MONTH_OFF_FLAG =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [367]-[index:565]-[竞争对手日累计视图]-[97]-['str' object has no attribute 'lfind']:{"name":"97.SQL语句","nodeId":"97","dsName":"GbaseDM","sql":"drop table dm_pub_competitor_dt_${dayid};\\nCREATE TABLE dm_pub_competitor_dt_${dayid} (\\n  OP_TIME date,\\n  COMP_PRODUCT_NO varchar(20),\\n  DEPT_COUNTY_ID smallint(6),\\n  ADVERSARY_ID varchar(20),\\n  OUT_CALL_DURATION bigint(20),\\n  IN_CALL_DURATION bigint(20),\\n  CALL_PRODUCT_NUMBER bigint(20),\\n  IS_VNO smallint(6),\\n    grid_id bigint(20),\\n\\tregional_center_id   bigint  -- 经营网格\\n) ENGINE=EXPRESS DISTRIBUTED BY('comp_product_no') DEFAULT CHARSET=utf8 TABLESPACE='sys_tablespace'","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [368]-[index:566]-[竞争对手日累计视图]-[63]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"63.目标表数据插入","nodeId":"63","sql":"insert into  ${DM_PUB_COMPETITOR_DT_YYYYMMDD}\\n (\\tOP_TIME ,\\n\\tCOMP_PRODUCT_NO ,\\n\\tDEPT_COUNTY_ID ,\\n\\tADVERSARY_ID ,\\n\\tOUT_CALL_DURATION ,\\n\\tIN_CALL_DURATION ,\\n\\tCALL_PRODUCT_NUMBER,\\n    IS_VNO,\\n\\tgrid_id,\\n\\tregional_center_id)  \\nselect\\ta.STAT_DATE,\\n\\t\\ta.CMPT_PHONE_NO,\\n\\t\\ta.BELNG_DEPT_COUNTY_ID,\\n\\t\\tcase when a.CARR_NAME='联通' then 1 when a.CARR_NAME='电信' then 2  end,\\n\\t\\tb.MT_CALING_CALL_DUR,\\n\\t\\tb.MT_CALLED_DUR,\\n\\t\\tnvl(c.CALL_PRODUCT_NUMBER,0),\\n\\t       a.virt_carr_flag as is_vno, /*--是否虚拟运营商号码 1 是 0 否*/\\n\\t\\t   a.grid_id,\\n\\t\\t   n.regional_center_id\\nfrom gbasedwi.DWI_BEH_USE_OPP_TOT_DS_${dayid} a\\nleft join (select distinct grid_id,grid_name,regional_center_id,regional_center_name from gbasedwd.dim_pub_cell) n on a.grid_id=n.grid_id\\nleft join gbasedwi.DWI_BEH_USE_INTERCONNECTION_DS_${dayid} b on a.CMPT_PHONE_NO = b.CMPT_PHONE_NO\\nleft join DM_PUB_TMP_COMP_CALL_${dayid} c on a.CMPT_PHONE_NO =c. COMP_PRODUCT_NO\\nwhere CARR_NAME in ('联通','电信')"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [369]-[index:567]-[竞争对手日累计视图]-[94]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据2","nodeId":"94","sql":"insert into ${TMP1_DM_PUB_COMP_CALL_YYYYMMDD}\\nselect a.CMPT_PHONE_NO,'1'  \\nfrom (select distinct CMPT_PHONE_NO from gbasedwi.DWI_BEH_USE_OPP_BASETOT_DS_${dayid} \\n\\t\\twhere CMPT_CARR  in ('02','03') ) a\\nleft join DM_PUB_TMP_COMP_CALL_${pdayid} b on a.CMPT_PHONE_NO=b.COMP_PRODUCT_NO\\nwhere b.COMP_PRODUCT_NO is null"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [370]-[index:568]-[竞争对手日累计视图]-[90]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入临时表的数据","nodeId":"90","sql":"insert into  ${TMP1_DM_PUB_COMP_CALL_YYYYMMDD}\\n (\\tCOMP_PRODUCT_NO,\\n\\tCALL_PRODUCT_NUMBER\\t)\\nselect  distinct CMPT_PHONE_NO,\\n\\t\\tb.CALL_PRODUCT_NUMBER+1\\nfrom gbasedwi.DWI_BEH_USE_OPP_BASETOT_DS_${dayid} a   \\ninner join DM_PUB_TMP_COMP_CALL_${pdayid} b on a.CMPT_PHONE_NO = b.COMP_PRODUCT_NO\\nwhere a.CMPT_CARR in ('02','03')"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [371]-[index:571]-[竞争对手日累计视图]-[71]-['str' object has no attribute 'lfind']:{"name":"创建临时表","nodeId":"71","dsName":"GbaseDM","sql":"drop table ${TMP1_DM_PUB_COMP_CALL_YYYYMMDD};\\n\\n create table ${TMP1_DM_PUB_COMP_CALL_YYYYMMDD}\\n            (\\n             COMP_PRODUCT_NO      VARCHAR(20),\\n             CALL_PRODUCT_NUMBER  SMALLINT\\n            )DISTRIBUTED BY('COMP_PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [372]-[index:572]-[竞争对手日累计视图]-[53]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"53.本月1号数据插入","nodeId":"53","sql":"insert into  ${DM_PUB_COMPETITOR_DT_YYYYMMDD}\\n (\\tOP_TIME ,\\n\\tCOMP_PRODUCT_NO ,\\n\\tDEPT_COUNTY_ID ,\\n\\tADVERSARY_ID ,\\n\\tOUT_CALL_DURATION ,\\n\\tIN_CALL_DURATION ,\\n\\tCALL_PRODUCT_NUMBER ,\\n\\tIS_VNO,\\n\\tgrid_id,\\n\\tregional_center_id)  \\nselect\\ta.STAT_DATE,\\n\\t\\ta.CMPT_PHONE_NO,\\n\\t\\ta.BELNG_DEPT_COUNTY_ID,\\n\\t\\tcase when a.CARR_NAME='联通' then 1 when a.CARR_NAME='电信' then 2  end,\\n\\t\\tb.MT_CALING_CALL_DUR,\\n\\t\\tb.MT_CALLED_DUR,\\n\\t\\tnvl(c.CALL_PRODUCT_NUMBER,0),\\n\\t\\ta.virt_carr_flag as is_vno, /*--是否虚拟运营商号码 1 是 0 否*/\\n\\t\\ta.grid_id,\\n\\t\\tn.regional_center_id\\nfrom gbasedwi.DWI_BEH_USE_OPP_TOT_DS_${dayid} a\\nleft join (select distinct grid_id,grid_name,regional_center_id,regional_center_name from gbasedwd.dim_pub_cell) n on a.grid_id=n.grid_id\\nleft join gbasedwi.DWI_BEH_USE_INTERCONNECTION_DS_${dayid} b on a.CMPT_PHONE_NO = b.CMPT_PHONE_NO\\nleft join DM_PUB_TMP_COMP_CALL_${dayid} c on a.CMPT_PHONE_NO =c. COMP_PRODUCT_NO\\nwhere CARR_NAME in ('联通','电信')"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [373]-[index:573]-[竞争对手日累计视图]-[72]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"72.插入临时表的数据","nodeId":"72","sql":" insert into  ${TMP1_DM_PUB_COMP_CALL_YYYYMMDD}\\n                    (\\n                             COMP_PRODUCT_NO      ,\\n                             CALL_PRODUCT_NUMBER      \\n                     )\\n         select   distinct   \\n                  CMPT_PHONE_NO ,\\n                   '1'\\n                     from gbasedwi.DWI_BEH_USE_OPP_BASETOT_DS_${curmfirstday}   a   \\n                   where   a.CMPT_CARR in ('02','03')\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [374]-[index:575]-[竞争对手日累计视图]-[87]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"87.创建临时表","nodeId":"87","sql":"drop table ${TMP1_DM_PUB_COMP_CALL_YYYYMMDD};\\n\\n create table ${TMP1_DM_PUB_COMP_CALL_YYYYMMDD}\\n            (\\n             COMP_PRODUCT_NO      VARCHAR(20),\\n             CALL_PRODUCT_NUMBER  SMALLINT\\n            )DISTRIBUTED BY('COMP_PRODUCT_NO')"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [375]-[index:578]-[个人日视图数据同步]-[7]-['str' object has no attribute 'lfind']:{"name":"7.插入","nodeId":"7","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_20190730_DAY_${dayid} \\n(select * from   \\nDM_PUB_20190730_DAY_${dayid}@dblink_dm);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [376]-[index:579]-[个人日视图数据同步]-[30]-['str' object has no attribute 'lfind']:{"name":"6.创建表","nodeId":"6","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_20190730_DAY_${dayid};\\nCREATE TABLE  DM_PUB_20190730_DAY_${dayid} distributed by('product_no')  as\\nselect * from DM_PUB_20190730_DAY_YYYYMMDD\\t;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [377]-[index:584]-[个人市场收入明细（月累计）]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"gbasegrid","dsName":"gbasegrid","schema_union":"gbasegrid","schema_dev":"gbasegrid","schema_prod":"gbasegrid","queue_union":"","queue_dev":"","queue_prod":"","name":"5.维表","nodeId":"5","sql":"drop table dm.dim_grid_grid_id;\\ncreate table dm.dim_grid_grid_id\\nselect distinct grid_id,grid_name from gbasedwd.dim_pub_cell\\n;\\ninsert into dm.dim_grid_grid_id VALUES\\n('0','不详');\\n\\ndrop table dm.dim_grid_regional_center_id;\\ncreate table dm.dim_grid_regional_center_id\\nselect distinct regional_center_id,regional_center_name from gbasedwd.dim_pub_cell\\n;\\ninsert into dm.dim_grid_regional_center_id VALUES\\n('0','不详');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [378]-[index:585]-[个人市场收入明细（月累计）]-[7]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"7.导表","nodeId":"7","sql":"drop table dm.dm_grid_dw_grid_detail_ds_${dayid};\\ncreate table dm.dm_grid_dw_grid_detail_ds_${dayid} distributed by ('phone_no')\\nselect * from dm_grid_dw_grid_detail_ds_${dayid}@dblink_dm;\\n\\ndrop table dm.dim_grid_grid_id;\\ncreate table dm.dim_grid_grid_id\\nselect * from dim_grid_grid_id@dblink_dm;\\n\\ndrop table dm.dim_grid_regional_center_id;\\ncreate table dm.dim_grid_regional_center_id\\nselect * from dim_grid_regional_center_id@dblink_dm;\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [379]-[index:586]-[个人市场收入明细（月累计）]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"gbasegrid","dsName":"gbasegrid","schema_union":"gbasegrid","schema_dev":"gbasegrid","schema_prod":"gbasegrid","queue_union":"","queue_dev":"","queue_prod":"","name":"3.创建结果表","nodeId":"3","sql":"drop table dm.dm_grid_dw_grid_detail_ds_${dayid};\\ncreate table dm.dm_grid_dw_grid_detail_ds_${dayid} distributed by ('phone_no')\\nselect a.op_time,\\n       phone_no,\\n\\t   date(innet_date) as innet_date,\\n\\t   fee_type,\\n\\t   plan_id,\\n\\t   plan_name,\\n\\t   create_time,\\n\\t   grid_county_id,\\n\\t   oper_grid_id,\\n\\t   a.grid_id,\\n\\t   b.chl_name as chl_id,\\n\\t   org_chl_sub_type_name as chl_name,\\n\\t   micro_county_id,\\n\\t   micro_oper_grid_id,\\n\\t   a.micro_name,\\n\\t   card_county_id,\\n\\t   target_cnt_m,\\n\\t   b.chl_short_name\\nfrom grid_dw_grid_110102_detail_${dayid} a\\nleft join gbasegrid.dim_grid_chl_hall_union b on a.chl_id=b.chl_id\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [380]-[index:589]-[日用户资料表导入应用库日调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_USER_${dayid};\\ncreate table DM_PUB_USER_${dayid} distributed by ('product_no') as select * from DM_PUB_USER_YYYYMMDD;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [381]-[index:590]-[日用户资料表导入应用库日调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_USER_${dayid}(\\n   OP_TIME     ,\\n   USER_ID     ,\\n   CUST_ID     ,\\n   ACCT_ID     ,\\n   PRODUCT_NO     ,\\n   PROD_CATALOG_ID     ,\\n   AGE     ,\\n   SEX_ID     ,\\n   INDUSTRY_ID     ,\\n   EDUCATION_ID     ,\\n   OCCUPATION_ID     ,\\n   CUSTSTATUS_ID     ,\\n   CUSTTYPE_ID     ,\\n   CUST_CLASS_ID     ,\\n   VIP_MARK     ,\\n   VIP_SCALE_ID     ,\\n   ENTERPRISE_ID     ,\\n   CITY_ID     ,\\n   COUNTY_ID     ,\\n   DEPT_ID     ,\\n   CHANNEL_ID     ,\\n   CHANNELTYPE_ID     ,\\n   USER_OPEN_ID     ,\\n   USER_INNET_ID     ,\\n   BRAND_ID     ,\\n   USERSTATUS_ID     ,\\n   LAST_USERSTATUS_ID     ,\\n   USER_OPENTIME     ,\\n   USER_OFFTIME     ,\\n   USERTYPE_ID     ,\\n   PLAN_ID     ,\\n   OFF_REASON_ID     ,\\n   ENTERPRISE_MARK     ,\\n   MONTH_ARRIVE_MARK     ,\\n   MONTH_NEW_MARK     ,\\n   MONTH_OFF_MARK     ,\\n   VPMN_MARK     ,\\n   SUB_USERSTATUS_ID     ,\\n   LASTSUB_USERSTATUS_ID     ,\\n   DEAL_OPERATOR     ,\\n   USER_NAME     ,\\n   CUST_NAME     ,\\n   SUB_BRAND_ID     ,\\n   ENTERPRISE_SCALE_ID     ,\\n   CUST_ADDRESS     ,\\n   CUST_SVC_NO     ,\\n   BA_SVC_NO     ,\\n   IDEN_ID     ,\\n   IDEN_NO     ,\\n   USER_GRADE     ,\\n   PASS_GRADE     ,\\n   WATCH_FLAG     ,\\n   POST_BILL_FLAG     ,\\n   ROAM_TYPE     ,\\n   PAYBILL_FLAG     ,\\n   BILL_TYPE     ,\\n   STOP_CALL_FLAG     ,\\n   IMSI_NO     ,\\n   SIM_NO     ,\\n   VALID_NEW_MARK     ,\\n   FIRST_VALID_CALLTIME     ,\\n   FIRST_UNVALID_CALLTIME     ,\\n   FIRST_CHARGETIME     ,\\n   POST_CODE     ,\\n   SUB_BILL_ID     ,\\n   INNET_TIME     ,\\n   ACTIVE_DATE     ,\\n   PRE_DESTORY_TIME     ,\\n   LAST_TRANS_DATE     ,\\n   CREDIT_LEVEL     ,\\n   CREDIT_AMOUNT     ,\\n   ADDRESS_ID     ,\\n   EXCHANGE_ID     ,\\n   IS_OUT_NET     ,\\n   BAL_ORG_ID     ,\\n   CONT_ID     ,\\n   RISK_FLAG     ,\\n   CREATOR_NO     ,\\n   CREATE_ORGID     ,\\n   DONE_CODE     ,\\n   CREATE_DATE     ,\\n   DONE_DATE     ,\\n   DAY_NEW_MARK     ,\\n   DAY_OFF_MARK     ,\\n   STOP_LEVEL     ,\\n   F_CHANNEL_ID     ,\\n   F_DEPT_ID     ,\\n   BIND_MARK     ,\\n   BINDSTART_DATE     ,\\n   BINDEND_DATE     ,\\n   TD_MARK     ,\\n   CS_ZGD_MARK     ,\\n   IS_CHANGE_USIM     ,\\n   IS_HANDLE_4G     ,\\n   IS_TERMINAL_4G     ,\\n   IS_MIFI_4G     ,\\n   TERMINAL_4G     ,\\n   IS_TEST_4G     ,\\n   IS_YIJINGPHONE_USER     ,\\n   ZEROCALL_CUR_FLAG     ,\\n   ZEROCALL_H_FLAG     ,\\n   REPAY_SCORE     ,\\n   EXPIRE_SCORE     ,\\n   BALANCE_AMOUNT     ,\\n   IS_YIJING_ZEROCALL     ,\\n   VIP_SCALE_ID1     ,\\n   IS_SCROE_THREE     ,\\n   IS_SCROE_SIX     ,\\n   SUB_BRAND_ID1     ,\\n   IMEI ,\\n   GRID_ID) \\nselect \\n   OP_TIME     ,\\n   USER_ID     ,\\n   CUST_ID     ,\\n   ACCT_ID     ,\\n   PRODUCT_NO     ,\\n   PROD_CATALOG_ID     ,\\n   AGE     ,\\n   SEX_ID     ,\\n   INDUSTRY_ID     ,\\n   EDUCATION_ID     ,\\n   OCCUPATION_ID     ,\\n   CUSTSTATUS_ID     ,\\n   CUSTTYPE_ID     ,\\n   CUST_CLASS_ID     ,\\n   VIP_MARK     ,\\n   VIP_SCALE_ID     ,\\n   ENTERPRISE_ID     ,\\n   CITY_ID     ,\\n   COUNTY_ID     ,\\n   DEPT_ID     ,\\n   CHANNEL_ID     ,\\n   CHANNELTYPE_ID     ,\\n   USER_OPEN_ID     ,\\n   USER_INNET_ID     ,\\n   BRAND_ID     ,\\n   USERSTATUS_ID     ,\\n   LAST_USERSTATUS_ID     ,\\n   USER_OPENTIME     ,\\n   USER_OFFTIME     ,\\n   USERTYPE_ID     ,\\n   PLAN_ID     ,\\n   OFF_REASON_ID     ,\\n   ENTERPRISE_MARK     ,\\n   MONTH_ARRIVE_MARK     ,\\n   MONTH_NEW_MARK     ,\\n   MONTH_OFF_MARK     ,\\n   VPMN_MARK     ,\\n   SUB_USERSTATUS_ID     ,\\n   LASTSUB_USERSTATUS_ID     ,\\n   DEAL_OPERATOR     ,\\n   USER_NAME     ,\\n   CUST_NAME     ,\\n   SUB_BRAND_ID     ,\\n   ENTERPRISE_SCALE_ID     ,\\n   CUST_ADDRESS     ,\\n   CUST_SVC_NO     ,\\n   BA_SVC_NO     ,\\n   IDEN_ID     ,\\n   IDEN_NO     ,\\n   USER_GRADE     ,\\n   PASS_GRADE     ,\\n   WATCH_FLAG     ,\\n   POST_BILL_FLAG     ,\\n   ROAM_TYPE     ,\\n   PAYBILL_FLAG     ,\\n   BILL_TYPE     ,\\n   STOP_CALL_FLAG     ,\\n   IMSI_NO     ,\\n   SIM_NO     ,\\n   VALID_NEW_MARK     ,\\n   FIRST_VALID_CALLTIME     ,\\n   FIRST_UNVALID_CALLTIME     ,\\n   FIRST_CHARGETIME     ,\\n   POST_CODE     ,\\n   SUB_BILL_ID     ,\\n   INNET_TIME     ,\\n   ACTIVE_DATE     ,\\n   PRE_DESTORY_TIME     ,\\n   LAST_TRANS_DATE     ,\\n   CREDIT_LEVEL     ,\\n   CREDIT_AMOUNT     ,\\n   ADDRESS_ID     ,\\n   EXCHANGE_ID     ,\\n   IS_OUT_NET     ,\\n   BAL_ORG_ID     ,\\n   CONT_ID     ,\\n   RISK_FLAG     ,\\n   CREATOR_NO     ,\\n   CREATE_ORGID     ,\\n   DONE_CODE     ,\\n   CREATE_DATE     ,\\n   DONE_DATE     ,\\n   DAY_NEW_MARK     ,\\n   DAY_OFF_MARK     ,\\n   STOP_LEVEL     ,\\n   F_CHANNEL_ID     ,\\n   F_DEPT_ID     ,\\n   BIND_MARK     ,\\n   BINDSTART_DATE     ,\\n   BINDEND_DATE     ,\\n   TD_MARK     ,\\n   CS_ZGD_MARK     ,\\n   IS_CHANGE_USIM     ,\\n   IS_HANDLE_4G     ,\\n   IS_TERMINAL_4G     ,\\n   IS_MIFI_4G     ,\\n   TERMINAL_4G     ,\\n   IS_TEST_4G     ,\\n   IS_YIJINGPHONE_USER     ,\\n   ZEROCALL_CUR_FLAG     ,\\n   ZEROCALL_H_FLAG     ,\\n   REPAY_SCORE     ,\\n   EXPIRE_SCORE     ,\\n   BALANCE_AMOUNT     ,\\n   IS_YIJING_ZEROCALL     ,\\n   VIP_SCALE_ID1     ,\\n   IS_SCROE_THREE     ,\\n   IS_SCROE_SIX     ,\\n   SUB_BRAND_ID1     ,\\n   IMEI    ,\\n  GRID_ID\\n from  DM_PUB_USER_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [382]-[index:595]-[对端号码视图月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CALL_INFO_${monthid};\\ncreate table DM_PUB_CALL_INFO_${monthid} distributed by ('PRODUCT_NO') as select * from DM_PUB_CALL_INFO_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [383]-[index:596]-[对端号码视图月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CALL_INFO_${monthid} select * from DM_PUB_CALL_INFO_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [384]-[index:599]-[位置接口-手机用户位置明细表]-[12]-['str' object has no attribute 'lfind']:{"name":"12.SQL语句(5)","nodeId":"12","dsName":"BIGDB","sql":"drop table lop.tmp_base_user;\\ncreate table lop.tmp_base_user as\\nselect d.imsi,d.lac_ci,d.enter_time\\nfrom  (\\nselect imsi\\n,lac_ci\\n,timestamp(nvl(date(substr(exit_time,1,8))||substr(exit_time,9),date(substr(enter_time,1,8))||substr(enter_time,9))) as enter_time,\\nrow_number() over(partition by imsi order by nvl(exit_time,enter_time) desc) as n\\nfrom gbaseods.ods_h_a_otr_09011_loc_lac_ci_track_ds_${minutId}\\nwhere timestamp(nvl(date(substr(exit_time,1,8))||substr(exit_time,9),date(substr(enter_time,1,8))||substr(enter_time,9))) between\\n(timestamp(substr(to_char(timestamp(sys_time),'yyyymmddhh24miss'),1,11)||'000') - interval 4 minute ) and\\n(timestamp(substr(to_char(timestamp(sys_time),'yyyymmddhh24miss'),1,11)||'000') + interval 10 minute)\\n) d\\nwhere d.n<=1\\n;\\n\\ndrop table lop.tmp_base_phone;\\ncreate table lop.tmp_base_phone as\\nselect distinct '086'||cc.phone_no as phone_no,cc.imsi,dd.imei from lop.dim_intelligent_area cc\\nleft join gbasedwi.dwi_beh_use_steadyimei_ds_${p2dayid} dd on cc.phone_no=dd.phone_no\\nwhere cc.phone_no not in (select ac.phone_id from gbaseods.ods_d_f_bos_02104_important_user_data_${p2dayid} ac)\\n;\\n\\ninsert into lop.lop_st_user_location_detail_${minutId}\\nselect \\n b.phone_no as msisdn\\n,a.imsi\\n,b.imei\\n,case when c.county like '%东城%' then '110101' \\n when  c.county like '%西城%' then '110102' \\n when  c.county like '%崇文%' then '110103' \\n when  c.county like '%宣武%' then '110104' \\n when  c.county like '%朝阳%' then '110105' \\n when  c.county like '%丰台%' then '110106' \\n when  c.county like '%石景山%' then '110107' \\n when  c.county like '%海淀%'   then '110108' \\n when  c.county like '%门头沟%' then '110109' \\n when  c.county like '%房山%' then '110111' \\n when  c.county like '%通州%' then '110112' \\n when  c.county like '%顺义%' then '110113' \\n when  c.county like '%昌平%' then '110114' \\n when  c.county like '%大兴%' then '110115' \\n when  c.county like '%怀柔%' then '110116' \\n when  c.county like '%密云%' then '110118' \\n when  c.county like '%延庆%' then '110119' \\n when  c.county like '%平谷%' then '110117' else '10000' end as local_city\\n,'4' as location_source \\n,'' \\n,c.longitude \\n,c.latitude\\n,'' as height\\n,'2' as coordinate_system\\n,hex(to_number(c.lac_id)) as lacid\\n,hex(to_number(c.cell_id_trans)) as cellid\\n,a.enter_time as timestamp\\nfrom lop.tmp_base_user a \\nleft join gbasedwd.DIM_PUB_CELL c on a.lac_ci =concat(c.lac_id,'_',c.cell_id_trans)\\nleft outer join lop.tmp_base_phone b on a.imsi = b.imsi  \\nwhere CELL_ID_TRANS not in \\n(select a.CELL_ID_TRANS cell_id from gbasedwd.DIM_PUB_CELL a\\n  where a.cover_scene in ('党政军机关','党政军宿舍','武警军区')\\n  union \\n select b.CELL_ID_TRANS cell_id from gbasedwd.dim_pub_scene a\\n  inner join gbasedwd.DIM_PUB_CELL b\\n     on a.cell_id_10=b.cell_id_10 and a.cell_type=b.cell_type\\n    and a.second_zl in ('党政军机关','机关宿舍','机关驻地','政府机关')\\n)\\n;\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [385]-[index:600]-[位置接口-手机用户位置明细表]-[17]-['str' object has no attribute 'lfind']:{"name":"17.建表(3)","nodeId":"17","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_user_location_detail_${minutId};\\ncreate table if not exists lop.lop_st_user_location_detail_${minutId} (\\n  \\"msisdn\\" varchar(30) default null,  \\n  \\"imsi\\" varchar(30) default null,   \\n  \\"imei\\" varchar(30) default null,   \\n  \\"local_city\\" varchar(30) default null,  \\n  \\"location_source\\" int default null,  \\n  \\"precision\\" varchar(30) default null,  \\n  \\"longitude\\" double(10,7) default null,   \\n  \\"latitude\\" double(10,7) default null,   \\n  \\"height\\" varchar(30) default null,   \\n  \\"coordinate_system\\" varchar(30) default null,  \\n  \\"lacid\\" varchar(30) default null,  \\n  \\"cellid\\" varchar(30) default null,   \\n  \\"timestamp\\" varchar(30) default null   \\n) engine=express default charset=utf8 tablespace='sys_tablespace';","parentDsName":"BIGDB"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [386]-[index:602]-[渠道酬金020505日调度传输]-[6]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"6","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CHANNEL_020505_${dayid};\\nCREATE TABLE DM_PUB_CHANNEL_020505_${dayid} distributed by('channel_code')  as select * from DM_PUB_CHANNEL_020505_YYYYMMDD\\t;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [387]-[index:603]-[渠道酬金020505日调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"7","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CHANNEL_020505_${dayid} \\n(select * from   \\n ODS_D_F_OTR_020505_SOCIAL_SALE_${dayid}@dblink_ods);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [388]-[index:607]-[acct个人客户月视图自动生成程序月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_ACCT_${monthid};\\ncreate table DM_AUTORPT_ACCT_${monthid} distributed by ('PRODUCT_NO') as select * from DM_AUTORPT_ACCT_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [389]-[index:608]-[acct个人客户月视图自动生成程序月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_ACCT_${monthid} select * from DM_AUTORPT_ACCT_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [390]-[index:611]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[61]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"61.临时表08","nodeId":"61","sql":"drop table if exists dm.tmp_dm_autorpt_his_index_08_${monthid};\\nCREATE TABLE dm.tmp_dm_autorpt_his_index_08_${monthid} \\n (\\n  phone_no varchar(20) ,\\n  CALING_NUM decimal(42,0) , -- 主叫通话次数     \\n  CALLED_NUM decimal(42,0) , -- 被叫通话次数\\n  bhd_lgprs_res double(20,3) -- 饱和度国内流量资源\\n)distributed by ('phone_No');\\ninsert into dm.tmp_dm_autorpt_his_index_08_${monthid} \\nselect \\n      a.phone_no,\\n      b.CALING_NUM, -- 主叫通话次数\\n      b.CALLED_NUM, -- 被叫通话次数\\n      nvl(round(nvl(c.RES_USE_NUM,0)/nvl(c.RES_TOTAL_NUM,0),3),0) bhd_lgprs_res -- 饱和度国内流量资源\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid}  a\\nleft join \\n  ( \\n    select \\tphone_no,\\n            sum(CALL_NUM) CALL_NUM,-- 通话次数\\n            sum(CALING_NUM) CALING_NUM, -- 主叫通话次数\\n            sum(CALLED_NUM) CALLED_NUM  -- 被叫通话次数\\n    from gbasedwi.DWI_BEH_USE_VOC_USERTOT_MS_${monthid} \\n    group by phone_no\\n   ) b on a.phone_no=b.phone_no\\nleft join \\n     (   \\n       select phone_no,\\n              sum(case when b.item_code is not null then a.FREE_RES_USE_NUM else 0 end)/1024 RES_USE_NUM,    -- GPRS国内资源使用量 \\n              sum(case when b.item_code is not null then a.FREE_RES_TOTAL_NUM else 0 end)/1024 RES_TOTAL_NUM -- GPRS国内资源总量\\n       from gbasedwd.dwd_acc_offer_freeres_ms_${monthid}  a\\n       left join (\\n                   select item_code from dm.dim_pub_freeres_lty_itemcode group by item_code\\n                  ) b on a.item_code=b.item_code \\n\\t  where a.boss_prod_id not in ('54001105','53005095','50002352','54001809') \\n\\t\\t    and to_number(FREE_RES_total_NUM)<1000000000000000000    \\n       group by a.phone_no\\n       ) c on a.phone_no=c.phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [391]-[index:612]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[14]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"14.插入目标表","nodeId":"14","sql":"insert into ${TARGET_DM_AUTORPT_HIS_INDEX_YYYYMM}\\n (\\t OP_TIME\\n\\t,STATIS_MONTH        \\n\\t,PRODUCT_NO\\n\\t,HF0001\\n\\t,HF0002\\n\\t,HF0003\\n\\t,HF0004\\n\\t,HF0005\\n\\t,HF0006\\n\\t,HF0007\\n\\t,HF0008\\n\\t,HF0009\\n\\t,HF0010\\n\\t,HF0011\\n\\t,HF0012\\n\\t,HF0013\\n\\t,HF0014\\n\\t,HF0015\\n\\t,HF0016\\n\\t,HFGJ01\\n\\t,HFGJ01_1\\n\\t,HFGJ01_2\\n\\t,HFGJ01_3\\n\\t,HFGJ01_4\\n\\t,HFGJ02\\n\\t,HFGJ02_1\\n\\t,HFGJ02_2\\n\\t,HFGJ02_3\\n\\t,HFGJ02_4\\n\\t,HFGJ03\\n\\t,HFGJ03_1\\n\\t,HFGJ03_2\\n\\t,HFGJ03_3\\n\\t,HFGJ03_4\\n\\t,HM0001\\n\\t,HM0002\\n\\t,HM0003\\n\\t,HM0004\\n\\t,HM0005\\n\\t,HM0006\\n\\t,HM0007\\n\\t,HM0008\\n\\t,HM0009\\n\\t,HM0010\\n\\t,HM0011\\n\\t,HM0012\\n\\t,HM0013\\n\\t,HM0014\\n\\t,HM0015\\n\\t,province_name   -- 漫游省份   以下指标20190227新增\\n    ,last3_mounth_avg_cc  -- 近三个月平均消费（剔除即扣即返收入）\\n    ,last6_mounth_avg_cc   -- 近六个月平均消费（剔除即扣即返收入）\\n   ,dg_USE_RES_NUM        -- 订购定向流量资源使用量\\n   ,dg_TOTAL_RES_NUM      -- 订购定向流量资源总量\\n   ,zs_USE_RES_NUM        -- 赠送定向流量资源使用量\\n   ,zs_TOTAL_RES_NUM      -- 赠送定向流量资源总量   \\n   ,gprs_USE_RES_NUM      -- GPRS国内资源使用量\\n   ,is_acct_uesr_cc         -- 是否为出账客户（不含物联网）\\n   ,LAST1_PLAN_MONTHLY_FEE   -- 主套餐月租费-前第1月\\n   ,LAST2_PLAN_MONTHLY_FEE   -- 主套餐月租费-前第2月\\n   ,LAST3_PLAN_MONTHLY_FEE   -- 主套餐月租费-前第3月\\n   ,LAST6_PLAN_MONTHLY_FEE   -- 主套餐月租费-前第6月\\n   ,last1_tc_month_fee       -- 套餐月租费-前第1月\\n   ,last2_tc_month_fee       -- 套餐月租费-前第2月\\n   ,last3_tc_month_fee       -- 套餐月租费-前第3月\\n   ,last4_tc_month_fee       -- 套餐月租费-前第6月\\n   ,lastyear_d_tc_month_fee  -- 套餐月租费-去年同期\\n   ,lastyear_d_ztc_month_fee -- 主套餐月租费-去年同期 以下20190327添加\\n   ,is_bxl_plan_user         -- 是否不限量套餐到达用户\\n   ,rc_id                    -- 区域中心\\n   ,end_time                 -- 客户星级有效期\\n   ,bd_call_fee_cc\\n   ,prom_fee                 -- 低消费用       以下20190415日添加\\n   ,this_fee                 -- 当月预付费欠费\\n   ,this_backfee             -- 当月预付费欠费收回\\n   ,trans_amt                -- 赠费金额   \\n   ,minus_fee                -- 折后收入 \\n   ,is_group_plan_user       -- 是否集团套餐用户\\n   ,is_groupplan_mn_user     -- 是否集团套餐当月新增用户\\n   ,total_Fee                -- 套餐外语音费\\n   ,dept_county_id           -- 当月高频通信分公司\\n   ,grid_id                  -- 当月高频通信网格\\n   ,is_4gnet_newuser         --  是否4G网络客户（本地剔除物联网） 以下20190429日添加\\n   ,is_4g_arrieduser         --  是否4G有效客户（本地2019）\\n   ,CA_CUST_ID               --  客户CA编码\\n   ,REMOVE_FEE\\t      \\t     -- 折后ARPU（分) \\n   ,CALING_NUM             -- 主叫通话次数   -- 以下20190528日添加  \\n   ,CALLED_NUM                -- 被叫通话次数\\n   ,bhd_lgprs_res           -- 饱和度国内流量资源\\n   ,micro_id                -- 当月高频通信微格\\n   ,is_5gpuls               -- 是否5G终端用户\\n   ,lvl_name      -- CO重要程度\\n   ,co_grid\\n   ,co_begin_time,\\n   call_dur_gj_xg, -- 国际长途通话时长-香港\\ncall_fee_gj_xg, -- 国际长途超套费-香港\\ncall_dur_gj_xjp, -- 国际长途通话时长-新加坡\\ncall_fee_gj_xjp, -- 国际长途超套费-新加坡\\ncall_dur_gj_hg, -- 国际长途通话时长-韩国\\ncall_fee_gj_hg, -- 国际长途超套费-韩国\\ncall_dur_gj_mg, -- 国际长途通话时长-蒙古\\ncall_fee_gj_mg, -- 国际长途超套费-蒙古\\ncall_dur_gj_dg, -- 国际长途通话时长-德国\\ncall_fee_gj_dg, -- 国际长途超套费-德国\\ncall_dur_gj_fg, -- 国际长途通话时长-法国\\ncall_fee_gj_fg, -- 国际长途超套费-法国\\ncall_dur_gj_od, -- 国际长途通话时长-澳大利亚\\ncall_fee_gj_od, -- 国际长途超套费-澳大利亚\\ncall_dur_gj_am, -- 国际长途通话时长-美国\\ncall_fee_gj_am, -- 国际长途超套费-美国\\nis_top25_user, -- 是否重点客户保拓（TOP25%拍照客户）\\n  is_other75_user , -- 是否重点客户保拓（其他75%拍照客户）\\n  is_top25_by_user ,  -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n  is_other75_tz_user , -- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n  is_2018_zerocall_user , -- 是否重点客户保拓（2018年拍照期末0通信客户）\\n  is_2018_zerocall_tz_user , -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n  is_2019_newnet_user , -- 是否重点客户保拓（2019年新入网客户拓展客户）\\n  is_top25_lius  ,  -- 是否重点客户保拓(TOP25%流失客户)\\n  is_top25_lius2  ,  -- 是否重点客户保拓(流失TOP25%客户-ARPU同时低于最低拍照ARPU值和拍照期80%客户)\\n  is_top25_lius3 ,  -- 是否重点客户保拓(流失TOP25%客户-ARPU高于最低拍照ARPU值但低于80%客户)\\n  is_top25_lius4,   -- 是否重点客户保拓(流失TOP25%客户-ARPU高于80%但低于拍照最低ARPU值客户)\\n\\tzh_curm_arpu,\\nfee001,\\nfee002,\\nfee003,\\nfee004,\\nfee005,\\nfee006,\\nfee007,\\nfee008,\\nfee009,\\nfee010,\\nfee011,\\nfee012,\\nfee013,\\nlast_REMOVE_FEE,\\nlast2_REMOVE_FEE,\\nyouhui_fee,\\nycff_fee,\\n fee014\\n)\\nselect\\t'${month_id}-01'                     OP_TIME\\n\\t\\t,${monthid}                          STATIS_MONTH\\n\\t\\t,t1.PHONE_NO                         PRODUCT_NO\\n\\t\\t,t2.YEAR_SHOULD_FEE                  HF0001\\n\\t\\t,t2.LAST6_MOUNTH_AVG                 HF0002\\n\\t\\t,t2.LAST3_MOUNTH_AVG                 HF0003\\n\\t\\t,t2.MONTH_FEE                        HF0004\\n\\t\\t,t2.LAST1_MONTH_FEE                  HF0005\\n\\t\\t,t2.LAST2_MONTH_FEE                  HF0006\\n\\t\\t,t2.LAST3_MONTH_FEE                  HF0007\\n\\t\\t,t2.LAST4_MONTH_FEE                  HF0008\\n\\t\\t,t2.LAST5_MONTH_FEE                  HF0009\\n\\t\\t,t2.LAST6_MONTH_FEE                  HF0010\\n\\t\\t,t2.LAST7_MONTH_FEE                  HF0011\\n\\t\\t,t2.LAST8_MONTH_FEE                  HF0012\\n\\t\\t,t2.LAST9_MONTH_FEE                  HF0013\\n\\t\\t,t2.LAST10_MONTH_FEE                 HF0014\\n\\t\\t,t2.LAST11_MONTH_FEE                 HF0015\\n\\t\\t,t2.LAST12_MONTH_FEE                 HF0016\\n\\t\\t,t2.DANGQZFY                         HFGJ01\\n\\t\\t,t2.DANGQGJCT                        HFGJ01_1\\n\\t\\t,t2.DANGQGJMY                        HFGJ01_2\\n\\t\\t,t2.DANGQGTCT                        HFGJ01_3\\n\\t\\t,t2.DANGQGTMY                        HFGJ01_4\\n\\t\\t,t2.DANGQZFYQ1Y                      HFGJ02\\n\\t\\t,t2.DANGQGJCTQ1Y                     HFGJ02_1\\n\\t\\t,t2.DANGQGJMYQ1Y                     HFGJ02_2\\n\\t\\t,t2.DANGQGTCTQ1Y                     HFGJ02_3\\n\\t\\t,t2.DANGQGTMYQ1Y                     HFGJ02_4\\n\\t\\t,t2.DANGQZFYQ2Y                      HFGJ03\\n\\t\\t,t2.DANGQGJCTQ2Y                     HFGJ03_1\\n\\t\\t,t2.DANGQGJMYQ2Y                     HFGJ03_2\\n\\t\\t,t2.DANGQGTCTQ2Y                     HFGJ03_3\\n\\t\\t,t2.DANGQGTMYQ2Y                     HFGJ03_4\\n\\t\\t,t2.MOUNTH6_DURATION_AVG             HM0001\\n\\t\\t,t2.MOUNTH3_DURATION_AVG             HM0002\\n\\t\\t,t2.MONTH_DURATION_M                 HM0003\\n\\t\\t,t2.LAST1_DURATION_M                 HM0004\\n\\t\\t,t2.LAST2_DURATION_M                 HM0005\\n\\t\\t,t2.LAST3_DURATION_M                 HM0006\\n\\t\\t,t2.LAST4_DURATION_M                 HM0007\\n\\t\\t,t2.LAST5_DURATION_M                 HM0008\\n\\t\\t,t2.LAST6_DURATION_M                 HM0009\\n\\t\\t,t2.LAST7_DURATION_M                 HM0010\\n\\t\\t,t2.LAST8_DURATION_M                 HM0011\\n\\t\\t,t2.LAST9_DURATION_M                 HM0012\\n\\t\\t,t2.LAST10_DURATION_M                HM0013\\n\\t\\t,t2.LAST11_DURATION_M                HM0014\\n\\t\\t,t2.LAST12_DURATION_M                HM0015\\n\\t\\t,'null' -- t3.province_name\\n\\t\\t,t4.last3_mounth_avg_cc   -- 近三个月平均消费（剔除即扣即返收入）  \\n    ,t4.last6_mounth_avg_cc   -- 近六个月平均消费（剔除即扣即返收入）\\n    ,t5.dg_USE_RES_NUM \\n    ,t5.dg_TOTAL_RES_NUM\\n    ,t5.zs_USE_RES_NUM\\n    ,t5.zs_TOTAL_RES_NUM \\n    ,t5.gprs_USE_RES_NUM \\n    ,t5.is_acct_uesr_cc\\n    ,t6.LAST1_PLAN_MONTHLY_FEE \\n    ,t6.LAST2_PLAN_MONTHLY_FEE \\n    ,t6.LAST3_PLAN_MONTHLY_FEE \\n    ,t6.LAST6_PLAN_MONTHLY_FEE \\n    ,t6.last1_tc_month_fee \\n    ,t6.last2_tc_month_fee \\n    ,t6.last3_tc_month_fee \\n    ,t6.last6_tc_month_fee \\n    ,t6.lastyear_d_tc_month_fee\\n\\t,t6.lastyear_d_ztc_month_fee\\n\\t,t7.is_bxl_plan_user         -- 是否不限量套餐到达用户\\n    ,t7.rc_id                    -- 区域中心\\n    ,t7.end_time                 -- 客户星级有效期\\n\\t,t8.bd_call_fee_cc           -- 本地通话费（剔除低消）\\n\\t,t9.prom_fee       -- 低消费用       以下20190415日添加\\n   ,t9.this_fee     -- 当月预付费欠费\\n   ,t9.this_backfee  -- 当月预付费欠费收回\\n   ,t9.trans_amt   -- 赠费金额            \\n   ,t9.minus_fee   -- 折后收入    \\n   ,t10.is_group_plan_user  -- 是否集团套餐用户\\n   ,t10.is_groupplan_mn_user  -- 是否集团套餐当月新增用户\\n   ,t10.total_Fee      -- 套餐外语音费\\n   ,t11.dept_county_id  -- 当月高频通信分公司\\n   ,t11.grid_id          -- 当月高频通信网格\\n   ,t12.is_4gnet_newuser    --  是否4G网络客户（本地剔除物联网） 以下20190429日添加\\n   ,t12.is_4g_arrieduser   --  是否4G有效客户（本地2019）\\n   ,t12.CA_CUST_ID        --  客户CA编码\\n   ,t13.REMOVE_FEE\\t      -- 折后ARPU（分) \\n   ,t14.CALING_NUM             -- 主叫通话次数   -- 以下20190528日添加  \\n   ,t14.CALLED_NUM                -- 被叫通话次数\\n   ,t14.bhd_lgprs_res           -- 饱和度国内流量资源\\n   ,t11.micro_id               -- 当月高频通信微格\\n   ,t15.is_5gpuls\\n   ,t16.lvl_name\\n   ,t17.co_grid\\n   ,t17.co_begin_time,\\n   nvl(t18.call_dur_gj_xg,0), -- 国际长途通话时长-香港\\nnvl(t18.call_fee_gj_xg,0), -- 国际长途超套费-香港\\nnvl(t18.call_dur_gj_xjp,0), -- 国际长途通话时长-新加坡\\nnvl(t18.call_fee_gj_xjp,0), -- 国际长途超套费-新加坡\\nnvl(t18.call_dur_gj_hg,0), -- 国际长途通话时长-韩国\\nnvl(t18.call_fee_gj_hg,0), -- 国际长途超套费-韩国\\nnvl(t18.call_dur_gj_mg,0), -- 国际长途通话时长-蒙古\\nnvl(t18.call_fee_gj_mg,0), -- 国际长途超套费-蒙古\\nnvl(t18.call_dur_gj_dg,0), -- 国际长途通话时长-德国\\nnvl(t18.call_fee_gj_dg,0), -- 国际长途超套费-德国\\nnvl(t18.call_dur_gj_fg,0), -- 国际长途通话时长-法国\\nnvl(t18.call_fee_gj_fg,0), -- 国际长途超套费-法国\\nnvl(t18.call_dur_gj_od,0), -- 国际长途通话时长-澳大利亚\\nnvl(t18.call_fee_gj_od,0), -- 国际长途超套费-澳大利亚\\nnvl(t18.call_dur_gj_am,0), -- 国际长途通话时长-美国\\nnvl(t18.call_fee_gj_am,0), -- 国际长途超套费-美国 \\nt19.is_top25_user, -- 是否重点客户保拓（TOP25%拍照客户）\\n  t19.is_other75_user , -- 是否重点客户保拓（其他75%拍照客户）\\n  t19.is_top25_by_user ,  -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n  t19.is_other75_tz_user , -- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n  t19.is_2018_zerocall_user , -- 是否重点客户保拓（2018年拍照期末0通信客户）\\n  t19.is_2018_zerocall_tz_user , -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n  t19.is_2019_newnet_user , -- 是否重点客户保拓（2019年新入网客户拓展客户）\\n  t19.is_top25_lius  ,  -- 是否重点客户保拓(TOP25%流失客户)\\n  t19.is_top25_lius2  ,  -- 是否重点客户保拓(流失TOP25%客户-ARPU同时低于最低拍照ARPU值和拍照期80%客户)\\n  t19.is_top25_lius3 ,  -- 是否重点客户保拓(流失TOP25%客户-ARPU高于最低拍照ARPU值但低于80%客户)\\n  t19.is_top25_lius4,   -- 是否重点客户保拓(流失TOP25%客户-ARPU高于80%但低于拍照最低ARPU值客户)\\n  t21.zh_curm_arpu,\\nt20.fee001,\\nt20.fee002,\\nt20.fee003,\\nt20.fee004,\\nt20.fee005,\\nt20.fee006,\\nt20.fee007,\\nt20.fee008,\\nt20.fee009,\\nt20.fee010,\\nt21.fee011,\\nt21.fee012,\\nt21.fee013,\\nt22.REMOVE_FEE,\\nt23.REMOVE_FEE,\\nt13.youhui_fee,\\nt13.ycff_fee,\\nt21.fee014\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} t1\\nleft join (\\nselect\\n PRODUCT_NO,YEAR_SHOULD_FEE,LAST6_MOUNTH_AVG,LAST3_MOUNTH_AVG,MONTH_FEE,LAST1_MONTH_FEE                  \\n,LAST2_MONTH_FEE,LAST3_MONTH_FEE,LAST4_MONTH_FEE,LAST5_MONTH_FEE,LAST6_MONTH_FEE                  \\n,LAST7_MONTH_FEE,LAST8_MONTH_FEE,LAST9_MONTH_FEE,LAST10_MONTH_FEE,LAST11_MONTH_FEE                 \\n,LAST12_MONTH_FEE,DANGQZFY,DANGQGJCT,DANGQGJMY,DANGQGTCT,DANGQGTMY,DANGQZFYQ1Y                      \\n,DANGQGJCTQ1Y,DANGQGJMYQ1Y,DANGQGTCTQ1Y,DANGQGTMYQ1Y,DANGQZFYQ2Y,DANGQGJCTQ2Y                     \\n,DANGQGJMYQ2Y,DANGQGTCTQ2Y,DANGQGTMYQ2Y,MOUNTH6_DURATION_AVG,MOUNTH3_DURATION_AVG             \\n,MONTH_DURATION_M,LAST1_DURATION_M,LAST2_DURATION_M,LAST3_DURATION_M                 \\n,LAST4_DURATION_M,LAST5_DURATION_M,LAST6_DURATION_M,LAST7_DURATION_M                 \\n,LAST8_DURATION_M,LAST9_DURATION_M,LAST10_DURATION_M,LAST11_DURATION_M,LAST12_DURATION_M           \\nfrom ${SOURCE_DM_PUB_HIS_INDEX_YYYYMM}\\ngroup by  PRODUCT_NO,YEAR_SHOULD_FEE,LAST6_MOUNTH_AVG,LAST3_MOUNTH_AVG,MONTH_FEE,LAST1_MONTH_FEE                  \\n,LAST2_MONTH_FEE,LAST3_MONTH_FEE,LAST4_MONTH_FEE,LAST5_MONTH_FEE,LAST6_MONTH_FEE                  \\n,LAST7_MONTH_FEE,LAST8_MONTH_FEE,LAST9_MONTH_FEE,LAST10_MONTH_FEE,LAST11_MONTH_FEE                 \\n,LAST12_MONTH_FEE,DANGQZFY,DANGQGJCT,DANGQGJMY,DANGQGTCT,DANGQGTMY,DANGQZFYQ1Y                      \\n,DANGQGJCTQ1Y,DANGQGJMYQ1Y,DANGQGTCTQ1Y,DANGQGTMYQ1Y,DANGQZFYQ2Y,DANGQGJCTQ2Y                     \\n,DANGQGJMYQ2Y,DANGQGTCTQ2Y,DANGQGTMYQ2Y,MOUNTH6_DURATION_AVG,MOUNTH3_DURATION_AVG             \\n,MONTH_DURATION_M,LAST1_DURATION_M,LAST2_DURATION_M,LAST3_DURATION_M                 \\n,LAST4_DURATION_M,LAST5_DURATION_M,LAST6_DURATION_M,LAST7_DURATION_M                 \\n,LAST8_DURATION_M,LAST9_DURATION_M,LAST10_DURATION_M,LAST11_DURATION_M,LAST12_DURATION_M   ) t2 on t1.PHONE_NO=t2.PRODUCT_NO\\n-- left join nq201812461_result_${monthid} t3 on t1.phone_no=t3.phone_no\\nleft join tmp_mounth_avg_${monthid} t4 on t1.phone_no=t4.phone_no\\nleft join tmp_res_num_${monthid} t5 on t1.phone_no=t5.phone_no\\nleft join tmp_tc_month_fee_${monthid} t6 on t1.phone_no=t6.phone_no\\nleft join TMP_DM_AUTORPT_HIS_INDEX_01_${monthid} t7 on t1.phone_no=t7.phone_no\\nleft join tmp_dm_autorpt_his_index_02_${monthid} t8 on t1.phone_no=t8.phone_no\\nleft join tmp_dm_autorpt_his_index_03_${monthid} t9 on t1.phone_no=t9.phone_no\\nleft join tmp_dm_autorpt_his_index_04_${monthid} t10 on t1.phone_no=t10.phone_no\\nleft join tmp_dm_autorpt_his_index_05_${monthid} t11 on t1.phone_no=t11.phone_no\\nleft join tmp_dm_autorpt_his_index_06_${monthid} t12 on t1.phone_no=t12.phone_no\\nleft join tmp_dm_autorpt_his_index_07_${monthid} t13 on t1.user_id=t13.user_id \\nleft join tmp_dm_autorpt_his_index_08_${monthid} t14 on t1.phone_no=t14.phone_no\\nleft join tmp_dm_autorpt_his_index_09_${monthid} t15 on t1.phone_no=t15.phone_no\\nleft join tmp_dm_autorpt_his_index_10_${monthid} t16 on t1.phone_no=t16.product_NO\\nleft join tmp_dm_autorpt_his_index_11_${monthid} t17 on t1.phone_no=t17.product_no\\nleft join tmp_dm_autorpt_his_index_12_${monthid} t18 on t1.phone_no=t18.product_no\\nleft join tmp_dm_autorpt_his_index_13_${monthid} t19 on t1.phone_no=t19.phone_no \\nleft join tmp_dm_autorpt_his_index_14_${monthid} t20 on t1.phone_no=t20.product_no\\nleft join tmp_dm_autorpt_his_index_15_${monthid} t21 on t1.phone_no=t21.product_no\\nleft join DM_AUTORPT_HIS_INDEX_${pmonthid} t22 on t1.phone_no=t22.product_no\\nleft join DM_AUTORPT_HIS_INDEX_${p2monthid} t23 on t1.phone_no=t23.product_no\\n WHERE (t1.MONTH_ARRIVE_FLAG=1 or t1.MONTH_OFF_FLAG  =1) And t1.PROD_KIND_CODE=171000000001\\n -- (t1.ONNET_USER_FLAG=1 AND t1.PROD_KIND_CODE='171000000001') or t1.MONTH_OFF_FLAG =1;\\n \\n \\n \\n\\n \\n  \\n \\n \\n "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [392]-[index:613]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[33]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"33.临时表01","nodeId":"33","sql":"##删除表 \\ndrop table if exists TMP_DM_AUTORPT_HIS_INDEX_01_${monthid};\\n##创建表\\ncreate table TMP_DM_AUTORPT_HIS_INDEX_01_${monthid}\\n(\\n  phone_no varchar(20), \\n  is_bxl_plan_user bigint(2), -- 是否不限量套餐到达用户\\n  rc_id bigint(20),  -- 区域中心\\n  end_time date  -- 客户星级有效期\\n)distributed by ('phone_No');\\n##插入数据\\ninsert into TMP_DM_AUTORPT_HIS_INDEX_01_${monthid}\\nselect a.phone_no,\\n       case when b.phone_no is not null then 1 else 0 end is_bxl_plan_user, -- 是否不限量套餐到达用户\\n       c.MKT_REGION_CNTR, -- 区域中心\\n       date(d.end_time)   end_time      -- 客户星级有效期\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (\\n           select phone_no \\n           from gbasemsm.msm_dw_basekpi_10631_detail_${monthid}\\n           group by phone_no\\n           ) b on a.phone_No=b.phone_No\\nleft join (\\n           select phone_no,\\n                  MKT_REGION_CNTR -- 市场区域中心\\n           from gbasedwi.dwi_usr_pesn_persn_loc_ms_${monthid}\\n           group by phone_no,\\n                    mkt_region_cntr\\n          ) c on a.phone_no=c.phone_no\\nleft join (\\n           select phone_no, \\n                  end_time -- 客户星级有效期 \\n           from gbasedwi.DWI_TMT_STAR_CUS_MS_${monthid}\\n           group by phone_no,\\n                    end_time\\n          ) d on a.phone_no=d.phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [393]-[index:614]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[25]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"25.流量资源","nodeId":"25","sql":" drop table tmp_res_num_${monthid};\\n CREATE TABLE tmp_res_num_${monthid}\\n (\\n  phone_no varchar(20),\\n  dg_USE_RES_NUM BIGINT,\\n  dg_TOTAL_RES_NUM BIGINT,\\n  zs_USE_RES_NUM BIGINT,\\n  zs_TOTAL_RES_NUM BIGINT,\\n  gprs_USE_RES_NUM BIGINT,    \\n  is_acct_uesr_cc bigint(1)\\n)distributed by ('phone_No');\\n insert into tmp_res_num_${monthid}\\n select a.phone_no,\\n        b.dg_USE_RES_NUM,    -- 订购定向流量资源使用量(MB)\\n        b.dg_TOTAL_RES_NUM,  -- 订购定向流量资源总量(MB)\\n\\t\\tc.zs_USE_RES_NUM,    -- 赠送定向流量资源使用量(MB)\\n\\t\\tc.zs_TOTAL_RES_NUM,   -- 赠送定向流量资源总量(MB)\\n\\t\\td.gprs_USE_RES_NUM,   -- GPRS国内资源使用量(KB)  20190523日调整口径\\n\\t\\tcase when e.user_id is not null then 1 else 0 end is_acct_uesr_cc  -- 是否出账客户(不含物联网)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a   \\nleft join (select  b.phone_no,\\n                   sum(b.USE_RES_NUM/1024/1024) dg_USE_RES_NUM,\\n                   sum(b.TOTAL_RES_NUM/1024/1024) dg_TOTAL_RES_NUM       \\n           from dm.dim_dx_flow a\\n           left join gbasedwi.dwi_inco_bill_freeres_ms_${monthid} b on a.plan_id=b.plan_id and a.use_type=b.use_type \\n           group by phone_no\\n           ) b on a.phone_no=b.phone_no\\nleft join (select  phone_no,\\n                  sum(USE_RES_NUM/1024/1024) zs_USE_RES_NUM, -- 赠送定向流量资源使用量\\n                  sum(TOTAL_RES_NUM/1024/1024) zs_TOTAL_RES_NUM -- 赠送定向流量资源总量\\n           from gbasedwi.dwi_inco_bill_freeres_ms_${monthid}\\n           where plan_id='111002069417'\\n           group by phone_no\\n\\t\\t   ) c on a.phone_no=c.phone_no\\nleft join (\\n          select phone_no,\\n                 sum(case when b.item_code is not null then a.FREE_RES_USE_NUM else 0 end)/1024 gprs_USE_RES_NUM -- GPRS国内资源使用量 \\n          from gbasedwd.dwd_acc_offer_freeres_ds_${curmlastday} a\\n           left join (\\n                      select item_code from dm.dim_pub_freeres_lty_itemcode group by item_code\\n                     ) b on a.item_code=b.item_code \\n\\t\\t  where a.boss_prod_id not in ('54001105','53005095','50002352','54001809') \\n\\t\\t    and to_number(FREE_RES_total_NUM)<1000000000000000000    \\n           group by a.phone_no\\n        ) d on a.phone_no=d.phone_no  \\n left join ( select a.user_Id \\n             from           \\n\\t             (select user_id from gbasedwi.dwi_int_03004_ms_${monthid} group by user_id) a\\n            left join\\n\\t              (select user_no from gbasedwi.dwi_usr_pesn_thinginter_ms_${monthid}) b\\n                  on a.user_id = b.user_no\\n              where b.user_no is null \\n\\t\\t\\t  ) e on a.phone_no=e.user_id\\n\\t\\t\\t  \\n\\t\\t   \\n\\t\\t   "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [394]-[index:616]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[20]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"20.即扣即返收入","nodeId":"20","sql":"drop table tmp_jkjf_income_${monthid};\\nCREATE TABLE tmp_jkjf_income_${monthid} \\n(\\n  phone_No varchar(20),\\n  month_jkjf_income decimal(34,3) ,\\n  p_month_jkjf_income decimal(34,3) ,\\n  p1_month_jkjf_income decimal(34,3) ,\\n  p2_month_jkjf_income decimal(34,3) ,\\n  p3_month_jkjf_income decimal(34,3) ,\\n  p4_month_jkjf_income decimal(34,3) \\n)distributed by ('phone_No');\\n\\ninsert into tmp_jkjf_income_${monthid}\\nselect a.phone_No,\\n       nvl(b.month_jkjf_income,0) month_jkjf_income,\\n       nvl(c.p_month_jkjf_income,0) p_month_jkjf_income,\\n       nvl(d.p1_month_jkjf_income,0) p1_month_jkjf_income,\\n       nvl(e.p2_month_jkjf_income,0) p2_month_jkjf_income,\\n       nvl(f.p3_month_jkjf_income,0) p3_month_jkjf_income,\\n       nvl(g.p4_month_jkjf_income,0) p4_month_jkjf_income\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (\\n          select phone_no,\\n                 sum(should_income) month_jkjf_income  -- 当月即扣即返收入      \\n          from gbasedwi.dwi_inco_bill_item_tot_ms_${monthid} \\n          where acct_item_id in (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798,4686,4821,4820)\\n\\t\\t      -- 20190417日调整 (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798)\\n          group by phone_no\\n          ) b on a.phone_no=b.phone_no\\nleft join (\\n          select phone_no,\\n                 sum(should_income) p_month_jkjf_income  -- 前第1个月即扣即返收入      \\n          from gbasedwi.dwi_inco_bill_item_tot_ms_${pmonthid} \\n          where acct_item_id in (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798,4686,4821,4820)\\n\\t\\t      -- 20190417日调整 (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798)\\n          group by phone_no\\n          ) c on a.phone_no=c.phone_no\\nleft join (\\n          select phone_no,\\n                 sum(should_income) p1_month_jkjf_income  -- 前第2个月即扣即返收入      \\n          from gbasedwi.dwi_inco_bill_item_tot_ms_${p2monthid}\\n          where acct_item_id in (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798,4686,4821,4820)\\n\\t\\t      -- 20190417日调整 (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798)\\n          group by phone_no\\n          ) d on a.phone_no=d.phone_no\\nleft join (\\n          select phone_no,\\n                 sum(should_income) p2_month_jkjf_income  -- 前第3个月即扣即返收入      \\n          from gbasedwi.dwi_inco_bill_item_tot_ms_${p3monthid}\\n          where acct_item_id in (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798,4686,4821,4820)\\n\\t\\t      -- 20190417日调整 (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798)\\n          group by phone_no\\n          ) e on a.phone_no=e.phone_no     \\nleft join (\\n          select phone_no,\\n                 sum(should_income) p3_month_jkjf_income  -- 前第4个月即扣即返收入      \\n          from gbasedwi.dwi_inco_bill_item_tot_ms_${p4monthid}\\n          where acct_item_id in (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798,4686,4821,4820)\\n\\t\\t      -- 20190417日调整 (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798)\\n          group by phone_no\\n          ) f on a.phone_no=f.phone_no\\nleft join (\\n          select phone_no,\\n                 sum(should_income) p4_month_jkjf_income  -- 前第5个月即扣即返收入      \\n          from gbasedwi.dwi_inco_bill_item_tot_ms_${p5monthid}\\n          where acct_item_id in (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798,4686,4821,4820)\\n\\t\\t      -- 20190417日调整 (4596,4626,3693,4637,4658,4667,3611,4745,4775,4785,4786,4797,4798)\\n          group by phone_no\\n          ) g on a.phone_no=g.phone_no "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [395]-[index:617]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[45]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"45.临时表04","nodeId":"45","sql":"drop table if exists tmp_dm_autorpt_his_index_04_${monthid};\\ncreate table tmp_dm_autorpt_his_index_04_${monthid}  \\n(\\n  phone_No varchar(20) ,\\n  is_group_plan_user bigint(1) , -- 是否集团套餐用户\\n  is_groupplan_mn_user bigint(1) , -- 是否集团套餐当月新增用户\\n  total_Fee decimal(33,2)         -- 套餐外语音费\\n)distributed by ('phone_No') ;\\ninsert into tmp_dm_autorpt_his_index_04_${monthid}  \\nselect a.phone_No,\\n       case when c.phone_no is not null then 1 else 0 end  is_group_plan_user, -- 是否集团套餐用户\\n       case when d.phone_no is not null then 1 else 0 end  is_groupplan_mn_user, -- 是否集团套餐当月新增用户\\n       nvl(truncate(e.total_Fee,2),0) total_Fee -- 套餐外语音费\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (\\n             select a.phone_No -- 集团套餐用户\\n             from (\\n                    select PRODUCT_NO phone_no,\\n                           OFFER_ID\\n                    from dm.DM_PRODUCT_OFFER_${monthid} \\n                    where SVC_STATUS_ID = '1'\\n                    ) a\\n             left join dm.dim_group_offerid b on a.offer_Id=b.offer_Id\\n             where b.offer_Id is not null\\n             group by a.phone_No\\n           ) c on a.phone_no=c.phone_No\\nleft join ( \\n            select a.phone_No\\n            from (\\n                   select PRODUCT_NO phone_no,\\n                          OFFER_ID\\n                   from dm.DM_PRODUCT_OFFER_${monthid}\\n                   where SVC_STATUS_ID =1\\n                   and START_DATE ='${curm_first_day}'\\n                 ) a\\n            left join dm.dim_group_offerid b on a.offer_Id=b.offer_Id\\n            where b.offer_Id is not null\\n            group by a.phone_No\\n           ) d on a.phone_No=d.phone_No\\nleft join (\\n           select phone_No,\\n                  sum(total_Fee) total_Fee -- 套餐外语音费\\n           from gbasedwd.dwd_evt_cdr_voc_basetot_ms_${monthid}\\n\\t\\t   where OUT_PROD_FLAG=1\\n           group by phone_No\\n           ) e on a.phone_No=e.phone_No"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [396]-[index:619]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[12]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"12.创建目标表","nodeId":"12","sql":"DROP TABLE ${TARGET_DM_AUTORPT_HIS_INDEX_YYYYMM};\\nCREATE TABLE ${TARGET_DM_AUTORPT_HIS_INDEX_YYYYMM}\\n (\\t OP_TIME             DATE\\n\\t,STATIS_MONTH        INTEGER\\n\\t,PRODUCT_NO          VARCHAR(20)\\n\\t,HF0001              DECIMAL(12, 2)\\n\\t,HF0002              DECIMAL(12, 2)\\n\\t,HF0003              DECIMAL(12, 2)\\n\\t,HF0004              DECIMAL(12, 2)\\n\\t,HF0005              DECIMAL(12, 2)\\n\\t,HF0006              DECIMAL(12, 2)\\n\\t,HF0007              DECIMAL(12, 2)\\n\\t,HF0008              DECIMAL(12, 2)\\n\\t,HF0009              DECIMAL(12, 2)\\n\\t,HF0010              DECIMAL(12, 2)\\n\\t,HF0011              DECIMAL(12, 2)\\n\\t,HF0012              DECIMAL(12, 2)\\n\\t,HF0013              DECIMAL(12, 2)\\n\\t,HF0014              DECIMAL(12, 2)\\n\\t,HF0015              DECIMAL(12, 2)\\n\\t,HF0016              DECIMAL(12, 2)\\n\\t,HFGJ01              DECIMAL(12, 2)\\n\\t,HFGJ01_1            DECIMAL(12, 2)\\n\\t,HFGJ01_2            DECIMAL(12, 2)\\n\\t,HFGJ01_3            DECIMAL(12, 2)\\n\\t,HFGJ01_4            DECIMAL(12, 2)\\n\\t,HFGJ02              DECIMAL(12, 2)\\n\\t,HFGJ02_1            DECIMAL(12, 2)\\n\\t,HFGJ02_2            DECIMAL(12, 2)\\n\\t,HFGJ02_3            DECIMAL(12, 2)\\n\\t,HFGJ02_4            DECIMAL(12, 2)\\n\\t,HFGJ03              DECIMAL(12, 2)\\n\\t,HFGJ03_1            DECIMAL(12, 2)\\n\\t,HFGJ03_2            DECIMAL(12, 2)\\n\\t,HFGJ03_3            DECIMAL(12, 2)\\n\\t,HFGJ03_4            DECIMAL(12, 2)\\n\\t,HM0001              INTEGER\\n\\t,HM0002              INTEGER\\n\\t,HM0003              INTEGER\\n\\t,HM0004              INTEGER\\n\\t,HM0005              INTEGER\\n\\t,HM0006              INTEGER\\n\\t,HM0007              INTEGER\\n\\t,HM0008              INTEGER\\n\\t,HM0009              INTEGER\\n\\t,HM0010              INTEGER\\n\\t,HM0011              INTEGER\\n\\t,HM0012              INTEGER\\n\\t,HM0013              INTEGER\\n\\t,HM0014              INTEGER\\n\\t,HM0015              INTEGER\\n\\t,province_name       varchar(50)  -- 漫游省份   以下指标20190227新增\\n    ,last3_mounth_avg_cc decimal(41,2) -- 近三个月平均消费（剔除即扣即返收入）\\n    ,last6_mounth_avg_cc decimal(44,2)  -- 近六个月平均消费（剔除即扣即返收入）\\n   ,dg_USE_RES_NUM BIGINT       -- 订购定向流量资源使用量\\n   ,dg_TOTAL_RES_NUM BIGINT     -- 订购定向流量资源总量\\n   ,zs_USE_RES_NUM BIGINT      -- 赠送定向流量资源使用量\\n   ,zs_TOTAL_RES_NUM BIGINT     -- 赠送定向流量资源总量   \\n   ,gprs_USE_RES_NUM BIGINT    -- GPRS国内资源使用量\\n   ,is_acct_uesr_cc bigint(1)         -- 是否为出账客户（不含物联网）\\n   ,LAST1_PLAN_MONTHLY_FEE decimal(12,2)  -- 主套餐月租费-前第1月\\n   ,LAST2_PLAN_MONTHLY_FEE decimal(12,2)  -- 主套餐月租费-前第2月\\n   ,LAST3_PLAN_MONTHLY_FEE decimal(12,2)  -- 主套餐月租费-前第3月\\n   ,LAST6_PLAN_MONTHLY_FEE decimal(12,2)  -- 主套餐月租费-前第6月\\n   ,last1_tc_month_fee decimal(12,2)      -- 套餐月租费-前第1月\\n   ,last2_tc_month_fee decimal(12,2)      -- 套餐月租费-前第2月\\n   ,last3_tc_month_fee decimal(12,2)      -- 套餐月租费-前第3月\\n   ,last4_tc_month_fee decimal(12,2)      -- 套餐月租费-前第6月     \\n   ,lastyear_d_tc_month_fee decimal(12,2) -- 套餐月租费-去年同期\\n   ,lastyear_d_ztc_month_fee decimal(12,2) -- 主套餐月租费-去年同期\\n   ,is_bxl_plan_user bigint(2)             -- 是否不限量套餐到达用户\\n   ,rc_id bigint(20)                       -- 区域中心\\n   ,end_time date                          -- 客户星级有效期\\n   ,bd_call_fee_cc decimal(23,2)           -- 本地通话费（剔除低消）20190411日添加\\n   ,prom_fee decimal(44,2)                 -- 低消费用       以下20190415日添加\\n   ,this_fee decimal(35,3)                 -- 当月预付费欠费\\n   ,this_backfee decimal(42,2)             -- 当月预付费欠费收回\\n   ,trans_amt decimal(44,2)                -- 赠费金额   \\n   ,minus_fee decimal(45,2)                -- 折后收入 \\n   ,is_group_plan_user bigint(1)           -- 是否集团套餐用户\\n   ,is_groupplan_mn_user bigint(1)         -- 是否集团套餐当月新增用户\\n   ,total_Fee decimal(33,2)                -- 套餐外语音费\\n   ,dept_county_id int(11)                 -- 当月高频通信分公司 以下20190425日添加\\n   ,grid_id int(11)                        -- 当月高频通信网格\\n   ,is_4gnet_newuser bigint(1)             --  是否4G网络客户（本地剔除物联网） 以下20190428日添加\\n   ,is_4g_arrieduser bigint(1)             --  是否4G有效客户（本地2019）\\n   ,CA_CUST_ID varchar(50)                 --  客户CA编码\\n   ,REMOVE_FEE\\tDECIMAL(12,2)\\t           -- 折后ARPU（分) \\n   ,CALING_NUM decimal(42,0)               -- 主叫通话次数   -- 以下20190528日添加  \\n   ,CALLED_NUM decimal(42,0)               -- 被叫通话次数\\n   ,bhd_lgprs_res double(20,3)             -- 饱和度国内流量资源\\n   ,micro_id    varchar(20)                -- 当月高频通信微格\\n   ,is_5gpuls   int                        -- 是否5G终端用户\\n   ,lvl_name    varchar(20)                -- CO重要程度\\n   ,co_grid        varchar(200)            -- CO归属经分网格\\n   ,co_begin_time  datetime ,               -- CO起始时间\\n   call_dur_gj_xg  bigint, -- 国际长途通话时长-香港\\ncall_fee_gj_xg  decimal(12,2), -- 国际长途超套费-香港\\ncall_dur_gj_xjp  bigint, -- 国际长途通话时长-新加坡\\ncall_fee_gj_xjp  decimal(12,2), -- 国际长途超套费-新加坡\\ncall_dur_gj_hg  bigint, -- 国际长途通话时长-韩国\\ncall_fee_gj_hg  decimal(12,2), -- 国际长途超套费-韩国\\ncall_dur_gj_mg  bigint, -- 国际长途通话时长-蒙古\\ncall_fee_gj_mg  decimal(12,2), -- 国际长途超套费-蒙古\\ncall_dur_gj_dg  bigint, -- 国际长途通话时长-德国\\ncall_fee_gj_dg  decimal(12,2), -- 国际长途超套费-德国\\ncall_dur_gj_fg  bigint, -- 国际长途通话时长-法国\\ncall_fee_gj_fg  decimal(12,2), -- 国际长途超套费-法国\\ncall_dur_gj_od  bigint, -- 国际长途通话时长-澳大利亚\\ncall_fee_gj_od  decimal(12,2), -- 国际长途超套费-澳大利亚\\ncall_dur_gj_am  bigint, -- 国际长途通话时长-美国\\ncall_fee_gj_am  decimal(12,2),  -- 国际长途超套费-美国\\nis_top25_user bigint(1), -- 是否重点客户保拓（TOP25%拍照客户）\\n  is_other75_user bigint(1), -- 是否重点客户保拓（其他75%拍照客户）\\n  is_top25_by_user bigint(1),  -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n  is_other75_tz_user bigint(1),-- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n  is_2018_zerocall_user bigint(1),-- 是否重点客户保拓（2018年拍照期末0通信客户）\\n  is_2018_zerocall_tz_user bigint(1), -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n  is_2019_newnet_user bigint(1), -- 是否重点客户保拓（2019年新入网客户拓展客户）\\n  is_top25_lius  int,  -- 是否重点客户保拓(TOP25%流失客户)\\n  is_top25_lius2  int,  -- 是否重点客户保拓(流失TOP25%客户-ARPU同时低于最低拍照ARPU值和拍照期80%客户)\\n  is_top25_lius3  int,  -- 是否重点客户保拓(流失TOP25%客户-ARPU高于最低拍照ARPU值但低于80%客户)\\n  is_top25_lius4  int,  -- 是否重点客户保拓(流失TOP25%客户-ARPU高于80%但低于拍照最低ARPU值客户)\\n  zh_curm_arpu  decimal(18,2),  ###折后当月ARPU（剔除国际业务收入）\\n  fee001  decimal(18,2),  -- ARPU-主套餐月租费\\nfee002  decimal(18,2),  -- ARPU-流量\\nfee003  decimal(18,2),  -- ARPU-语音套外\\nfee004  decimal(18,2),  -- ARPU-短彩信\\nfee005  decimal(18,2),  -- ARPU-家庭宽带\\nfee006  decimal(18,2),  -- ARPU-个人融合产品\\nfee007  decimal(18,2),  -- ARPU-And Market\\nfee008  decimal(18,2),  -- ARPU-其他数据业务\\nfee009  decimal(18,2),  -- ARPU-其他收入\\nfee010  decimal(18,2),   -- ARPU-信息化\\nfee011  decimal(18,2),  -- ARPU-套餐及套外\\nfee012   decimal(18,2),  -- ARPU（国际业务收入）\\nfee013   decimal(18,2),   -- ARPU(折扣金额)\\nlast_REMOVE_FEE\\t DECIMAL(12,2),\\t   -- 上个月折后ARPU \\nlast2_REMOVE_FEE\\t DECIMAL(12,2),\\t   -- 上上个月折后ARPU \\nyouhui_fee  DECIMAL(12,2),   -- arpu(优惠金额)\\nycff_fee    DECIMAL(12,2),    -- arpu(预存返费金额)\\n fee014   decimal(18,2)   -- 折后实收收入\\n ) DISTRIBUTED BY('product_no');\\n\\n \\n\\n\\n "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [397]-[index:621]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[85]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"85.SQL语句","nodeId":"85","sql":"###删除表\\n drop table if exists dm.tmp_dm_autorpt_his_index_14_${monthid};\\n ###创建表\\n create table dm.tmp_dm_autorpt_his_index_14_${monthid}\\n ( \\n product_no varchar(20),\\n fee001  decimal(18,2),  -- ARPU-主套餐月租费\\nfee002  decimal(18,2),  -- ARPU-流量\\nfee003  decimal(18,2),  -- ARPU-语音套外\\nfee004  decimal(18,2),  -- ARPU-短彩信\\nfee005  decimal(18,2),  -- ARPU-家庭宽带\\nfee006  decimal(18,2),  -- ARPU-个人融合产品\\nfee007  decimal(18,2),  -- ARPU-And Market\\nfee008  decimal(18,2),  -- ARPU-其他数据业务\\nfee009  decimal(18,2),  -- ARPU-其他收入\\nfee010  decimal(18,2)   -- ARPU-信息化\\n )distributed by ('product_no');\\n ###插入数据\\ninsert into dm.tmp_dm_autorpt_his_index_14_${monthid}\\nselect \\na.phone_no,\\nfee001,\\nfee002,\\nfee003,\\nfee004,\\nfee005,\\nfee006,\\nfee007,\\nfee008,\\nfee009,\\nfee010\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a  \\nleft join \\n(select product_no,sum(case when fee_type_name='主套餐月租费' then should_fee else 0 end) fee001,\\nsum(case when a.fee_item_id in (914,1248,1511,1517,1518,1522,1523,2051,2052,2555,\\n                      2556,2557,2558,2559,2560,2561,2562,2563,2564,2565,2566,\\n                      2635,2701,2702,2707,2708,2709,2710,2722,2748,2749,2750,\\n                      2752,2798,3508,3509,3510,3511,3512,3513,3514,3599,3600,\\n                      3605,3606,3679,4594,4595,4627,4629,4633,4634,4666,4687,\\n                      4698,4699,4708,4710,4733,4748,4793,4813,4819,4845,4889,\\n                      4905,4999) then should_fee else 0 end) fee002,\\nsum(case when fee_type_name='语音套外' then should_fee else 0 end) fee003,\\nsum(case when fee_type_name='短彩信' and a.fee_item_id not in (226,1039,915,1038,916,1067,1513) \\n         then should_fee else 0 end) fee004,\\nsum(case when fee_type_name='家庭宽带' then should_fee else 0 end) fee005,\\nsum(case when fee_type_name='个人融合产品' then should_fee else 0 end) fee006,\\nsum(case when fee_type_name='And Market' then should_fee else 0 end) fee007,\\nsum(case when fee_type_name='其他数据业务' then should_fee else 0 end) fee008,\\nsum(case when fee_type_name='其他收入' then should_fee else 0 end) fee009,\\nsum(case when fee_type_name='信息化' and a.fee_item_id not in (3612,3654,3302,3301,761,1566,3586,4728,1568,1578)\\n         then should_fee else 0 end) fee010\\nfrom dm.dm_Pub_acct_shoulditem_${monthid} a\\nleft join gbasemsm.dim_ckpi_basekpi_feeitem b on a.fee_item_id2=b.fee_item_id\\ngroup by product_no) b on a.phone_no=b.product_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [398]-[index:622]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[74]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"74.SQL语句","nodeId":"74","sql":"drop table tmp_dm_autorpt_his_index_13_${monthid};\\ncreate table tmp_dm_autorpt_his_index_13_${monthid}\\n(phone_no   varchar(50),\\n  is_top25_user bigint(1), -- 是否重点客户保拓（TOP25%拍照客户）\\n  is_other75_user bigint(1), -- 是否重点客户保拓（其他75%拍照客户）\\n  is_top25_by_user bigint(1),  -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n  is_other75_tz_user bigint(1),-- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n  is_2018_zerocall_user bigint(1),-- 是否重点客户保拓（2018年拍照期末0通信客户）\\n  is_2018_zerocall_tz_user bigint(1), -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n  is_2019_newnet_user bigint(1), -- 是否重点客户保拓（2019年新入网客户拓展客户）\\n  is_top25_lius  int,  -- 是否重点客户保拓(TOP25%流失客户)\\n  is_top25_lius2  int,  -- 是否重点客户保拓(流失TOP25%客户-ARPU同时低于最低拍照ARPU值和拍照期80%客户)\\n  is_top25_lius3  int,  -- 是否重点客户保拓(流失TOP25%客户-ARPU高于最低拍照ARPU值但低于80%客户)\\n  is_top25_lius4  int  -- 是否重点客户保拓(流失TOP25%客户-ARPU高于80%但低于拍照最低ARPU值客户)\\n)distributed by ('phone_no');\\ninsert into tmp_dm_autorpt_his_index_13_${monthid}\\nselect a.phone_no,\\n       case when c.phone_No is not null then 1 else 0 end is_top25_user,    -- 是否重点客户保拓（TOP25%拍照客户）\\n       case when d.phone_no is not null then 1 else 0 end is_other75_user,    -- 是否重点客户保拓（其他75%拍照客户）\\n       case when e.phone_no is not null then 1 else 0 end is_top25_by_user,    -- 是否重点客户保拓（TOP25%拍照客户保有客户）\\n       case when f.phone_No is not null then 1 else 0 end is_other75_tz_user,    -- 是否重点客户保拓（其他75%拍照客户拓展客户）\\n       case when g.phone_No is not null then 1 else 0 end is_2018_zerocall_user,    -- 是否重点客户保拓（2018年拍照期末0通信客户）\\n       case when h.phone_no is not null then 1 else 0 end is_2018_zerocall_tz_user,    -- 是否重点客户保拓（2018年拍照期末0通信客户拓展客户）\\n       case when i.phone_no is not null then 1 else 0 end is_2019_newnet_user,    -- 是否重点客户保拓（2019年新入网客户拓展客户）\\n       b.is_top25_lius,\\n\\t   b.is_top25_lius2,\\n\\t   b.is_top25_lius3,\\n\\t   b.is_top25_lius4\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join (select user_id,phone_no,\\n                  if(flag = 0,1,0) is_top25_lius, -- 是否重点客户保拓(TOP25%流失客户)\\n                  if(flag = 0 and avg_income < min_snapshot_income and avg_income < snapshot_income * 0.8,1,0)is_top25_lius2, -- 是否重点客户保拓(流失TOP25%客户-ARPU同时低于最低拍照ARPU值和拍照期80%客户)\\n                  if(flag = 0 and avg_income >= min_snapshot_income and avg_income < snapshot_income * 0.8,1,0)is_top25_lius3, -- 是否重点客户保拓(流失TOP25%客户-ARPU高于最低拍照ARPU值但低于80%客户)\\n                  if(flag = 0 and avg_income < min_snapshot_income and avg_income >= snapshot_income * 0.8,1,0)is_top25_lius4 -- 是否重点客户保拓(流失TOP25%客户-ARPU高于80%但低于拍照最低ARPU值客户)\\n           from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\n           where hold_flag = 1\\n           )b on a.phone_no=b.phone_no\\nleft join (\\n          select phone_no from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\n          where hold_flag = 1\\n          group by phone_No\\n          ) c on a.phone_No=c.phone_no\\nleft join (\\n          select phone_no from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\n          where hold_flag = 2\\n          group by phone_No\\n          ) d on a.phone_No=d.phone_no\\nleft join (\\n          select phone_no from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\n          where hold_flag = 1 and flag = 1\\n          group by phone_No\\n          ) e on a.phone_No=e.phone_no\\nleft join (\\n          select phone_no from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\n          where hold_flag = 2 and flag = 1\\n          group by phone_No\\n          ) f on a.phone_No=f.phone_no       \\nleft join (\\n          select phone_no from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\n          where hold_flag = 3\\n          group by phone_No\\n          ) g on a.phone_No=g.phone_no\\nleft join (\\n          select phone_no from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\n          where hold_flag = 3 and flag = 1\\n          group by phone_No\\n          ) h on a.phone_No=h.phone_no        \\nleft join (\\n          select phone_no from gbasemsm.msm_dw_basekpi_110705_detail_${curmlastday}\\n          where hold_flag = 4 and flag = 1\\n          group by phone_No\\n          ) i on a.phone_No=i.phone_no "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [399]-[index:623]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[69]-['str' object has no attribute 'lfind']:{"parentDsName":"gbasegrid","dsName":"gbasegrid","schema_union":"gbasegrid","schema_dev":"gbasegrid","schema_prod":"gbasegrid","queue_union":"","queue_dev":"","queue_prod":"","name":"69.临时表11","nodeId":"69","sql":"drop table if exists dm.tmp_dm_autorpt_his_index_11_${monthid};\\nCREATE TABLE dm.tmp_dm_autorpt_his_index_11_${monthid}\\n(product_no    varchar(20),\\nco_grid        varchar(200), -- CO归属经分网格\\nco_begin_time  datetime     -- CO起始时间\\n)distributed by ('product_no'); \\ninsert into dm.tmp_dm_autorpt_his_index_11_${monthid}\\nselect distinct a.phone_no,b.grid_name,b.eff_date\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (select a.memb_no,a.co_code,b.grid_name,b.regional_center_name,c.eff_date\\n           from gbasedwi.dwi_usr_grp_meb_ms_${monthid} a\\n           left join gbasegrid.dim_grid_10144_colist_${monthid} b on a.co_code=b.co_code\\n\\t\\t   left join gbasedwi.dwi_usr_grp_custinfo_ms_${monthid} c on a.co_code=c.co_code\\n)b on a.phone_no=b.memb_no\\n;\\ndrop table  dm.tmp_dm_autorpt_his_index_12_list_${monthid};\\nCREATE TABLE dm.tmp_dm_autorpt_his_index_12_list_${monthid}\\n(op_time     varchar(20),\\nproduct_no    varchar(20),\\ncall_dur_gj_xg  bigint, -- 国际长途通话时长-香港\\ncall_fee_gj_xg  decimal(12,2), -- 国际长途超套费-香港\\ncall_dur_gj_xjp  bigint, -- 国际长途通话时长-新加坡\\ncall_fee_gj_xjp  decimal(12,2), -- 国际长途超套费-新加坡\\ncall_dur_gj_hg  bigint, -- 国际长途通话时长-韩国\\ncall_fee_gj_hg  decimal(12,2), -- 国际长途超套费-韩国\\ncall_dur_gj_mg  bigint, -- 国际长途通话时长-蒙古\\ncall_fee_gj_mg  decimal(12,2), -- 国际长途超套费-蒙古\\ncall_dur_gj_dg  bigint, -- 国际长途通话时长-德国\\ncall_fee_gj_dg  decimal(12,2), -- 国际长途超套费-德国\\ncall_dur_gj_fg  bigint, -- 国际长途通话时长-法国\\ncall_fee_gj_fg  decimal(12,2), -- 国际长途超套费-法国\\ncall_dur_gj_od  bigint, -- 国际长途通话时长-澳大利亚\\ncall_fee_gj_od  decimal(12,2), -- 国际长途超套费-澳大利亚\\ncall_dur_gj_am  bigint, -- 国际长途通话时长-美国\\ncall_fee_gj_am  decimal(12,2)  -- 国际长途超套费-美国\\n); "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [400]-[index:624]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[71]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"71.临时表12","nodeId":"71","sql":"drop table if exists dm.tmp_dm_autorpt_his_index_12_${monthid};\\nCREATE TABLE dm.tmp_dm_autorpt_his_index_12_${monthid}\\n(product_no    varchar(20),\\ncall_dur_gj_xg  bigint, -- 国际长途通话时长-香港\\ncall_fee_gj_xg  decimal(12,2), -- 国际长途超套费-香港\\ncall_dur_gj_xjp  bigint, -- 国际长途通话时长-新加坡\\ncall_fee_gj_xjp  decimal(12,2), -- 国际长途超套费-新加坡\\ncall_dur_gj_hg  bigint, -- 国际长途通话时长-韩国\\ncall_fee_gj_hg  decimal(12,2), -- 国际长途超套费-韩国\\ncall_dur_gj_mg  bigint, -- 国际长途通话时长-蒙古\\ncall_fee_gj_mg  decimal(12,2), -- 国际长途超套费-蒙古\\ncall_dur_gj_dg  bigint, -- 国际长途通话时长-德国\\ncall_fee_gj_dg  decimal(12,2), -- 国际长途超套费-德国\\ncall_dur_gj_fg  bigint, -- 国际长途通话时长-法国\\ncall_fee_gj_fg  decimal(12,2), -- 国际长途超套费-法国\\ncall_dur_gj_od  bigint, -- 国际长途通话时长-澳大利亚\\ncall_fee_gj_od  decimal(12,2), -- 国际长途超套费-澳大利亚\\ncall_dur_gj_am  bigint, -- 国际长途通话时长-美国\\ncall_fee_gj_am  decimal(12,2)  -- 国际长途超套费-美国\\n)distributed by ('product_no'); \\ninsert into tmp_dm_autorpt_his_index_12_${monthid}\\nselect product_no,\\n       sum(call_dur_gj_xg),\\nsum(call_fee_gj_xg),\\nsum(call_dur_gj_xjp),\\nsum(call_fee_gj_xjp),\\nsum(call_dur_gj_hg),\\nsum(call_fee_gj_hg),\\nsum(call_dur_gj_mg),\\nsum(call_fee_gj_mg),\\nsum(call_dur_gj_dg),\\nsum(call_fee_gj_dg),\\nsum(call_dur_gj_fg),\\nsum(call_fee_gj_fg),\\nsum(call_dur_gj_od),\\nsum(call_fee_gj_od),\\nsum(call_dur_gj_am),\\nsum(call_fee_gj_am)\\nfrom dm.tmp_dm_autorpt_his_index_12_list_${monthid}\\ngroup by product_no\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [401]-[index:625]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[83]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"83.SQL语句","nodeId":"83","sql":" ###删除表 \\n drop table if exists dm.tmp_dm_autorpt_his_index_15_${monthid};\\n ###创建表\\n create table dm.tmp_dm_autorpt_his_index_15_${monthid}\\n (\\n product_no varchar(20),\\n zh_curm_arpu decimal(18,2),  ###折后当月ARPU（剔除国际业务收入）\\n fee011   decimal(18,2),  -- ARPU-套餐及套外\\n fee012   decimal(18,2),  -- ARPU（国际业务收入）\\n fee013   decimal(18,2),   -- ARPU(折扣金额)\\n fee014   decimal(18,2)   -- 折后实收收入 \\n )distributed by ('product_no');\\n ###插入数据\\ninsert into dm.tmp_dm_autorpt_his_index_15_${monthid}\\nselect distinct\\na.phone_no,\\ne.REMOVE_FEE-(c.MONTH_FEE-(c.MONTH_FEE-b.IC1300-b.IC0500-b.IC0400-b.IC0800-b.IC0700-d.ROAMOUT_FEE)),\\n(e.REMOVE_FEE-(c.MONTH_FEE-(c.MONTH_FEE-b.IC1300-b.IC0500-b.IC0400-b.IC0800-b.IC0700-d.ROAMOUT_FEE)))-\\n   (fee004+fee005+fee006+fee007+fee008+fee009+fee010),\\nc.MONTH_FEE-(c.MONTH_FEE-b.IC1300-b.IC0500-b.IC0400-b.IC0800-b.IC0700-d.ROAMOUT_FEE),\\nc.MONTH_FEE-e.REMOVE_FEE,\\nc.MONTH_FEE-g.trans_amt-g.this_fee+g.this_backfee\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a  \\nleft join dm.DM_AUTORPT_ACCT_${monthid} b on a.phone_no=b.product_no\\nleft join (select product_no,MONTH_FEE from dm.dm_pub_his_index_${monthid} group by product_no,MONTH_FEE) c on a.phone_no=c.product_no\\nleft join dm.DM_PUB_INCREASE_${monthid} d on a.phone_no=d.product_no\\nleft join dm.tmp_dm_autorpt_his_index_07_${monthid} e on a.USER_ID=e.USER_ID\\nleft join dm.tmp_dm_autorpt_his_index_14_${monthid} f on a.phone_no=f.product_no\\nleft join dm.tmp_dm_autorpt_his_index_03_${monthid} g on a.phone_no=g.phone_no\\nwhere (a.prod_kind_code= 171000000001 and a.month_arrive_flag=1) or a.month_off_flag  =1;\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [402]-[index:626]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[50]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"50.临时表05","nodeId":"50","sql":"drop table if exists dm.tmp_dm_autorpt_his_index_05_${monthid};\\ncreate table dm.tmp_dm_autorpt_his_index_05_${monthid}\\n(\\n  phone_no varchar(20) ,\\n  dept_county_id int(11) , -- 当月高频通信分公司\\n  grid_id int(11),           -- 当月高频通信网格\\n  micro_id   varchar(20)       -- 当月高频通信微格\\n)distributed by ('phone_No'); \\ninsert into dm.tmp_dm_autorpt_his_index_05_${monthid}\\nselect distinct\\n    a.phone_no,\\n    nvl(b.dept_county_id,0), -- 当月高频通信分公司\\n    nvl(b.grid_id,0),        -- 当月高频通信网格\\n\\tc.cell_id         -- 当月高频通信微格 \\n  from (\\n         select phone_no,\\n               substr(HIGH_CELL,instr(high_cell,'_')+1) as high_cell\\n          from gbasedwa.dwa_uv_user_databusi_ms_${monthid}\\n\\t\\t) a\\n left join gbasedwd.dim_pub_cell b on a.HIGH_CELL=b.cell_id\\n left join dm.dim_cell_micro c on b.cell_id_10=c.cell_id\\n where a.high_cell is not null;\\n "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [403]-[index:627]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[67]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"67.临时表10","nodeId":"67","sql":"drop table if exists dm.tmp_dm_autorpt_his_index_10_${monthid};\\nCREATE TABLE dm.tmp_dm_autorpt_his_index_10_${monthid} \\n(product_no varchar(20),\\nlvl_name    varchar(20))distributed by ('product_no');\\ninsert into tmp_dm_autorpt_his_index_10_${monthid}\\nselect a.phone_no,b.lvl_name\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (select\\n               a.co_code,i.lvl_name,MEMB_NO\\n             from gbasedwi.DWI_USR_GRP_MEB_MS_${monthid} a\\n             left join gbasedwi.dwi_usr_grp_custinfo_ms_${monthid} b on a.co_code=b.co_code\\n\\t\\t\\t left join gbasedwd.dim_pub_grp_scale i on b.GRP_SCALE_ID= i.grp_scale_id\\n           ) b on a.phone_no=b.MEMB_NO"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [404]-[index:628]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[43]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"43.临时表03","nodeId":"43","sql":"drop table if exists tmp_dm_autorpt_his_index_03_${monthid}; \\ncreate table tmp_dm_autorpt_his_index_03_${monthid}  \\n (\\n  phone_No varchar(20) ,\\n  prom_fee decimal(44,2) ,      -- 低消费用       \\n  this_fee decimal(35,3) ,     -- 当月预付费欠费\\n  this_backfee decimal(42,2) , -- 当月预付费欠费收回\\n  trans_amt decimal(44,2) ,    -- 赠费金额   \\n  minus_fee decimal(45,2)      -- 折后收入 \\n) distributed by ('phone_No');\\ninsert into tmp_dm_autorpt_his_index_03_${monthid} \\nselect a.phone_No,\\n       nvl(truncate(f.prom_fee,2),0)   prom_fee,   -- 低消费用\\n       nvl(b.should_income-c.fact_amt,0) this_fee, -- 当月预付费欠费\\n       nvl(d.this_backfee,0)  this_backfee,        -- 当月预付费欠费收回\\n       nvl(truncate(e.trans_amt,2),0)    trans_amt, -- 赠费金额    \\n       nvl(truncate(g.SHOULD_INCOME,2),0)-nvl(truncate(e.trans_amt,2),0) minus_fee -- 折后收入 \\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (\\n           select phone_No,\\n                  sum(should_income) should_income -- 应收\\n           from gbasedwi.DWI_INCO_BILL_ITEM_TOT_MS_${monthid}\\n           group by phone_no\\n           ) b on a.phone_no=b.phone_No\\nleft join (\\n           select phone_No, \\n                  sum(fact_amt)  fact_amt-- 实收\\n           from gbasedwi.dwi_inco_bill_fact_tot_ms_${monthid}\\n           group by phone_NO\\n          ) c on a.phone_no=c.phone_no\\nleft join (\\n           select a.product_No phone_No,\\n                  sum(a.this_backfee) this_backfee -- 预付费欠费收回\\n           from gbaserpt.dm_acct_mzback_${monthid} a \\n           -- where a.bill_cycle_id <= '201406'  gbasedwd.dim_rpt_general_sheet1 c \\n           group by a.product_No\\n           ) d on a.phone_No=d.phone_No        \\nleft join (\\n           select phone_No,      \\n                  sum(a.trans_amt)/100 trans_amt\\n           from  ( \\n                   select bill_id phone_No,\\n                          trans_amt\\n                   from gbaserpt.nq_zengfei_0129_${monthid} a\\n                   left join gbaseods.ods_d_f_bos_bs_book_scheme_sap_type_${curmlastday} b on a.sap_id = b.sap_id\\n\\t\\t\\t\\t   -- gbasedwd.dim_acct_sap_type b\\n                   where b.sap_type = '1'\\n                   group by bill_Id,trans_amt\\n                  ) a \\n           group by phone_No\\n           ) e on a.phone_no=e.phone_No\\nleft join (\\n           select serv_id,\\n                  abs(truncate(sum(prom_fee)/100,2)) prom_fee -- 低消费用\\n           from gbasedwd.dwd_tmp_v8_bos_50038_prom_log_${monthid} -- 20190703调整\\n\\t\\t   -- gbaseods.ods_m_a_bos_50038_prom_log_${monthid}\\n           where adjust_item='88000002' and prom_fee<0 \\n           group by serv_id\\n          ) f on a.user_id=f.serv_Id\\nleft join (\\n           select phone_no,\\n                  sum(SHOULD_INCOME) SHOULD_INCOME \\n\\t\\t   from gbasedwi.DWI_INCO_BILL_USER_MS_${monthid}\\n\\t\\t   group by phone_no\\n\\t\\t       ) g on a.phone_no=g.phone_no \\n \\n "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [405]-[index:629]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[65]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"65.临时表9","nodeId":"65","sql":"drop table if exists dm.tmp_dm_autorpt_his_index_09_${monthid};\\nCREATE TABLE dm.tmp_dm_autorpt_his_index_09_${monthid} \\n(\\nphone_no varchar(50),\\nis_5gpuls int -- 是否5G终端用户\\n)distributed by ('phone_No');\\ninsert into dm.tmp_dm_autorpt_his_index_09_${monthid} \\nselect a.phone_No,\\n       case when e.phone_No is not null then 1 else 0 end     -- 是否5G终端用户\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (select distinct phone_no from gbasemsm.msm_dw_basekpi_110945_detail_${monthid})e on a.phone_no=e.phone_no\\n\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [406]-[index:630]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[41]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"41.临时表02","nodeId":"41","sql":"drop table if exists tmp_dm_autorpt_his_index_02_${monthid};\\nCREATE TABLE tmp_dm_autorpt_his_index_02_${monthid}     \\n(\\n  phone_no varchar(20) ,\\n  bd_call_fee_cc decimal(23,2) -- 本地通话费（剔除低消）\\n)distributed by ('phone_No');\\ninsert into tmp_dm_autorpt_his_index_02_${monthid}\\nselect a.phone_no,\\n       truncate(b.IC0100+nvl(c.prom_fee,0),2) bd_call_fee_cc -- 本地通话费（剔除低消）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join ( \\n            select PRODUCT_NO,\\n                   IC0100 -- 本地通话费\\n            from dm.DM_AUTORPT_ACCT_${monthid}\\n            group by PRODUCT_NO,\\n                     IC0100\\n           ) b on a.phone_NO=b.PRODUCT_NO\\nleft join (\\n           select serv_id,\\n                  sum(prom_fee)/100 prom_fee\\n           from gbasedwd.dwd_tmp_v8_bos_50038_prom_log_${monthid}\\n            where adjust_item='88000002' \\n\\t\\t\\t      and prom_fee<0 \\n\\t        group by serv_id\\n          ) c on a.user_id=c.serv_id"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [407]-[index:631]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[22]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"22.月平均消费","nodeId":"22","sql":"##近三个月平均消费（剔除即扣即返收入）\\n##近六个月平均消费（剔除即扣即返收入）\\ndrop table tmp_mounth_avg_${monthid};\\nCREATE TABLE tmp_mounth_avg_${monthid}    \\n(\\n  phone_no varchar(20),\\n  last3_mounth_avg_cc decimal(41,2), -- 近三个月平均消费（剔除即扣即返收入）\\n  last6_mounth_avg_cc decimal(44,2)  -- 近六个月平均消费（剔除即扣即返收入）\\n)distributed by ('phone_No');\\ninsert into tmp_mounth_avg_${monthid}\\nselect a.phone_no,\\n       ((nvl(d.SHOULD_INCOME,0)-c.month_jkjf_income)+\\n        (nvl(b.MONTH_FEE,0)-c.p_month_jkjf_income)+\\n        (nvl(b.LAST1_MONTH_FEE,0)-c.p1_month_jkjf_income))/3 as last3_mounth_avg_cc,\\n\\t   ((nvl(d.SHOULD_INCOME,0)-c.month_jkjf_income)+\\n\\t    (nvl(b.MONTH_FEE,0)-c.p_month_jkjf_income)+\\n\\t    (nvl(b.LAST1_MONTH_FEE,0)-c.p1_month_jkjf_income)+\\n\\t    (nvl(b.LAST2_MONTH_FEE,0)-c.p2_month_jkjf_income)+\\n\\t    (nvl(b.LAST3_MONTH_FEE,0)-c.p3_month_jkjf_income)+\\n\\t    (nvl(b.LAST4_MONTH_FEE,0)-c.p4_month_jkjf_income))/6 as last6_mounth_avg_cc\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a    \\nleft join (select phone_no,\\n                  sum(SHOULD_INCOME) SHOULD_INCOME \\n\\t\\t       from gbasedwi.DWI_INCO_BILL_USER_MS_${monthid}\\n\\t\\t       group by phone_no\\n\\t\\t    ) d on a.phone_no=d.phone_no \\nleft join (select product_no,\\n                  MONTH_FEE,\\n                  LAST1_MONTH_FEE,\\n\\t\\t\\t\\t  LAST2_MONTH_FEE,\\n\\t\\t\\t\\t  LAST3_MONTH_FEE,\\n\\t\\t\\t\\t  LAST4_MONTH_FEE\\n\\t\\t   from dm.dm_pub_his_index_${pmonthid}\\n\\t\\t   group by product_no,\\n\\t\\t          MONTH_FEE,\\n                  LAST1_MONTH_FEE,\\n\\t\\t\\t\\t  LAST2_MONTH_FEE,\\n\\t\\t\\t\\t  LAST3_MONTH_FEE,\\n\\t\\t\\t\\t  LAST4_MONTH_FEE\\n\\t\\t   ) b on a.PHONE_NO=b.product_no\\nleft join dm.tmp_jkjf_income_${monthid} c on a.phone_no=c.phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [408]-[index:633]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[53]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"53.临时表06","nodeId":"53","sql":"drop table if exists tmp_dm_autorpt_his_index_06_${monthid};\\nCREATE TABLE tmp_dm_autorpt_his_index_06_${monthid}\\n (\\n  phone_no varchar(20) ,       \\n  is_4gnet_newuser bigint(1) ,  --  是否4G网络客户（本地剔除物联网）\\n  is_4g_arrieduser bigint(1) ,  --  是否4G有效客户（本地2019）\\n  CA_CUST_ID varchar(50)        --  客户CA编码\\n )distributed by ('phone_No');\\ninsert into tmp_dm_autorpt_his_index_06_${monthid}\\nselect a.phone_no,\\n      case when b.phone_No is not null then 1 else 0 end is_4gnet_newuser, --  是否4G网络客户（本地剔除物联网）\\n      '0' is_4g_arrieduser,   -- case when c.phone_No is not null then 1 else 0 end is_4g_arrieduser, --  是否4G有效客户（本地2019）\\n      d.CA_CUST_ID  -- 客户CA编码\\t\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a \\nleft join (     \\n           select phone_no \\n           from gbasemsm.msm_dw_basekpi_110725_deteil_${curmlastday}\\n           group by phone_No\\n           ) b on a.phone_no=b.phone_No\\n-- left join (\\n--            select phone_no \\n--            from gbasemsm.msm_dw_basekpi_110726_deteil_${curmlastday}\\n--            group by phone_No\\n--            ) c on a.phone_no=c.phone_No\\nleft join gbasedwi.DWI_USR_PESN_ALLCUST_MS_${monthid} d on a.CUST_ID=d.CUST_ID "} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [409]-[index:634]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[27]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"27.套餐月租费","nodeId":"27","sql":"drop table tmp_tc_month_fee_${monthid};\\nCREATE TABLE tmp_tc_month_fee_${monthid} \\n(\\n  phone_no varchar(20) ,\\n  LAST1_PLAN_MONTHLY_FEE decimal(12,2) ,\\n  LAST2_PLAN_MONTHLY_FEE decimal(12,2) ,\\n  LAST3_PLAN_MONTHLY_FEE decimal(12,2) ,\\n  LAST6_PLAN_MONTHLY_FEE decimal(12,2) ,\\n  last1_tc_month_fee decimal(12,2) ,\\n  last2_tc_month_fee decimal(12,2) ,\\n  last3_tc_month_fee decimal(12,2) ,\\n  last6_tc_month_fee decimal(12,2) ,\\n  lastyear_d_tc_month_fee decimal(12,2),\\n  lastyear_d_ztc_month_fee decimal(12,2)\\n) distributed by ('phone_No');\\ninsert into tmp_tc_month_fee_${monthid}\\nselect a.phone_no,      \\n       b.PLAN_MONTHLY_FEE LAST1_PLAN_MONTHLY_FEE, -- 主套餐月租费-前第1月\\n\\t   c.PLAN_MONTHLY_FEE LAST2_PLAN_MONTHLY_FEE, -- 主套餐月租费-前第2月\\n\\t   d.PLAN_MONTHLY_FEE LAST3_PLAN_MONTHLY_FEE, -- 主套餐月租费-前第3月\\n\\t   e.PLAN_MONTHLY_FEE LAST6_PLAN_MONTHLY_FEE, -- 主套餐月租费-前第6月       \\n\\t   f.PLAN_MONTHLY_FEE lastyear_d_ztc_month_fee, -- 主套餐月租费-去年同期 20190327日添加\\n\\t   b1.tc_month_fee    last1_tc_month_fee, --  套餐月租费-前第1月\\n\\t   b2.tc_month_fee    last2_tc_month_fee, --  套餐月租费-前第2月\\n\\t   b3.tc_month_fee    last3_tc_month_fee, --  套餐月租费-前第3月\\n\\t   b4.tc_month_fee    last6_tc_month_fee, --  套餐月租费-前第6月\\n\\t   b5.tc_month_fee    lastyear_d_tc_month_fee --  套餐月租费-去年同期\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid} a\\nleft join \\n       (\\n\\t    select PRODUCT_NO,PLAN_MONTHLY_FEE from DM_PUB_INCREASE_${pmonthid}@dblink_dm group by PRODUCT_NO,PLAN_MONTHLY_FEE\\n\\t\\t) b on a.phone_no=b.product_no\\nleft join \\n       (\\n\\t    select PRODUCT_NO,PLAN_MONTHLY_FEE from DM_PUB_INCREASE_${p2monthid}@dblink_dm  group by PRODUCT_NO,PLAN_MONTHLY_FEE\\n\\t\\t) c on a.phone_no=c.product_no\\nleft join \\n       (\\n\\t    select PRODUCT_NO,PLAN_MONTHLY_FEE from DM_PUB_INCREASE_${p3monthid}@dblink_dm  group by PRODUCT_NO,PLAN_MONTHLY_FEE\\n\\t\\t) d on a.phone_no=d.product_no\\nleft join \\n       (\\n\\t    select PRODUCT_NO,PLAN_MONTHLY_FEE from DM_PUB_INCREASE_${p6monthid}@dblink_dm  group by PRODUCT_NO,PLAN_MONTHLY_FEE\\n\\t\\t) e on a.phone_no=e.product_no\\nleft join \\n       (\\n\\t    select PRODUCT_NO,PLAN_MONTHLY_FEE from DM_PUB_INCREASE_${preYearcurMonth}@dblink_dm  group by PRODUCT_NO,PLAN_MONTHLY_FEE\\n\\t\\t) f on a.phone_no=f.product_no\\nleft join (\\n            select PRODUCT_NO,IC1500 tc_month_fee from DM_AUTORPT_ACCT_${pmonthid}@dblink_dm  group by PRODUCT_NO,IC1500\\n          ) b1 on a.phone_no=b1.product_no\\nleft join (\\n            select PRODUCT_NO,IC1500 tc_month_fee from DM_AUTORPT_ACCT_${p2monthid}@dblink_dm  group by PRODUCT_NO,IC1500\\n          ) b2 on a.phone_no=b2.product_no\\nleft join (\\n            select PRODUCT_NO,IC1500 tc_month_fee from DM_AUTORPT_ACCT_${p3monthid}@dblink_dm  group by PRODUCT_NO,IC1500\\n          ) b3 on a.phone_no=b3.product_no\\nleft join (\\n            select PRODUCT_NO,IC1500 tc_month_fee from DM_AUTORPT_ACCT_${p6monthid}@dblink_dm  group by PRODUCT_NO,IC1500\\n          ) b4 on a.phone_no=b4.product_no\\nleft join (     \\n            select PRODUCT_NO,IC1500 tc_month_fee from DM_AUTORPT_ACCT_${preYearcurMonth}@dblink_dm  group by PRODUCT_NO,IC1500\\n          ) b5 on a.phone_no=b5.product_no\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [410]-[index:635]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[56]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"56.临时表07","nodeId":"56","sql":"DROP TABLE IF EXISTS tmp_dm_autorpt_his_index_07_${monthid};\\nCREATE TABLE tmp_dm_autorpt_his_index_07_${monthid}   \\n(\\t\\n    USER_ID\\t\\tVARCHAR(20),\\t -- 用户标识   \\n\\tREMOVE_FEE\\tDECIMAL(12,2),\\t -- 折后ARPU\\n\\tyouhui_fee  DECIMAL(12,2),   -- arpu(优惠金额)\\n\\tycff_fee    DECIMAL(12,2)    -- arpu(预存返费金额)\\n)distributed by ('USER_ID');\\n\\nINSERT INTO tmp_dm_autorpt_his_index_07_${monthid}\\nselect a.user_id,\\n       nvl(a.should_fee,0) - nvl(b.fee,0) REMOVE_FEE,  -- 折后ARPU\\n\\t   nvl(c.youhui_fee,0),\\n\\t   nvl(b.fee,0)\\nfrom (\\n       select user_id,\\n\\t         sum(case when fee_item_id<>'0800' then should_fee/100 else 0 end) should_fee\\n\\t  from gbasebas.int_03004_ms_${monthid}\\n\\t  group by user_id\\n\\t  ) a\\nleft join (\\n       select user_id,\\n\\t\\t\\t abs(sum(case when fee_item_id='0800' then should_fee/100 else 0 end)) youhui_fee\\n\\t  from gbasebas.int_03005_ms_${monthid}\\n\\t  group by user_id\\n\\t  ) c on a.user_id=c.user_id\\nleft join\\n        ( \\n\\t\\t select user_id,\\n\\t\\t        sum(remove_fee/100) fee \\n\\t     from gbasemsm.int_03028_ms_${monthid}\\n\\t\\t group by user_id\\n\\t\\t )  b on a.user_id = b.user_id;\\t\\t\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [411]-[index:636]-[DM_AUTORPT_HIS_INDEX_YYYYMM]-[80]-['str' object has no attribute 'lfind']:{"name":"80.SQL语句","nodeId":"80","dsName":"GbaseDM","sql":"delete from tmp_dm_autorpt_his_index_12_list_${monthid} where op_time='${i}';\\ninsert into tmp_dm_autorpt_his_index_12_list_${monthid}\\nselect '${i}',\\n       a.phone_no,\\n       sum(case when county_name='香港' then CALL_DUR else 0 end),\\n       sum(case when county_name='香港' then TOTAL_FEE else 0 end),\\n       sum(case when county_name='新加坡' then CALL_DUR else 0 end),\\n       sum(case when county_name='新加坡' then TOTAL_FEE else 0 end),\\n       sum(case when county_name='韩国' then CALL_DUR else 0 end),\\n       sum(case when county_name='韩国' then TOTAL_FEE else 0 end),\\n       sum(case when county_name='蒙古' then CALL_DUR else 0 end),\\n       sum(case when county_name='蒙古' then TOTAL_FEE else 0 end),\\n       sum(case when county_name='德国' then CALL_DUR else 0 end),\\n       sum(case when county_name='德国' then TOTAL_FEE else 0 end),\\n       sum(case when county_name='法国' then CALL_DUR else 0 end),\\n       sum(case when county_name='法国' then TOTAL_FEE else 0 end),\\n       sum(case when county_name='澳大利亚' then CALL_DUR else 0 end),\\n       sum(case when county_name='澳大利亚' then TOTAL_FEE else 0 end),\\n       sum(case when county_name='美国' then CALL_DUR else 0 end),\\n       sum(case when county_name='美国' then TOTAL_FEE else 0 end)\\nfrom gbasedwd.DWD_EVT_CDR_VOC_DS_${i} a\\nleft join \\n(select trim(inter_code) as inter_code,trim(county_name) as county_name \\n from gbasedwd.dim_inter \\n where test_flag=1\\n group by trim(inter_code),trim(county_name)) d\\non a.OPPHOME_CITY_ID=d.inter_code\\nwhere (base_fee+toll_fee+toll_append_fee_1+toll_append_fee_2)>0 and TOLL_TYPE in (3,4,5,6,8)\\ngroup by a.phone_no\\n\\n","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [412]-[index:637]-[漫游视图]-[15]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"同步数据","nodeId":"15","sql":"delete from dm_pub_roam_voc_gprs_dm_${monthid} where op_time='${day_id}';\\ninsert into dm_pub_roam_voc_gprs_dm_${monthid} \\nselect * from dm_pub_roam_voc_gprs_dm_${monthid}@dblink_dm\\nwhere op_time='${day_id}';\\n\\ndelete from dm_pub_roam_voc_gprs_dm_yyyymm;\\ninsert into dm_pub_roam_voc_gprs_dm_yyyymm\\nselect max(op_time) from dm_pub_roam_voc_gprs_dm_${monthid}\\n;\\n\\n\\n\\ncreate table if not exists dm.dm_pub_roam_voc_gprs_ds_${dayid}\\n(product_no  varchar(20))distributed by ('product_no')"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [413]-[index:640]-[漫游视图]-[23]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"23.SQL语句","nodeId":"23","sql":"drop table dm_pub_roam_voc_gprs_dm_${monthid};\\ncreate table dm_pub_roam_voc_gprs_dm_${monthid}\\n(op_time        date,     --  统计时间\\nphone_no        varchar(20),   -- 手机号\\nprovince_name   varchar(20),   -- 省份\\ncall_dur        bigint,        -- 通话时长（分钟）\\nORGN_CALL_DUR   bigint,        -- 原始通话时长（秒）\\ncall_num        bigint,        -- 通话次数\\ncall_total_fee       decimal(20,2), -- 通话费\\ngprs_dur        bigint,        -- 流量使用时长（分钟）\\nTOTAL_FLOW      decimal(20,2), -- 使用流量（MB）\\ngprs_num        bigint,        -- 流量使用次数\\ngprs_total_fee       decimal(20,2)  -- 流量费\\n)distributed by ('phone_no');\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [414]-[index:641]-[漫游视图]-[12]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"12.插入当天数据","nodeId":"12","sql":"delete from dm_pub_roam_voc_gprs_dm_${monthid} where op_time='${day_id}';\\ninsert into dm_pub_roam_voc_gprs_dm_${monthid}\\nselect '${day_id}',\\n       nvl(a.phone_no,b.phone_no),\\n\\t   nvl(a.province_name,b.province_name),\\n\\t   nvl(a.call_dur,0),\\n\\t   nvl(a.ORGN_CALL_DUR,0),\\n\\t   nvl(a.call_num,0),\\n\\t   nvl(a.total_fee,0),\\n\\t   nvl(b.call_dur,0),\\n\\t   nvl(b.TOTAL_FLOW,0),\\n\\t   nvl(b.call_num,0),\\n\\t   nvl(b.total_fee,0)\\nfrom tmp_pub_roam_voc_${dayid} a\\nfull join tmp_pub_roam_gprs_${dayid} b on a.phone_no=b.phone_no and a.province_name=b.province_name"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [415]-[index:642]-[漫游视图]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"5.gprs","nodeId":"5","sql":"drop table tmp_pub_roam_gprs_${dayid};\\ncreate table tmp_pub_roam_gprs_${dayid}\\n(phone_no       varchar(20),\\nprovince_name   varchar(20),\\ncall_dur        bigint,\\nTOTAL_FLOW      decimal(20,2),\\ncall_num        bigint,\\ntotal_fee       decimal(20,2)\\n)distributed by ('phone_no');\\ninsert into tmp_pub_roam_gprs_${dayid}\\nselect phone_no,b.province_name,sum(call_dur),sum(TOTAL_FLOW)/1024/1024,sum(call_num),sum(total_fee)\\nfrom gbasedwd.DWD_EVT_CDR_GPRS_BUSITYPETOT_DM_${monthid} a\\nleft join gbasedwd.dim_call_roamcity b on (case when a.roam_city=100 then 10 else a.roam_city end)=b.city_id\\nwhere roam_type in (0,1,5,7) and a.roam_city is not null and a.stat_date='${day_id}'\\ngroup by phone_no,b.province_name\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [416]-[index:643]-[漫游视图]-[7]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"建表","nodeId":"7","sql":"drop table dm_pub_roam_voc_gprs_dm_${monthid};\\ncreate table dm_pub_roam_voc_gprs_dm_${monthid}\\n(op_time        date,     --  统计时间\\nphone_no        varchar(20),   -- 手机号\\nprovince_name   varchar(20),   -- 省份\\ncall_dur        bigint,        -- 通话时长（分钟）\\nORGN_CALL_DUR   bigint,        -- 原始通话时长（秒）\\ncall_num        bigint,        -- 通话次数\\ncall_total_fee       decimal(20,2), -- 通话费\\ngprs_dur        bigint,        -- 流量使用时长（分钟）\\nTOTAL_FLOW      decimal(20,2), -- 使用流量（MB）\\ngprs_num        bigint,        -- 流量使用次数\\ngprs_total_fee       decimal(20,2)  -- 流量费\\n)distributed by ('phone_no');\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [417]-[index:644]-[漫游视图]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"3.voc","nodeId":"3","sql":"drop table tmp_pub_roam_voc_${dayid};\\ncreate table tmp_pub_roam_voc_${dayid}\\n(phone_no       varchar(20),\\nprovince_name   varchar(20),\\ncall_dur        bigint,\\nORGN_CALL_DUR   bigint,\\ncall_num        bigint,\\ntotal_fee       decimal(20,2)\\n)distributed by ('phone_no');\\ninsert into tmp_pub_roam_voc_${dayid}\\nselect phone_no,b.province_name,sum(call_dur),sum(ORGN_CALL_DUR),sum(call_num),sum(total_fee)\\nfrom gbasedwd.DWD_EVT_CDR_VOC_BASETOT_DS_${dayid} a\\nleft join gbasedwd.dim_call_roamcity b on a.roam_city=b.city_id\\nwhere roam_type in (0,1,5,7) and a.roam_city is not null\\ngroup by phone_no,b.province_name\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [418]-[index:646]-[对端号码视图]-[7]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"7.插入数据","nodeId":"7","sql":"insert into ${dm_pub_call_info_yyyymm}\\n     (\\tOP_TIME,\\n\\t\\tSTATIS_MONTH,\\n\\t\\tPRODUCT_NO,\\n\\t\\tcounty_name,\\n\\t\\tOPPOSITE_REGULAR_NO, \\n\\t\\tOUT_CALL_COUNT,\\n\\t\\tOUT_CALL_DURATION_M,\\n\\t\\tIN_CALL_COUNT,\\n\\t\\tIN_CALL_DURATION_M)\\n   select TO_DATE('${monthid}','YYYYMM') OP_TIME,\\n          TO_DATE('${monthid}','YYYYMM') STATIS_MONTH,\\n          a.phone_no product_no,\\n\\t\\t  b.dept_county_name,\\n          opp_no opp_no,\\n          sum(CALING_LOC_CALL_NUM + CALING_TOLL_CALL_NUM +\\n              CALING_ROAM_CALL_NUM),\\n          sum(CALING_LOC_CALL_DUR + CALING_TOLL_CALL_DUR + CALING_ROAM_CALL_DUR),\\n          sum(CALLED_LOC_CALL_NUM + CALLED_TOLL_CALL_NUM +\\n              CALLED_ROAM_CALL_NUM),\\n          sum(CALLED_LOC_CALL_DUR + CALLED_TOLL_CALL_DUR + CALLED_ROAM_CALL_DUR)\\n     from gbasedwi.DWI_BEH_USE_SPHERE_TOT_MS_${monthid}  a\\n\\t left join (select phone_no,\\n                 b.dept_county_name\\n           from gbasedwi.dwi_usr_pesn_persn_loc_ms_${monthid} a \\n            left join ( select dept_county_id,dept_county_name \\n                        from gbasedwd.dim_pub_dept_county\\n                       ) b on a.dept_county_id=b.dept_county_id ) b on a.phone_no=b.phone_no\\n\\t where (length(opp_no) <= '11' and opp_no not like '13%' and\\n          opp_no not like '14%' and opp_no not like '15%' and opp_no not like '19%' and\\n          opp_no not like '18%' and opp_no not like '16%' and opp_no not like '17%' and\\n          length(rtrim(translate(opp_no, '0123456789', ''))) = '0' and\\n          length(rtrim(translate(opp_no, '0', ''))) != '0')\\n\\t  or (length(opp_no) > '11' and\\n          substr(opp_no, length(opp_no) - 10, 2) not like '13%' and\\n          substr(opp_no, length(opp_no) - 10, 2) not like '14%' and\\n          substr(opp_no, length(opp_no) - 10, 2) not like '15%' and\\n          substr(opp_no, length(opp_no) - 10, 2) not like '18%' and\\n          substr(opp_no, length(opp_no) - 10, 2) not like '16%' and\\n          substr(opp_no, length(opp_no) - 10, 2) not like '17%' and\\n          substr(opp_no, length(opp_no) - 10, 2) not like '19%' and\\n          length(rtrim(translate(opp_no, '0123456789', ''))) = '0' and\\n          length(rtrim(translate(opp_no, '0', ''))) != '0')\\n\\tgroup by a.phone_no,b.dept_county_name,opp_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [419]-[index:649]-[对端号码视图]-[22]-['str' object has no attribute 'lfind']:{"name":"删除表","nodeId":"22","dsName":"GbaseDM","sql":"drop table ${dm_pub_call_info_yyyymm};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [420]-[index:651]-[对端号码视图]-[19]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"19","dsName":"GbaseDM","sql":"create table ${dm_pub_call_info_yyyymm}\\n\\t (\\tOP_TIME                 DATE  ,\\n\\t\\tSTATIS_MONTH            INTEGER ,\\n\\t\\tPRODUCT_NO              VARCHAR(20) ,\\n\\t\\tcounty_name             VARCHAR(20) ,\\n\\t\\tOPPOSITE_REGULAR_NO     VARCHAR(30) ,\\n\\t\\tOUT_CALL_COUNT          BIGINT,\\n\\t\\tOUT_CALL_DURATION_M     BIGINT,\\n\\t\\tIN_CALL_COUNT           BIGINT,\\n\\t\\tIN_CALL_DURATION_M      BIGINT\\t\\t)\\n\\tDISTRIBUTED BY('product_no') ;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [421]-[index:654]-[渠道酬金020502月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"8","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CHANNEL_020502_${monthid};\\nCREATE TABLE  DM_PUB_CHANNEL_020502_${monthid} distributed by('channel_code')  as select * from DM_PUB_CHANNEL_020502_YYYYMM ;\\n\\n","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [422]-[index:655]-[渠道酬金020502月调度传输]-[10]-['str' object has no attribute 'lfind']:{"name":"插入","nodeId":"10","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CHANNEL_020502_${monthid} \\n(select * from   \\n ODS_M_F_OTR_020502_SOCIETYSALEQUALITYLIST_${monthid}@dblink_ods);\\n\\n","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [423]-[index:657]-[业务稽核单]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"3.生成表","nodeId":"3","sql":"drop table DM_BBC_BI_D2D_BUSI_DD;\\ncreate table DM_BBC_BI_D2D_BUSI_DD distributed by ('audit_id')\\nselect distinct '${day_id}' op_time,\\n       a.audit_id,\\n       b.department_name,\\n       b.organized_name,\\n       a.done_date,\\n       a.audit_tic_type,\\n       a.bill_id,\\n       c.\\"name\\" yw_name,\\n       a.business_name,\\n       c.risk_level,\\n       a.brand,\\n       a.done_code,\\n       a.case_no,\\n       a.op_name,\\n       a.op_code,\\n       a.file_id,\\n       a.order_code,\\n\\t   a.cust_id,\\n       g1.cust_service_id,\\n       a.customer_order_id,\\n       a.cust_name,\\n       a.special_num_name,\\n       a.opr_object_name,\\n       a.channel_type_name,\\n       a.pre_order_id,\\n       a.is_wzh,\\n       a.sys_auto,\\n       a.is_relation_receipt,\\n       d.attr_value,\\n       nvl(e.real_name_flag,0)real_name_flag,\\n       c.is_import_business,\\n       a.order_state_name,\\n       a.is_channel_mid,\\n       a.audit_status,\\n       a.auditor_name,\\n       a.auditor_code,\\n       a.audit_time,\\n       a.audit_desc,\\n       a.audit_modify_counts,\\n       a.err_op_name,\\n       a.err_op_code,\\n       a.err_op_id,\\n       a.err_time,\\n       a.err_mdy_desc,\\n       a.rechecker_name,\\n       a.rechecker_code,\\n       a.recheck_time,\\n       a.recheck_desc,\\n       a.tck_cmp_time,\\n       a.deadline,\\n\\t   a.batch_audit\\nfrom SA_D_DM_BBC_BI_D2D_BUSI_dt_${dayid} a\\nleft join gbaseods.ODS_D_F_BBC_SYS_EA_DEPT_ORG_${dayid} b on a.org_id=b.organize_id\\nleft join gbaseods.ODS_D_F_BBC_SYS_PERSONAL_BUSI_TYPE_${dayid} c on a.busi_type_id_by_d2d=c.id\\nleft join (select cust_id,max(case when attr_value='Y' then 1 else 0 end) attr_value\\n           from gbaseods.ods_d_f_crm_01563_indiv_cust_ext_${dayid} group by cust_id) d on a.cust_id=d.cust_id\\nleft join (select cust_id,real_name_flag,row_number()over(partition by cust_id order by done_date desc)rn \\n           from gbaseods.ods_d_f_crm_01001_cust_info_${dayid}) e on a.cust_id=e.cust_id and e.rn=1\\nleft join (select cust_id,cust_service_id,row_number()over(partition by cust_id order by done_date desc)rn \\n           from gbaseods.ods_d_f_crm_01001_cust_info_${dayid} where state='U') g1 on a.cust_id=g1.cust_id and g1.rn=1\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [424]-[index:658]-[业务稽核单]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"5.导表到小集群","nodeId":"5","sql":"drop table DM_BBC_BI_D2D_BUSI_DD;\\ncreate table DM_BBC_BI_D2D_BUSI_DD distributed by ('audit_id')\\nselect * from DM_BBC_BI_D2D_BUSI_DD@dblink_dm;\\n\\n\\ndelete from dim_d2d_ORGANIZED_NAME;\\ninsert into dim_d2d_ORGANIZED_NAME\\nselect distinct organized_name\\nfrom (\\nselect distinct organized_name from DM_BBC_BI_D2D_BUSI_DD\\nunion all\\nselect distinct organized_name from dm_pub_d2d_receipt_ticket_dd\\n)a;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [425]-[index:661]-[IMEI信息视图日累计调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_IMEI_INFO_${dayid};\\ncreate table DM_PUB_IMEI_INFO_${dayid} distributed by ('IMEI')  as select * from DM_PUB_IMEI_INFO_YYYYMMDD;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [426]-[index:662]-[IMEI信息视图日累计调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"8.插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_IMEI_INFO_${dayid} \\nselect *\\n from DM_PUB_IMEI_INFO_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [427]-[index:663]-[top25流失原因用户123]-[3]-['str' object has no attribute 'lfind']:{"name":"3.累计表","nodeId":"3","dsName":"GbaseDM","sql":"-- create table dm.dm_pot25_lost_cause_flow_dm\\n-- (op_time          date,\\n--  mon              int,\\n--  product_no       varchar(20),\\n--  remove_fee       decimal(12,2),\\n--  gprs             bigint,\\n--  out_call_dur     bigint\\n-- )distributed by ('product_no');\\ndelete from  dm.dm_pot25_lost_cause_flow_dm where op_time='${curm_first_day}';\\ninsert into dm.dm_pot25_lost_cause_flow_dm\\nselect '${curm_first_day}',\\n       ${monthid},\\n       a.product_no,\\n       max(nvl(a.remove_fee,0)),\\n       max(nvl(c.GP0000,0)),\\n       max(nvl(d.out_call_dureation_m,0))\\nfrom dm_autorpt_his_index_${monthid}@dblink_dm a \\nleft join dm_autorpt_newbusi_${monthid}@dblink_dm c on a.product_no=c.product_no\\nleft join dm_pub_201212018_${monthid}@dblink_dm d on a.product_no=d.product_no\\ngroup by a.product_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [428]-[index:665]-[top25流失原因用户123]-[31]-['str' object has no attribute 'lfind']:{"name":"31.累计合约失效用户","nodeId":"31","dsName":"GbaseDM","sql":"## 累计合约失效用户\\n-- create table dm.dm_pot25_lost_cause_heyue_dm\\n-- (op_time       date,\\n--  mon           int,\\n--  product_no    varchar(20),\\n--  offer_id      bigint,\\n--  order_name    varchar(100),\\n--  end_date      date\\n-- )distributed by ('product_no') ;\\n\\ndelete from dm.dm_pot25_lost_cause_heyue_dm where op_time ='${curm_first_day}' ;\\ninsert into dm.dm_pot25_lost_cause_heyue_dm\\nselect '${curm_first_day}',\\n        ${monthid},\\n        product_no,\\n        offer_id,\\n        order_name,\\n        end_date\\nfrom (   select product_no, end_date,  offer_id ,order_name,\\n                 row_number() over(partition by product_no order by end_date desc,create_time desc ) rn \\n         from dm_product_offer_${monthid}@dblink_dm  a \\n         inner join dim_chang_qian_offer@dblink_dm  b on a.offer_id=b.plan_id\\n         ) a where rn =1 ;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [429]-[index:666]-[top25流失原因用户123]-[10]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"10.SQL语句","nodeId":"10","sql":"drop table dm.dm_pot25_lost_cause_user123_ms_${monthid} ;\\ncreate table dm.dm_pot25_lost_cause_user123_ms_${monthid}\\n( stat_date       date,\\n  product_no        varchar(20),   -- 手机号码\\n  county_id          int,\\n  online_month     int,           -- 网龄\\n  plan_name        varchar(100),  -- 合约名称\\n  end_date         date,          -- 合约到期时间\\n  end_flag         int,           -- 合约是否当月到期\\n  remove_fee       decimal(12,2), -- 拍照期折后ARPU\\n  avg_remove_fee   decimal(12,2), -- 考核期平均ARPU\\n  gprs             bigint,        -- 拍照期DOU\\n  avg_gprs         bigint,        -- 考核期DOU\\n  out_call_dur     bigint,        -- 拍照期MOU\\n  avg_out_call_dur bigint         -- 考核期MOU\\n) distributed by ('product_no');\\ninsert into dm.dm_pot25_lost_cause_user123_ms_${monthid}\\nselect  '${curm_first_day}',\\n       a.product_no,\\n       a.county_id,\\n       a.online_month,\\n       a.plan_name,\\n       a.end_date,\\n       case when to_number(date_format(end_date,'%Y%m'))=${monthid} then 1 else 0 end,\\n       a.remove_fee,\\n       nvl(b.remove_fee,0),\\n       a.gprs,\\n       nvl(b.gprs,0),\\n       a.out_call_dur,\\n       nvl(b.out_call_dur,0)\\nfrom dm.dm_pot25_lost_cause_user123_user_${monthid} a\\nleft join (select product_no,avg(remove_fee) remove_fee,\\n                  avg(gprs) gprs,\\n                  avg(out_call_dur) out_call_dur\\n           from dm.dm_pot25_lost_cause_flow_dm \\n           where mon  >=${year}01 and mon <=${monthid}\\n           group by product_no\\n           ) b on a.product_no=b.product_no\\n;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [430]-[index:667]-[top25流失原因用户123]-[20]-['str' object has no attribute 'lfind']:{"name":"20.SQL语句","nodeId":"20","dsName":"GbaseDM","sql":"drop table dm.dm_pot25_lost_cause_user123_ms_${monthid} ;\\ncreate table dm.dm_pot25_lost_cause_user123_ms_${monthid}\\n( stat_date       date,\\n  product_no        varchar(20),   -- 手机号码\\n  county_id          int,\\n  online_month     int,           -- 网龄\\n  plan_name        varchar(100),  -- 合约名称\\n  end_date         date,          -- 合约到期时间\\n  end_flag         int,           -- 合约是否当月到期\\n  remove_fee       decimal(12,2), -- 拍照期折后ARPU\\n  avg_remove_fee   decimal(12,2), -- 考核期平均ARPU\\n  gprs             bigint,        -- 拍照期DOU\\n  avg_gprs         bigint,        -- 考核期DOU\\n  out_call_dur     bigint,        -- 拍照期MOU\\n  avg_out_call_dur bigint         -- 考核期MOU\\n) distributed by ('product_no');\\ninsert into dm.dm_pot25_lost_cause_user123_ms_${monthid}\\nselect '${curm_first_day}',\\n       a.product_no,\\n       a.county_id,\\n       a.online_month,\\n       a.plan_name,\\n       a.end_date,\\n       case when to_number(date_format(end_date,'%Y%m'))=${monthid} then 1 else 0 end,\\n       a.remove_fee,\\n       nvl(b.remove_fee,0),\\n       a.gprs,\\n       nvl(b.gprs,0),\\n       a.out_call_dur,\\n       nvl(b.out_call_dur,0)\\nfrom dm.dm_pot25_lost_cause_user123_user_${monthid} a\\nleft join (select product_no,avg(remove_fee) remove_fee,\\n                  avg(gprs) gprs,\\n                  avg(out_call_dur) out_call_dur\\n           from dm.dm_pot25_lost_cause_flow_dm \\n           where mon  >=(${monthid}-5) and mon <=${monthid}\\n           group by product_no\\n           ) b on a.product_no=b.product_no\\n;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [431]-[index:670]-[top25流失原因用户123]-[7]-['str' object has no attribute 'lfind']:{"name":"7.数据导入大集群","nodeId":"7","dsName":"GbaseDM","sql":"-- CREATE TABLE dm.dm_pub_201212018_201911 (\\n--   OP_TIME date DEFAULT NULL,\\n--   STATIS_DATE bigint(20) DEFAULT NULL,\\n--   PRODUCT_NO varchar(20) DEFAULT NULL,\\n--   CPU_FREQUENCY bigint(20) DEFAULT NULL,\\n--   IS_GSM smallint(6) DEFAULT NULL,\\n--   IS_CDMA smallint(6) DEFAULT NULL,\\n--   IS_STABLE_IMEI smallint(6) DEFAULT NULL,\\n--   IS_NEW_IMEI smallint(6) DEFAULT NULL,\\n--   TERMSCREEN_ID varchar(10) DEFAULT NULL,\\n--   IS_TURN_BRAND smallint(6) DEFAULT NULL,\\n--   OLD_ORDER_NAME varchar(200) DEFAULT NULL,\\n--   NEW_ORDER_NAME varchar(200) DEFAULT NULL,\\n--   TRUTH_NAME smallint(6) DEFAULT NULL,\\n--   BIRTH_DAY date DEFAULT NULL,\\n--   ENTERPRISE_MARK smallint(6) DEFAULT NULL,\\n--   BA_SVC_NO varchar(30) DEFAULT NULL,\\n--   DEPT_CHANNEL_ID bigint(20) DEFAULT NULL,\\n--   VIP_MANAGER_ID varchar(30) DEFAULT NULL,\\n--   WORK_NAME varchar(20) DEFAULT NULL,\\n--   STATION_NAME varchar(100) DEFAULT NULL,\\n--   VIP_NO varchar(50) DEFAULT NULL,\\n--   IS_APPLY_STOP smallint(6) DEFAULT NULL,\\n--   FIRST_NET_AWAKE smallint(6) DEFAULT NULL,\\n--   CALL_DAYS bigint(20) DEFAULT NULL,\\n--   MESSAGE_DAYS bigint(20) DEFAULT NULL,\\n--   ACCT2 decimal(14,2) DEFAULT NULL,\\n--   ACCT12 decimal(14,2) DEFAULT NULL,\\n--   ACCT14 decimal(14,2) DEFAULT NULL,\\n--   ACCT16 decimal(14,2) DEFAULT NULL,\\n--   IR_STAR_LONG decimal(14,2) DEFAULT NULL,\\n--   ACK_INTLONG decimal(14,2) DEFAULT NULL,\\n--   CUR_PROMOTION_SCORE bigint(20) DEFAULT NULL,\\n--   CUR_DATA_SCORE bigint(20) DEFAULT NULL,\\n--   CUR_CONSUME_SCORE bigint(20) DEFAULT NULL,\\n--   CHANGE_SCORE_MONTH bigint(20) DEFAULT NULL,\\n--   CHANGE_SCORE_YEAR bigint(20) DEFAULT NULL,\\n--   CMNET_TIME bigint(20) DEFAULT NULL,\\n--   CMWAP_TIME bigint(20) DEFAULT NULL,\\n--   FREE_FLOW_ALL bigint(20) DEFAULT NULL,\\n--   IS_ACTIVE smallint(6) DEFAULT NULL,\\n--   IS_ACCT_USER smallint(6) DEFAULT NULL,\\n--   LAST_YEAR_PHONE smallint(6) DEFAULT NULL,\\n--   ISCARD_DOUBLE smallint(6) DEFAULT NULL,\\n--   ENT_CUST_ID varchar(50) DEFAULT NULL,\\n--   DOUBLE_CARD_TYPE smallint(6) DEFAULT NULL,\\n--   IS_TD_USER smallint(6) DEFAULT NULL,\\n--   IS_PHOTO_USER smallint(6) DEFAULT NULL,\\n--   PHOTO_DEPT bigint(20) DEFAULT NULL,\\n--   TURN_BRAND_OLD bigint(20) DEFAULT NULL,\\n--   TURN_BRAND_NEW bigint(20) DEFAULT NULL,\\n--   OPPOSITE_NUMBER int(11) DEFAULT NULL,\\n--   OPPOSITE_PHONE_NUMBER bigint(20) DEFAULT NULL,\\n--   CUST_LEVEL bigint(20) DEFAULT NULL,\\n--   IMSI_NO varchar(30) DEFAULT NULL,\\n--   LAST_GPRS_FLOW_M bigint(20) DEFAULT NULL,\\n--   CALL_TOTAL_PROPORTION decimal(14,3) DEFAULT NULL,\\n--   MESSAGE_TOTAL_PROPORTION decimal(14,3) DEFAULT NULL,\\n--   GPRS_TOTAL_PROPORTION decimal(14,3) DEFAULT NULL,\\n--   CALL_DURATION_M bigint(20) DEFAULT NULL,\\n--   OUT_CALL_DUREATION_M bigint(20) DEFAULT NULL,\\n--   IN_CALL_DURATION_M bigint(20) DEFAULT NULL,\\n--   INPLAN_OUT_CALL_DURAION_M bigint(20) DEFAULT NULL,\\n--   INPLAN_IN_CALL_DURATION_M bigint(20) DEFAULT NULL,\\n--   OUTPLAN_OUT_CALL_DURATION_M bigint(20) DEFAULT NULL,\\n--   OUTPLAN_IN_CALL_DURATION_M bigint(20) DEFAULT NULL,\\n--   TD_CALL_NUM bigint(20) DEFAULT NULL,\\n--   TD_VOICE_NUM bigint(20) DEFAULT NULL,\\n--   TD_GPRS_NUM bigint(20) DEFAULT NULL,\\n--   IS_SCHOOL_USER smallint(6) DEFAULT NULL,\\n--   TD_PHONE varchar(100) DEFAULT NULL,\\n--   WLAN_GPRS bigint(20) DEFAULT NULL,\\n--   WLANPC_GPRS bigint(20) DEFAULT NULL,\\n--   CALL_10086_COUNT bigint(20) DEFAULT NULL,\\n--   SCALE_ID smallint(6) DEFAULT NULL,\\n--   OWE_THREE_FEE decimal(14,2) DEFAULT NULL,\\n--   MARGIN_GPRS bigint(20) DEFAULT NULL,\\n--   GPRS_COUNT1 bigint(20) DEFAULT NULL,\\n--   GPRS_COUNT2 int(11) DEFAULT NULL,\\n--   GPRS_COUNT3 int(11) DEFAULT NULL,\\n--   GPRS_COUNT4 int(11) DEFAULT NULL,\\n--   TD_THREEMONTH_PHONE varchar(100) DEFAULT NULL,\\n--   BRAND_ID smallint(6) DEFAULT NULL,\\n--   MAIN_BRAND_ID smallint(6) DEFAULT NULL,\\n--   LAST_STOP_DATE datetime DEFAULT NULL,\\n--   STOP_ONCE_NUM bigint(20) DEFAULT NULL,\\n--   STOP_TWICE_NUM bigint(20) DEFAULT NULL,\\n--   OWE_FEE decimal(13,3) DEFAULT NULL,\\n--   IS_SELL smallint(6) DEFAULT NULL,\\n--   IS_CHANGE_USIM smallint(6) DEFAULT NULL,\\n--   IS_HANDLE_4G smallint(6) DEFAULT NULL,\\n--   IS_TERMINAL_4G smallint(6) DEFAULT NULL,\\n--   IS_MIFI_4G smallint(6) DEFAULT NULL,\\n--   TERMINAL_4G varchar(800) DEFAULT NULL,\\n--   IS_TEST_4G smallint(6) DEFAULT NULL,\\n--   IS_PREPARATION_CARD smallint(6) DEFAULT NULL,\\n--   IS_ACTIVATION_CARD smallint(6) DEFAULT NULL,\\n--   IS_139MAILBOX_USER smallint(6) DEFAULT NULL,\\n--   IS_DELAY_USER smallint(6) DEFAULT NULL,\\n--   IS_LISTPROTECT_USER smallint(6) DEFAULT NULL,\\n--   IS_BILLPROTECT_USER smallint(6) DEFAULT NULL,\\n--   IS_3G_ASSESSUSER smallint(6) DEFAULT NULL,\\n--   IS_4G_ASSESSUSER smallint(6) DEFAULT NULL,\\n--   IS_4G_USER smallint(6) DEFAULT NULL,\\n--   IS_YEAR_PHONE smallint(6) DEFAULT NULL,\\n--   IS_OFFER_4G smallint(6) DEFAULT NULL,\\n--   IS_CONTRACT_4G smallint(6) DEFAULT NULL,\\n--   ACTIVE_COUNT smallint(6) DEFAULT NULL,\\n--   GPRS_FEE decimal(13,3) DEFAULT NULL,\\n--   IS_STRESS smallint(6) DEFAULT NULL,\\n--   THREE_FOUR_IMEI varchar(14) DEFAULT NULL,\\n--   TRANSFER_CALL_DURATION_M bigint(20) DEFAULT NULL,\\n--   CUST_TYPE varchar(20) DEFAULT NULL,\\n--   DEPT_NAME varchar(20) DEFAULT NULL,\\n--   ENTERPRISE_MARK1 varchar(50) DEFAULT NULL,\\n--   IS_MISSUSER varchar(50) DEFAULT NULL,\\n--   CAMPUS_ID smallint(6) DEFAULT NULL,\\n--   IS_USIM_USER smallint(6) DEFAULT NULL,\\n--   IS_NFC_USER smallint(6) DEFAULT NULL,\\n--   IS_YIJINGPHONE_USER smallint(6) DEFAULT NULL,\\n--   FLAG_2G varchar(1) DEFAULT NULL,\\n--   FLAG_3G varchar(1) DEFAULT NULL,\\n--   FLAG_4G varchar(1) DEFAULT NULL,\\n--   RES_SPEC_NAME varchar(256) DEFAULT NULL,\\n--   MAT_CODE varchar(25) DEFAULT NULL,\\n--   DONE_DATE date DEFAULT NULL,\\n--   ROOM_NAME varchar(100) DEFAULT NULL,\\n--   DUAL_CARD varchar(1) DEFAULT NULL,\\n--   CALL_USED_VALUE bigint(20) DEFAULT NULL,\\n--   IS_YIJING_ACCT_USER int(11) DEFAULT NULL,\\n--   IS_4GNET_user_kaohe int(11) DEFAULT NULL,\\n--   IS_offer_user bigint(20) DEFAULT NULL,\\n--   county_id int(11) DEFAULT NULL,\\n--   is_comm_user varchar(10) DEFAULT NULL,\\n--   dx_gprs_resource_bhd decimal(10,4) DEFAULT NULL,\\n--   bxl_gprs_resource_bhd decimal(10,4) DEFAULT NULL,\\n--   curm_arpu decimal(18,2) DEFAULT NULL,\\n--   yk_flow_m bigint(20) DEFAULT NULL,\\n--   tx_flow_m bigint(20) DEFAULT NULL,\\n--   aqi_flow_m bigint(20) DEFAULT NULL,\\n--   mgzb_flow_m bigint(20) DEFAULT NULL,\\n--   pptv_flow_m bigint(20) DEFAULT NULL,\\n--   xg_flow_m bigint(20) DEFAULT NULL,\\n--   mg_flow_m bigint(20) DEFAULT NULL,\\n--   blbl_flow_m bigint(20) DEFAULT NULL,\\n--   wy_flow_m bigint(20) DEFAULT NULL,\\n--   mgyy_flow_m bigint(20) DEFAULT NULL,\\n--   wzry_flow_m bigint(20) DEFAULT NULL,\\n--   mgyx_flow_m bigint(20) DEFAULT NULL,\\n--   mgyd_flow_m bigint(20) DEFAULT NULL,\\n--   mgdm_flow_m bigint(20) DEFAULT NULL,\\n--   qqyy_flow_m bigint(20) DEFAULT NULL,\\n--   kgyy_flow_m bigint(20) DEFAULT NULL,\\n--   kwyy_flow_m bigint(20) DEFAULT NULL,\\n--   jrtt_flow_m bigint(20) DEFAULT NULL,\\n--   ks_flow_M bigint(20) DEFAULT NULL,\\n--   bd_flow_m bigint(20) DEFAULT NULL,\\n--   wb_flow_m bigint(20) DEFAULT NULL,\\n--   sh_flow_m bigint(20) DEFAULT NULL,\\n--   bfyy_flow_m bigint(20) DEFAULT NULL,\\n--   ls_flow_m bigint(20) DEFAULT NULL,\\n--   mgsp_flow_m bigint(20) DEFAULT NULL,\\n--   ysj_flow_m bigint(20) DEFAULT NULL,\\n--   is_onetofive bigint(20) DEFAULT NULL,\\n--   Pmonthowefee01 decimal(16,2) DEFAULT NULL,\\n--   Pmonthowefee02 decimal(16,2) DEFAULT NULL,\\n--   Pmonthowefee03 decimal(16,2) DEFAULT NULL,\\n--   user_level int(11) DEFAULT NULL\\n-- ) ENGINE=EXPRESS DISTRIBUTED BY('product_no') DEFAULT CHARSET=utf8 TABLESPACE='sys_tablespace' ;\\n-- \\n-- insert into  dm.dm_pub_201212018_201911 \\n-- select * from dm_pub_201212018_201911@dblink_dm ;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [432]-[index:671]-[top25流失原因用户123]-[5]-['str' object has no attribute 'lfind']:{"name":"5.用户集","nodeId":"5","dsName":"GbaseDM","sql":"-- 用户集\\ndrop table dm.dm_pot25_lost_cause_user123_user_${monthid} ;\\ncreate table dm.dm_pot25_lost_cause_user123_user_${monthid} \\n(product_no      varchar(20),\\n county_id       int,\\n online_month    int,\\n plan_id         bigint,\\n plan_name       varchar(100),\\n end_date        date,\\n remove_fee       decimal(12,2),\\n gprs             bigint,\\n out_call_dur     bigint\\n)distributed by ('product_no') ;\\ninsert into dm.dm_pot25_lost_cause_user123_user_${monthid} \\nselect  phone_no,\\n        a.county_id,\\n        timestampdiff(month,date(I0425),'${curm_last_day}')+1,\\n        offer_id,\\n        order_name,\\n        end_date,\\n\\t\\tnvl(remove_fee,0),\\n        nvl(gprs,0),\\n        nvl(out_call_dur,0)\\nfrom  gbasemsm.tmp_msm_dw_basekpi_110705_detail_${curmlastday} a\\nleft join  dm.dm_autorpt_base_info_${monthid} b on a.phone_no=b.product_no\\nleft join (select product_no,offer_id,order_name,end_date \\n           from ( select product_no,end_date,offer_id,order_name,\\n                         row_number() over(partition by product_no order by end_date desc ) rn \\n                  from dm.dm_pot25_lost_cause_heyue_dm\\n                  where mon<='${monthid}' and end_date is not null\\n                ) a where rn=1\\n          ) c on a.phone_no=c.product_no\\nleft join (select product_no, avg(remove_fee) remove_fee ,\\n                  avg(gprs) gprs,avg(out_call_dur) out_call_dur\\n          from dm.dm_pot25_lost_cause_flow_dm \\n          where mon in (${pyearid}10,${pyearid}11,${pyearid}12)  group by product_no\\n          ) d on a.phone_no=d.product_no\\nwhere flag=1 and expand_flag in (1,2,3)\\n\\n;","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [433]-[index:672]-[top25流失原因用户123]-[27]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"导入小集群","nodeId":"27","sql":"drop table dm.dm_pot25_lost_cause_user123_ms_${monthid} ;\\ncreate table dm.dm_pot25_lost_cause_user123_ms_${monthid} distributed by ('product_no')\\nselect * from dm_pot25_lost_cause_user123_ms_${monthid}@dblink_dm;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [434]-[index:673]-[数据业务（日指标）]-[34]-['str' object has no attribute 'lfind']:{"name":"插入数据非一号","nodeId":"34","dsName":"GbaseDM","sql":"insert into ${DM_PUB_NEWBUSI_YYYYMMDD} \\n  (\\tOP_TIME\\n\\t,STATIS_DATE\\n\\t,PRODUCT_NO\\n\\t,D_N_001\\n\\t,D_N_002\\n\\t,D_N_003\\n\\t,D_N_004\\n\\t,D_N_005\\n\\t,D_N_006\\n\\t,D_N_007\\n\\t,D_N_008\\n\\t,D_N_009\\n\\t,D_N_010\\n\\t,D_N_011\\n\\t,D_N_012\\n\\t,D_N_013\\n\\t,D_N_014\\n\\t,D_N_015\\n\\t,D_N_016\\n\\t,D_N_017\\n\\t,D_N_018\\n\\t,D_N_019\\n\\t,D_N_020\\n\\t,D_N_021\\n\\t,D_N_022\\n\\t,D_N_023\\n\\t,D_N_024\\n\\t,D_N_025\\n\\t,D_N_026\\n\\t,D_N_027\\n\\t,D_N_028\\n\\t,D_N_029\\n\\t,D_N_030\\n\\t,D_N_031\\n\\t,D_N_032\\n\\t,D_N_033\\n\\t,D_N_034\\n\\t,D_N_035\\n\\t,D_N_036\\n\\t,D_N_037\\n\\t,D_N_038\\n\\t,D_N_039\\n\\t,D_N_040\\n\\t,D_N_041\\n\\t,D_N_042\\n\\t,D_N_043\\n\\t,D_N_044\\n\\t,D_N_045\\n\\t,D_N_046\\n\\t,D_N_047\\n\\t,D_N_048\\n\\t,D_N_049\\n\\t,D_N_050\\t) \\nselect  to_date('${dayid}','YYYYMMDD')         OP_TIME\\n\\t\\t,${dayid}                              STATIS_DATE\\n\\t\\t,nvl(nvl(nvl(nvl(t.PHONE_NO,t1.phone_no),t2.phone_no),t3.phone_no),t4.phone_no) PRODUCT_NO\\n\\t\\t,nvl(t1.SMS_P2P_NUM,0)                 D_N_001\\n\\t\\t,nvl(t1.SMS_P2P_INNET_NUM,0)           D_N_002\\n\\t\\t,nvl(t1.SMS_P2P_NETO_NUM,0)            D_N_003\\n\\t\\t,nvl(t1.SMS_P2P_NETO_CTC_CMC_NUM,0)    D_N_004\\n\\t\\t,nvl(t1.SMS_P2P_NETO_CUC_CMC_NUM,0)    D_N_005\\n\\t\\t,nvl(t1.MMS_P2P_NUM,0)                 D_N_006\\n\\t\\t,nvl(t1.MMS_P2P_INNET_NUM,0)     D_N_007\\n\\t\\t,nvl(t1.MMS_P2P_NETO_NUM,0)      D_N_008\\n\\t\\t,nvl(t1.MMS_P2P_CTC_NUM,0)       D_N_009\\n\\t\\t,nvl(t1.MMS_P2P_CUC_NUM,0)       D_N_010\\n\\t\\t,nvl(t1.MMS_INTER_NUM,0)         D_N_011\\n\\t\\t,nvl(t2.GPRS_TOTAL_FLOW,0)       D_N_012\\n\\t\\t,nvl(t2.GPRS_BUSY_FLOW,0)        D_N_013\\n\\t\\t,nvl(t2.GPRS_IDLE_FLOW,0)   D_N_014\\n\\t\\t,nvl(t2.GPRS_UP_FLOW,0)     D_N_015\\n\\t\\t,nvl(t2.GPRS_DOWN_FLOW,0)   D_N_016\\n\\t\\t,nvl(t3.WLAN_TOTAL_FLOW,0)  D_N_017\\n\\t\\t,nvl(t3.WLAN_TOTAL_DUR,0)   D_N_018\\n\\t\\t,nvl(t3.WLAN_CMCCEDU_DUR,0) D_N_019\\n\\t\\t,nvl(t2.GPRS_CMWAP_FLOW,0)  D_N_020\\n\\t\\t,nvl(t2.GPRS_CMNET_FLOW,0)  D_N_021\\n\\t\\t,nvl(t2.CMWAP_DUR,0)   D_N_022\\n\\t\\t,nvl(t2.CMNET_DUR,0)   D_N_023\\n\\t\\t,(t2.GPRS_LAND_ROAM_FLOW+t2.GPRS_INTER_ROAM_FLOW+t2.GPRS_HMT_ROAM_FLOW)   D_N_024\\n\\t\\t,nvl(t2.BILL_FLOW ,0)            D_N_025\\n\\t\\t/*,nvl(t4.COMM_DAYS,0)                   D_N_026*/\\n\\t\\t,nvl(t5.D_N_026,0)             D_N_026\\n\\t\\t,nvl(t2.G4_NET_GPRS_FLOW,0)            D_N_027\\n\\t\\t,nvl(t2.G4_NET_GPRS_UP_FLOW,0)         D_N_028\\n\\t\\t,nvl(t2.G4_NET_GPRS_DOWN_FLOW ,0)      D_N_029\\n\\t\\t,nvl(t2.GPRS_LAND_ROAM_FLOW ,0)        D_N_030\\n\\t\\t,null                           D_N_031\\n\\t\\t,null                           D_N_032\\n\\t\\t,null                           D_N_033\\n\\t\\t,null                           D_N_034\\n\\t\\t,null                           D_N_035\\n\\t\\t,null                           D_N_036\\n\\t\\t,null                           D_N_037\\n\\t\\t,null                           D_N_038\\n\\t\\t,null                           D_N_039\\n\\t\\t,null                           D_N_040\\n\\t\\t,null                           D_N_041\\n\\t\\t,null                           D_N_042\\n\\t\\t,null                           D_N_043\\n\\t\\t,null                           D_N_044\\n\\t\\t,null                           D_N_045\\n\\t\\t,null                           D_N_046\\n\\t\\t,null                           D_N_047\\n\\t\\t,null                           D_N_048\\n\\t\\t,null                           D_N_049\\n\\t\\t,null                           D_N_050\\nfrom  gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} t               /*用户资料小表月表*/\\nleft join (select phone_no\\n                 ,sum(SMS_P2P_NUM)               SMS_P2P_NUM            \\n                 ,sum(SMS_P2P_INNET_NUM)         SMS_P2P_INNET_NUM   \\n                 ,sum(SMS_P2P_NETO_NUM)          SMS_P2P_NETO_NUM   \\n                 ,sum(SMS_P2P_NETO_CTC_CMC_NUM)  SMS_P2P_NETO_CTC_CMC_NUM\\n                 ,sum(SMS_P2P_NETO_CUC_CMC_NUM)  SMS_P2P_NETO_CUC_CMC_NUM\\n                 ,sum(MMS_P2P_NUM)               MMS_P2P_NUM         \\n                 ,sum(MMS_P2P_INNET_NUM)         MMS_P2P_INNET_NUM \\n                 ,sum(MMS_P2P_NETO_NUM)          MMS_P2P_NETO_NUM \\n                 ,sum(MMS_P2P_CTC_NUM)           MMS_P2P_CTC_NUM   \\n                 ,sum(MMS_P2P_CUC_NUM)           MMS_P2P_CUC_NUM   \\n                 ,sum(MMS_INTER_NUM)             MMS_INTER_NUM\\n         from gbasedwi.DWI_BEH_USE_SMS_USERTOT_DT_${dayid} group by phone_no)  t1        /*用户短信行为汇总日累计表*/\\n\\ton t.phone_no=t1.phone_no\\nleft join (select phone_no\\n\\t\\t\\t\\t,sum(GPRS_TOTAL_FLOW)\\t\\t\\tGPRS_TOTAL_FLOW\\n\\t\\t\\t\\t,sum(GPRS_BUSY_FLOW)\\t\\t\\tGPRS_BUSY_FLOW\\n\\t\\t\\t\\t,sum(GPRS_IDLE_FLOW)\\t\\t\\tGPRS_IDLE_FLOW\\n\\t\\t\\t\\t,sum(GPRS_UP_FLOW)\\t\\t\\t\\tGPRS_UP_FLOW\\n\\t\\t\\t\\t,sum(GPRS_DOWN_FLOW)\\t\\t\\tGPRS_DOWN_FLOW\\n\\t\\t\\t\\t,sum(GPRS_CMWAP_FLOW)\\t\\t\\tGPRS_CMWAP_FLOW\\n\\t\\t\\t\\t,sum(GPRS_CMNET_FLOW)\\t\\t\\tGPRS_CMNET_FLOW\\n\\t\\t\\t\\t,sum(CMWAP_DUR)\\t\\t\\t\\t\\tCMWAP_DUR\\n\\t\\t\\t\\t,sum(CMNET_DUR)\\t\\t\\t\\t\\tCMNET_DUR\\n\\t\\t\\t\\t,sum(GPRS_LAND_ROAM_FLOW)\\t\\tGPRS_LAND_ROAM_FLOW\\n\\t\\t\\t\\t,sum(GPRS_INTER_ROAM_FLOW)\\t\\tGPRS_INTER_ROAM_FLOW\\n\\t\\t\\t\\t,sum(GPRS_HMT_ROAM_FLOW)\\t\\tGPRS_HMT_ROAM_FLOw\\n\\t\\t\\t\\t,sum(BILL_FLOW)\\t\\t\\t\\t\\tBILL_FLOW\\n\\t\\t\\t\\t,sum(G4_NET_GPRS_FLOW)\\t\\t\\tG4_NET_GPRS_FLOW\\n\\t\\t\\t\\t,sum(G4_NET_GPRS_UP_FLOW)\\t\\tG4_NET_GPRS_UP_FLOW\\n\\t\\t\\t\\t,sum(G4_NET_GPRS_DOWN_FLOW)\\t\\tG4_NET_GPRS_DOWN_FLOW\\n\\t\\t from  gbasedwi.DWI_BEH_USE_GPRS_USERTOT_DT_${dayid} group by phone_no) t2 /*用户GPRS业务汇总日累计表*/\\n\\ton t.phone_no=t2.phone_no\\nleft join gbasedwi.DWI_BEH_USE_WLAN_TOT_DT_${dayid}  t3 /*WLAN汇总日累计表*/   on t.phone_no=t3.phone_no\\nleft join  (select distinct phone_no from gbasedwi.DWI_BEH_USE_VOC_USERTOT_DT_${dayid}) t4 on t.phone_no = t4.phone_no\\nleft join (select PRODUCT_NO,D_N_026 from TMP_DM_PUB_NEWBUSI)  t5 on t.phone_no=t5.product_no\\nwhere PROD_KIND_CODE= '171000000001' and (t.MONTH_ARRIVE_FLAG=1 or t.MONTH_OFF_FLAG  =1 or t.MONTH_NEW_FLAG =1)","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [435]-[index:674]-[数据业务（日指标）]-[39]-['str' object has no attribute 'lfind']:{"name":"插入临时表","nodeId":"39","dsName":"GbaseDM","sql":"insert into TMP_DM_PUB_NEWBUSI\\n  (PRODUCT_NO\\n\\t,D_N_026)\\n\\tselect \\na.PRODUCT_NO,\\nsum(D_N_026) D_N_026\\nfrom (select\\nnvl(nvl(nvl(nvl(t.PHONE_NO,t1.phone_no),t2.phone_no),t3.phone_no),t4.phone_no) PRODUCT_NO,\\ncase when (NVL(t1.SMS_P2P_NUM,0)+NVL(t1.MMS_P2P_NUM,0)+NVL(t3.WLAN_TOTAL_FLOW,0)+NVL(t2.GPRS_TOTAL_FLOW,0))> 0 or nvl(t4.CALL_NUM,0)>0 then 1 else 0 end        D_N_026\\nfrom  gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} t               /*用户资料小表月表*/\\nleft join gbasedwi.DWI_BEH_USE_SMS_USERTOT_DS_${dayid}  t1        /*用户短信行为汇总日表*/\\n\\ton t.phone_no=t1.phone_no\\nleft join (select phone_no\\n\\t\\t\\t\\t,sum(GPRS_TOTAL_FLOW)\\t\\t\\tGPRS_TOTAL_FLOW\\n\\t\\t from  gbasedwi.DWI_BEH_USE_GPRS_USERTOT_DS_${dayid} group by phone_no) t2 /*用户GPRS业务汇总日表*/\\n\\ton t.phone_no=t2.phone_no\\nleft join gbasedwi.DWI_BEH_USE_WLAN_TOT_DS_${dayid} t3 /*WLAN汇总日累计表*/   on t.phone_no=t3.phone_no\\nleft join  (select phone_no\\n\\t\\t\\t\\t,sum(CALL_NUM) CALL_NUM  from  gbasedwi.DWI_BEH_USE_VOC_USERTOT_DS_${dayid} group by phone_no) t4 on t.phone_no = t4.phone_no\\nwhere PROD_KIND_CODE= '171000000001' and (t.MONTH_ARRIVE_FLAG=1 or t.MONTH_OFF_FLAG  =1 or t.MONTH_NEW_FLAG =1)  \\nUNION ALL select PRODUCT_NO,D_N_026 from dm_pub_newbusi_${pdayid} ) a group by a.product_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [436]-[index:678]-[数据业务（日指标）]-[43]-['str' object has no attribute 'lfind']:{"name":"创建临时表","nodeId":"43","dsName":"GbaseDM","sql":"drop table TMP_DM_PUB_NEWBUSI;\\ncreate table TMP_DM_PUB_NEWBUSI\\n ( PRODUCT_NO   varchar(20),\\n   D_N_026      BIGINT)distributed by ('PRODUCT_NO')","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [437]-[index:680]-[数据业务（日指标）]-[28]-['str' object has no attribute 'lfind']:{"name":"插入目标数据","nodeId":"28","dsName":"GbaseDM","sql":"insert into ${DM_PUB_NEWBUSI_YYYYMMDD} \\n  (\\tOP_TIME\\n\\t,STATIS_DATE\\n\\t,PRODUCT_NO\\n\\t,D_N_001\\n\\t,D_N_002\\n\\t,D_N_003\\n\\t,D_N_004\\n\\t,D_N_005\\n\\t,D_N_006\\n\\t,D_N_007\\n\\t,D_N_008\\n\\t,D_N_009\\n\\t,D_N_010\\n\\t,D_N_011\\n\\t,D_N_012\\n\\t,D_N_013\\n\\t,D_N_014\\n\\t,D_N_015\\n\\t,D_N_016\\n\\t,D_N_017\\n\\t,D_N_018\\n\\t,D_N_019\\n\\t,D_N_020\\n\\t,D_N_021\\n\\t,D_N_022\\n\\t,D_N_023\\n\\t,D_N_024\\n\\t,D_N_025\\n\\t,D_N_026\\n\\t,D_N_027\\n\\t,D_N_028\\n\\t,D_N_029\\n\\t,D_N_030\\n\\t,D_N_031\\n\\t,D_N_032\\n\\t,D_N_033\\n\\t,D_N_034\\n\\t,D_N_035\\n\\t,D_N_036\\n\\t,D_N_037\\n\\t,D_N_038\\n\\t,D_N_039\\n\\t,D_N_040\\n\\t,D_N_041\\n\\t,D_N_042\\n\\t,D_N_043\\n\\t,D_N_044\\n\\t,D_N_045\\n\\t,D_N_046\\n\\t,D_N_047\\n\\t,D_N_048\\n\\t,D_N_049\\n\\t,D_N_050\\t) \\nselect  to_date('${dayid}','YYYYMMDD')         OP_TIME\\n\\t\\t,${dayid}                              STATIS_DATE\\n\\t\\t,nvl(nvl(nvl(nvl(t.PHONE_NO,t1.phone_no),t2.phone_no),t3.phone_no),t4.phone_no) PRODUCT_NO\\n\\t\\t,nvl(t1.SMS_P2P_NUM,0)                 D_N_001\\n\\t\\t,nvl(t1.SMS_P2P_INNET_NUM,0)           D_N_002\\n\\t\\t,nvl(t1.SMS_P2P_NETO_NUM,0)            D_N_003\\n\\t\\t,nvl(t1.SMS_P2P_NETO_CTC_CMC_NUM,0)    D_N_004\\n\\t\\t,nvl(t1.SMS_P2P_NETO_CUC_CMC_NUM,0)    D_N_005\\n\\t\\t,nvl(t1.MMS_P2P_NUM,0)                 D_N_006\\n\\t\\t,nvl(t1.MMS_P2P_INNET_NUM,0)     D_N_007\\n\\t\\t,nvl(t1.MMS_P2P_NETO_NUM,0)      D_N_008\\n\\t\\t,nvl(t1.MMS_P2P_CTC_NUM,0)       D_N_009\\n\\t\\t,nvl(t1.MMS_P2P_CUC_NUM,0)       D_N_010\\n\\t\\t,nvl(t1.MMS_INTER_NUM,0)         D_N_011\\n\\t\\t,nvl(t2.GPRS_TOTAL_FLOW,0)       D_N_012\\n\\t\\t,nvl(t2.GPRS_BUSY_FLOW,0)        D_N_013\\n\\t\\t,nvl(t2.GPRS_IDLE_FLOW,0)   D_N_014\\n\\t\\t,nvl(t2.GPRS_UP_FLOW,0)     D_N_015\\n\\t\\t,nvl(t2.GPRS_DOWN_FLOW,0)   D_N_016\\n\\t\\t,nvl(t3.WLAN_TOTAL_FLOW,0)  D_N_017\\n\\t\\t,nvl(t3.WLAN_TOTAL_DUR,0)   D_N_018\\n\\t\\t,nvl(t3.WLAN_CMCCEDU_DUR,0) D_N_019\\n\\t\\t,nvl(t2.GPRS_CMWAP_FLOW,0)  D_N_020\\n\\t\\t,nvl(t2.GPRS_CMNET_FLOW,0)  D_N_021\\n\\t\\t,nvl(t2.CMWAP_DUR,0)   D_N_022\\n\\t\\t,nvl(t2.CMNET_DUR,0)   D_N_023\\n\\t\\t,(t2.GPRS_LAND_ROAM_FLOW+t2.GPRS_INTER_ROAM_FLOW+t2.GPRS_HMT_ROAM_FLOW)   D_N_024\\n\\t\\t,nvl(t2.BILL_FLOW ,0)            D_N_025\\n\\t\\t/*,nvl(t4.COMM_DAYS,0)                   D_N_026*/\\n\\t\\t,case when (NVL(t1.SMS_P2P_NUM,0)+NVL(t1.MMS_P2P_NUM,0)+NVL(t3.WLAN_TOTAL_FLOW,0)+NVL(t2.GPRS_TOTAL_FLOW,0))> 0 or t4.CALL_NUM>0 then 1 else 0 end                D_N_026\\n\\t\\t,nvl(t2.G4_NET_GPRS_FLOW,0)            D_N_027\\n\\t\\t,nvl(t2.G4_NET_GPRS_UP_FLOW,0)         D_N_028\\n\\t\\t,nvl(t2.G4_NET_GPRS_DOWN_FLOW ,0)      D_N_029\\n\\t\\t,nvl(t2.GPRS_LAND_ROAM_FLOW ,0)  D_N_030\\n\\t\\t,null                           D_N_031\\n\\t\\t,null                           D_N_032\\n\\t\\t,null                           D_N_033\\n\\t\\t,null                           D_N_034\\n\\t\\t,null                           D_N_035\\n\\t\\t,null                           D_N_036\\n\\t\\t,null                           D_N_037\\n\\t\\t,null                           D_N_038\\n\\t\\t,null                           D_N_039\\n\\t\\t,null                           D_N_040\\n\\t\\t,null                           D_N_041\\n\\t\\t,null                           D_N_042\\n\\t\\t,null                           D_N_043\\n\\t\\t,null                           D_N_044\\n\\t\\t,null                           D_N_045\\n\\t\\t,null                           D_N_046\\n\\t\\t,null                           D_N_047\\n\\t\\t,null                           D_N_048\\n\\t\\t,null                           D_N_049\\n\\t\\t,null                           D_N_050\\nfrom  gbasedwi.DWI_USR_PESN_PARTINFO_DS_${dayid} t               /*用户资料小表月表*/\\nfull join gbasedwi.DWI_BEH_USE_SMS_USERTOT_DT_${dayid}  t1        /*用户短信行为汇总日累计表*/\\n\\ton t.phone_no=t1.phone_no\\nfull join (select phone_no\\n\\t\\t\\t\\t,sum(GPRS_TOTAL_FLOW)\\t\\t\\tGPRS_TOTAL_FLOW\\n\\t\\t\\t\\t,sum(GPRS_BUSY_FLOW)\\t\\t\\tGPRS_BUSY_FLOW\\n\\t\\t\\t\\t,sum(GPRS_IDLE_FLOW)\\t\\t\\tGPRS_IDLE_FLOW\\n\\t\\t\\t\\t,sum(GPRS_UP_FLOW)\\t\\t\\t\\tGPRS_UP_FLOW\\n\\t\\t\\t\\t,sum(GPRS_DOWN_FLOW)\\t\\t\\tGPRS_DOWN_FLOW\\n\\t\\t\\t\\t,sum(GPRS_CMWAP_FLOW)\\t\\t\\tGPRS_CMWAP_FLOW\\n\\t\\t\\t\\t,sum(GPRS_CMNET_FLOW)\\t\\t\\tGPRS_CMNET_FLOW\\n\\t\\t\\t\\t,sum(CMWAP_DUR)\\t\\t\\t\\t\\tCMWAP_DUR\\n\\t\\t\\t\\t,sum(CMNET_DUR)\\t\\t\\t\\t\\tCMNET_DUR\\n\\t\\t\\t\\t,sum(GPRS_LAND_ROAM_FLOW)\\t\\tGPRS_LAND_ROAM_FLOW\\n\\t\\t\\t\\t,sum(GPRS_INTER_ROAM_FLOW)\\t\\tGPRS_INTER_ROAM_FLOW\\n\\t\\t\\t\\t,sum(GPRS_HMT_ROAM_FLOW)\\t\\tGPRS_HMT_ROAM_FLOw\\n\\t\\t\\t\\t,sum(BILL_FLOW)\\t\\t\\t\\t\\tBILL_FLOW\\n\\t\\t\\t\\t,sum(G4_NET_GPRS_FLOW)\\t\\t\\tG4_NET_GPRS_FLOW\\n\\t\\t\\t\\t,sum(G4_NET_GPRS_UP_FLOW)\\t\\tG4_NET_GPRS_UP_FLOW\\n\\t\\t\\t\\t,sum(G4_NET_GPRS_DOWN_FLOW)\\t\\tG4_NET_GPRS_DOWN_FLOW\\n\\t\\t from  gbasedwi.DWI_BEH_USE_GPRS_USERTOT_DT_${dayid} group by phone_no) t2 /*用户GPRS业务汇总日累计表*/\\n\\ton t.phone_no=t2.phone_no\\nfull join gbasedwi.DWI_BEH_USE_WLAN_TOT_DT_${dayid}  t3 /*WLAN汇总日累计表*/   on t.phone_no=t3.phone_no\\n/*FULL join (select phone_no,count(distinct stat_date) COMM_DAYS \\n\\t\\t   from gbasedwi.dwi_beh_use_cdrcomm_user_dt_${dayid}\\n\\t\\t   where  stat_date>'${curm_first_day}' and stat_date <= '${day_id}' group by phone_no) t4 \\ton t.PHONE_NO=t4.PHONE_NO*/\\nfull join  gbasedwi.DWI_BEH_USE_VOC_USERTOT_DT_${dayid} t4 on t.phone_no = t4.phone_no\\nwhere PROD_KIND_CODE= '171000000001' and (t.MONTH_ARRIVE_FLAG=1 or t.MONTH_OFF_FLAG  =1 or t.MONTH_NEW_FLAG =1)","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [438]-[index:684]-[base_info个人客户月视图自动生成程序月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"7.创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_BASE_INFO_${monthid};\\ncreate table DM_AUTORPT_BASE_INFO_${monthid} distributed by ('PRODUCT_NO') as select * from DM_AUTORPT_BASE_INFO_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [439]-[index:685]-[base_info个人客户月视图自动生成程序月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"8.插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_BASE_INFO_${monthid}\\n(OP_TIME ,\\nSTATIS_MONTH,\\nUSER_ID ,\\nPRODUCT_NO ,\\nI0414 ,\\nI0415 ,\\nI0416 ,\\nI0417 ,\\nI0418 ,\\nI0419 ,\\nI0420 ,\\nI0421 ,\\nI0422 ,\\nI0423 ,\\nI0424 ,\\nI0425 ,\\nI0426 ,\\nI0427 ,\\nI0428 ,\\nI0429 ,\\nI0430 ,\\nI0431 ,\\nI0432 ,\\nI0433 ,\\nI0434 ,\\nI0435 ,\\nI0437 ,\\nI0438 ,\\nI0439 ,\\nI0440 ,\\nI0441 ,\\nI0442 ,\\nI0443 ,\\nI0444 ,\\nI0968,\\nI2001)\\nselect\\nOP_TIME ,\\nSTATIS_MONTH,\\nUSER_ID ,\\nPRODUCT_NO ,\\nI0414 ,\\nI0415 ,\\nI0416 ,\\nI0417 ,\\nI0418 ,\\nI0419 ,\\nI0420 ,\\nI0421 ,\\nI0422 ,\\nI0423 ,\\nI0424 ,\\nI0425 ,\\nI0426 ,\\nI0427 ,\\nI0428 ,\\nI0429 ,\\nI0430 ,\\nI0431 ,\\nI0432 ,\\nI0433 ,\\nI0434 ,\\nI0435 ,\\nI0437 ,\\nI0438 ,\\nI0439 ,\\nI0440 ,\\nI0441 ,\\nI0442 ,\\nI0443 ,\\nI0444 ,\\nI0968 ,\\nI2001\\nfrom DM_AUTORPT_BASE_INFO_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [440]-[index:688]-[数据业务DM_AUTORPT_NEWBUSI_YYYYMM]-[57]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"创建临时表","nodeId":"57","sql":"CREATE TABLE ${TARGET_TMP_DM_AUTORPT_NEWBUSI}\\n (\\tPHONE_NO \\tVARCHAR(50),\\n \\tAR0001\\t\\tBIGINT,\\n\\tAR0002\\t\\tBIGINT,\\n\\tAR0003\\t\\tBIGINT,\\n\\tAR0004\\t\\tBIGINT,\\n\\tAR0005\\t\\tBIGINT\\t)\\nDISTRIBUTED BY('PHONE_NO');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [441]-[index:689]-[数据业务DM_AUTORPT_NEWBUSI_YYYYMM]-[58]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"58.插入临时表","nodeId":"58","sql":"INSERT INTO ${TARGET_TMP_DM_AUTORPT_NEWBUSI}\\n\\t(PHONE_NO,AR0001,AR0002,AR0003,AR0004,AR0005)\\nSELECT  PHONE_NO,\\n\\t\\tNVL(B.GP0000,0),\\n\\t\\tNVL(B.AR0001,0),\\n\\t\\tNVL(B.AR0002,0),\\n\\t\\tNVL(NVL(B.AR0001,0)+NVL(B.AR0002,0)+NVL(B.GP0000,0),0)/3\\tAR0004,\\n\\t\\tNVL(NVL(B.AR0001,0)+NVL(B.AR0002,0)+NVL(B.GP0000,0)+NVL(E.AR0001,0)+NVL(E.AR0002,0)+NVL(E.GP0000,0),0)/6\\tAR0005\\nFROM ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} A\\nLEFT JOIN (select PRODUCT_NO, GP0000,AR0001,AR0002 from ${SOURCE_DM_AUTORPT_NEWBUSI_PYYYYMM} group by PRODUCT_NO,GP0000,AR0001,AR0002) B ON A.PHONE_NO=B.PRODUCT_NO\\nLEFT JOIN (select PRODUCT_NO, GP0000,AR0001,AR0002 from DM_AUTORPT_NEWBUSI_${p4monthid}@dblink_dm \\ngroup by PRODUCT_NO,GP0000,AR0001,AR0002) E ON A.PHONE_NO=E.PRODUCT_NO\\nWHERE (A.ONNET_USER_FLAG=1 AND A.PROD_KIND_CODE='171000000001') OR A.MONTH_OFF_FLAG =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [442]-[index:690]-[数据业务DM_AUTORPT_NEWBUSI_YYYYMM]-[61]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"创建临时表2","nodeId":"61","sql":"CREATE TABLE TMP01_DM_AUTORPT_NEWBUSI\\n( OP_TIME date ,\\n  USER_ID varchar(22),\\n  PHONE_NO varchar(50),\\n  CMCC_USAGE_FLAG smallint(6),\\n  CMCC_EDU_USAGE_FLAG smallint(6),\\n  CMCC_USAGE_DURA_M int(11),\\n  CMCC_EDU_USAGE_DURA_M int(11),\\n  CMCC_USAGE_FLOW_M decimal(16,2),\\n  CMCC_LOGON_TIMES int(11),\\n  CMCC_EDU_LOGON_TIMES int(11)\\t) \\nDISTRIBUTED BY('PHONE_NO');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [443]-[index:691]-[数据业务DM_AUTORPT_NEWBUSI_YYYYMM]-[62]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据2","nodeId":"62","sql":"insert into TMP01_DM_AUTORPT_NEWBUSI\\n (    OP_TIME\\n     ,USER_ID\\n     ,PHONE_NO\\n     ,CMCC_USAGE_FLAG\\n     ,CMCC_EDU_USAGE_FLAG\\n     ,CMCC_USAGE_DURA_M\\n     ,CMCC_EDU_USAGE_DURA_M\\n     ,CMCC_USAGE_FLOW_M\\n     ,CMCC_LOGON_TIMES\\n     ,CMCC_EDU_LOGON_TIMES\\t)\\nselect '${month_id}-01'\\t\\tOP_TIME\\n      ,t1.USER_ID         \\tUSER_ID\\n      ,t1.PHONE_NO        \\tPHONE_NO\\n      ,max(case when t2.WLAN_CMCC_FLOW>0\\n                then 1\\n                else 0 end)           CMCC_USAGE_FLAG\\n      ,max(case when t2.WLAN_CMCCEDU_FLOW>0\\n                then 1\\n                else 0 end)           CMCC_EDU_USAGE_FLAG\\n      ,max(t2.WLAN_CMCC_DUR)          CMCC_USAGE_DURA_M\\n      ,max(t2.WLAN_CMCCEDU_DUR)       CMCC_EDU_USAGE_DURA_M\\n      ,max(t2.WLAN_CMCC_FLOW)         CMCC_USAGE_FLOW_M\\n      ,0                              CMCC_LOGON_TIMES\\n      ,0                              CMCC_EDU_LOGON_TIMES\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} t1\\nleft join ${SOURCE_DWI_BEH_USE_WLAN_TOT_MS_YYYYMM} t2 on t1.PHONE_NO=t2.PHONE_NO\\nWHERE (t1.ONNET_USER_FLAG=1 AND t1.PROD_KIND_CODE='171000000001') OR t1.MONTH_OFF_FLAG =1\\ngroup by t1.USER_ID,t1.PHONE_NO;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [444]-[index:694]-[数据业务DM_AUTORPT_NEWBUSI_YYYYMM]-[19]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"删除所有表","nodeId":"19","sql":"DROP TABLE ${TARGET_DM_AUTORPT_NEWBUSI_YYYYMM};\\nDROP TABLE ${TARGET_TMP_DM_AUTORPT_NEWBUSI};\\ndrop table TMP01_DM_AUTORPT_NEWBUSI;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [445]-[index:695]-[数据业务DM_AUTORPT_NEWBUSI_YYYYMM]-[33]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"33.插入数据到目标表","nodeId":"33","sql":"INSERT INTO ${TARGET_DM_AUTORPT_NEWBUSI_YYYYMM}\\n(\\tOP_TIME,\\n\\tUSER_ID,\\n\\tPRODUCT_NO,\\n\\tAR0001,\\n\\tAR0002,\\n\\tAR0003,\\n\\tAR0004,\\n\\tAR0005,\\n\\tAR0006,\\n\\tFEE001,\\n\\tGP0000,\\n\\tGP0001,\\n\\tGP0002,\\n\\tGP0010,\\n\\tGP0020,\\n\\tGP0030,\\n\\tGP0100,\\n\\tGP0110,\\n\\tGP0120,\\n\\tGP0200,\\n\\tGP0210,\\n\\tGP0220,\\n\\tGP0300,\\n\\tGP0310,\\n\\tGP0320,\\n\\tGP0400,\\n\\tGP0410,\\n\\tGP0420,\\n\\tGP0500,\\n\\tGP0510,\\n\\tGP0520,\\n\\tGP0600,\\n\\tGP0610,\\n\\tGP0620,\\n\\tGP0650,\\n\\tGP0651,\\n\\tGP0652,\\n\\tGP0660,\\n\\tGP0661,\\n\\tGP0662,\\n\\tGP0700,\\n\\tGP0710,\\n\\tGP0720,\\n\\tGP0800,\\n\\tGP0810,\\n\\tGP0820,\\n\\tGP0900,\\n\\tGP0910,\\n\\tGP0920,\\n\\tGP1000,\\n\\tGP2000,\\n\\tGP3000,\\n\\tGP4000,\\n    WL0001,\\n\\tWL0002,\\n\\tWL0003,\\n\\tWL0004,\\n\\tWL0005,\\n\\tWL0006,\\n\\tWL0007,\\n\\tWL0008,\\n\\tWL0009,\\n\\tWL0010,\\n    I0450,\\n\\tI0451,\\n\\tI0452,\\n\\tI0453,\\n\\tI0454,\\n\\tI0455,\\n\\tI0456,\\n\\tI0461,\\n\\tI0549,\\n\\tI0550,\\n\\tI0551,\\n\\tI0552,\\n\\tI0465,\\n\\tI0553,\\n\\tI0554,\\n\\tN00001,\\n\\tN00004,\\n\\tN00005,\\n\\tN00006,\\n\\tN00007,\\n\\tN00008,\\n\\tN00009,\\n\\tN00010,\\n\\tN00011,\\n\\tN00012,\\n\\tN00013,\\n\\tN00014,\\n\\tN00015,\\n\\tN00016,\\n\\tN00017,\\n\\tN00018,\\n\\tN00019,\\n\\tN00020,\\n\\tN00021,\\n\\tN00022,\\n\\tN00023,\\n\\tN00024,\\n\\tN00025,\\n\\tN00026,\\n\\tN00027,\\n\\tN00028,\\n\\tN00029,\\n\\tN00030,\\n\\tN00031,\\n\\tN00034,\\n\\tN00035,\\n\\tN00036,\\n\\tN00037,\\n\\tN00038,\\n\\tN00039,\\n\\tN00040,\\n\\tN00041,\\n\\tN00042,\\n\\tN00043,\\n\\tN00044,\\n\\tN00045,\\n\\tN00046,\\n\\tN00047,\\n\\tN00048,\\n\\tN00049,\\n\\tN00050,\\n\\tN00051,\\n\\tN00052,\\n\\tN00053,\\n\\tN00054,\\n\\tN00055,\\n\\tN00056,\\n\\tN00057,\\n\\tN00058,\\n\\tN00059,\\n\\tN00060,\\n\\tN00061,\\n\\tN00062,\\n\\tN00063,\\n\\tN00064,\\n\\tN00065,\\n\\tN00066,\\n\\tN00067,\\n\\tN00068,\\n\\tN00069,\\n\\tN00070,\\n\\tN00071,\\n\\tN00072,\\n\\tN00073,\\n\\tN00074,\\n\\tN00075,\\n\\tN00076)\\nselect\\t'${month_id}-01'                    OP_TIME,\\n\\t\\tA.USER_ID                           USER_ID,\\n\\t\\tA.PHONE_NO                          PRODUCT_NO,\\n\\t\\tNVL(E.AR0001,0)      \\t\\t\\t\\tAR0001,\\n        NVL(E.AR0002,0)      \\t\\t\\t\\tAR0002,\\n        NVL(E.AR0003,0)      \\t\\t\\t\\tAR0003,\\n        NVL(E.AR0004,0)   \\t\\t\\t\\t\\tAR0004,\\n        NVL(E.AR0005,0)     \\t\\t\\t\\tAR0005,\\n\\t\\tcase when NVL(E.AR0001,0)=0 then 0 else nvl(B.GPRS_TOTAL_FLOW,0)/NVL(E.AR0001,0) end AR0006,\\n\\t\\tnvl(t1.total_fee,0)               FEE001,  /*value(sum(total_fee),0) as TOTAL_FEE, dw_newbusi_gprs_dt_201605 */\\n\\t\\tnvl(B.GPRS_TOTAL_FLOW,0)            GP0000,\\n\\t\\tnvl(B.GPRS_TOTAL_NUM,0)             GP0001,\\n        nvl(B.GPRS_TOTAL_DUR,0)             GP0002,\\n\\t\\tnvl(B.G4_NET_GPRS_FLOW,0)           GP0010,\\n        nvl(B.G4_NET_GPRS_UP_FLOW,0)        GP0020,\\n        nvl(B.G4_NET_GPRS_DOWN_FLOW,0)      GP0030,\\n\\t\\tnvl(B.T_GPRS_FLOW,0)                GP0100,\\n        nvl(B.T_GPRS_UP_FLOW,0)             GP0110,\\n        nvl(B.T_GPRS_DOWN_FLOW,0)           GP0120,\\n\\t\\tnvl(B.G_GPRS_FLOW,0)                GP0200,\\n        nvl(B.G_GPRS_UP_FLOW,0)             GP0210,\\n        nvl(B.G_GPRS_DOWN_FLOW,0)           GP0220,\\n\\t\\tnvl(B.GPRS_BUSY_FLOW,0)             GP0300,\\n        nvl(B.GPRS_BUSY_UP_FLOW,0)          GP0310,\\n        nvl(B.GPRS_BUSY_DOWN_FLOW,0)        GP0320,\\n\\t\\tnvl(B.GPRS_IDLE_FLOW,0)             GP0400,\\n        nvl(B.GPRS_IDLE_UP_FLOW,0)          GP0410,\\n        nvl(B.GPRS_IDLE_DOWN_FLOW,0)        GP0420,\\n\\t\\tnvl(B.GPRS_LOC_FLOW,0)              GP0500,\\n        nvl(B.GPRS_LOC_UP_FLOW,0)           GP0510,\\n        nvl(B.GPRS_LOC_DOWN_FLOW,0)         GP0520,\\n\\t\\tnvl(B.GPRS_LAND_ROAM_FLOW,0)        GP0600,\\n        nvl(B.GPRS_LAND_ROAM_UP_FLOW,0)     GP0610,\\n        nvl(B.GPRS_LAND_ROAM_DOWN_FLOW,0)   GP0620,\\n        nvl(B.GPRS_INTER_ROAM_FLOW,0)       GP0650,\\n        nvl(B.GPRS_INTER_ROAM_UP_FLOW,0)    GP0651,\\n        nvl(B.GPRS_INTER_ROAM_DOWN_FLOW,0)  GP0652,\\n\\t    nvl(B.GPRS_HMT_ROAM_FLOW,0)         GP0660,\\n        nvl(B.GPRS_HMT_ROAM_UP_FLOW,0)      GP0661,\\n        nvl(B.GPRS_HMT_ROAM_DOWN_FLOW,0)    GP0662,\\n        nvl(B.GPRS_CMNET_FLOW,0)            GP0700,\\n        nvl(B.GPRS_CMNET_UP_FLOW,0)         GP0710,\\n        nvl(B.GPRS_CMNET_DOWN_FLOW,0)       GP0720,\\n        nvl(B.GPRS_CMWAP_FLOW,0)            GP0800,\\n        nvl(B.GPRS_CMWAP_UP_FLOW,0)         GP0810,\\n        nvl(B.GPRS_CMWAP_DOWN_FLOW,0)       GP0820,\\n        nvl(B.GPRS_CMTDS_FLOW,0)            GP0900,\\n        nvl(B.GPRS_CMTDS_UP_FLOW,0)         GP0910,\\n        nvl(B.GPRS_CMTDS_DOWN_FLOW,0)       GP0920,\\n\\t\\tnvl(B.GPRS_UP_FLOW,0)               GP1000,\\n\\t\\tnvl(B.GPRS_DOWN_FLOW,0)             GP2000,\\n\\t\\tnvl(B.NO_BILL_FLOW,0)               GP3000,\\n        nvl(B.BILL_FLOW,0)                  GP4000,\\n\\t\\tnvl(C.WLAN_TOTAL_DUR,0)             WL0001,\\n        nvl(C.WLAN_TOTAL_FLOW,0)            WL0002,\\n        nvl(C.WLAN_TOTAL_USE_NUM,0)         WL0003,\\n        nvl(C.WLAN_UP_FLOW,0)               WL0004,\\n        nvl(C.WLAN_DOWN_FLOW,0)             WL0005,\\n        nvl(C.WLAN_LIVELY_USER_FLAG,0)     \\tWL0006,\\n        nvl(C.WLAN_CMCC_DUR,0)              WL0007,\\n        nvl(C.WLAN_CMCC_FLOW,0)             WL0008,\\n        nvl(C.WLAN_CMCCEDU_DUR,0)           WL0009,\\n        nvl(C.WLAN_CMCCEDU_FLOW,0)          WL0010,\\n\\t\\tF.CMCC_USAGE_FLAG                   I0450,\\n\\t\\tF.CMCC_EDU_USAGE_FLAG               I0451,\\n\\t\\tF.CMCC_USAGE_DURA_M                 I0452,\\n\\t\\tF.CMCC_EDU_USAGE_DURA_M             I0453,\\n\\t\\tF.CMCC_USAGE_FLOW_M                 I0454,\\n\\t\\tF.CMCC_LOGON_TIMES                  I0455,\\n\\t\\tF.CMCC_EDU_LOGON_TIMES              I0456,\\n\\t\\tNULL                                I0461,\\n\\t\\tNULL                                I0549,\\n\\t\\tNULL                                I0550,\\n\\t\\tNULL                                I0551,\\n\\t\\tNULL                                I0552,\\n\\t\\t0                                   I0465,\\n\\t\\t0                                   I0553,\\n\\t\\tNULL                                I0554,\\n\\t\\tnvl(D.SMS_P2P_NUM              ,0)  N00001,\\n\\t\\tnvl(D.SMS_P2P_INNET_NUM        ,0)  N00004,\\n\\t\\tnvl(D.SMS_P2P_NETO_NUM         ,0)  N00005,\\n\\t\\tnvl(D.SMS_P2P_NETO_CUC_CMC_NUM ,0)  N00006,\\n\\t\\tnvl(D.SMS_P2P_CUC_FIX_NUM      ,0)  N00007,\\n\\t\\tnvl(D.SMS_P2P_NETO_CTC_CMC_NUM ,0)  N00008,\\n\\t\\tnvl(D.SMS_P2P_CTC_FIX_NUM      ,0)  N00009,\\n\\t\\tnvl(D.SMS_GRP_NUM              ,0)  N00010,\\n\\t\\tnvl(D.SMS_CMC_CHAT_NUM         ,0)  N00011,\\n\\t\\tnvl(D.MMS_MONT_NUM             ,0)  N00012,\\n\\t\\tnvl(D.MMSM_SELF_NUM            ,0)  N00013,\\n\\t\\tnvl(D.MMSM_SELF_GRP_MMS_NUM    ,0)  N00014,\\n\\t\\tnvl(D.MMSM_SELF_12580_LIFE_NUM ,0)  N00015,\\n\\t\\tnvl(D.MMSM_SELF_139_MAIL_NUM   ,0)  N00016,\\n\\t\\tnvl(D.MMSM_SELF_FETION_NUM     ,0)  N00017,\\n\\t\\tnvl(D.MMSM_SELF_MOB_ANIMAT_NUM ,0)  N00018,\\n\\t\\tnvl(D.MMSM_SELF_NONGXT_NUM     ,0)  N00019,\\n\\t\\tnvl(D.MMSM_SELF_PHONE_DESK_NUM ,0)  N00020,\\n\\t\\tnvl(D.MMSM_SELF_PHN_STOCK_NUM  ,0)  N00021,\\n\\t\\tnvl(D.MMSM_SELF_WSPORT_CLUB_NUM,0)  N00022,\\n\\t\\tnvl(D.MMSM_SELF_SPORT_NUM      ,0)  N00023,\\n\\t\\tnvl(D.MONT_SP_MMS_NUM          ,0)  N00024,\\n\\t\\tnvl(D.MMS_MONT_OTHR_NUM        ,0)  N00025,\\n\\t\\tnvl(D.SMS_MONT_NUM             ,0)  N00026,\\n\\t\\tnvl(D.SMS_MONT_UP_NUM          ,0)  N00027,\\n\\t\\tnvl(D.SMS_MONT_DOWN_NUM        ,0)  N00028,\\n\\t\\tNULL                                N00029,\\n\\t\\tnvl(D.ICT_SMS_NUM      ,0)          N00030,\\n\\t\\tnvl(D.MMS_P2P_NUM      ,0)          N00031,\\n\\t\\tnvl(D.MMS_P2P_INNET_NUM,0)          N00034,\\n\\t\\tnvl(D.MMS_P2P_NETO_NUM ,0)          N00035,\\n\\t\\tnvl(D.MMS_P2P_CUC_NUM  ,0)          N00036,\\n\\t\\tnvl(D.MMS_P2P_CTC_NUM  ,0)          N00037,\\n\\t\\tNULL                                N00038,\\n\\t\\tnvl(D.SMS_INTER_P2P_NUM,0)          N00039,\\n\\t\\tNULL                                N00040,\\n\\t\\tNULL                                N00041,\\n\\t\\tNULL                                N00042,\\n        NULL                                N00043,\\n        NULL                                N00044,\\n\\t\\tNULL                                N00045,\\n\\t\\tNULL                                N00046,\\n\\t\\tNULL                                N00047,\\n        NULL                                N00048,\\n\\t\\tnvl(D.MMS_INTER_NUM      ,0)        N00049,\\n\\t\\tnvl(D.INTMES_SMS_NUM     ,0)        N00050,\\n\\t\\tnvl(D.INTMES_SMS_UP_NUM  ,0)        N00051,\\n\\t\\tnvl(D.INTMES_SMS_DOWN_NUM,0)        N00052,\\n\\t\\tnvl(D.MMS_MAIL_NUM       ,0)        N00053,\\n\\t\\tNULL                                N00054,\\n        NULL                                N00055,\\n        NULL                                N00056,\\n\\t\\tNULL                                N00057,\\n\\t\\tnvl(D.SMS_MOB_SALON_NUM,0)          N00058,\\n\\t\\tNULL                                N00059,\\n        NULL                                N00060,\\n\\t\\tNULL                  \\t\\t\\t\\tN00061,\\n\\t\\tNULL                                N00062,\\n        NULL                                N00063,\\n\\t\\tNULL                                N00064,\\n        NULL                                N00065,\\n        NULL                                N00066,\\n        NULL                                N00067,\\n        NULL                                N00068,\\n\\t\\tNULL                                N00069,\\n        NULL                                N00070,\\n        NULL                                N00071,\\n        NULL                                N00072,\\n        NULL                                N00073,\\n        NULL                                N00074,\\n        NULL                                N00075,\\n        NULL                                N00076\\nFROM ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} A\\nLEFT JOIN ${TARGET_TMP_DM_AUTORPT_NEWBUSI} E ON A.PHONE_NO=E.PHONE_NO\\nLEFT JOIN \\n\\t( SELECT PHONE_NO,sum(GPRS_TOTAL_FLOW) GPRS_TOTAL_FLOW,sum(GPRS_TOTAL_NUM) GPRS_TOTAL_NUM,\\n\\t\\t\\t sum(GPRS_TOTAL_DUR) GPRS_TOTAL_DUR,sum(G4_NET_GPRS_FLOW) G4_NET_GPRS_FLOW,\\n\\t\\t\\t sum(G4_NET_GPRS_UP_FLOW) G4_NET_GPRS_UP_FLOW,\\n\\t\\t\\t sum(G4_NET_GPRS_DOWN_FLOW) G4_NET_GPRS_DOWN_FLOW,\\n\\t\\t\\t sum(T_GPRS_FLOW) T_GPRS_FLOW,sum(T_GPRS_UP_FLOW) T_GPRS_UP_FLOW,\\n\\t\\t\\t sum(T_GPRS_DOWN_FLOW) T_GPRS_DOWN_FLOW,sum(G_GPRS_FLOW) G_GPRS_FLOW,\\n\\t\\t\\t sum(G_GPRS_UP_FLOW) G_GPRS_UP_FLOW,sum(G_GPRS_DOWN_FLOW) G_GPRS_DOWN_FLOW,\\n\\t\\t\\t sum(GPRS_BUSY_FLOW) GPRS_BUSY_FLOW,sum(GPRS_BUSY_UP_FLOW) GPRS_BUSY_UP_FLOW,\\n\\t\\t\\t sum(GPRS_BUSY_DOWN_FLOW) GPRS_BUSY_DOWN_FLOW,sum(GPRS_IDLE_FLOW) GPRS_IDLE_FLOW,\\n\\t\\t\\t sum(GPRS_IDLE_UP_FLOW) GPRS_IDLE_UP_FLOW,sum(GPRS_IDLE_DOWN_FLOW) GPRS_IDLE_DOWN_FLOW,\\n\\t\\t\\t sum(GPRS_LOC_FLOW) GPRS_LOC_FLOW,sum(GPRS_LOC_UP_FLOW) GPRS_LOC_UP_FLOW,\\n\\t\\t\\t sum(GPRS_LOC_DOWN_FLOW) GPRS_LOC_DOWN_FLOW,sum(GPRS_LAND_ROAM_FLOW) GPRS_LAND_ROAM_FLOW,\\n\\t\\t\\t sum(GPRS_LAND_ROAM_UP_FLOW) GPRS_LAND_ROAM_UP_FLOW,\\n\\t\\t\\t sum(GPRS_LAND_ROAM_DOWN_FLOW) GPRS_LAND_ROAM_DOWN_FLOW,\\n\\t\\t\\t sum(GPRS_INTER_ROAM_FLOW) GPRS_INTER_ROAM_FLOW,\\n\\t\\t\\t sum(GPRS_INTER_ROAM_UP_FLOW) GPRS_INTER_ROAM_UP_FLOW,\\n\\t\\t\\t sum(GPRS_INTER_ROAM_DOWN_FLOW) GPRS_INTER_ROAM_DOWN_FLOW,\\n\\t\\t\\t sum(GPRS_HMT_ROAM_FLOW) GPRS_HMT_ROAM_FLOW,\\n\\t\\t\\t sum(GPRS_HMT_ROAM_UP_FLOW) GPRS_HMT_ROAM_UP_FLOW,\\n\\t\\t\\t sum(GPRS_HMT_ROAM_DOWN_FLOW) GPRS_HMT_ROAM_DOWN_FLOW,\\n\\t\\t\\t sum(GPRS_CMNET_FLOW) GPRS_CMNET_FLOW,\\n\\t\\t\\t sum(GPRS_CMNET_UP_FLOW) GPRS_CMNET_UP_FLOW,\\n\\t\\t\\t sum(GPRS_CMNET_DOWN_FLOW) GPRS_CMNET_DOWN_FLOW,\\n\\t\\t\\t sum(GPRS_CMWAP_FLOW) GPRS_CMWAP_FLOW,\\n\\t\\t\\t sum(GPRS_CMWAP_UP_FLOW) GPRS_CMWAP_UP_FLOW,\\n\\t\\t\\t sum(GPRS_CMWAP_DOWN_FLOW) GPRS_CMWAP_DOWN_FLOW,\\n\\t\\t\\t sum(GPRS_CMTDS_FLOW) GPRS_CMTDS_FLOW,\\n\\t\\t\\t sum(GPRS_CMTDS_UP_FLOW) GPRS_CMTDS_UP_FLOW,\\n\\t\\t\\t sum(GPRS_CMTDS_DOWN_FLOW) GPRS_CMTDS_DOWN_FLOW,\\n\\t\\t\\t sum(GPRS_UP_FLOW) GPRS_UP_FLOW,\\n\\t\\t\\t sum(GPRS_DOWN_FLOW) GPRS_DOWN_FLOW,\\n\\t\\t\\t sum(NO_BILL_FLOW) NO_BILL_FLOW,\\n\\t\\t\\t sum(BILL_FLOW) BILL_FLOW\\n\\t FROM ${SOURCE_DWI_BEH_USE_GPRS_USERTOT_MS_YYYYMM}\\n\\t GROUP BY PHONE_NO) B  ON B.PHONE_NO = A.PHONE_NO\\nLEFT JOIN ${SOURCE_DWI_BEH_USE_WLAN_TOT_MS_YYYYMM} C ON C.PHONE_NO = A.PHONE_NO\\nLEFT JOIN TMP01_DM_AUTORPT_NEWBUSI F ON A.PHONE_NO=F.PHONE_NO\\nLEFT JOIN ${SOURCE_DWI_BEH_USE_SMS_USERTOT_MS_YYYYMM} D ON D.user_id = A.user_id and a.phone_no=d.phone_no \\nLEFT JOIN (SELECT PHONE_NO,SUM(TOTAL_FEE) TOTAL_FEE FROM  ${SOURCE_DWD_EVT_CDR_GPRS_BUSITYPETOT_MS_YYYYMM} \\n         GROUP BY PHONE_NO) T1 ON  T1.PHONE_NO = A.PHONE_NO \\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001\\n-- (A.ONNET_USER_FLAG=1 AND A.PROD_KIND_CODE='171000000001') OR A.MONTH_OFF_FLAG =1"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [446]-[index:699]-[数据业务（日累计指标）日累计调度传输]-[6]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"6","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_NEWBUSI_${dayid};\\ncreate table DM_PUB_NEWBUSI_${dayid} distributed by ('product_no') as select * from DM_PUB_NEWBUSI_YYYYMMDD;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [447]-[index:700]-[数据业务（日累计指标）日累计调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"7","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_NEWBUSI_${dayid} select * from DM_PUB_NEWBUSI_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [448]-[index:706]-[物联网视图（日）]-[19]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"19.创建表","nodeId":"19","sql":"create table ${DM_GOVER_WLW_DS_YYYYMMDD}\\n(  stat_date date ,\\n  product_no varchar(20) ,\\n  busi_code varchar(20) ,\\n  plan_id bigint(20) ,\\n  plan_name varchar(200) ,\\n  svc_substatus_id varchar(20) ,\\n  apply_date date ,\\n  begin_time date ,\\n  end_time date ,\\n  end_date date ,\\n  create_time date ,\\n  op_staff_no varchar(20) ,\\n  updt_oper_id varchar(20) ,\\n  cust_name varchar(300) ,\\n  ca_code varchar(50) ,\\n  boss_acct_id varchar(20) ,\\n  grp_mgr varchar(40) ,\\n  scale_id smallint(6) ,\\n  industry_cntr varchar(8) ,\\n  prod_attr_name_1 varchar(500) ,\\n  prod_attr_val_1 varchar(500) ,\\n  prod_attr_name_2 varchar(500) ,\\n  prod_attr_val_2 varchar(500) ,\\n  prod_attr_name_3 varchar(500) ,\\n  prod_attr_val_3 varchar(500) ,\\n  prod_attr_name_4 varchar(500) ,\\n  prod_attr_val_4 varchar(500) ,\\n  prod_attr_name_5 varchar(500) ,\\n  prod_attr_val_5 varchar(500) ,\\n  prod_attr_name_6 varchar(500) ,\\n  prod_attr_val_6 varchar(500) ,\\n  prod_attr_name_7 varchar(500) ,\\n  prod_attr_val_7 varchar(500) ,\\n  prod_attr_name_8 varchar(500) ,\\n  prod_attr_val_8 varchar(500) ,\\n  prod_attr_name_9 varchar(500) ,\\n  prod_attr_val_9 varchar(500) ,\\n  prod_attr_name_10 varchar(500) ,\\n  prod_attr_val_10 varchar(500) ,\\n  prod_attr_val_11 varchar(500) ,\\n  prod_attr_val_12 varchar(500) ,\\n  prod_attr_val_13 varchar(500) ,\\n  prod_attr_val_14 varchar(500) ,\\n  prod_attr_val_15 varchar(500) ,\\n  prod_attr_val_16 varchar(500) ,\\n  prod_attr_val_17 varchar(500) ,\\n  prod_attr_val_18 varchar(500) ,\\n  prod_attr_val_19 varchar(500) ,\\n  prod_attr_val_20 varchar(500) ,\\n  channel_name varchar(200) ,\\n  co_code varchar(30) ,\\n  enterprise_name varchar(300) ,\\n  ent_industry_id varchar(20) ,\\n  par_industry_id varchar(20) ,\\n  agnt_name varchar(120) ,\\n  agnt_region_name varchar(60) ,\\n  agnt_code varchar(50) ,\\n  agnt_region_code varchar(15) ,\\n  grp_grid_code smallint(6) ,\\n  local_vocation varchar(300) \\n) DISTRIBUTED BY('product_no')"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [449]-[index:707]-[物联网视图（日）]-[7]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"7.插入数据","nodeId":"7","sql":"insert into ${DM_GOVER_WLW_DS_YYYYMMDD}\\nselect distinct\\nstat_date\\n,grp_bill_no\\n,a.busi_code\\n,plan_id\\n,plan_name\\n,svc_substatus_id\\n,apply_date\\n,begin_time\\n,end_time\\n,end_date\\n,create_time\\n,op_staff_no\\n,updt_oper_id \\n,cust_name\\n,ca_code\\n,boss_acct_id\\n,grp_mgr\\n,scale_id\\n,industry_cntr\\n,prod_attr_name_1 \\n,prod_attr_val_1\\n,prod_attr_name_2 \\n,prod_attr_val_2\\n,prod_attr_name_3 \\n,prod_attr_val_3\\n,prod_attr_name_4 \\n,prod_attr_val_4\\n,prod_attr_name_5 \\n,prod_attr_val_5\\n,prod_attr_name_6 \\n,prod_attr_val_6\\n,prod_attr_name_7 \\n,prod_attr_val_7\\n,prod_attr_name_8 \\n,prod_attr_val_8\\n,prod_attr_name_9 \\n,prod_attr_val_9\\n,prod_attr_name_10 \\n,prod_attr_val_10\\n,prod_attr_val_11\\n,prod_attr_val_12\\n,prod_attr_val_13\\n,prod_attr_val_14\\n,prod_attr_val_15\\n,prod_attr_val_16\\n,prod_attr_val_17\\n,prod_attr_val_18\\n,prod_attr_val_19\\n,prod_attr_val_20\\n,channel_name\\n,co_code\\n,enterprise_name\\n,trim(ent_industry_id)\\n,trim(par_industry_id)\\n,agnt_name\\n,agnt_region_name\\n,agnt_code\\n,agnt_region_code\\n,grp_grid_code\\n,local_vocation \\nfrom gbasedwi.dwi_inst_offer_grp_ord_ds_${dayid} a\\ninner join gbasedwd.dim_enterprise_grpinfo_wlw b on a.busi_code=b.busi_code\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [450]-[index:709]-[物联网视图（日）]-[22]-['str' object has no attribute 'lfind']:{"name":"22.删除表","nodeId":"22","dsName":"GbaseDM","sql":"drop table ${DM_GOVER_WLW_DS_YYYYMMDD};","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [451]-[index:711]-[账务信息]-[8]-['str' object has no attribute 'lfind']:{"name":"SQL语句","nodeId":"8","dsName":"GbaseDM","sql":"  insert into ${DM_PUB_SHOULD_YYYYMM}\\n          (op_time,             \\n            product_no,                  \\n            ic0000,              \\n            ic0100,              \\n            ic0200,              \\n            ic0300,              \\n            ic0400,              \\n            ic0500,              \\n            ic0600,              \\n            ic0700,              \\n            ic0800,              \\n            ic0900,              \\n            ic1000,              \\n            ic1100,              \\n            ic1200,              \\n            ic1300,              \\n            ic1400,              \\n            ic1500,              \\n            ic1600,              \\n            ic1700)  \\n         select to_date('${monthid}','YYYYMM') stat_mon                                                                               ,                                                              \\n            a.phone_no                                                                                                                ,\\n            sum(a.SHOULD_INCOME)                                                                                               ic0000,            \\n            Sum(Case  When b.TYPE_NAME = '本地通话费' Then  a.SHOULD_INCOME  else 0  end)                                      ic0100,            \\n            sum(case when b.TYPE_NAME = '漫游通话费' then a.SHOULD_INCOME else 0 end                          )                ic0200,            \\n            sum(case when b.TYPE_NAME = '普通国内长途费'   then a.SHOULD_INCOME else 0 end                    )                ic0300,            \\n            sum(case when b.TYPE_NAME = '普通港澳台长途费'   then a.SHOULD_INCOME else 0 end                   )               ic0400,            \\n            sum(case when b.TYPE_NAME = '普通国际长途费'   then a.SHOULD_INCOME else 0 end  )                                  ic0500,            \\n            sum(case when b.TYPE_NAME = 'IP国内长途费'    then a.SHOULD_INCOME else 0 end      )                               ic0600,            \\n            sum(case when b.TYPE_NAME = 'IP港澳台长途费'  then a.SHOULD_INCOME else 0 end        )                             ic0700,            \\n            sum(case when b.TYPE_NAME = 'IP国际长途费'    then a.SHOULD_INCOME else 0 end               )                      ic0800,            \\n            sum(case when b.TYPE_NAME = '话音增值业务收入'  then a.SHOULD_INCOME else 0 end                 )                  ic0900,            \\n            sum(case when b.TYPE_NAME = '短信数据业务收入'   then a.SHOULD_INCOME else 0 end      )                            ic1000,            \\n            sum(case when b.TYPE_NAME = '非短信数据业务收入'   then a.SHOULD_INCOME else 0 end )                               ic1100,            \\n            sum(case when b.TYPE_NAME = 'CMNET业务收入'   then a.SHOULD_INCOME else 0 end     )                                ic1200,            \\n            sum(case when b.TYPE_NAME = '其他数据业务收入' then a.SHOULD_INCOME else 0 end                        )            ic1300,            \\n            sum(case when b.TYPE_NAME = '月租费'   then a.SHOULD_INCOME else 0 end      )                                      ic1400,            \\n            sum(case when b.TYPE_NAME = '套餐月租费'     then a.SHOULD_INCOME else 0 end                      )                ic1500,            \\n            sum(case when b.TYPE_NAME = '信息费'  then a.SHOULD_INCOME else 0 end             )                                ic1600,            \\n           sum(case when b.Charge_code Is Null   then a.SHOULD_INCOME else 0 end                  )                            ic1700\\n      from gbasedwi.DWI_INCO_BILL_ITEM_TOT_MS_${monthid} a \\n      left outer join gbasedwd.dim_rpt_general_sheet1 b  on a.ACCT_ITEM_ID = b.charge_code\\n       group by phone_no","parentDsName":"GbaseDM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [452]-[index:717]-[坏账视图月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_ACCT_OWECHECK_${monthid};\\ncreate table DM_PUB_ACCT_OWECHECK_${monthid} distributed by('product_no') as select * from DM_PUB_ACCT_OWECHECK_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [453]-[index:718]-[坏账视图月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_ACCT_OWECHECK_${monthid} select * from DM_PUB_ACCT_OWECHECK_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [454]-[index:720]-[历史数据表]-[12]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入结果表数据","nodeId":"12","sql":"insert into ${DM_PUB_HIS_INDEX_YYYYMM}\\n (\\tOP_TIME,\\n\\tSTATIS_MONTH,\\n\\tPRODUCT_NO,\\n\\tYEAR_SHOULD_FEE,\\n\\tLAST6_MOUNTH_AVG,\\n\\tLAST3_MOUNTH_AVG,\\n\\tMONTH_FEE,\\n\\tLAST1_MONTH_FEE,\\n\\tLAST2_MONTH_FEE,\\n\\tLAST3_MONTH_FEE,\\n\\tLAST4_MONTH_FEE,\\n\\tLAST5_MONTH_FEE,\\n\\tLAST6_MONTH_FEE,\\n\\tLAST7_MONTH_FEE,\\n\\tLAST8_MONTH_FEE,\\n\\tLAST9_MONTH_FEE,\\n\\tLAST10_MONTH_FEE,\\n\\tLAST11_MONTH_FEE,\\n\\tLAST12_MONTH_FEE,\\n\\tMOUNTH6_DURATION_AVG,\\n\\tMOUNTH3_DURATION_AVG,\\n\\tMONTH_DURATION_M,\\n\\tLAST1_DURATION_M,\\n\\tLAST2_DURATION_M,\\n\\tLAST3_DURATION_M,\\n\\tLAST4_DURATION_M,\\n\\tLAST5_DURATION_M,\\n\\tLAST6_DURATION_M,\\n\\tLAST7_DURATION_M,\\n\\tLAST8_DURATION_M,\\n\\tLAST9_DURATION_M,\\n\\tLAST10_DURATION_M,\\n\\tLAST11_DURATION_M,\\n\\tLAST12_DURATION_M,\\n\\tDANGQZFY,\\n\\tDANGQGJCT,\\n\\tDANGQGJMY,\\n\\tDANGQGTCT,\\n\\tDANGQGTMY,\\n\\tDANGQZFYQ1Y,\\n\\tDANGQGJCTQ1Y,\\n\\tDANGQGJMYQ1Y,\\n\\tDANGQGTCTQ1Y,\\n\\tDANGQGTMYQ1Y,\\n\\tDANGQZFYQ2Y,\\n\\tDANGQGJCTQ2Y,\\n\\tDANGQGJMYQ2Y,\\n\\tDANGQGTCTQ2Y,\\n\\tDANGQGTMYQ2Y\\t)\\nselect\\tTO_DATE('${month_id}','YYYY-MM') as op_time,    \\n\\t\\ta.STAT_MON as statis_month,\\n\\t\\ta.phone_no,\\n\\t\\tcase when '${monthid}' = '${curyfirstmonth}' then nvl(d.SHOULD_INCOME,0) \\n\\t\\t\\t else nvl(b.year_should_fee,0)+nvl(d.SHOULD_INCOME,0) end,  \\n\\t\\t(nvl(d.SHOULD_INCOME,0)+nvl(b.MONTH_FEE,0)+nvl(b.LAST1_MONTH_FEE,0)+nvl(b.LAST2_MONTH_FEE,0)+nvl(b.LAST3_MONTH_FEE,0)+nvl(b.LAST4_MONTH_FEE,0))/6 as last6_mounth_avg,\\t\\t\\n\\t\\t(nvl(d.SHOULD_INCOME,0)+nvl(b.MONTH_FEE,0)+nvl(b.LAST1_MONTH_FEE,0))/3 as last3_mounth_avg,\\n\\t\\tnvl(d.SHOULD_INCOME,0),\\n\\t\\tnvl(b.MONTH_FEE,0) ,\\n\\t\\tnvl(b.LAST1_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST2_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST3_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST4_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST5_MONTH_FEE,0), \\n\\t\\tnvl(b.LAST6_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST7_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST8_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST9_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST10_MONTH_FEE,0),\\n\\t\\tnvl(b.LAST11_MONTH_FEE,0), \\n\\t\\t(nvl(e.CALL_DUR,0)+nvl(b.MONTH_DURATION_M,0)+nvl(b.LAST1_DURATION_M,0)+nvl(b.LAST2_DURATION_M,0)+nvl(b.LAST3_DURATION_M,0)+nvl(b.LAST4_DURATION_M,0))/6 as mounth6_DURATION_avg ,\\n\\t\\t(nvl(e.CALL_DUR,0)+nvl(b.MONTH_DURATION_M,0)+nvl(b.LAST1_DURATION_M,0))/3 as mounth3_DURATION_avg,\\n\\t\\tnvl(e.CALL_DUR,0),\\n\\n\\t\\tnvl(b.MONTH_DURATION_M,0), \\n\\t\\tnvl(b.LAST1_DURATION_M,0), \\n\\t\\tnvl(b.LAST2_DURATION_M,0), \\n\\t\\tnvl(b.LAST3_DURATION_M,0), \\n\\t\\tnvl(b.LAST4_DURATION_M,0), \\n\\t\\tnvl(b.LAST5_DURATION_M,0), \\n\\t\\tnvl(b.LAST6_DURATION_M,0),\\n\\t\\tnvl(b.LAST7_DURATION_M,0), \\n\\t\\tnvl(b.LAST8_DURATION_M,0), \\n\\t\\tnvl(b.LAST9_DURATION_M,0), \\n\\t\\tnvl(b.LAST10_DURATION_M,0),\\n\\t\\tnvl(b.LAST11_DURATION_M,0),\\n\\t\\tnvl(c.dangqzfy,0)         ,\\n\\t\\tnvl(c.dangqgjct,0)        ,\\n\\t\\tnvl(c.dangqgjmy,0)        ,\\n\\t\\tnvl(c.dangqgtct,0)        ,\\n\\t\\tnvl(c.dangqgtmy,0)        ,\\n\\n\\t\\tnvl(b.DANGQZFY,0)         ,\\n\\t\\tnvl(b.DANGQGJCT,0)        ,\\n\\t\\tnvl(b.DANGQGJMY,0)        ,\\n\\t\\tnvl(b.DANGQGTCT,0)        ,\\n\\t\\tnvl(b.DANGQGTMY,0)        ,\\n\\n\\t\\tnvl(b.DANGQZFYQ1Y,0)      ,\\n\\t\\tnvl(b.DANGQGJCTQ1Y,0)     ,\\n\\t\\tnvl(b.DANGQGJMYQ1Y,0)     ,\\n\\t\\tnvl(b.DANGQGTCTQ1Y,0)     ,\\n\\t\\tnvl(b.DANGQGTMYQ1Y,0)  \\nfrom gbasedwi.DWI_USR_PESN_MS_${monthid} a    \\nleft join (select phone_no,sum(SHOULD_INCOME) SHOULD_INCOME \\n\\t\\t   from gbasedwi.DWI_INCO_BILL_USER_MS_${monthid} \\n\\t\\t   group by phone_no) d on a.phone_no=d.phone_no \\nleft join (select phone_no,USER_ID,sum(CALL_DUR) CALL_DUR from gbasedwi.DWI_BEH_USE_VOC_USERTOT_MS_${monthid}\\n\\t\\t   group by phone_no,USER_ID) e\\ton a.phone_no = e.phone_no and a.USER_ID=e.USER_ID\\nleft join dm_pub_his_index_${pmonthid} b on a.PHONE_NO=b.product_no\\nleft join (select PHONE_NO,\\n                  nvl(sum(case when group_type_id in (4,5,7,8) or ACCT_ITEM_ID in ('249','43','108') then should_income end),0) as dangqzfy,\\n                  nvl(sum(case when group_type_id in (5,8) then should_income end),0) as dangqgjct,\\n\\t              nvl(sum(case when ACCT_ITEM_ID in ('43','108') then should_income end),0) as dangqgjmy,\\n\\t              nvl(sum(case when group_type_id in (4,7) then should_income end),0) as dangqgtct,\\n\\t              nvl(sum(case when  ACCT_ITEM_ID= '249' then should_income end),0) as dangqgtmy\\n           from gbasedwi.DWI_INCO_BILL_ITEM_TOT_MS_${monthid}            \\n           where ACCT_ITEM_ID in ('249','43','108') or group_type_id in (4,5,7,8) \\n           group by PHONE_NO) c on a.phone_no=c.phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [455]-[index:726]-[宽带信息日视图日调度传输]-[11]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"11","dsName":"Gbase_6_DM","sql":"drop table dm_pub_broadband_msg_${dayid} ;\\ncreate table dm_pub_broadband_msg_${dayid} distributed by ('LOGIN_ID') as select * from dm_pub_broadband_msg_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [456]-[index:727]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[12]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"12.插入数据到目标表","nodeId":"12","sql":"insert into ${TARGET_DM_AUTORPT_ORDER_USER_YYYYMM}\\n (\\t\\tOP_TIME,\\n\\t\\tSTATIS_MONTH,\\n\\t\\tPRODUCT_NO,\\n\\t\\tI0332,\\n        I0333, \\n        I0337,\\n        plan_id1,\\n        I0339,\\n        I0340,\\n        I0341,\\n        I0343,\\n        I0937,\\n        I0941,\\n new_plan_name,\\n SHOULD_INCOME,\\n dgdd_paln_id,\\n dgdd_plan_name)\\nselect \\tto_date('${curmfirstday}','YYYYMMDD'),\\n\\t\\t'${monthid}',\\n\\t\\ta.phone_no,\\n\\t\\tnvl((case when d.plan_id is not null then d.plan_id else b.plan_id end),'0'),\\n        nvl((case when e.offer_id is not null then e.offer_id else b.new_plan_id end),'0'), -- 下月生效套餐\\n\\t\\tnvl((case when d.plan_id is not null then d.plan_id else b.plan_id end),'0'), -- 主套餐\\n\\t\\tnvl((case when d.plan_id is not null then d.plan_id else b.plan_id end),'0'),\\n\\t\\tnvl(c.POST_ZD_BILL,0),\\t\\t/*纸质邮寄账单*/\\n\\t\\tnvl(c.POST_ZXD_BILL,0),\\t\\t/*纸质邮寄账详单*/\\n\\t\\tnvl(c.EMAIL_ZXD_BILL,0),\\t/*EMAIL账详单*/\\n\\t\\tnvl(c.SMS_LZD_BILL,0),\\t\\t/*长短信账单*/\\n\\t\\tnvl(c.MMS_ZD_BILL,0),\\t\\t/*彩信账单*/\\n\\t\\tnvl(c.WAP_BILL,0)\\t,\\t\\t/*wap账单*/\\n        case when e.offer_name is not null then e.offer_name else b.new_plan_name end new_plan_name,\\n        nvl(f.SHOULD_INCOME,0),  /*主套餐-当月生效费用（出账）*/\\n        g.plan_id,  -- 动感地带策划id\\n        g.plan_name  -- 动感地带策划名称\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} a\\nleft join ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_02} b on a.phone_no = b.phone_no\\nleft join ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_01} c on a.phone_no = c.PHONE_NO\\nleft join ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_03} d on a.phone_no = d.PHONE_NO\\nleft join ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_04} e on a.phone_no = e.PHONE_NO\\nleft join dm.TMP_DM_AUTORPT_ORDER_USER_05 f on a.phone_no = f.PHONE_NO\\nleft join DM.TMP_DM_AUTORPT_ORDER_USER_07_${monthid} g on a.phone_no = g.phone_no\\nwhere (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001\\n\\n--  (A.ONNET_USER_FLAG=1 AND A.PROD_KIND_CODE='171000000001') or A.MONTH_OFF_FLAG =1;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [457]-[index:728]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"删除表","nodeId":"8","sql":"DROP TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_01};\\nDROP TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_02};\\nDROP TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_03};\\nDROP TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_04};\\ndrop table ${TARGET_DM_AUTORPT_ORDER_USER_YYYYMM};"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [458]-[index:729]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[38]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"create table ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_04} \\n (\\tPHONE_NO    \\tVARCHAR(20),\\n\\toffer_id\\t    VARCHAR(100),\\n    offer_name      VARCHAR(200)\\n )DISTRIBUTED BY('PHONE_NO');\\n \\ninsert into ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_04} \\nselect a.phone_no,a.offer_id,b.offer_name \\nfrom\\n (select a.phone_no,\\n        max(b.offer_id) call_offer_id, \\n        max(c.offer_id) gprs_offer_id,\\n        concat(max(b.offer_id),'|',max(c.offer_id)) offer_id\\n  from gbasedwi.DWI_INST_ASSET_MS_${monthid} a\\n  left join dm.dim_offer_call_list b on a.plan_id=b.offer_id\\n  left join dm.dim_offer_gprs_list c on a.plan_id=c.offer_id\\n  where date(a.eff_time)<='${nextm_first_day}' and date(a.exp_time)>'${nextm_first_day}'\\n  group by phone_no) a\\nleft join dm.dim_offer_static b on a.offer_id=b.offer_id;\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [459]-[index:731]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[19]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"删除临时表","nodeId":"19","sql":"DROP TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_01};\\nDROP TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_02};\\nDROP TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_03};\\nDROP TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_04};"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [460]-[index:733]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[23]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入数据到临时表2","nodeId":"23","sql":"insert into ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_02} \\n (\\tphone_no,\\n    plan_id,\\n\\tnew_plan_id,\\n new_plan_name)\\nselect phone_no,\\n       max(case when CUR_CYCLE_STATE='1' and exp_time >= to_date('${curm_last_day}','YYYY-MM-DD')  then PLAN_ID end) as plan_id,\\n\\t   max(case when eff_time  <=  to_date('${nextm_first_day}','YYYY-MM-DD') and exp_time  >  to_date('${nextm_first_day}','YYYY-MM-DD')  then PLAN_ID end) as new_plan_id,\\n\\t   max(case when eff_time  <=  to_date('${nextm_first_day}','YYYY-MM-DD') and exp_time  >  to_date('${nextm_first_day}','YYYY-MM-DD')  then plan_name end) as new_plan_name\\n  from ${SOURCE_DWI_INST_OFFER_PLAN_MS_YYYYMM} \\n  group by phone_no;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [461]-[index:734]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[9]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"创建临时表1","nodeId":"9","sql":"CREATE TABLE ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_01}\\n(\\tOP_TIME       \\tDATE,\\n    PHONE_NO    \\tVARCHAR(20),\\n\\tPOST_ZD_BILL\\tSMALLINT,\\n\\tPOST_ZXD_BILL\\tSMALLINT,\\n\\tEMAIL_ZXD_BILL\\tSMALLINT,\\n\\tSMS_LZD_BILL\\tSMALLINT,\\n\\tWAP_BILL\\t\\tSMALLINT,\\n\\tMMS_ZD_BILL\\t\\tSMALLINT\\t)\\nDISTRIBUTED BY('PHONE_NO');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [462]-[index:735]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[27]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"27.更新主套餐维表","nodeId":"27","sql":"truncate table  DIM_OFFER_STATIC;\\ninsert into DIM_OFFER_STATIC (offer_id,offer_name)  \\nselect plan_id,plan_name from gbasedwi.DIM_SVC_OFF_STATIC_DS_${curmlastday}\\nwhere EXISTS_TABLE_NAME='DWI_INST_OFFER_PLAN_DS';\\n##20190322修改 增加'无' 以取没有主套餐的用户数据\\ninsert into dm.dim_offer_static values (0,'无'); \\n#20221121修改，增加畅享套餐策划至主套餐维表  \\ninsert into dm.dim_offer_static (offer_id,offer_name) \\nselect concat(call_id,'|',gprs_id) plan_id,cx_offer_name from dm.dim_cx_offer_type_list;\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [463]-[index:736]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[11]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"创建目标表","nodeId":"11","sql":"CREATE TABLE ${TARGET_DM_AUTORPT_ORDER_USER_YYYYMM}\\n       (    OP_TIME       DATE\\n           ,STATIS_MONTH  INTEGER\\n           ,PRODUCT_NO    VARCHAR(20)\\n           ,I0065         SMALLINT\\n           ,I0066         SMALLINT\\n           ,I0067         SMALLINT\\n           ,I0069         SMALLINT\\n           ,I0072         SMALLINT\\n           ,I0073         SMALLINT\\n           ,I0124         VARCHAR(10)\\n           ,I0158         SMALLINT\\n           ,I0165         SMALLINT\\n           ,I0175         SMALLINT\\n           ,I0185         SMALLINT\\n           ,I0189         SMALLINT\\n           ,I0192         SMALLINT\\n           ,I0194         SMALLINT\\n           ,I0198         SMALLINT\\n           ,I0199         SMALLINT\\n           ,I0202         SMALLINT\\n           ,I0204         SMALLINT\\n           ,I0206         SMALLINT\\n           ,I0207         SMALLINT\\n           ,I0208         SMALLINT\\n           ,I0209         SMALLINT\\n           ,I0210         SMALLINT\\n           ,I0211         SMALLINT\\n           ,I0212         SMALLINT\\n           ,I0213         SMALLINT\\n           ,I0214         SMALLINT\\n           ,I0215         SMALLINT\\n           ,I0216         SMALLINT\\n           ,I0217         SMALLINT\\n           ,I0218         SMALLINT\\n           ,I0219         SMALLINT\\n           ,I0220         SMALLINT\\n           ,I0221         SMALLINT\\n           ,I0222         SMALLINT\\n           ,I0223         SMALLINT\\n           ,I0224         SMALLINT\\n           ,I0225         SMALLINT\\n           ,I0226         SMALLINT\\n           ,I0227         SMALLINT\\n           ,I0228         SMALLINT\\n           ,I0229         SMALLINT\\n           ,I0231         SMALLINT\\n           ,I0232         SMALLINT\\n           ,I0233         SMALLINT\\n           ,I0234         SMALLINT\\n           ,I0235         SMALLINT\\n           ,I0236         SMALLINT\\n           ,I0237         SMALLINT\\n           ,I0238         SMALLINT\\n           ,I0239         SMALLINT\\n           ,I0241         SMALLINT\\n           ,I0242         SMALLINT\\n           ,I0243         SMALLINT\\n           ,I0244         INTEGER\\n           ,I0245         SMALLINT\\n           ,I0246         SMALLINT\\n           ,I0248         SMALLINT\\n           ,I0249         SMALLINT\\n           ,I0302         VARCHAR(10)\\n           ,I0305         VARCHAR(10)\\n           ,I0310         VARCHAR(10)\\n           ,I0319         VARCHAR(10)\\n           ,I0332         varchar(100)\\n           ,I0333         varchar(100)\\n           ,I0334         SMALLINT\\n           ,I0335         INTEGER\\n           ,I0336         BIGINT\\n           ,I0337         varchar(100)\\n           ,I0338         SMALLINT\\n           ,I0339         SMALLINT\\n           ,I0340         SMALLINT\\n           ,I0341         SMALLINT\\n           ,I0342         SMALLINT\\n           ,I0343         SMALLINT\\n           ,I0344         SMALLINT\\n           ,I0345         SMALLINT\\n           ,I0346         SMALLINT\\n           ,I0347         SMALLINT\\n           ,I0348         SMALLINT\\n           ,I0349         SMALLINT\\n           ,I0350         SMALLINT\\n           ,I0351         SMALLINT\\n           ,I0352         SMALLINT\\n           ,I0353         SMALLINT\\n           ,I0354         SMALLINT\\n           ,I0356         SMALLINT\\n           ,I0357         INTEGER\\n           ,I0358         INTEGER\\n           ,I0359         INTEGER\\n           ,I0360         INTEGER\\n           ,I0361         SMALLINT\\n           ,I0362         SMALLINT\\n           ,I0363         SMALLINT\\n           ,I0364         SMALLINT\\n           ,I0365         SMALLINT\\n           ,I0366         SMALLINT\\n           ,I0367         SMALLINT\\n           ,I0368         SMALLINT\\n           ,I0369         SMALLINT\\n           ,I0370         SMALLINT\\n           ,I0371         SMALLINT\\n           ,I0372         SMALLINT\\n           ,I0373         SMALLINT\\n           ,I0374         DATE\\n           ,I0375         SMALLINT\\n           ,I0376         DATE\\n           ,I0478         VARCHAR(10)\\n           ,I0631         SMALLINT\\n           ,I0716         SMALLINT\\n           ,I0717         SMALLINT\\n           ,I0718         SMALLINT\\n           ,I0719         SMALLINT\\n           ,I0792         VARCHAR(10)\\n           ,I0879         INTEGER\\n           ,I0937         SMALLINT\\n           ,I0941         SMALLINT\\n           ,I0947         VARCHAR(10)\\n           ,PB1000        SMALLINT\\n           ,PB1001        SMALLINT\\n           ,PB1001_1      DATE\\n           ,PB1002        SMALLINT\\n           ,PB1002_1      DATE\\n           ,PB1003        SMALLINT\\n           ,PB1003_1      DATE\\n           ,PB1004        SMALLINT\\n           ,PB1004_1      DATE\\n           ,PB1005        SMALLINT\\n           ,PB1005_1      DATE\\n           ,PB1006        SMALLINT\\n           ,PB1006_1      DATE\\n           ,PB1007        SMALLINT\\n           ,PB1007_1      DATE\\n           ,PB1008        SMALLINT\\n           ,PB1008_1      DATE\\n           ,PB1009        SMALLINT\\n           ,PB1009_1      DATE\\n           ,PB1010        SMALLINT\\n           ,PB1010_1      DATE\\n           ,PB1011        SMALLINT\\n           ,PB1011_1      DATE\\n           ,PB1012        SMALLINT\\n           ,PB1012_1      DATE\\n           ,PB1013        SMALLINT\\n           ,PB1013_1      DATE\\n           ,PB1014        SMALLINT\\n           ,PB1014_1      DATE\\n           ,PB1015        SMALLINT\\n           ,PB1015_1      DATE\\n           ,PB1016        SMALLINT\\n           ,PB1016_1      DATE\\n           ,PB1017        SMALLINT\\n           ,PB1017_1      DATE\\n           ,PB1018        SMALLINT\\n           ,PB1018_1      DATE\\n           ,PB1019        SMALLINT\\n           ,PB1019_1      DATE\\n           ,PB1020        SMALLINT\\n           ,PB1021        SMALLINT\\n           ,PB1021_1      DATE\\n           ,PB1022        SMALLINT\\n           ,PB1023        SMALLINT\\n           ,PB1023_1      DATE\\n           ,PB1024        SMALLINT\\n           ,PB1024_1      DATE\\n           ,PB1025        SMALLINT\\n           ,PB1025_1      DATE\\n           ,PB1026        SMALLINT\\n           ,PB1026_1      DATE\\n           ,PB1027        SMALLINT\\n           ,PB1027_1      DATE\\n           ,PB1028        SMALLINT\\n           ,PB1028_1      DATE\\n           ,PB1029        SMALLINT\\n           ,PB1029_1      DATE\\n           ,PB1030        SMALLINT\\n           ,PB1030_1      DATE\\n           ,PB1031        SMALLINT\\n           ,PB1031_1      DATE\\n           ,PB1032        SMALLINT\\n           ,PB1032_1      DATE\\n           ,PB1033        SMALLINT\\n           ,PB1033_1      DATE\\n           ,PB1035        SMALLINT\\n           ,PB1035_1      DATE\\n           ,PB1036        SMALLINT\\n           ,PB1036_1      DATE\\n           ,PB1037        SMALLINT\\n           ,PB1037_1      DATE\\n           ,PB1038        SMALLINT\\n           ,PB1038_1      DATE\\n           ,PB1039        SMALLINT\\n           ,PB1039_1      DATE\\n           ,PB1040        SMALLINT\\n           ,PB1040_1      DATE\\n           ,PB1041        SMALLINT\\n           ,PB1041_1      DATE\\n           ,PB1042        SMALLINT\\n           ,PB1042_1      DATE\\n           ,PB1043        SMALLINT\\n           ,PB1043_1      DATE\\n           ,PB1044        SMALLINT\\n           ,PB1044_1      DATE\\n           ,PB1045        SMALLINT\\n           ,PB1045_1      DATE\\n           ,PB1046        SMALLINT\\n           ,PB1046_1      DATE\\n           ,PB1047        SMALLINT\\n           ,PB1047_1      DATE\\n           ,PB1048        SMALLINT\\n           ,PB1048_1      DATE\\n           ,PB1049        SMALLINT\\n           ,PB1049_1      DATE\\n           ,PB1050        SMALLINT\\n           ,PB1050_1      DATE\\n           ,PB1051        SMALLINT\\n           ,PB1051_1      DATE\\n           ,PB1052        SMALLINT\\n           ,PB1052_1      DATE\\n           ,PB1053        SMALLINT\\n           ,PB1053_1      DATE\\n           ,PB1054        SMALLINT\\n           ,PB1054_1      DATE\\n           ,PB1056        SMALLINT\\n           ,PB1056_1      DATE\\n           ,PB1057        SMALLINT\\n           ,PB1057_1      DATE\\n           ,PB1058        SMALLINT\\n           ,PB1058_1      DATE\\n           ,PB1059        SMALLINT\\n           ,PB1059_1      DATE\\n           ,PB1060        SMALLINT\\n           ,PB1060_1      DATE\\n           ,PB1061        SMALLINT\\n           ,PB1061_1      DATE\\n           ,PB1100        DATE\\n           ,PB1200        DATE\\n           ,PB2000        SMALLINT\\n           ,PB2001        SMALLINT\\n           ,PB2002        SMALLINT\\n           ,PB2003        SMALLINT\\n           ,PB2004        SMALLINT\\n           ,PB2005        SMALLINT\\n           ,PB2006        SMALLINT\\n           ,PB2007        SMALLINT\\n           ,PB2008        SMALLINT\\n           ,PB2009        SMALLINT\\n           ,PB2010        SMALLINT\\n           ,PB2011        SMALLINT\\n           ,PB2012        SMALLINT\\n           ,PB2013        SMALLINT\\n           ,PB2014        SMALLINT\\n           ,PB2015        SMALLINT\\n           ,PB2016        SMALLINT\\n           ,PB2017        SMALLINT\\n           ,PB2018        SMALLINT\\n           ,PB2019        SMALLINT\\n           ,PB2020        SMALLINT\\n           ,PB2021        SMALLINT\\n           ,PB2022        SMALLINT\\n           ,PB2023        SMALLINT\\n           ,PB2024        SMALLINT\\n           ,PB2025        SMALLINT\\n           ,PB2026        SMALLINT\\n           ,PB2027        SMALLINT\\n           ,PB2028        SMALLINT\\n           ,PB2029        SMALLINT\\n           ,PB2030        SMALLINT\\n           ,plan_id1      varchar(100)\\n           ,new_plan_name\\t    varchar(100)\\n           ,SHOULD_INCOME decimal(12,3) -- 主套餐-当月生效费用（出账）\\n           ,dgdd_paln_id varchar(300)\\n           ,dgdd_plan_name varchar(300)\\n    ) DISTRIBUTED BY('product_no');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [464]-[index:737]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[22]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"创建临时表2","nodeId":"22","sql":"create table ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_02} \\n (\\tPHONE_NO    \\tVARCHAR(20),\\n\\tplan_id\\t\\t\\tBIGINT\\t,\\nnew_plan_id\\t\\t\\tBIGINT\\t,\\n new_plan_name\\t    varchar(100))\\nDISTRIBUTED BY('PHONE_NO');"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [465]-[index:738]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[47]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.TMP_DM_AUTORPT_ORDER_USER_05;\\ncreate table dm.TMP_DM_AUTORPT_ORDER_USER_05\\n(phone_no   varchar(50),\\n SHOULD_INCOME decimal(12,3)\\n )DISTRIBUTED BY('PHONE_NO');\\n \\ninsert into dm.TMP_DM_AUTORPT_ORDER_USER_05\\nselect a.phone_no,sum(SHOULD_INCOME) SHOULD_INCOME\\nfrom\\n(select distinct phone_no,acct_item_id\\nfrom\\n    (select a.phone_no,b.acct_item_id\\n     from ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_03} a\\n     left join (select *,item_id-88000000 acct_item_id from gbasedwi.dwi_inst_plan_prod_and_ms_${monthid}) b on a.call_offer_id=b.plan_id\\n\\n     union all\\n\\n     select a.phone_no,b.acct_item_id\\n     from ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_03} a\\n     left join (select *,item_id-88000000 acct_item_id from gbasedwi.dwi_inst_plan_prod_and_ms_${monthid}) b on a.gprs_offer_id=b.plan_id\\n    ) a\\n) a\\nleft join gbasedwi.dwi_inco_bill_item_tot_ms_${monthid} b on a.phone_no=b.phone_no and a.acct_item_id=b.acct_item_id\\ngroup by a.phone_no"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [466]-[index:739]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[51]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table DM.TMP_DM_AUTORPT_ORDER_USER_06_${monthid};\\ncreate table  DM.TMP_DM_AUTORPT_ORDER_USER_06_${monthid} distributed by ('phone_no')\\nselect \\na.phone_no,\\nnvl((case when d.plan_id is not null then d.plan_id else b.plan_id end),'0') as plan_id\\nfrom ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} a\\nleft join ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_02} b on a.phone_no = b.phone_no\\nleft join ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_03} d on a.phone_no = d.PHONE_NO;\\n\\ndrop table DM.TMP_DM_AUTORPT_ORDER_USER_07_${monthid};\\ncreate table  DM.TMP_DM_AUTORPT_ORDER_USER_07_${monthid}  distributed by ('phone_no')\\nselect \\na.phone_no,\\nb.plan_id,\\nb.plan_name\\nfrom DM.TMP_DM_AUTORPT_ORDER_USER_06_${monthid} a\\nleft join (select distinct a.* from gbasedwd.dim_mzone_info a) b  on a.plan_id = b.plan_id;\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [467]-[index:741]-[产品订购表DM_AUTORPT_ORDER_USER_YYYYMM]-[33]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"create table ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_03} \\n (\\tPHONE_NO    \\tVARCHAR(20),\\n\\tcall_offer_id\\tBIGINT,\\n    gprs_offer_id   BIGINT,\\n    plan_id         VARCHAR(100)\\n )DISTRIBUTED BY('PHONE_NO');\\n \\n insert into ${SOURCE_TMP_DM_AUTORPT_ORDER_USER_03} \\n select a.phone_no,\\n        max(b.offer_id) , \\n        max(c.offer_id) ,\\n        concat(max(b.offer_id),'|',max(c.offer_id))\\n  from gbasedwi.dwi_inst_offer_list_all_ms_${monthid} a\\n  left join dm.dim_offer_call_list b on a.plan_id=b.offer_id\\n  left join dm.dim_offer_gprs_list c on a.plan_id=c.offer_id\\n  where date(a.exp_time)>='${curm_last_day}'\\n  group by phone_no;\\n\\n"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [468]-[index:745]-[驻留模型分析近30天日程序]-[12]-['str' object has no attribute 'lfind']:{"name":"创建中间表","nodeId":"12","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_ALL_${dayid} (\\n  \\"IMSI\\" varchar(100) DEFAULT NULL,\\n  \\"LAC_CI\\" varchar(100) DEFAULT NULL,\\n  \\"IN_TIME\\" datetime DEFAULT NULL,\\n  \\"OUT_TIME\\" datetime DEFAULT NULL\\n) COMPRESS(5, 5)  ENGINE=EXPRESS DISTRIBUTED BY('imsi') DEFAULT CHARSET=utf8 TABLESPACE='sys_tablespace'","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [469]-[index:746]-[驻留模型分析近30天日程序]-[13]-['str' object has no attribute 'lfind']:{"name":"删除中间表","nodeId":"13","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_ALL_${dayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_ALL_${dayid} (\\n  \\"IMSI\\" varchar(100) DEFAULT NULL,\\n  \\"LAC_CI\\" varchar(100) DEFAULT NULL,\\n  \\"IN_TIME\\" datetime DEFAULT NULL,\\n  \\"OUT_TIME\\" datetime DEFAULT NULL\\n) COMPRESS(5, 5)  ENGINE=EXPRESS DISTRIBUTED BY('imsi') DEFAULT CHARSET=utf8 TABLESPACE='sys_tablespace'","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [470]-[index:749]-[驻留模型分析近30天日程序]-[23]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"23","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_ALL_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [471]-[index:750]-[驻留模型分析近30天日程序]-[34]-['str' object has no attribute 'lfind']:{"name":"插入中间表","nodeId":"34","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_ALL_${dayid}\\n  (IMSI, LAC_CI, IN_TIME, OUT_TIME)\\n  SELECT IMSI,\\n         bts,\\n       in_cell_time,\\n         CASE\\n           WHEN out_cell_time is null  or  length(out_cell_time)<>19  THEN\\n            '${day_id} 23:59:59'\\n           ELSE\\n            out_cell_time end\\n    FROM (SELECT IMSI,\\n                 bts,\\n                 in_cell_time,\\n                 out_cell_time,\\n                 ROW_NUMBER() OVER(PARTITION BY IMSI,bts, in_cell_time ORDER BY out_cell_time) RN\\n            FROM gbasedwd.dwd_evt_cdr_userloc_dtl_ds_${dayid}) A\\n   WHERE RN = 1 and  length(in_cell_time)=19","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [472]-[index:753]-[驻留模型分析近30天日程序]-[43]-['str' object has no attribute 'lfind']:{"name":"创建开机日表","nodeId":"43","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_ON_${pdayid} (IMSI VARCHAR(20) , LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [473]-[index:754]-[驻留模型分析近30天日程序]-[44]-['str' object has no attribute 'lfind']:{"name":"删除开机日表","nodeId":"44","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_ON_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_ON_${pdayid} (IMSI VARCHAR(20) , LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [474]-[index:757]-[驻留模型分析近30天日程序]-[50]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"50","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_ON_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [475]-[index:758]-[驻留模型分析近30天日程序]-[55]-['str' object has no attribute 'lfind']:{"name":"插入开机日表","nodeId":"55","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_ON_${pdayid}\\n  SELECT IMSI, LAC_CI, IN_TIME, OUT_TIME, MOMENT\\n    FROM (SELECT A.*,\\n                 TO_CHAR(IN_TIME, 'HH24') MOMENT,\\n                 ROW_NUMBER() OVER(PARTITION BY IMSI ORDER BY OUT_TIME) RN\\n            FROM LOP.LOP_ST_BEH_STAY_ALL_${pdayid} A\\n           WHERE TO_DATE('${p_day_id} 05:00:00', 'YYYY-MM-DD HH24:MI:SS') <=\\n                 OUT_TIME\\n             AND TO_DATE('${p_day_id} 09:00:00', 'YYYY-MM-DD HH24:MI:SS') >=\\n                 OUT_TIME) A\\n   WHERE RN = 1\\n     AND TO_DATE('${p_day_id} 04:00:00', 'YYYY-MM-DD HH24:MI:SS') >= IN_TIME;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [476]-[index:761]-[驻留模型分析近30天日程序]-[79]-['str' object has no attribute 'lfind']:{"name":"创建开机累计日表","nodeId":"79","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_ON_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [477]-[index:762]-[驻留模型分析近30天日程序]-[80]-['str' object has no attribute 'lfind']:{"name":"删除开机累计日表","nodeId":"80","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_ON_T_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_ON_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [478]-[index:765]-[驻留模型分析近30天日程序]-[86]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"86","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_ON_T_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [479]-[index:766]-[驻留模型分析近30天日程序]-[89]-['str' object has no attribute 'lfind']:{"name":"插入开机累计日表","nodeId":"89","dsName":"GbaseLOP","sql":"INSERT INTO lop.lop_st_beh_stay_on_t_${pdayid}\\n  SELECT IMSI, LAC_CI, STATE, USE_DATE\\n    FROM (SELECT NVL(A.IMSI, B.IMSI) IMSI,\\n                 NVL(A.LAC_CI, B.LAC_CI) LAC_CI,\\n                 (CASE\\n                   WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                    '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                   WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                    SUBSTR(STATE, 3) || '/1'\\n                   ELSE\\n                    SUBSTR(STATE, 3) || '/0'\\n                 END) STATE,\\n                 NVL((CASE\\n                       WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                        1\\n                       WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                        (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                        LENGTH('1')\\n                       ELSE\\n                        (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                        LENGTH('1')\\n                     END),\\n                     0) USE_DATE\\n            FROM LOP.LOP_ST_BEH_STAY_ON_T_${p2dayid} A\\n            FULL JOIN LOP.LOP_ST_BEH_STAY_ON_${pdayid} B\\n              ON A.IMSI = B.IMSI\\n             AND A.LAC_CI = B.LAC_CI\\n           GROUP BY NVL(A.IMSI, B.IMSI),\\n                    NVL(A.LAC_CI, B.LAC_CI),\\n                    (CASE\\n                      WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                       '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                      WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                       SUBSTR(STATE, 3) || '/1'\\n                      ELSE\\n                       SUBSTR(STATE, 3) || '/0'\\n                    END),\\n                    NVL((CASE\\n                          WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                           1\\n                          WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                           (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                           LENGTH('1')\\n                          ELSE\\n                           (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                           LENGTH('1')\\n                        END),\\n                        0)) A\\n   WHERE USE_DATE > 0;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [480]-[index:769]-[驻留模型分析近30天日程序]-[99]-['str' object has no attribute 'lfind']:{"name":"创建关机日表","nodeId":"99","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_OFF_${pdayid} (IMSI VARCHAR(20) , LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [481]-[index:770]-[驻留模型分析近30天日程序]-[100]-['str' object has no attribute 'lfind']:{"name":"删除关机日表","nodeId":"100","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_OFF_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_OFF_${pdayid} (IMSI VARCHAR(20) , LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [482]-[index:772]-[驻留模型分析近30天日程序]-[105]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"105","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_OFF_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [483]-[index:773]-[驻留模型分析近30天日程序]-[108]-['str' object has no attribute 'lfind']:{"name":"插入关机日表","nodeId":"108","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_OFF_${pdayid}\\n  SELECT IMSI, LAC_CI, IN_TIME, OUT_TIME, MOMENT\\n    FROM (SELECT A.*,\\n                 TO_CHAR(IN_TIME, 'HH24') MOMENT,\\n                 ROW_NUMBER() OVER(PARTITION BY IMSI ORDER BY IN_TIME DESC) RN\\n            FROM (SELECT IMSI, LAC_CI, IN_TIME, OUT_TIME\\n                    FROM LOP.LOP_ST_BEH_STAY_ALL_${pdayid} A\\n                   WHERE TO_DATE('${p_day_id} 20:00:00',\\n                                 'YYYY-MM-DD HH24:MI:SS') <= IN_TIME\\n                  UNION ALL\\n                  SELECT IMSI, LAC_CI, IN_TIME, OUT_TIME\\n                    FROM LOP.LOP_ST_BEH_STAY_ALL_${dayid} A\\n                   WHERE TO_DATE('${day_id} 01:00:00',\\n                                 'YYYY-MM-DD HH24:MI:SS') >= IN_TIME) A) A\\n   WHERE RN = 1\\n     AND TO_DATE('${p_day_id} 20:00:00', 'YYYY-MM-DD HH24:MI:SS') <= IN_TIME\\n     AND TO_DATE('${day_id} 00:00:00', 'YYYY-MM-DD HH24:MI:SS') > IN_TIME;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [484]-[index:777]-[驻留模型分析近30天日程序]-[117]-['str' object has no attribute 'lfind']:{"name":"创建关机累计日表","nodeId":"117","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_OFF_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [485]-[index:778]-[驻留模型分析近30天日程序]-[118]-['str' object has no attribute 'lfind']:{"name":"删除关机累计日表","nodeId":"118","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_OFF_T_${pdayid} ;\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_OFF_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [486]-[index:781]-[驻留模型分析近30天日程序]-[124]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"124","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_OFF_T_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [487]-[index:782]-[驻留模型分析近30天日程序]-[127]-['str' object has no attribute 'lfind']:{"name":"插入关机累计日表","nodeId":"127","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_OFF_T_${pdayid}\\n  SELECT IMSI, LAC_CI, STATE, USE_DATE\\n    FROM (SELECT NVL(A.IMSI, B.IMSI) IMSI,\\n                 NVL(A.LAC_CI, B.LAC_CI) LAC_CI,\\n                 (CASE\\n                   WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                    '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                   WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                    SUBSTR(STATE, 3) || '/1'\\n                   ELSE\\n                    SUBSTR(STATE, 3) || '/0'\\n                 END) STATE,\\n                 NVL((CASE\\n                       WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                        1\\n                       WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                        (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                        LENGTH('1')\\n                       ELSE\\n                        (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                        LENGTH('1')\\n                     END),\\n                     0) USE_DATE\\n            FROM LOP.LOP_ST_BEH_STAY_OFF_T_${p2dayid} A\\n            FULL JOIN LOP.LOP_ST_BEH_STAY_OFF_${pdayid} B\\n              ON A.IMSI = B.IMSI\\n             AND A.LAC_CI = B.LAC_CI\\n           GROUP BY NVL(A.IMSI, B.IMSI),\\n                    NVL(A.LAC_CI, B.LAC_CI),\\n                    (CASE\\n                      WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                       '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                      WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                       SUBSTR(STATE, 3) || '/1'\\n                      ELSE\\n                       SUBSTR(STATE, 3) || '/0'\\n                    END),\\n                    NVL((CASE\\n                          WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                           1\\n                          WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                           (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                           LENGTH('1')\\n                          ELSE\\n                           (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                           LENGTH('1')\\n                        END),\\n                        0)) A\\n   WHERE USE_DATE > 0;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [488]-[index:785]-[驻留模型分析近30天日程序]-[135]-['str' object has no attribute 'lfind']:{"name":"创建休息日表","nodeId":"135","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_REST_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [489]-[index:786]-[驻留模型分析近30天日程序]-[136]-['str' object has no attribute 'lfind']:{"name":"删除休息日表","nodeId":"136","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_REST_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_REST_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [490]-[index:788]-[驻留模型分析近30天日程序]-[141]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"141","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_REST_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [491]-[index:789]-[驻留模型分析近30天日程序]-[144]-['str' object has no attribute 'lfind']:{"name":"插入休息日表","nodeId":"144","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_REST_${pdayid}\\n  SELECT IMSI, LAC_CI, IN_TIME, OUT_TIME, MOMENT\\n    FROM (SELECT A.*,\\n                 TO_CHAR(IN_TIME, 'HH24') MOMENT,\\n                 ROW_NUMBER() OVER(PARTITION BY IMSI ORDER BY TIMESTAMPDIFF(MINUTE,(CASE\\n                   WHEN IN_TIME <\\n                        TO_DATE('${p_day_id} 00:00:00',\\n                                'YYYY-MM-DD HH24:MI:SS') THEN\\n                    TO_DATE('${p_day_id} 00:00:00',\\n                            'YYYY-MM-DD HH24:MI:SS')\\n                   ELSE\\n                    IN_TIME\\n                 END),(CASE\\n                   WHEN OUT_TIME >\\n                        TO_DATE('${p_day_id} 05:00:00',\\n                                'YYYY-MM-DD HH24:MI:SS') THEN\\n                    TO_DATE('${p_day_id} 05:00:00',\\n                            'YYYY-MM-DD HH24:MI:SS')\\n                   ELSE\\n                    OUT_TIME\\n                 END)) DESC) RN\\n            FROM LOP.LOP_ST_BEH_STAY_ALL_${pdayid} A\\n           WHERE TO_DATE('${p_day_id} 00:00:00', 'YYYY-MM-DD HH24:MI:SS') <=\\n                 OUT_TIME\\n             AND TO_DATE('${p_day_id} 05:00:00', 'YYYY-MM-DD HH24:MI:SS') >=\\n                 IN_TIME) A\\n   WHERE RN = 1;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [492]-[index:793]-[驻留模型分析近30天日程序]-[153]-['str' object has no attribute 'lfind']:{"name":"创建休息累计日表","nodeId":"153","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_REST_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [493]-[index:794]-[驻留模型分析近30天日程序]-[154]-['str' object has no attribute 'lfind']:{"name":"删除休息累计日表","nodeId":"154","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_REST_T_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_REST_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [494]-[index:797]-[驻留模型分析近30天日程序]-[160]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"160","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_REST_T_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [495]-[index:798]-[驻留模型分析近30天日程序]-[163]-['str' object has no attribute 'lfind']:{"name":"插入休息累计日表","nodeId":"163","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_REST_T_${pdayid}\\n  SELECT IMSI, LAC_CI, STATE, USE_DATE\\n    FROM (SELECT NVL(A.IMSI, B.IMSI) IMSI,\\n                 NVL(A.LAC_CI, B.LAC_CI) LAC_CI,\\n                 (CASE\\n                   WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                    '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                   WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                    SUBSTR(STATE, 3) || '/1'\\n                   ELSE\\n                    SUBSTR(STATE, 3) || '/0'\\n                 END) STATE,\\n                 NVL((CASE\\n                       WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                        1\\n                       WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                        (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                        LENGTH('1')\\n                       ELSE\\n                        (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                        LENGTH('1')\\n                     END),\\n                     0) USE_DATE\\n            FROM LOP.LOP_ST_BEH_STAY_REST_T_${p2dayid} A\\n            FULL JOIN LOP.LOP_ST_BEH_STAY_REST_${pdayid} B\\n              ON A.IMSI = B.IMSI\\n             AND A.LAC_CI = B.LAC_CI\\n           GROUP BY NVL(A.IMSI, B.IMSI),\\n                    NVL(A.LAC_CI, B.LAC_CI),\\n                    (CASE\\n                      WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                       '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                      WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                       SUBSTR(STATE, 3) || '/1'\\n                      ELSE\\n                       SUBSTR(STATE, 3) || '/0'\\n                    END),\\n                    NVL((CASE\\n                          WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                           1\\n                          WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                           (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                           LENGTH('1')\\n                          ELSE\\n                           (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                           LENGTH('1')\\n                        END),\\n                        0)) A\\n   WHERE USE_DATE > 0;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [496]-[index:801]-[驻留模型分析近30天日程序]-[173]-['str' object has no attribute 'lfind']:{"name":"创建居住地日表","nodeId":"173","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_DOMIC_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20) , OPEN_DATE INT, CLOSE_DATE INT, REST_DATE INT, STAY_DATE INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [497]-[index:802]-[驻留模型分析近30天日程序]-[174]-['str' object has no attribute 'lfind']:{"name":"删除居住地日表","nodeId":"174","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_DOMIC_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_DOMIC_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20) , OPEN_DATE INT, CLOSE_DATE INT, REST_DATE INT, STAY_DATE INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [498]-[index:805]-[驻留模型分析近30天日程序]-[180]-['str' object has no attribute 'lfind']:{"name":"删除临时表","nodeId":"180","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_DOMIC_TMP;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [499]-[index:806]-[驻留模型分析近30天日程序]-[183]-['str' object has no attribute 'lfind']:{"name":"插入居住地日表","nodeId":"183","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_DOMIC_${pdayid}\\n  SELECT IMSI,\\n         LAC_CI,\\n         OPEN_DATE,\\n         CLOSE_DATE,\\n         REST_DATE,\\n         STAY_DATE\\n    FROM (SELECT IMSI,\\n                 LAC_CI,\\n                 OPEN_DATE,\\n                 CLOSE_DATE,\\n                 REST_DATE,\\n                 STAY_DATE,\\n                 ROW_NUMBER() OVER(PARTITION BY IMSI ORDER BY STAY_DATE DESC) RN\\n            FROM (SELECT D.IMSI,\\n                         D.LAC_CI,\\n                         SUM(NVL(A.USE_DATE, 0)) OPEN_DATE,\\n                         SUM(NVL(B.USE_DATE, 0)) CLOSE_DATE,\\n                         SUM(NVL(C.USE_DATE, 0)) REST_DATE,\\n                         SUM(NVL(NVL(A.USE_DATE, 0) + NVL(B.USE_DATE, 0) +\\n                                 NVL(C.USE_DATE, 0),\\n                                 0)) STAY_DATE\\n                    FROM LOP.LOP_ST_BEH_STAY_DOMIC_TMP D\\n                    LEFT JOIN LOP.LOP_ST_BEH_STAY_ON_T_${pdayid} A\\n                      ON D.IMSI = A.IMSI\\n                     AND D.LAC_CI = A.LAC_CI\\n                    LEFT JOIN LOP.LOP_ST_BEH_STAY_OFF_T_${pdayid} B\\n                      ON D.IMSI = B.IMSI\\n                     AND D.LAC_CI = B.LAC_CI\\n                    LEFT JOIN LOP.LOP_ST_BEH_STAY_REST_T_${pdayid} C\\n                      ON D.IMSI = C.IMSI\\n                     AND D.LAC_CI = C.LAC_CI\\n                   GROUP BY D.IMSI, D.LAC_CI) A) A\\n   WHERE RN = 1;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [500]-[index:808]-[驻留模型分析近30天日程序]-[192]-['str' object has no attribute 'lfind']:{"name":"创建居住地临时表","nodeId":"192","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_DOMIC_TMP (IMSI VARCHAR(20), LAC_CI VARCHAR(20) ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [501]-[index:809]-[驻留模型分析近30天日程序]-[193]-['str' object has no attribute 'lfind']:{"name":"删除居住地临时表","nodeId":"193","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_DOMIC_TMP;\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_DOMIC_TMP (IMSI VARCHAR(20), LAC_CI VARCHAR(20) ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [502]-[index:811]-[驻留模型分析近30天日程序]-[208]-['str' object has no attribute 'lfind']:{"name":"插入居住地临时表","nodeId":"208","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_DOMIC_TMP\\n  SELECT IMSI, LAC_CI\\n    FROM (SELECT IMSI, LAC_CI\\n            FROM LOP.LOP_ST_BEH_STAY_ON_T_${pdayid} A\\n          UNION ALL\\n          SELECT IMSI, LAC_CI\\n            FROM LOP.LOP_ST_BEH_STAY_OFF_T_${pdayid} B\\n          UNION ALL\\n          SELECT IMSI, LAC_CI\\n            FROM LOP.LOP_ST_BEH_STAY_REST_T_${pdayid} C) A\\n   GROUP BY IMSI, LAC_CI;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [503]-[index:814]-[驻留模型分析近30天日程序]-[214]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"214","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_DOMIC_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [504]-[index:817]-[驻留模型分析近30天日程序]-[226]-['str' object has no attribute 'lfind']:{"name":"创建上午工作日日表","nodeId":"226","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_MORN_${pdayid} (IMSI VARCHAR(20) , LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [505]-[index:818]-[驻留模型分析近30天日程序]-[227]-['str' object has no attribute 'lfind']:{"name":"删除上午工作日日表","nodeId":"227","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_MORN_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_MORN_${pdayid} (IMSI VARCHAR(20) , LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [506]-[index:821]-[驻留模型分析近30天日程序]-[233]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"233","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_MORN_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [507]-[index:822]-[驻留模型分析近30天日程序]-[236]-['str' object has no attribute 'lfind']:{"name":"插入上午工作日日表","nodeId":"236","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_MORN_${pdayid}\\n  SELECT IMSI, LAC_CI, IN_TIME, OUT_TIME, MOMENT\\n    FROM (SELECT A.*,\\n                 TO_CHAR(IN_TIME, 'HH24') MOMENT,\\n                 ROW_NUMBER() OVER(PARTITION BY IMSI ORDER BY TIMESTAMPDIFF(MINUTE,(CASE\\n                   WHEN IN_TIME <\\n                        TO_DATE('${p_day_id} 08:30:00',\\n                                'YYYY-MM-DD HH24:MI:SS') THEN\\n                    TO_DATE('${p_day_id} 08:30:00',\\n                            'YYYY-MM-DD HH24:MI:SS')\\n                   ELSE\\n                    IN_TIME\\n                 END),(CASE\\n                   WHEN OUT_TIME >\\n                        TO_DATE('${p_day_id} 12:00:00',\\n                                'YYYY-MM-DD HH24:MI:SS') THEN\\n                    TO_DATE('${p_day_id} 12:00:00',\\n                            'YYYY-MM-DD HH24:MI:SS')\\n                   ELSE\\n                    OUT_TIME\\n                 END)) DESC) RN\\n            FROM LOP.LOP_ST_BEH_STAY_ALL_${pdayid} A,\\n                 LOP.LOP_DIM_ST_BEH_WORK_DAY      B\\n           WHERE TO_DATE('${p_day_id} 08:30:00', 'YYYY-MM-DD HH24:MI:SS') <=\\n                 OUT_TIME\\n             AND TO_DATE('${p_day_id} 12:00:00', 'YYYY-MM-DD HH24:MI:SS') >=\\n                 IN_TIME\\n             AND B.DAY_TIME = '${pdayid}'\\n             AND B.IS_WORK = 1) A\\n   WHERE RN = 1;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [508]-[index:825]-[驻留模型分析近30天日程序]-[252]-['str' object has no attribute 'lfind']:{"name":"创建上午工作日累计日表","nodeId":"252","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_MORN_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [509]-[index:826]-[驻留模型分析近30天日程序]-[253]-['str' object has no attribute 'lfind']:{"name":"删除上午工作日累计日表","nodeId":"253","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_MORN_T_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_MORN_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [510]-[index:829]-[驻留模型分析近30天日程序]-[256]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"256","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_MORN_T_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [511]-[index:830]-[驻留模型分析近30天日程序]-[257]-['str' object has no attribute 'lfind']:{"name":"插入上午工作日累计日表","nodeId":"257","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_MORN_T_${pdayid}\\n  SELECT IMSI, LAC_CI, STATE, USE_DATE\\n    FROM (SELECT NVL(A.IMSI, B.IMSI) IMSI,\\n                 NVL(A.LAC_CI, B.LAC_CI) LAC_CI,\\n                 (CASE\\n                   WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                    '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                   WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                    SUBSTR(STATE, 3) || '/1'\\n                   ELSE\\n                    SUBSTR(STATE, 3) || '/0'\\n                 END) STATE,\\n                 NVL((CASE\\n                       WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                        1\\n                       WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                        (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                        LENGTH('1')\\n                       ELSE\\n                        (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                        LENGTH('1')\\n                     END),\\n                     0) USE_DATE\\n            FROM LOP.LOP_ST_BEH_STAY_MORN_T_${p2dayid} A\\n            FULL JOIN LOP.LOP_ST_BEH_STAY_MORN_${pdayid} B\\n              ON A.IMSI = B.IMSI\\n             AND A.LAC_CI = B.LAC_CI\\n           GROUP BY NVL(A.IMSI, B.IMSI),\\n                    NVL(A.LAC_CI, B.LAC_CI),\\n                    (CASE\\n                      WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                       '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                      WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                       SUBSTR(STATE, 3) || '/1'\\n                      ELSE\\n                       SUBSTR(STATE, 3) || '/0'\\n                    END),\\n                    NVL((CASE\\n                          WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                           1\\n                          WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                           (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                           LENGTH('1')\\n                          ELSE\\n                           (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                           LENGTH('1')\\n                        END),\\n                        0)) A\\n   WHERE USE_DATE > 0;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [512]-[index:833]-[驻留模型分析近30天日程序]-[262]-['str' object has no attribute 'lfind']:{"name":"创建下午工作日日表","nodeId":"262","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_AFTER_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [513]-[index:834]-[驻留模型分析近30天日程序]-[263]-['str' object has no attribute 'lfind']:{"name":"删除下午工作日日表","nodeId":"263","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_AFTER_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_AFTER_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20) , IN_TIME DATETIME , OUT_TIME DATETIME, MOMENT INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [514]-[index:837]-[驻留模型分析近30天日程序]-[269]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"269","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_AFTER_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [515]-[index:838]-[驻留模型分析近30天日程序]-[272]-['str' object has no attribute 'lfind']:{"name":"插入下午工作日日表","nodeId":"272","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_AFTER_${pdayid}\\n  SELECT IMSI, LAC_CI, IN_TIME, OUT_TIME, MOMENT\\n    FROM (SELECT A.*,\\n                 TO_CHAR(IN_TIME, 'HH24') MOMENT,\\n                 ROW_NUMBER() OVER(PARTITION BY IMSI ORDER BY TIMESTAMPDIFF(MINUTE,(CASE\\n                   WHEN IN_TIME <\\n                        TO_DATE('${p_day_id} 13:30:00',\\n                                'YYYY-MM-DD HH24:MI:SS') THEN\\n                    TO_DATE('${p_day_id} 13:30:00',\\n                            'YYYY-MM-DD HH24:MI:SS')\\n                   ELSE\\n                    IN_TIME\\n                 END),(CASE\\n                   WHEN OUT_TIME >\\n                        TO_DATE('${p_day_id} 18:00:00',\\n                                'YYYY-MM-DD HH24:MI:SS') THEN\\n                    TO_DATE('${p_day_id} 18:00:00',\\n                            'YYYY-MM-DD HH24:MI:SS')\\n                   ELSE\\n                    OUT_TIME\\n                 END)) DESC) RN\\n            FROM LOP.LOP_ST_BEH_STAY_ALL_${pdayid} A,\\n                 LOP.LOP_DIM_ST_BEH_WORK_DAY      B\\n           WHERE TO_DATE('${p_day_id} 13:30:00', 'YYYY-MM-DD HH24:MI:SS') <=\\n                 OUT_TIME\\n             AND TO_DATE('${p_day_id} 18:00:00', 'YYYY-MM-DD HH24:MI:SS') >=\\n                 IN_TIME\\n             AND B.DAY_TIME = '${pdayid}'\\n             AND B.IS_WORK = 1) A\\n   WHERE RN = 1;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [516]-[index:841]-[驻留模型分析近30天日程序]-[288]-['str' object has no attribute 'lfind']:{"name":"创建下午工作日累计日表","nodeId":"288","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_AFTER_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [517]-[index:842]-[驻留模型分析近30天日程序]-[289]-['str' object has no attribute 'lfind']:{"name":"删除下午工作日累计日表","nodeId":"289","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_AFTER_T_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_AFTER_T_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20), STATE VARCHAR(255), USE_DATE INTEGER) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [518]-[index:845]-[驻留模型分析近30天日程序]-[292]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"292","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_AFTER_T_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [519]-[index:846]-[驻留模型分析近30天日程序]-[293]-['str' object has no attribute 'lfind']:{"name":"插入下午工作日累计日表","nodeId":"293","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_AFTER_T_${pdayid}\\n  SELECT IMSI, LAC_CI, STATE, USE_DATE\\n    FROM (SELECT NVL(A.IMSI, B.IMSI) IMSI,\\n                 NVL(A.LAC_CI, B.LAC_CI) LAC_CI,\\n                 (CASE\\n                   WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                    '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                   WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                    SUBSTR(STATE, 3) || '/1'\\n                   ELSE\\n                    SUBSTR(STATE, 3) || '/0'\\n                 END) STATE,\\n                 NVL((CASE\\n                       WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                        1\\n                       WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                        (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                        LENGTH('1')\\n                       ELSE\\n                        (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                        LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                        LENGTH('1')\\n                     END),\\n                     0) USE_DATE\\n            FROM LOP.LOP_ST_BEH_STAY_AFTER_T_${p2dayid} A\\n            FULL JOIN LOP.LOP_ST_BEH_STAY_AFTER_${pdayid} B\\n              ON A.IMSI = B.IMSI\\n             AND A.LAC_CI = B.LAC_CI\\n           GROUP BY NVL(A.IMSI, B.IMSI),\\n                    NVL(A.LAC_CI, B.LAC_CI),\\n                    (CASE\\n                      WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                       '0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/0/1'\\n                      WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                       SUBSTR(STATE, 3) || '/1'\\n                      ELSE\\n                       SUBSTR(STATE, 3) || '/0'\\n                    END),\\n                    NVL((CASE\\n                          WHEN A.STATE IS NULL AND B.IMSI IS NOT NULL THEN\\n                           1\\n                          WHEN A.STATE IS NOT NULL AND B.IMSI IS NOT NULL THEN\\n                           (LENGTH(SUBSTR(STATE, 3) || '/1') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/1', '1', ''))) /\\n                           LENGTH('1')\\n                          ELSE\\n                           (LENGTH(SUBSTR(STATE, 3) || '/0') -\\n                           LENGTH(REPLACE(SUBSTR(STATE, 3) || '/0', '1', ''))) /\\n                           LENGTH('1')\\n                        END),\\n                        0)) A\\n   WHERE USE_DATE > 0;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [520]-[index:848]-[驻留模型分析近30天日程序]-[299]-['str' object has no attribute 'lfind']:{"name":"创建工作日表","nodeId":"299","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_WORK_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20) , MORN_DATE INT, AFTER_DATE INT , WORK_DATE INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [521]-[index:849]-[驻留模型分析近30天日程序]-[300]-['str' object has no attribute 'lfind']:{"name":"删除工作日表","nodeId":"300","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_WORK_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_WORK_${pdayid} (IMSI VARCHAR(20), LAC_CI VARCHAR(20) , MORN_DATE INT, AFTER_DATE INT , WORK_DATE INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [522]-[index:852]-[驻留模型分析近30天日程序]-[305]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"305","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_WORK_${pmonthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [523]-[index:853]-[驻留模型分析近30天日程序]-[308]-['str' object has no attribute 'lfind']:{"name":"插入工作日表","nodeId":"308","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_WORK_${pdayid}\\n  SELECT IMSI, LAC_CI, MORN_DATE, AFTER_DATE, WORK_DATE\\n    FROM (SELECT IMSI,\\n                 LAC_CI,\\n                 MORN_DATE,\\n                 AFTER_DATE,\\n                 WORK_DATE,\\n                 ROW_NUMBER() OVER(PARTITION BY IMSI ORDER BY WORK_DATE DESC) RN\\n            FROM (SELECT NVL(A.IMSI, B.IMSI) IMSI,\\n                         NVL(A.LAC_CI, B.LAC_CI) LAC_CI,\\n                         SUM(NVL(A.USE_DATE, 0)) MORN_DATE,\\n                         SUM(NVL(B.USE_DATE, 0)) AFTER_DATE,\\n                         SUM(NVL(NVL(A.USE_DATE, 0) + NVL(B.USE_DATE, 0), 0)) WORK_DATE\\n                    FROM LOP.LOP_ST_BEH_STAY_MORN_T_${pdayid} A\\n                    FULL JOIN LOP.LOP_ST_BEH_STAY_AFTER_T_${pdayid} B\\n                      ON A.IMSI = B.IMSI\\n                     AND A.LAC_CI = B.LAC_CI\\n                   GROUP BY NVL(A.IMSI, B.IMSI),\\n                            NVL(A.LAC_CI, B.LAC_CI)) A) A\\n   WHERE RN = 1;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [524]-[index:857]-[驻留模型分析近30天日程序]-[322]-['str' object has no attribute 'lfind']:{"name":"驻留模型日表","nodeId":"322","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_PRODUCT_${pdayid} (IMSI VARCHAR(20), STAY_LAC_CI VARCHAR(20) , OPEN_DAYS INT, CLOSE_DAYS INT, REST_DAYS INT, STAY_DAYS INT, WORK_LAC_CI VARCHAR(20) , MORN_DAYS INT, AFTER_DAYS INT, WORK_DAYS INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [525]-[index:858]-[驻留模型分析近30天日程序]-[323]-['str' object has no attribute 'lfind']:{"name":"删除驻留模型日表","nodeId":"323","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_PRODUCT_${pdayid};\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_PRODUCT_${pdayid} (IMSI VARCHAR(20), STAY_LAC_CI VARCHAR(20) , OPEN_DAYS INT, CLOSE_DAYS INT, REST_DAYS INT, STAY_DAYS INT, WORK_LAC_CI VARCHAR(20) , MORN_DAYS INT, AFTER_DAYS INT, WORK_DAYS INT ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [526]-[index:861]-[驻留模型分析近30天日程序]-[330]-['str' object has no attribute 'lfind']:{"name":"插入驻留模型日表","nodeId":"330","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_PRODUCT_${pdayid}\\n  SELECT D.IMSI,\\n         C.LAC_CI STAY_LAC_CI,\\n         NVL(C.OPEN_DATE, 0),\\n         NVL(C.CLOSE_DATE, 0),\\n         NVL(C.REST_DATE, 0),\\n         NVL(C.STAY_DATE, 0),\\n         B.LAC_CI WORK_LAC_CI,\\n         NVL(B.MORN_DATE, 0),\\n         NVL(B.AFTER_DATE, 0),\\n         NVL(B.WORK_DATE, 0)\\n    FROM LOP.LOP_ST_BEH_STAY_PRODUCT_TMP D\\n    LEFT JOIN LOP.LOP_ST_BEH_STAY_WORK_${pdayid} B\\n      ON D.IMSI = B.IMSI\\n    LEFT JOIN LOP.LOP_ST_BEH_STAY_DOMIC_${pdayid} C\\n      ON D.IMSI = C.IMSI;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [527]-[index:863]-[驻留模型分析近30天日程序]-[332]-['str' object has no attribute 'lfind']:{"name":"创建驻留模型临时表","nodeId":"332","dsName":"GbaseLOP","sql":"CREATE TABLE LOP.LOP_ST_BEH_STAY_PRODUCT_TMP (IMSI VARCHAR(20) ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [528]-[index:864]-[驻留模型分析近30天日程序]-[333]-['str' object has no attribute 'lfind']:{"name":"删除驻留模型临时表","nodeId":"333","dsName":"GbaseLOP","sql":"DROP TABLE LOP_ST_BEH_STAY_PRODUCT_TMP;\\nCREATE TABLE LOP.LOP_ST_BEH_STAY_PRODUCT_TMP (IMSI VARCHAR(20) ) COMPRESS(5, 5) ENGINE=EXPRESS DISTRIBUTED BY('IMSI') DEFAULT CHARSET=UTF8 TABLESPACE='SYS_TABLESPACE';","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [529]-[index:866]-[驻留模型分析近30天日程序]-[340]-['str' object has no attribute 'lfind']:{"name":"插入驻留模型临时表","nodeId":"340","dsName":"GbaseLOP","sql":"INSERT INTO LOP.LOP_ST_BEH_STAY_PRODUCT_TMP\\n  SELECT IMSI\\n    FROM (SELECT IMSI\\n            FROM LOP.LOP_ST_BEH_STAY_WORK_${pdayid} A\\n          UNION ALL\\n          SELECT IMSI FROM LOP.LOP_ST_BEH_STAY_DOMIC_${pdayid} B) A\\n   GROUP BY IMSI;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [530]-[index:869]-[驻留模型分析近30天日程序]-[346]-['str' object has no attribute 'lfind']:{"name":"删除历史表","nodeId":"346","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_PRODUCT_${p12monthid}${day};","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [531]-[index:870]-[驻留模型分析近30天日程序]-[352]-['str' object has no attribute 'lfind']:{"name":"删除临时表","nodeId":"352","dsName":"GbaseLOP","sql":"DROP TABLE LOP.LOP_ST_BEH_STAY_PRODUCT_TMP;","parentDsName":"GbaseLOP"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [532]-[index:873]-[2014年日新增指标数据表日调度传输]-[6]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"6.创建表","nodeId":"6","sql":"drop table DM_PUB_INCREASE_DAY_${dayid};\\nCREATE TABLE  DM_PUB_INCREASE_DAY_${dayid} distributed by('product_no')  as select * from DM_PUB_INCREASE_DAY_YYYYMMDD\\t;"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [533]-[index:875]-[2014年日新增指标数据表日调度传输]-[7]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"插入","nodeId":"7","sql":"insert into DM_PUB_INCREASE_DAY_${dayid} \\n(select * from   \\nDM_PUB_INCREASE_DAY_${dayid}@dblink_dm);"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [534]-[index:879]-[渠道酬金020501日调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_CHANNEL_020501_${dayid};\\nCREATE TABLE  DM_PUB_CHANNEL_020501_${dayid} distributed by('channel_code')  as select * from DM_PUB_CHANNEL_020501_YYYYMMDD\\t;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [535]-[index:880]-[渠道酬金020501日调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_CHANNEL_020501_${dayid} \\n(select * from   \\n ODS_D_F_OTR_020501_SOC_SALE_INF_${dayid}@dblink_ods);","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [536]-[index:884]-[宽带信息月视图月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_BROADBAND_MSG_${monthid};\\ncreate table DM_PUB_BROADBAND_MSG_${monthid}  distributed by ('LOGIN_ID') as select * from dm_pub_broadband_msg_yyyymm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [537]-[index:885]-[宽带信息月视图月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_BROADBAND_MSG_${monthid}    select * from DM_PUB_BROADBAND_MSG_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [538]-[index:891]-[历史数据表DM_AUTORPT_RES_YYYYMM]-[10]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"10.插入数据到最终表","nodeId":"10","sql":"insert into ${TARGET_DM_AUTORPT_RES_YYYYMM}(\\n       OP_TIME\\n      ,STATIS_MONTH\\n      ,PRODUCT_NO   \\n      ,I0942\\n      ,I0943\\n      ,I0944\\n      ,I0945\\n      ,I0946\\n      ,IM0001\\n      ,IM0002\\n      ,IM0003\\n      ,IM0004\\n      ,IM0005\\n      ,IM0006\\n      ,IM0007\\n      ,IM0008\\n      ,IM0009\\n      ,IM0010\\n      ,IM0011\\n      ,IM0012\\n      ,IM0013\\n      ,IM0014\\n      ,IM0015\\n      ,IM0016\\n      ,IM0017\\n      ,IM0018\\n      ,IM0019\\n      ,IMFUNC001\\n      ,IMFUNC002\\n      ,IMFUNC003\\n      ,IMFUNC004\\n      ,IMFUNC005\\n      ,IMFUNC006\\n      ,IMFUNC007\\n      ,IMFUNC008\\n      ,IMFUNC009\\n      ,IMFUNC010\\n      ,IMFUNC011\\n      ,IMFUNC012\\n      ,IMFUNC013\\n      ,IMFUNC014\\n      ,IMFUNC015\\n      ,IMFUNC016\\n      ,IMFUNC017\\n      ,IMFUNC018\\n      ,IMFUNC019\\n      ,IMFUNC020\\n      ,IMFUNC021\\n      ,IMFUNC022\\n      ,IMFUNC023\\n      ,IMFUNC024\\n      ,IMFUNC025\\n      ,IMFUNC026\\n      ,IMFUNC027\\n      ,IMFUNC028\\n      ,IMFUNC029\\n      ,IMFUNC030\\n      ,IMFUNC031\\n      ,IMFUNC032\\n      ,IMFUNC033\\n      ,IMFUNC034\\n      ,IMFUNC035\\n      ,IMFUNC036\\n      ,IMFUNC037\\n      ,IMFUNC038\\n      ,IMFUNC039\\n      ,IMFUNC040\\n      ,IMFUNC041\\n      ,IMFUNC042\\n      ,IMFUNC043\\n      ,IMFUNC044\\n      ,IMFUNC045\\n      ,IMFUNC046\\n      ,IMFUNC047\\n      ,IMFUNC048\\n      ,IMFUNC049\\n      ,IMFUNC050\\n      ,IMFUNC051\\n      ,IMFUNC052\\n      ,IMFUNC053\\n      ,IMFUNC054\\n      ,IMFUNC055\\n      ,IMFUNC056\\n      ,IMFUNC057\\n      ,IMFUNC058\\n      ,IMFUNC059\\n      ,IMFUNC060\\n      ,IMFUNC061\\n      ,IMFUNC062\\n      ,IMFUNC063\\n      ,IMFUNC064\\n      ,IMFUNC065\\n      ,IMFUNC066\\n      ,IMFUNC067\\n      ,IMFUNC068\\n      ,IMFUNC069\\n      ,IMFUNC070\\n      ,IMFUNC071\\n      ,IMFUNC072\\n      ,IMFUNC073\\n      ,IMFUNC074\\n      ,IMFUNC075\\n      ,IMFUNC076\\n      ,IMFUNC077\\n      ,IMFUNC078\\n      ,IMFUNC079\\n      ,IMFUNC080\\n      ,IMFUNC081\\n      ,IMFUNC082\\n      ,IMFUNC083\\n      ,SIM0001\\n      ,SIM0002\\n      ,SIM0003\\n      ,SIM0004\\n      ,SIM0005\\n      ,SIM0006\\n      ,SIM0007\\n      ,SIM0008\\n      ,SIM0009\\n      ,SIM0010\\n      ,SIM0011\\n      ,SIM0012\\n      ,SIM0013\\n      ,SIM0014\\n      ,SIM0015\\n      ,SIM0016\\n      ,SIM0017\\n      ,SIM0018\\n      ,SIM0019\\n      ,SIM0020\\n      ,SIM0021\\n      ,SIM0022\\n      ,SIM0023\\n      ,SIM0024\\n      ,SIM0025\\n      ,SIM0026\\n      ,SIM0027\\n      ,SIM0028\\n      ,SIM0029\\n      ,SIM0030\\n      ,SIM0031\\n      ,SIM0032\\n      ,SIM0033\\n      ,SIM0034\\n      ,SIM0035\\n      ,SIM0036\\n      ,SIM0037\\n      ,SIM0038\\n      ,SIM0039\\n      ,SIM0040 \\n,term_brand_new)\\nselect '${month_id}-01'   \\t\\t\\t\\tOP_TIME\\n      ,${monthid}         \\t\\t\\t\\tSTATIS_MONTH\\n      ,t1.PHONE_NO        \\t\\t\\t\\tPRODUCT_NO\\n      ,t3.SEND_CARD_TIME\\t\\t\\t\\tI0942\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\tI0943\\n      ,t3.chl_name\\t\\t\\t\\t\\t\\tI0944\\t/*T19.CARD_GIVEN_CHANNEL_NAME,\\tI0944,*/\\n      ,nvl(t3.CHL_LVL,0)\\t\\t\\t\\tI0945\\n      ,nvl(t2.DEPT_SUBAREA_ID,0)\\t\\tI0946\\n      ,t4.tac\\t\\t\\t\\t            IM0001\\t/*T18.IMEI_SECTION,\\tIM0001,*/\\t\\t\\t/*终端tac*/\\n      ,t4.TERMCLASS_ID\\t\\t\\t\\t\\tIM0002\\t/*Value(T18.TERMCLASS_ID,0),\\tIM0002,*/  /*终端tac*/\\n      ,t4.TERM_BRAND\\t     \\t        IM0003\\n      ,T4.TERM_MODEL                    IM0004\\n      ,NULL\\n      ,nvl(t4.os_id,0)                  IM0006\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,t4.TERM_LAUNCH_DATE                    IM0015\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,t4.DOU_CARD_FLAG+2   IMFUNC040\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,NULL\\n      ,t3.SEND_CARD_BRAND\\t\\t\\t\\tSIM0001\\n      ,t3.CHL_ID          \\t\\t\\t\\tSIM0002\\n      ,t3.CHL_NAME        \\t\\t\\t\\tSIM0003\\n      ,NVL(t3.CHL_LVL,0)\\t\\t\\t\\tSIM0004\\n      ,t3.CHL_TYPE        \\t\\t\\t\\tSIM0005\\n      ,t3.DEPT_COUNTY_ID\\t\\t\\t\\tSIM0006\\n      ,t3.DEPT_COUNTY_NAME\\t\\t\\t\\tSIM0007\\n      ,NULL\\t                 \\t\\t\\tSIM0008\\n      ,NULL\\t                 \\t\\t\\tSIM0009\\n      ,null                 \\t\\t\\tSIM0010\\n      ,null                 \\t\\t\\tSIM0011\\n      ,t3.ORGN_SEND_CARD_TIME     \\t\\tSIM0012\\n      ,t3.ORGN_SEND_CARD_CHL_ID   \\t\\tSIM0013\\n      ,t3.ORGN_SEND_CARD_CHL_NAME \\t\\tSIM0014\\n      ,t3.SEND_CARD_TIME          \\t\\tSIM0015\\n      ,nvl(t3.ACTIVE_FLAG,0)      \\t\\tSIM0016\\n      ,t3.ACTIVE_TIME             \\t\\tSIM0017\\n      ,nvl(t3.ACTIVE_10086_FLAG,0) \\t\\tSIM0018\\n      ,t3.ACTIVE_10086_TIME       \\t\\tSIM0019\\n      ,nvl(t3.VALID_ACTIVE_FLAG,0) \\t\\tSIM0020\\n      ,t3.VALID_ACTIVE_TIME       \\t\\tSIM0021\\n      ,nvl(t3.MAR_ONNET_FLAG,0)         SIM0022\\n      ,nvl(t3.LOST_FLAG,0)              SIM0023\\n      ,t3.LOST_TIME               \\t\\tSIM0024\\n      ,nvl(t3.CHL_FLOW_TRUN_DAYS,0)     SIM0025\\n      ,nvl(t3.LOST_DAYS,0)              SIM0026\\n      ,nvl(t3.LOST_DUR_LVL,0)           SIM0027\\n      ,nvl(t3.FLOW_TRUN_DAYS_LVL,0)     SIM0028\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\tSIM0029\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\tSIM0030\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\tSIM0031\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\tSIM0032\\n      ,0\\t\\t\\t\\t\\t\\t\\t\\tSIM0033\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*t3.HALL_FLOW_TRUN_DAYS       \\tSIM0034*/\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*t3.HALL_30_DAY_FLOW_TRUN_ID  \\tSIM0035*/\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*t3.ACTIVE_DAYS             \\tSIM0036*/\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*t3.DAYS_30_ACTIVE_FLAG       \\tSIM0037*/\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*t3.CARD_KIND              \\tSIM0038*/\\n      ,NULL\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t/*t3.WRITE_WAY              \\tSIM0039*/\\n      ,null\\t\\t\\t\\t\\t\\t\\t\\tSIM0040\\n      ,t4.TERM_TYPE\\n from ${SOURCE_DWI_USR_PESN_PARTINFO_MS_YYYYMM} t1\\n left join (select  a.phone_no,a.tac,\\n\\t\\t\\t\\t\\tcase when g5_flag=1 then 4 when g5_flag=0 and g4_model in (1,6,7,9) then 5 else 6 end TERMCLASS_ID,\\n                    b.TERM_TYPE,b.TERM_BRAND,b.TERM_MODEL,\\n                    b.DOU_CARD_FLAG,\\n                    b.TERM_LAUNCH_DATE,\\n\\t\\t\\t\\t\\tb.OS_VERSION OS_ID\\n\\t\\t\\tfrom GBASEDWI.DWI_BEH_USE_STEADYIMEI_MS_${monthid} a\\n           left join gbasedwd.DWD_RES_SVC_TERM_BRAND_OBASS_MS_${monthid} b on a.tac=b.tac_no) t4 \\n\\ton t1.phone_no=t4.phone_no\\n left join ${SOURCE_DWI_RES_NAC_CODE_NUM_DT_YYYYMMDD} t3 ON T1.PHONE_NO=T3.PHONE_NO\\n LEFT JOIN GBASEDWI.DWI_USR_PESN_PERSN_LOC_MS_${monthid} T2 ON T1.PHONE_NO=T2.PHONE_NO\\n WHERE (t1.MONTH_ARRIVE_FLAG=1 or t1.MONTH_OFF_FLAG  =1) And t1.PROD_KIND_CODE=171000000001\\n -- (t1.ONNET_USER_FLAG=1 AND t1.PROD_KIND_CODE='171000000001') or t1.MONTH_OFF_FLAG =1"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [539]-[index:895]-[cust个人客户月视图自动生成程序月调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_AUTORPT_CUST_${monthid};\\ncreate table DM_AUTORPT_CUST_${monthid} distributed by ('PRODUCT_NO') as select * from  DM_AUTORPT_CUST_YYYYMM;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [540]-[index:896]-[cust个人客户月视图自动生成程序月调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_AUTORPT_CUST_${monthid} select * from DM_AUTORPT_CUST_${monthid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:16 | 【ERROR】<run>@<step1_trans_sql_code> | [541]-[index:900]-[位置接口-用户常驻地明细表]-[6]-['str' object has no attribute 'lfind']:{"name":"6.建最终表(3)","nodeId":"6","dsName":"BIGDB","sql":"drop table if exists lop.lop_st_user_residence_detail_${monthid};\\ncreate table if not exists lop.lop_st_user_residence_detail_${monthid} (\\nmsisdn char(14),\\nimsi varchar(20),\\nstay_local_city char(10),\\nstay_lac_id char(10),\\nstay_cell_id char(10),\\nstay_longitude Double(10,7),\\nstay_latitude Double(10,7),\\nstay_days int,\\nwork_local_city char(6),\\nwork_lac_id char(10),\\nwork_cell_id char(10),\\nwork_longitude Double(10,7),\\nwork_latitude Double(10,7),\\nwork_days int\\n)DISTRIBUTED BY('imsi');\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [542]-[index:901]-[位置接口-用户常驻地明细表]-[7]-['str' object has no attribute 'lfind']:{"name":"7.临时表1插入","nodeId":"7","dsName":"BIGDB","sql":"insert into lop.vt_1(imsi,stay_local_city,stay_lac_id,stay_cell_id,stay_longitude,stay_latitude,stay_days)\\nselect\\n a.imsi\\n,case when b.county = '东城' then '110101'\\n when  b.county = '西城' then '110102'\\n when  b.county = '崇文' then '110103'\\n when  b.county = '宣武' then '110104'\\n when  b.county = '朝阳' then '110105'\\n when  b.county = '丰台' then '110106'\\n when  b.county = '石景山' then '110107'\\n when  b.county = '海淀'   then '110108'\\n when  b.county = '门头沟' then '110109'\\n when  b.county = '房山' then '110111'\\n when  b.county = '通州' then '110112'\\n when  b.county = '顺义' then '110113'\\n when  b.county = '昌平' then '110114'\\n when  b.county = '大兴' then '110115'\\n when  b.county = '怀柔' then '110116'\\n when  b.county = '平谷' then '110117'\\n when  b.county = '密云' then '110118'\\n when  b.county = '延庆' then '110119' end as stay_local_city\\n,hex(to_number(substring_index(a.stay_lac_ci,'_', 1))) as stay_lac_id\\n,hex(to_number(substring_index(a.stay_lac_ci,'_',-1))) as stay_cell_id\\n,b.longitude as stay_longitude\\n,b.latitude as stay_latitude\\n,a.stay_days\\nfrom lop.lop_st_beh_stay_product_${curmlastday} a\\ninner join gbasedwd.DIM_PUB_CELL b on a.stay_lac_ci =concat(b.lac_id,'_',b.cell_id_trans)\\nwhere b.cell_id_trans not in (\\nselect a.CELL_ID_TRANS cell_id from gbasedwd.DIM_PUB_CELL a\\n where a.cover_scene in ('党政军机关','党政军宿舍','武警军区')\\n union\\nselect b.CELL_ID_TRANS cell_id from gbasedwd.dim_pub_scene a\\n inner join gbasedwd.DIM_PUB_CELL b\\n    on a.cell_id_10=b.cell_id_10 and a.cell_type=b.cell_type\\n   and a.second_zl in ('党政军机关','机关宿舍','机关驻地','政府机关')\\n)\\n;\\n\\ninsert into lop.vt_1(imsi,work_local_city,work_lac_id,work_cell_id,work_longitude,work_latitude,work_days)\\nselect\\n e.imsi\\n,case when f.county = '东城' then '110101'\\n when f.county = '西城' then '110102'\\n when f.county = '崇文' then '110103'\\n when f.county = '宣武' then '110104'\\n when f.county = '朝阳' then '110105'\\n when f.county = '丰台' then '110106'\\n when f.county = '石景山' then '110107'\\n when f.county = '海淀'   then '110108'\\n when f.county = '门头沟' then '110109'\\n when f.county = '房山' then '110111'\\n when f.county = '通州' then '110112'\\n when f.county = '顺义' then '110113'\\n when f.county = '昌平' then '110114'\\n when f.county = '大兴' then '110115'\\n when f.county = '怀柔' then '110116'\\n when f.county = '平谷' then '110117'\\n when f.county = '密云' then '110118'\\n when f.county = '延庆' then '110119' end as work_local_city\\n,hex(to_number(substring_index(e.work_lac_ci,'_', 1))) as work_lac_id\\n,hex(to_number(substring_index(e.work_lac_ci,'_',-1))) as work_cell_id\\n,f.longitude as work_longitude\\n,f.latitude as work_latitude\\n,e.work_days\\nfrom lop.lop_st_beh_stay_product_${curmlastday} e\\ninner join gbasedwd.DIM_PUB_CELL f on e.work_lac_ci =concat(f.lac_id,'_',f.cell_id_trans)\\nwhere f.cell_id_trans not in (\\nselect a.CELL_ID_TRANS cell_id from gbasedwd.DIM_PUB_CELL a\\n where a.cover_scene in ('党政军机关','党政军宿舍','武警军区')\\n union\\nselect b.CELL_ID_TRANS cell_id from gbasedwd.dim_pub_scene a\\n inner join gbasedwd.DIM_PUB_CELL b\\n    on a.cell_id_10=b.cell_id_10 and a.cell_type=b.cell_type\\n   and a.second_zl in ('党政军机关','机关宿舍','机关驻地','政府机关')\\n)\\n;\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [543]-[index:903]-[位置接口-用户常驻地明细表]-[13]-['str' object has no attribute 'lfind']:{"name":"13.新建临时表1","nodeId":"13","dsName":"BIGDB","sql":"drop table lop.vt_1;\\ncreate table lop.vt_1 (\\nimsi char(20),\\nstay_local_city char(10),\\nstay_lac_id char(10),\\nstay_cell_id char(10),\\nstay_longitude Double(10,7),\\nstay_latitude Double(10,7),\\nstay_days int,\\nwork_local_city char(6),\\nwork_lac_id char(10),\\nwork_cell_id char(10),\\nwork_longitude Double(10,7),\\nwork_latitude Double(10,7),\\nwork_days int\\n);\\n","parentDsName":"BIGDB"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [544]-[index:904]-[位置接口-用户常驻地明细表]-[23]-['str' object has no attribute 'lfind']:{"name":"23.result","nodeId":"23","dsName":"GbaseODS","sql":"insert into lop.lop_st_user_residence_detail_${monthid}\\nselect\\n'086'||b.phone_no,\\na.imsi,\\nstay_local_city,\\nstay_lac_id,\\nstay_cell_id,\\nstay_longitude,\\nstay_latitude,\\ncase when stay_days > 30 then 30 else stay_days end,\\nwork_local_city,\\nwork_lac_id,\\nwork_cell_id,\\nwork_longitude,\\nwork_latitude,\\ncase when work_days > 30 then 30 else work_days end\\nfrom\\n(select imsi\\n\\t\\t\\t ,max(stay_local_city)  stay_local_city\\n\\t\\t\\t ,max(stay_lac_id    )  stay_lac_id\\n\\t\\t\\t ,max(stay_cell_id   )  stay_cell_id\\n\\t\\t\\t ,max(stay_longitude )  stay_longitude\\n\\t\\t\\t ,max(stay_latitude  )  stay_latitude\\n\\t\\t\\t ,sum(nvl(stay_days,0)) stay_days\\n\\t\\t\\t ,max(work_local_city)  work_local_city\\n\\t\\t\\t ,max(work_lac_id    )  work_lac_id\\n\\t\\t\\t ,max(work_cell_id   )  work_cell_id\\n\\t\\t\\t ,max(work_longitude )  work_longitude\\n\\t\\t\\t ,max(work_latitude  )  work_latitude\\n\\t\\t\\t ,sum(nvl(work_days,0)) work_days\\n  from lop.vt_1\\n where length(trim(imsi)) = 15\\n group by imsi\\n)a\\nleft join\\n(select distinct trim(imsi) imsi,trim(phone_no) phone_no from gbasedwi.dwi_usr_pesn_partinfo_ms_${monthid}\\n  where length(trim(phone_no))=11 and length(trim(imsi))=15\\n    and phone_no not in (select phone_id from gbaseods.ODS_D_F_BOS_02104_IMPORTANT_USER_DATA_${curmlastday})\\n) b on a.imsi=b.imsi\\n;\\n","parentDsName":"GbaseODS"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [545]-[index:905]-[竞争对手日累计视图日累计调度传输]-[8]-['str' object has no attribute 'lfind']:{"name":"插入数据","nodeId":"8","dsName":"Gbase_6_DM","sql":"insert into DM_PUB_COMPETITOR_DT_${dayid} select * from DM_PUB_COMPETITOR_DT_${dayid}@dblink_dm;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [546]-[index:906]-[竞争对手日累计视图日累计调度传输]-[7]-['str' object has no attribute 'lfind']:{"name":"创建表","nodeId":"7","dsName":"Gbase_6_DM","sql":"drop table DM_PUB_COMPETITOR_DT_${dayid};\\ncreate table DM_PUB_COMPETITOR_DT_${dayid} distributed by ('COMP_PRODUCT_NO') as select * from DM_PUB_COMPETITOR_DT_YYYYMMDD;","parentDsName":"Gbase_6_DM"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [547]-[index:911]-[cmiot号码属性]-[11]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into dm_pub_cmiot_phone_attr_ms_${monthid}\\nselect '${month_id}',\\n       a.phone_no,\\n       innet_date,\\n       user_state,\\n       state_eff_date,\\n       card_physical_type,\\n       serv_type01,\\n       serv_state01,\\n       serv_start_time01,\\n       serv_end_time01,\\n       serv_type02,\\n       serv_state02,\\n       serv_start_time02,\\n       serv_end_time02,\\n       serv_type03,\\n       serv_state03,\\n       serv_start_time03,\\n       serv_end_time03,\\n       serv_type04,\\n       serv_state04,\\n       serv_start_time04,\\n       serv_end_time04,\\n       serv_type05,\\n       serv_state05,\\n       serv_start_time05,\\n       serv_end_time05,\\n       ord_group_type,\\n       group_id,\\n       memb_group_time,\\n       memb_state,\\n       group_eff_date,\\n       acct_code,\\n       acct_org_id,\\n       grp_cust_id,\\n       grp_name,\\n       channel_name,\\n       create_date,\\n       manager_name,\\n       nvl(round(total_flow/1024/1024,2),0),\\n       nvl(round(flow_2g/1024/1024,2),0),\\n       nvl(round(flow_4g/1024/1024,2),0),\\n       nvl(round(flow_nb/1024/1024,2),0),\\n       nvl(round(flow_5g/1024/1024,2),0),\\n       nvl(round(up_flow/1024/1024,2),0),\\n       nvl(round(down_flow/1024/1024,2),0),\\n       nvl(receivable_fee,0)\\nfrom gbasegem.gem_cmiot_phone_attr_ds_${curmlastday} a\\nleft join \\n(select charge_no,\\n       sum(total_flow) total_flow,\\n       sum(case when rta_type=2 then total_flow end) flow_2g,\\n       sum(case when rta_type=6 then total_flow end) flow_4g,\\n       sum(case when rta_type=7 then total_flow end) flow_nb,\\n       sum(case when volume_5g='Y' then total_flow end) flow_5g,\\n       sum(up_flow) up_flow,\\n       sum(down_flow) down_flow\\nfrom GBASEDWD.DWD_EVT_CDR_GPRS_CMIOT_BUSITYPETOT_MS_${monthid}\\ngroup by charge_no\\n)b on a.phone_no=b.charge_no\\nleft join (select b.phone_no,\\n                  sum(receivable_fee) receivable_fee\\n           from gbaseods.ods_m_a_cmiot_91048_group_member_pay_income_${monthid} a\\n           inner join gbasedwd.DWD_SVC_USR_THINGNET_USER_DT_${curmlastday} b on a.user_id=b.user_id\\n           group by b.phone_no\\n          ) c on a.phone_no=c.phone_no"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [548]-[index:913]-[cmiot号码属性]-[9]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm_pub_cmiot_phone_attr_ms_${monthid};\\ncreate table dm_pub_cmiot_phone_attr_ms_${monthid} (\\n  op_time   varchar(30),                  -- 数据日期\\n  phone_no varchar(30),                   -- 用户号码\\n  innet_date varchar(30),                 -- 入网日期\\n  user_state varchar(30),                 -- 号码状态\\n  state_eff_date varchar(30),             -- 状态生效时间\\n  card_physical_type varchar(30),         -- 卡物理类型\\n  serv_type01 varchar(30),                -- 基础服务类型01\\n  serv_state01 varchar(30),               -- 基础服务状态01\\n  serv_start_time01 varchar(30),          -- 基础服务开通时间01\\n  serv_end_time01 varchar(30),            -- 基础服务结束时间01\\n  serv_type02 varchar(30),                -- 基础服务类型02\\n  serv_state02 varchar(30),               -- 基础服务状态02\\n  serv_start_time02 varchar(30),          -- 基础服务开通时间02\\n  serv_end_time02 varchar(30),            -- 基础服务结束时间02\\n  serv_type03 varchar(30),                -- 基础服务类型03\\n  serv_state03 varchar(30),               -- 基础服务状态03\\n  serv_start_time03 varchar(30),          -- 基础服务开通时间03\\n  serv_end_time03 varchar(30),            -- 基础服务结束时间03\\n  serv_type04 varchar(30),                -- 基础服务类型04\\n  serv_state04 varchar(30),               -- 基础服务状态04\\n  serv_start_time04 varchar(30),          -- 基础服务开通时间04\\n  serv_end_time04 varchar(30),            -- 基础服务结束时间04\\n  serv_type05 varchar(30),                -- 基础服务类型05\\n  serv_state05 varchar(30),               -- 基础服务状态05\\n  serv_start_time05 varchar(30),          -- 基础服务开通时间05\\n  serv_end_time05 varchar(30),            -- 基础服务结束时间05\\n  ord_group_type varchar(30),             -- 是否订购群组\\n  group_id varchar(30),                   -- 群组编码\\n  memb_group_time varchar(30),            -- 成员加群时间\\n  memb_state varchar(30),                 -- 成员状态\\n  group_eff_date varchar(30),             -- 状态生效时间\\n  acct_code varchar(30),                  -- 账户编码\\n  acct_org_id varchar(30),                -- 账户归属组织机构\\n  grp_cust_id varchar(30),                -- 集团客户编码\\n  grp_name varchar(300),                  -- 集团名称\\n  channel_name varchar(30),               -- 集团客户归属组织机构\\n  create_date varchar(30),                -- 客户创建日期\\n  manager_name varchar(50),               -- 客户经理\\n  total_flow   decimal(30,2),             -- 总流量\\n  flow_2g      decimal(30,2),             -- 2G流量\\n  flow_4g      decimal(30,2),             -- 4G流量\\n  flow_nb      decimal(30,2),             -- NB流量\\n  flow_5g      decimal(30,2),             -- 5G流量\\n  up_flow      decimal(30,2),             -- 上行流量\\n  down_flow    decimal(30,2),              -- 下行流量\\n  receivable_fee  decimal(30,2)           -- 含税总消费\\n)distributed by('phone_no');"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [549]-[index:915]-[cmiot号码属性]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm_pub_cmiot_phone_attr_ds_${dayid};\\ncreate table dm_pub_cmiot_phone_attr_ds_${dayid} (\\n  op_time   date,                         -- 数据日期\\n  phone_no varchar(30),                   -- 用户号码\\n  innet_date varchar(30),                 -- 入网日期\\n  user_state varchar(30),                 -- 号码状态\\n  state_eff_date varchar(30),             -- 状态生效时间\\n  card_physical_type varchar(30),         -- 卡物理类型\\n  serv_type01 varchar(30),                -- 基础服务类型01\\n  serv_state01 varchar(30),               -- 基础服务状态01\\n  serv_start_time01 varchar(30),          -- 基础服务开通时间01\\n  serv_end_time01 varchar(30),            -- 基础服务结束时间01\\n  serv_type02 varchar(30),                -- 基础服务类型02\\n  serv_state02 varchar(30),               -- 基础服务状态02\\n  serv_start_time02 varchar(30),          -- 基础服务开通时间02\\n  serv_end_time02 varchar(30),            -- 基础服务结束时间02\\n  serv_type03 varchar(30),                -- 基础服务类型03\\n  serv_state03 varchar(30),               -- 基础服务状态03\\n  serv_start_time03 varchar(30),          -- 基础服务开通时间03\\n  serv_end_time03 varchar(30),            -- 基础服务结束时间03\\n  serv_type04 varchar(30),                -- 基础服务类型04\\n  serv_state04 varchar(30),               -- 基础服务状态04\\n  serv_start_time04 varchar(30),          -- 基础服务开通时间04\\n  serv_end_time04 varchar(30),            -- 基础服务结束时间04\\n  serv_type05 varchar(30),                -- 基础服务类型05\\n  serv_state05 varchar(30),               -- 基础服务状态05\\n  serv_start_time05 varchar(30),          -- 基础服务开通时间05\\n  serv_end_time05 varchar(30),            -- 基础服务结束时间05\\n  ord_group_type varchar(30),             -- 是否订购群组\\n  group_id varchar(30),                   -- 群组编码\\n  memb_group_time varchar(30),            -- 成员加群时间\\n  memb_state varchar(30),                 -- 成员状态\\n  group_eff_date varchar(30),             -- 状态生效时间\\n  acct_code varchar(30),                  -- 账户编码\\n  acct_org_id varchar(30),                -- 账户归属组织机构\\n  grp_cust_id varchar(30),                -- 集团客户编码\\n  grp_name varchar(300),                  -- 集团名称\\n  channel_name varchar(30),               -- 集团客户归属组织机构\\n  create_date varchar(30),                -- 客户创建日期\\n  manager_name varchar(50),               -- 客户经理\\n  total_flow   decimal(30,2),             -- 总流量\\n  flow_2g      decimal(30,2),             -- 2G流量\\n  flow_4g      decimal(30,2),             -- 4G流量\\n  flow_nb      decimal(30,2),             -- NB流量\\n  flow_5g      decimal(30,2),             -- 5G流量\\n  up_flow      decimal(30,2),             -- 上行流量\\n  down_flow    decimal(30,2)              -- 下行流量\\n)distributed by('phone_no');"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [550]-[index:916]-[cmiot号码属性]-[18]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm_pub_cmiot_phone_attr_ds_${dayid};\\ncreate table dm_pub_cmiot_phone_attr_ds_${dayid} distributed by('phone_no')\\nselect * from dm_pub_cmiot_phone_attr_ds_${dayid}@dblink_dm;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [551]-[index:917]-[cmiot号码属性]-[22]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm_pub_cmiot_phone_attr_ms_${monthid};\\ncreate table dm_pub_cmiot_phone_attr_ms_${monthid} distributed by('phone_no')\\nselect * from dm_pub_cmiot_phone_attr_ms_${monthid}@dblink_dm;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [552]-[index:918]-[cmiot号码属性]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into dm_pub_cmiot_phone_attr_ds_${dayid}\\nselect '${day_id}',\\n       phone_no,\\n       innet_date,\\n       user_state,\\n       state_eff_date,\\n       card_physical_type,\\n       serv_type01,\\n       serv_state01,\\n       serv_start_time01,\\n       serv_end_time01,\\n       serv_type02,\\n       serv_state02,\\n       serv_start_time02,\\n       serv_end_time02,\\n       serv_type03,\\n       serv_state03,\\n       serv_start_time03,\\n       serv_end_time03,\\n       serv_type04,\\n       serv_state04,\\n       serv_start_time04,\\n       serv_end_time04,\\n       serv_type05,\\n       serv_state05,\\n       serv_start_time05,\\n       serv_end_time05,\\n       ord_group_type,\\n       group_id,\\n       memb_group_time,\\n       memb_state,\\n       group_eff_date,\\n       acct_code,\\n       acct_org_id,\\n       grp_cust_id,\\n       grp_name,\\n       channel_name,\\n       create_date,\\n       manager_name,\\n       nvl(round(total_flow/1024/1024,2),0),\\n       nvl(round(flow_2g/1024/1024,2),0),\\n       nvl(round(flow_4g/1024/1024,2),0),\\n       nvl(round(flow_nb/1024/1024,2),0),\\n       nvl(round(flow_5g/1024/1024,2),0),\\n       nvl(round(up_flow/1024/1024,2),0),\\n       nvl(round(down_flow/1024/1024,2),0)\\nfrom gbasegem.gem_cmiot_phone_attr_ds_${dayid} a\\nleft join \\n(select charge_no,\\n       sum(total_flow) total_flow,\\n       sum(case when rta_type=2 then total_flow end) flow_2g,\\n       sum(case when rta_type=6 then total_flow end) flow_4g,\\n       sum(case when rta_type=7 then total_flow end) flow_nb,\\n       sum(case when volume_5g='Y' then total_flow end) flow_5g,\\n       sum(up_flow) up_flow,\\n       sum(down_flow) down_flow\\nfrom gbasedwd.DWD_EVT_CDR_CMIOT_GPRS_DS_${dayid}\\ngroup by charge_no\\n)b on a.phone_no=b.charge_no"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [553]-[index:920]-[cmiot商品订购]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm_pub_cmiot_phone_ord_dd;\\ncreate table dm_pub_cmiot_phone_ord_dd (\\n  op_time   date,                         -- 数据日期\\n  phone_no varchar(30),           -- 用户号码 \\n  commodity_code varchar(30),     -- 号码订购商品\\n  group_type varchar(30),         -- 是否群组商品\\n  ord_date varchar(30),           -- 订购时间 \\n  ord_eff_date varchar(30),       -- 订购生效时间\\n  ord_exp_date varchar(30),       -- 订购失效时间\\n  commod_name varchar(100),       -- 商品名称 \\n  commod_logo varchar(30),        -- 主附商品标识\\n  commod_user varchar(30),        -- 商品使用对象\\n  commod_tariff varchar(30),      -- 商品资费 \\n  commod_flow varchar(30),        -- 商品包含流量\\n  commod_dur varchar(30),         -- 商品包含时长\\n  smms_num varchar(30),           -- 商品包含短信\\n  bill_type varchar(30),          -- 商品计费类型\\n  bill_cycle varchar(30),         -- 商品计费周期\\n  commod_discount varchar(30),    -- 商品销售折扣\\n  commod_price varchar(30)        -- 商品销售价格\\n\\n)distributed by('phone_no');"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [554]-[index:921]-[cmiot商品订购]-[18]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm_pub_cmiot_phone_ord_dd;\\ncreate table dm_pub_cmiot_phone_ord_dd distributed by('phone_no')\\nselect * from dm_pub_cmiot_phone_ord_dd@dblink_dm;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [555]-[index:922]-[cmiot商品订购]-[11]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into dm_pub_cmiot_phone_ord_ms_${monthid}\\nselect '${month_id}',\\n       phone_no,\\n       commodity_code,\\n       group_type,\\n       ord_date,\\n       ord_eff_date,\\n       ord_exp_date,\\n       commod_name,\\n       commod_logo,\\n       commod_user,\\n       commod_tariff,\\n       commod_flow,\\n       commod_dur,\\n       smms_num,\\n       bill_type,\\n       bill_cycle,\\n       commod_discount,\\n       commod_price\\nfrom gbasegem.gem_cmiot_phone_ord_ds_${curmlastday}"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [556]-[index:925]-[cmiot商品订购]-[22]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm_pub_cmiot_phone_ord_ms_${monthid};\\ncreate table dm_pub_cmiot_phone_ord_ms_${monthid} distributed by('phone_no')\\nselect * from dm_pub_cmiot_phone_ord_ms_${monthid}@dblink_dm;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [557]-[index:926]-[cmiot商品订购]-[9]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm_pub_cmiot_phone_ord_ms_${monthid};\\ncreate table dm_pub_cmiot_phone_ord_ms_${monthid}\\n( op_time   varchar(30),          -- 数据日期\\n  phone_no varchar(30),           -- 用户号码 \\n  commodity_code varchar(30),     -- 号码订购商品\\n  group_type varchar(30),         -- 是否群组商品\\n  ord_date varchar(30),           -- 订购时间 \\n  ord_eff_date varchar(30),       -- 订购生效时间\\n  ord_exp_date varchar(30),       -- 订购失效时间\\n  commod_name varchar(100),       -- 商品名称 \\n  commod_logo varchar(30),        -- 主附商品标识\\n  commod_user varchar(30),        -- 商品使用对象\\n  commod_tariff varchar(30),      -- 商品资费 \\n  commod_flow varchar(30),        -- 商品包含流量\\n  commod_dur varchar(30),         -- 商品包含时长\\n  smms_num varchar(30),           -- 商品包含短信\\n  bill_type varchar(30),          -- 商品计费类型\\n  bill_cycle varchar(30),         -- 商品计费周期\\n  commod_discount varchar(30),    -- 商品销售折扣\\n  commod_price varchar(30)        -- 商品销售价格\\n)distributed by('phone_no');"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [558]-[index:928]-[cmiot商品订购]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into dm_pub_cmiot_phone_ord_dd\\nselect '${day_id}',\\n       phone_no,\\n       commodity_code,\\n       group_type,\\n       ord_date,\\n       ord_eff_date,\\n       ord_exp_date,\\n       commod_name,\\n       commod_logo,\\n       commod_user,\\n       commod_tariff,\\n       commod_flow,\\n       commod_dur,\\n       smms_num,\\n       bill_type,\\n       bill_cycle,\\n       commod_discount,\\n       commod_price\\nfrom gbasegem.gem_cmiot_phone_ord_ds_${dayid}"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [559]-[index:931]-[涉诈数据提取]-[11]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseRPT","dsName":"GbaseRPT","schema_union":"GbaseRPT","schema_dev":"GbaseRPT","schema_prod":"GbaseRPT","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists gbaserpt.rpt_202106422_gdthdx_user_ds_${monthid};\\ncreate table if not exists gbaserpt.rpt_202106422_gdthdx_user_ds_${monthid}\\nselect a.phone_no\\nfrom (select phone_no,opp_rule_no\\n      from gbasedwd.dwd_evt_cdr_voc_basetot_ms_${monthid}\\n      group by phone_no,opp_rule_no)a\\ninner join (select phone_no,opp_rule_no\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_ms_${pmonthid}\\n            group by phone_no,opp_rule_no\\n            )b on a.phone_no=b.phone_no and a.opp_rule_no=b.opp_rule_no\\ninner join (select phone_no,opp_rule_no\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_ms_${p2monthid}\\n            group by phone_no,opp_rule_no\\n            )c on a.phone_no=c.phone_no and a.opp_rule_no=c.opp_rule_no\\ninner join (select phone_no,opp_rule_no\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_ms_${p3monthid}\\n            group by phone_no,opp_rule_no\\n            )d on a.phone_no=d.phone_no and a.opp_rule_no=d.opp_rule_no\\ninner join (select phone_no,opp_rule_no\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_ms_${p4monthid}\\n            group by phone_no,opp_rule_no\\n            )e on a.phone_no=e.phone_no and a.opp_rule_no=e.opp_rule_no\\ninner join (select phone_no,opp_rule_no\\n            from gbasedwd.dwd_evt_cdr_voc_basetot_ms_${p5monthid}\\n            group by phone_no,opp_rule_no\\n            )f on a.phone_no=f.phone_no and a.opp_rule_no=f.opp_rule_no\\ngroup by a.phone_no having count(distinct a.opp_rule_no)>=3\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [560]-[index:932]-[涉诈数据提取]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseRPT","dsName":"GbaseRPT","schema_union":"GbaseRPT","schema_dev":"GbaseRPT","schema_prod":"GbaseRPT","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists gbaserpt.rpt_202106422_new_user_ds_${dayid};\\ncreate table if not exists gbaserpt.rpt_202106422_new_user_ds_${dayid} distributed by ('phone_no')\\nselect phone_no\\nfrom \\n(select phone_no from gbasedwi.DWI_INST_ORD_LIST_DM_${monthid}\\nwhere busi_op_id='191000000001' and ord_type='开户' \\nand stat_date>date(${p3monthdayid}) and stat_date<='${day_id}'\\nunion all\\nselect phone_no from gbasedwi.DWI_INST_ORD_LIST_DM_${pmonthid}\\nwhere busi_op_id='191000000001' and ord_type='开户' \\nand stat_date>date(${p3monthdayid}) and stat_date<='${day_id}'\\nunion all\\nselect phone_no from gbasedwi.DWI_INST_ORD_LIST_DM_${p2monthid}\\nwhere busi_op_id='191000000001' and ord_type='开户' \\nand stat_date>date(${p3monthdayid}) and stat_date<='${day_id}'\\nunion all\\nselect phone_no from gbasedwi.DWI_INST_ORD_LIST_DM_${p3monthid}\\nwhere busi_op_id='191000000001' and ord_type='开户' \\nand stat_date>date(${p3monthdayid}) and stat_date<='${day_id}'\\n)a\\ngroup by phone_no"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [561]-[index:933]-[涉诈数据提取]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseRPT","dsName":"GbaseRPT","schema_union":"GbaseRPT","schema_dev":"GbaseRPT","schema_prod":"GbaseRPT","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists gbaserpt.rpt_202106422_jmxkg_user_ds_${dayid};\\ncreate table if not exists gbaserpt.rpt_202106422_jmxkg_user_ds_${dayid}\\nselect a.phone_no\\nfrom gbaserpt.rpt_202106422_new_user_ds_${dayid} a\\nleft join \\n(select phone_no\\nfrom (\\nselect phone_no\\nfrom gbasedwd.dwd_evt_cdr_voc_basetot_dm_${monthid}\\nwhere stat_date>='${p4day_id}' and stat_date<='${day_id}'\\ngroup by phone_no having sum(call_num)>0\\nunion all\\nselect phone_no\\nfrom gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${monthid}\\nwhere stat_date>='${p4day_id}' and stat_date<='${day_id}'\\ngroup by phone_no having sum(total_flow)>0\\nunion all\\nselect USER_NO\\nfrom gbasedwd.DWD_EVT_CDR_SMMS_BASETOT_dm_${monthid}\\nwhere stat_date>='${p4day_id}' and stat_date<='${day_id}'\\ngroup by USER_NO having sum(call_num)>0\\nunion all\\nselect phone_no\\nfrom gbasedwd.dwd_evt_cdr_voc_basetot_dm_${pmonthid}\\nwhere stat_date>='${p4day_id}' and stat_date<='${day_id}'\\ngroup by phone_no having sum(call_num)>0\\nunion all\\nselect phone_no\\nfrom gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${pmonthid}\\nwhere stat_date>='${p4day_id}' and stat_date<='${day_id}'\\ngroup by phone_no having sum(total_flow)>0\\nunion all\\nselect USER_NO\\nfrom gbasedwd.DWD_EVT_CDR_SMMS_BASETOT_dm_${pmonthid}\\nwhere stat_date>='${p4day_id}' and stat_date<='${day_id}'\\ngroup by USER_NO having sum(call_num)>0\\n)a group by phone_no\\n)b on a.phone_no=b.phone_no\\nwhere b.phone_no is null"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [562]-[index:934]-[涉诈数据提取]-[7]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseRPT","dsName":"GbaseRPT","schema_union":"GbaseRPT","schema_dev":"GbaseRPT","schema_prod":"GbaseRPT","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists gbaserpt.rpt_202106422_ghimei_user_ds_${dayid};\\ncreate table if not exists gbaserpt.rpt_202106422_ghimei_user_ds_${dayid}\\nselect a.phone_no\\nfrom gbaserpt.rpt_202106422_new_user_ds_${dayid} a\\nleft join (select phone_no from gbasedwi.dwi_beh_use_term_chg_ds_${dayid}\\nwhere cur_fir_time='${day_id}'\\n) b on a.phone_no=b.phone_no\\nwhere b.phone_no is not null\\ngroup by a.phone_no"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [563]-[index:937]-[家庭市场收入明细（月累计）]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"gbasegrid","dsName":"gbasegrid","schema_union":"gbasegrid","schema_dev":"gbasegrid","schema_prod":"gbasegrid","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists dm.dm_grid_dw_grid_110100_detail_ds_${dayid};\\ncreate table dm.dm_grid_dw_grid_110100_detail_ds_${dayid}\\n(op_time                        date,            -- 数据日期\\n cust_type                     int,             -- 客户收入类型id\\n cust_type_name                varchar(50),     -- 客户收入类型\\n belong_type                   int,             -- 归属类型\\n phone_no                      varchar(20),     -- 用户号码\\n useractive_time               date,            -- 入网时间或办理时间\\n plan_id                       bigint,          -- 策划ID\\n plan_name                     varchar(100),    -- 策划名称\\n chl_hall_id                   varchar(100),    -- 社区名称或渠道简称id\\n chl_hall_name                 varchar(100),    -- 社区名称或渠道简称\\n ORG_CHL_SUB_TYPE_NAME         varchar(100),    -- 渠道类型\\n grid_county_id                int,             -- 分公司\\n oper_grid_id                  int,             -- 经营网格\\n grid_id                       int,             -- 经分网格\\n target_cnt_d                  decimal(20,6),   -- 当日收入\\n target_cnt_m                  decimal(20,6)    -- 当月累计收入\\n)distributed by ('phone_no');"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [564]-[index:938]-[家庭市场收入明细（月累计）]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"gbasegrid","dsName":"gbasegrid","schema_union":"gbasegrid","schema_dev":"gbasegrid","schema_prod":"gbasegrid","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into dm.dm_grid_dw_grid_110100_detail_ds_${dayid}\\nselect op_time\\n,cust_type\\n,cust_type_name\\n,belong_type\\n,phone_no\\n,useractive_time\\n,plan_id\\n,plan_name\\n,nvl(b.chl_hall_id,0)lan_chl_id,nvl(b.chl_hall_name,'不详') chl_hall_name\\n,ORG_CHL_SUB_TYPE_NAME\\n,grid_county_id\\n,oper_grid_id\\n,a.grid_id\\n,target_cnt_d\\n,target_cnt_m\\nfrom gbasegrid.grid_dw_grid_110100_detail_ds_${dayid} a\\nleft join (select sub_type,chl_hall_id,chl_hall_name from gbasegrid.dim_grid_relat_${dayid}\\n           where type=1 and chl_hall_id<>'') b on a.lan_chl_id=b.chl_hall_id\\nleft join gbasedwd.dwd_prty_chl_orgchl_ds_${dayid} c on a.lan_chl_id=c.ORG_CHL_CODE\\n;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [565]-[index:939]-[家庭市场收入明细（月累计）]-[7]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.dm_grid_dw_grid_110100_detail_ds_${dayid};\\ncreate table dm.dm_grid_dw_grid_110100_detail_ds_${dayid} distributed by ('phone_no')\\nselect * from dm_grid_dw_grid_110100_detail_ds_${dayid}@dblink_dm;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [566]-[index:940]-[自助流量汇总]-[11]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"delete from dm.dm_gprs_tot_dm_${pmonthid} where op_time='${dayid}';\\ninsert into dm.dm_gprs_tot_dm_${pmonthid}\\nselect '${dayid}',phone_no,sum(total_flow)total_flow\\nfrom gbasedwd.dwd_evt_cdr_gprs_ds_${dayid}\\nwhere left(begin_time,7)='${p_month_id}'\\ngroup by phone_no"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [567]-[index:942]-[自助流量汇总]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"delete from dm.dm_gprs_tot_dm_${monthid} where op_time='${dayid}';\\ninsert into dm.dm_gprs_tot_dm_${monthid}\\nselect '${dayid}',phone_no,sum(total_flow)total_flow\\nfrom gbasedwd.dwd_evt_cdr_gprs_ds_${dayid}\\nwhere left(begin_time,7)='${month_id}'\\ngroup by phone_no"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [568]-[index:944]-[2021年7月新增个人日累计指标]-[51]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"delete from dm_pub_20220915_5g_dm_${monthid} where op_time='${dayid}';\\ninsert into dm_pub_20220915_5g_dm_${monthid}\\nselect distinct date('${dayid}'),phone_no,sum(total_flow)\\nfrom gbasemsm.msm_dw_basekpi_111230_detail_${dayid}\\ngroup by phone_no\\n;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [569]-[index:945]-[2021年7月新增个人日累计指标]-[23]-['str' object has no attribute 'lfind']:{"parentDsName":"GBASE_CAMPUS_100","dsName":"GBASE_CAMPUS_100","schema_union":"gbase_campus","schema_dev":"gbase_campus","schema_prod":"gbase_campus","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_06_${dayid};\\ncreate table dm.tmp_20210720_06_${dayid}\\n(product_no   varchar(20),\\nadd_fee       varchar(100),   -- 随心计划-折扣产品\\nis_timeout_contract   int, -- 校园卡校园合约当月到期用户\\nis_no_contract   int,  -- 校园卡无校园合约用户\\nis_contract   int,   -- 校园卡校园合约捆绑用户\\nxz_sms_date   datetime,  -- 当月首次查询是否符合携转条件时间\\n is_5g_sa_open   int\\n)distributed by ('product_no');\\ninsert into dm.tmp_20210720_06_${dayid}\\nselect a.phone_no,\\n       add_fee,\\n       nvl(is_timeout_contract,0),\\n       nvl(is_no_contract,0),\\n       nvl(is_contract,0),\\n       commit_time,\\n       case when e.imsi is not null then 1  else 0 end\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join gbaserpt.rpt_nq202106452_result_ms_${dayid} b on a.phone_no=b.phone_no\\nleft join (select phone_no,\\n                  max(case when is_lvl=1 then 1 else 0 end) is_timeout_contract,\\n                  max(case when is_lvl=2 then 1 else 0 end) is_no_contract,\\n                  max(case when is_lvl<>2 then 1 else 0 end) is_contract\\n           from gbase_campus.contract_details_list_ds_${dayid} group by phone_no\\n          ) c on a.phone_no=c.phone_no\\nleft join (select phone_no,is_ok,commit_time,row_number()over(partition by phone_no order by commit_time) rn\\n           from dm.dm_xiezhan_sms_user_dm\\n           where op_time>='${curmfirstday}' and op_time <='${dayid}'\\n          ) d on a.phone_no=d.phone_no and rn=1 and is_ok=1\\nleft join (select distinct imsi \\n           from dm.dm_pub_5g_sa_open_dm_${monthid} where stat_date<='${day_id}'\\n          )e on a.imsi=e.imsi\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [570]-[index:946]-[2021年7月新增个人日累计指标]-[21]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table tmp_20210720_05_${dayid};\\ncreate table tmp_20210720_05_${dayid}\\n(product_no varchar(20),\\nvolume_5g      decimal(20,4),  -- GPRS-5G-SA流量\\nnongcun_user      varchar(100)   -- 农村常驻用户\\n)distributed by ('PRODUCT_NO');\\ninsert into tmp_20210720_05_${dayid}\\nselect a.phone_no,\\n       nvl(b.volume_5g,0),\\n       nvl(c.dept_county_name,'非农村夜间常驻用户')\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (select a.phone_no,case when flow_sa_g5> flow_all then flow_all else flow_sa_g5 end volume_5g\\n           from (select phone_no,sum(flow) flow_sa_g5\\n\\t             from gbaserpt.rpt_bj_5g_flow_detail_dm_${dayid} where flag = '1' group by phone_no) a\\n           left join (select phone_no,sum(flow) flow_all \\n                      from gbaserpt.rpt_bj_5g_flow_detail_dm_${dayid} \\n                      where flag='3' group by phone_no) b on a.phone_no=b.phone_no\\n)b on a.phone_no=b.phone_no\\nleft join (select a.imsi,b.dept_county_name\\n           from lop.lop_st_beh_stay_product_${pdayid} a\\n           left join (select b.lac_id||'_'||b.cell_id_trans as cell_id,b.dept_county_name\\n                      from gbaseods.ods_d_f_gis_station_vgrid_${pdayid} a\\n                      left join gbasedwd.dim_pub_cell b on a.CELL_CODE_CI=b.cell_id_10 and a.BASE_STAT_TYPE=b.cell_type\\n                     )b on a.stay_lac_ci=b.cell_id\\n          )c on a.imsi=c.imsi\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [571]-[index:947]-[2021年7月新增个人日累计指标]-[138]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_21_${dayid};\\ncreate table dm.tmp_20210720_21_${dayid}\\n(phone_no   varchar(50),\\n is_shipin_user int , -- 是否视频客户活跃客户\\n bend_4G_GPRS   decimal(50,4), -- 本地4G流量(MB)\\n bend_5G_GPRS   decimal(50,4), -- 本地5G流量(MB)\\n manru_4G_GPRS  decimal(50,4), -- 漫入4G流量(MB)\\n manru_5G_GPRS  decimal(50,4)  -- 漫入5G流量(MB)\\n )distributed by ('phone_no');\\n \\ninsert into dm.tmp_20210720_21_${dayid}\\nselect a.phone_no,\\n       case when b.phone_no is not null then 1 else 0 end is_shipin_user,  -- 是否视频客户活跃客户\\n       nvl(c.row_4,0) bend_4G_GPRS,   -- 本地4G流量(MB)\\n       nvl(d.row_5,0) bend_5G_GPRS,   -- 本地5G流量(MB)\\n       nvl(e.row_4,0) manru_4G_GPRS,  -- 国内漫游4G流量(MB)\\n       nvl(f.row_5,0) manru_5G_GPRS   -- 国内漫游5G流量(MB)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join (select distinct phone_no from gbasedwd.dwd_evt_cdr_voc_basetot_dm_${monthid} \\n           where IS_4G_VOICE=1 and is_volte=1 and call_type=1 and opp_rule_no in ('10086','1008611') \\n             and call_dur>0 and (stat_date between '${curm_first_day}' and '${day_id}')\\n           ) b on a.phone_no=b.phone_no\\nLEFT JOIN (SELECT phone_no,sum(TOTAL_FLOW)/1024/1024 row_4 FROM gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${monthid}\\n           WHERE ROAM_TYPE IN ('0','1','7') and NET_TYPE=6 and stat_date between '${curm_first_day}' and '${day_id}' -- 本地-4G\\n           group by 1) c on a.phone_no=c.phone_no\\nLEFT JOIN (SELECT phone_no,sum(VOLUME_5G)/1024/1024 row_5 FROM gbasedwi.hp_dwi_beh_use_gprs_user_e2567_dm_${monthid}\\n           WHERE ROAM_TYPE IN ('0','1','7') and NET_TYPE=7 and stat_date between '${curm_first_day}' and '${day_id}' -- 本地-5G\\n           group by 1) d on a.phone_no=d.phone_no\\nLEFT JOIN (SELECT phone_no,sum(TOTAL_FLOW)/1024/1024 row_4 FROM gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${monthid} \\n           WHERE ROAM_TYPE IN ('5') and NET_TYPE=6 and stat_date between '${curm_first_day}' and '${day_id}'  -- 国内漫游-4G\\n           group by 1) e on a.phone_no=e.phone_no\\nLEFT JOIN (SELECT phone_no,sum(VOLUME_5G)/1024/1024 row_5 FROM gbasedwi.hp_dwi_beh_use_gprs_user_e2567_dm_${monthid} \\n           WHERE ROAM_TYPE IN ('5') and NET_TYPE=7 and stat_date between '${curm_first_day}' and '${day_id}' -- 国内漫游-5G\\n           group by 1) f on a.phone_no=f.phone_no\\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [572]-[index:948]-[2021年7月新增个人日累计指标]-[140]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_22_${dayid};\\ncreate table dm.tmp_20210720_22_${dayid}\\n(phone_no   varchar(50),\\n voc_out_fee   decimal(20,4), -- 语音结出费用(元)\\n gprs_out_fee   decimal(20,4) -- 流量结出费用(元)\\n )distributed by ('phone_no');\\n \\ninsert into dm.tmp_20210720_22_${dayid}\\nselect a.phone_no,\\n       nvl(b.voc_out_fee,0) voc_out_fee ,  -- 语音结出费用\\n       nvl(c.gprs_out_fee,0) gprs_out_fee  -- 流量结出费用\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join (select phone_no,sum(fee1) voc_out_fee\\n           from (select stat_date,phone_no,to_char(sum(resultfee1)) fee1\\n                 from gbasedwd.dwd_evt_sttl_voc_roamout_dm_${monthid} where srctype_id='309' -- D出访文件\\n                 group by stat_date,phone_no\\n                 union all\\n                 select stat_date,phone_no,to_char(truncate(sum(to_number(rm_chg))/1000.0,3)) \\n                 from gbasedwd.dwd_evt_sttl_voc_volte_dm_${monthid} where srctype_id='352'  -- D出访文件\\n                 group by stat_date,phone_no\\n                ) a \\n           where stat_date between '${curm_first_day}' and '${day_id}'\\n           group by 1\\n          ) b on a.phone_no=b.phone_no\\nleft join (select phone_no,sum(total_fee) gprs_out_fee\\n           from (select stat_date,phone_no,apnni,\\n                        sum(nvl(data_flowup1,0)+nvl(data_flowdown1,0)+nvl(data_flowup2,0)+nvl(data_flowdown2,0))/1024/1024/1024*1.55 as total_fee\\n                 from gbasedwd.dwd_evt_sttl_lte_lroam_dm_${monthid}\\n                 where srctype_id='336' and substr(phone_no,1,6) not in ('147660','178940','178941','178942','178943','178944','178945')\\n                 group by stat_date,phone_no,VISIT_AREA_CODE,apnni\\n                 union all\\n                 select stat_date,phone_no,apnni,\\n                        sum(nvl(data_flowup1,0)+nvl(data_flowdown1,0)+nvl(data_flowup2,0)+nvl(data_flowdown2,0))/1024/1024/1024*1.55 as total_fee\\n                 from gbasedwd.dwd_evt_sttl_g5_lroam_dm_${monthid}\\n                 where srctype_id='346'\\n                 group by stat_date,phone_no,VISIT_AREA_CODE,apnni\\n                ) a\\n           where not (upper(apnni) in ('CMLAP','CMTDS','CMNET') and substr(phone_no,1,6) in ('147440','147441','147442','147443','147444','147445','147446','147447','147448','147449','147165','147166','147167','147168','147169'))\\n           and substr(phone_no,1,6) not in ('147345','147346','147347','147348','147349','148020')\\n           and upper(apnni) not in ('IMS','CMREAD')\\n           and stat_date between '${curm_first_day}' and '${day_id}'\\n           group by 1\\n          ) c on a.phone_no=c.phone_no\\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [573]-[index:949]-[2021年7月新增个人日累计指标]-[130]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_realname_${dayid};\\ncreate table dm.tmp_20210720_realname_${dayid} distributed by ('phone_no')\\nselect distinct \\n       a.phone_no,\\n       a.use_no,\\n       a.use_type,\\n       case when b.lan_rh_phone_no is not null then 1 else 0 end is_lan_rh_user -- 是否办理宽带用户\\n       \\nfrom \\n(select phone_no,\\n        case when user_type='个人客户' then cust_no when user_type='单位客户' then use_no end use_no,\\n        case when user_type='个人客户' then cust_type when user_type='单位客户' then use_type end use_type \\n from gbasedwi.dwi_usr_pesn_realname_base_ds_${dayid}\\n where user_type in ('个人客户','单位客户') and on_line_mark=1\\n ) a\\nleft join (select distinct lan_rh_phone_no from dm.dm_pub_broadband_msg_${dayid} where lan_rh_phone_no is not null\\n          ) b on a.phone_no=b.lan_rh_phone_no\\nwhere a.use_type='身份证';\\n\\ndrop table dm.tmp_20210720_20_${dayid};\\ncreate table dm.tmp_20210720_20_${dayid}\\n(phone_no  varchar(50),\\n is_lan_rh_user  int, -- 名下是否有移动宽带\\n  is_shenzx_user  int,  -- 是否神州行用户（一经口径）\\n chl_lvl1   varchar(50), -- 一级归归类（发卡）-新增质量日报口径\\n chl_lvl2   varchar(50)  -- 二级归归类（发卡）-新增质量日报口径\\n )distributed by ('phone_no');\\n\\ninsert into dm.tmp_20210720_20_${dayid}\\nselect a.phone_no,\\n       case when use_no_sum=0 then 0 else 1 end is_lan_rh_user, -- 名下是否有移动宽带\\n       case when c.user_id is not null then 1 else 0 end is_shenzx_user, -- 是否神州行用户（一经口径）\\n       chl_lvl1, -- 一级归类（发卡）-新增质量日报口径\\n       chl_lvl2  -- 二级归类（发卡）-新增质量日报口径\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join (select a.phone_no,use_no_sum \\n           from dm.tmp_20210720_realname_${dayid} a\\n           left join (select use_no,sum(is_lan_rh_user) use_no_sum \\n                      from dm.tmp_20210720_realname_${dayid} group by use_no) b on a.use_no=b.use_no\\n           ) b on a.phone_no=b.phone_no\\nleft join (select distinct user_id from gbasebas.tb_stat_02325 \\n           where eff_dt<='${day_id}' and end_dt>'${day_id}') c on a.user_id=c.user_id\\nleft join (select product_no,user_id,chl_lvl1,chl_lvl2,join_date, row_number()over(partition  by user_id order by join_date desc ) rn \\n           from gbaserpt.rpt_nq201806383_detail_dm_${year} where stat_month<='${monthid}'\\n          ) d on a.user_id=d.user_id and d.rn=1\\nWHERE  (a.MONTH_ARRIVE_FLAG=1 or a.MONTH_OFF_FLAG  =1) And a.PROD_KIND_CODE=171000000001;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [574]-[index:950]-[2021年7月新增个人日累计指标]-[29]-['str' object has no attribute 'lfind']:{"parentDsName":"GBASE_CAMPUS_100","dsName":"GBASE_CAMPUS_100","schema_union":"gbase_campus","schema_dev":"gbase_campus","schema_prod":"gbase_campus","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_07_${dayid};\\ncreate table dm.tmp_20210720_07_${dayid}\\n(product_no   varchar(20),\\nis_overdeal   int,   -- 超套客户数(集团)\\nis_high_three int,   -- 三高客户数(集团)\\nis_dengw_yij  int,   -- 登网（一经）\\nis_high_one   int,   -- 高单价超套客户\\nis_high_two   int,   -- 高频高额超套客户\\nz_call_days   int,   -- 语音通话主叫天数\\nshx_zk_name    varchar(50)  -- 省心计划-折扣产品\\n)distributed by ('product_no');\\ninsert into dm.tmp_20210720_07_${dayid}\\nselect a.phone_no,\\n       case when b.user_id is not null then 1 else 0 end ,  \\n       nvl(c.is_high_three,0),    \\n       case when d.phone_no is not null then 1 else 0 end,\\n       case when c1.user_id is not null then 1 else 0 end, \\n       case when c.user_id is not null then 1 else 0 end,\\n       nvl(e.z_call_days,0),\\n       f.zk_name\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join gbasemsm.msm_dw_basekpi_overmeal_user_${dayid} b on a.phone_no=b.phone_no\\nleft join (select a.user_id, case when b.user_id is not null then 1 else 0 end is_high_three\\n           from (select user_id\\n                from (\\n       \\t             select a.user_id from gbasemsm.msm_dw_basekpi_overmeal_user_${dayid} a inner join gbasemsm.msm_dw_basekpi_overmeal_highvalue_${dayid} b on a.user_id = b.user_id\\n         \\t             union all\\n          \\t           select a.user_id from gbasemsm.msm_dw_basekpi_overmeal_user_${pmonthid} a inner join gbasemsm.msm_dw_basekpi_overmeal_highvalue_${pmonthid} b on a.user_id = b.user_id\\n         \\t             union all\\n          \\t           select a.user_id from gbasemsm.msm_dw_basekpi_overmeal_user_${p2monthid} a inner join gbasemsm.msm_dw_basekpi_overmeal_highvalue_${p2monthid} b on a.user_id = b.user_id\\n                       ) a \\n                 group by user_id\\n  \\t\\t           having(count(*)>1)\\n\\t              ) a\\n \\t         left join gbasemsm.msm_dw_basekpi_overmeal_highprice_${dayid} b on a.user_id = b.user_id\\n          )c on a.user_id=c.user_id\\n left join gbasemsm.msm_dw_basekpi_overmeal_highprice_${dayid} c1 on a.user_id=c1.user_id\\nleft join gbasemsm.msm_dw_basekpi_111230_detail_mon_${dayid} d on a.phone_no=d.phone_no\\nleft join (select phone_no,count(distinct stat_date) z_call_days\\n           from gbasedwd.dwd_evt_cdr_voc_basetot_dm_${monthid} where call_type=1 and stat_date<='${day_id}'\\n           group by phone_no)e on a.phone_no=e.phone_no\\nleft join gbaserpt.rpt_nq202110026_result_ds_${dayid} f on a.phone_no=f.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [575]-[index:951]-[2021年7月新增个人日累计指标]-[31]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_08_${dayid};\\ncreate table dm.tmp_20210720_08_${dayid}\\n(product_no   varchar(20),\\ntaowai_gprs    decimal(20,2),   --  套外流量\\ntaowai_gprs_fee  decimal(20,2),   --  套外流量费\\nis_low_risk      int   -- 低风险\\n)distributed by ('product_no');\\ninsert into dm.tmp_20210720_08_${dayid}\\nselect a.phone_no,\\n       nvl(b.total_flow,0) taowai_gprs,\\n       nvl(c.mt_should_income,0) taowai_gprs_fee,\\n       case when d.phone_no is not null then 1 else 0 end\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join (select phone_no,round((sum(total_flow/1024/1024)),2) total_flow                                                                                                                      \\n           from gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${monthid}                                                                                    \\n           where (not ( nvl(APN_NET_ID,'') ='IMS' and CONTENT_BILL_ID in ('1050000003','1050000004','1050000005','999999')) ) -- 根据04031VOLTE流量话单添加   \\n           and  out_prod_flag =1 and STAT_DATE<='${day_id}'\\n           group by phone_no\\n          )b on a.phone_no=b.phone_no\\nleft join (select phone_no,sum(mt_should_income) mt_should_income\\n           from gbasedwi.dwi_inco_bill_item_tot_ds_${dayid}\\n           where acct_item_id in (select fee_item_id from gbasebas.int_boss_charge_code_corresponding \\n                                  where charge_code in ('0627') and flag='0') \\n           group by phone_no\\n           )c on a.phone_no=c.phone_no\\nleft join (select phone_no from dm.dm_pub_low_risk_result_ds_${dayid}\\n           where is_low=1\\n           )d on a.phone_no=d.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [576]-[index:952]-[2021年7月新增个人日累计指标]-[26]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"delete from dm.dm_xiezhan_sms_user_dm where left(op_time,4)='${pyearid}';\\ndelete from dm.dm_xiezhan_sms_user_dm where op_time='${dayid}';\\ninsert into dm.dm_xiezhan_sms_user_dm\\nselect '${dayid}' as op_time,targt_addr as phone_no,1 is_ok,commit_time\\nfrom gbasedwd.DWD_EVT_HCI_10086SMS_CDR_DS_${dayid}\\nwhere sms_text like '【业务办理提醒】%携号转网%' and sms_text like '%您的号码满足携转条件%' \\nunion all\\nselect '${dayid}' as op_time,targt_addr as phone_no,0 is_ok,commit_time\\nfrom gbasedwd.DWD_EVT_HCI_10086SMS_CDR_DS_${dayid}\\nwhere sms_text like '【业务办理提醒】%携号转网%' \\nand (sms_text like '%影响携号转网%' or sms_text like '%无法办理携号转网%')"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [577]-[index:953]-[2021年7月新增个人日累计指标]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table tmp_20210720_02_${dayid};\\ncreate table tmp_20210720_02_${dayid}\\n(product_no varchar(20),\\nFEATURE_VALUE      bigint,  -- 主套餐档位\\nnew_plan_name      varchar(100)   -- 下月生效套餐名称\\n)distributed by ('PRODUCT_NO');\\ninsert into tmp_20210720_02_${dayid}\\nselect a.phone_no,\\n       b.FEATURE_VALUE,\\n       c.new_plan_name\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (select PRODUCT_NO,\\n                  case when a.plan_id in (111001001404,111001000789,111001000788,111001000787,111001000786,\\n                                      111001000785,111001000784) then b.FEATURE_VALUE else c.FEATURE_VALUE end FEATURE_VALUE\\n           from DM.tmp_20210720_01_${dayid} a\\n           left join (select a.phone_no,sum(c.FEATURE_VALUE)FEATURE_VALUE\\n                      from gbasedwi.DWI_INST_OFFER_LIST_ALL_dS_${dayid} a\\n                      inner join (select * from dm.dim_offer_call_list\\n                                  union all select * from dm.dim_offer_gprs_list) b on a.plan_id=b.offer_id\\n                      left join dm.dim_plan_name_fee c on b.offer_id=c.PRODUCT_ITEM_ID\\n                      group by a.phone_no\\n                     )b on a.PRODUCT_NO=b.phone_no\\n           left join dm.dim_plan_name_fee c on a.plan_id=c.PRODUCT_ITEM_ID\\n)b on a.phone_no=b.PRODUCT_NO\\nleft join (select a.product_no,case when a.new_plan_id in (111001001404,111001000789,111001000788,111001000787,111001000786,\\n                  111001000785,111001000784) then a.new_plan_name||'-'||yy_name||'+'||ll_name\\n                  else new_plan_name end  as new_plan_name\\n           from dm.tmp_20210720_01_${dayid} a\\n           left join (select a.phone_no,max(b.offer_id),max(c.offer_id),\\n                      max(b.offer_name)yy_name,max(c.offer_name)ll_name\\n                      from gbasedwi.DWI_INST_ASSET_DS_${dayid} a\\n                      left join (select * from dm.dim_offer_call_list) b on a.plan_id=b.offer_id\\n                      left join (select * from dm.dim_offer_gprs_list) c on a.plan_id=c.offer_id\\n                      where a.EFF_TIME>=to_date('${nextm_first_day}','YYYY-MM-DD')\\n                      group by a.phone_no\\n                     )b on a.product_no=b.phone_no\\n)c on a.phone_no=c.PRODUCT_NO\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [578]-[index:957]-[2021年7月新增个人日累计指标]-[40]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_11_${dayid};\\ncreate table dm.tmp_20210720_11_${dayid}\\n(product_no   varchar(20),\\nis_31day_5g_dengw        int,  -- 5g登网客户数（31天口径）\\nis_31day_5g_dengw_fen    int,  -- 5g登网客户数（分公司31天口径）\\n totalflow_wifi     decimal(35,2),   -- 双卡槽终端WIFI流量使用量（MB）\\n totalflow_lt       decimal(35,2),   -- 双卡槽终端第二卡槽流量使用量-联通（MB）\\n totalflow_dx       decimal(35,2)    -- 双卡槽终端第二卡槽流量使用量-电信（MB）\\n)distributed by ('product_no');\\ninsert into dm.tmp_20210720_11_${dayid}\\nselect a.phone_no,\\n       case when b.phone_no is not null then 1 else 0 end,\\n       case when c.phone_no is not null then 1 else 0 end,\\n       nvl(d.totalflow_wifi,0),\\n       nvl(e.totalflow_lt,0),\\n       nvl(f.totalflow_dx,0)\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join gbasemsm.msm_dw_basekpi_111281_detail_${dayid} b on a.phone_no=b.phone_no\\nleft join gbasemsm.msm_dw_basekpi_111281_detail_${dayid} c on a.phone_no=c.phone_no\\nleft join (select phone_no,sum(nvl(totalfloww,0))totalflow_wifi from dm.dm_pub_carr_wifi_dm_${monthid} where date(op_time)<='${day_id}'\\n           group by phone_no\\n          )d on a.phone_no=d.phone_no\\nleft join (select phone_no,sum(nvl(totalflowd,0))totalflow_lt from dm.dm_pub_carr_lt_dm_${monthid} where date(op_time)<='${day_id}'\\n           group by phone_no\\n          )e on a.phone_no=e.phone_no\\nleft join (select phone_no,sum(nvl(totalflowd,0))totalflow_dx from dm.dm_pub_carr_dx_dm_${monthid} where date(op_time)<='${day_id}'\\n           group by phone_no\\n          )f on a.phone_no=f.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [579]-[index:958]-[2021年7月新增个人日累计指标]-[70]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_17_${dayid};\\ncreate table dm.tmp_20210720_17_${dayid} \\n(\\n  phone_no varchar(20) ,\\n  cell_num int, -- 日累计语音主叫基站个数\\n  imei_num int,  -- 日累计语音主叫终端个数\\n  b_opp_rule_no_num int, -- 日累计被叫对端号码个数\\n  z_opp_rule_no_num int , -- 日累计主叫对端号码个数\\n  z_opp_rule_no_ls decimal(27,4),-- 日累计主叫对端号码离散度\\n  z_cell_id_ls decimal(27,4),  -- 日累计主叫基站离散度\\n  SHOULD_fee VARCHAR(50),       -- 出账收入（一经口径）\\n  is_low_pro int,         -- 是否低风险pro\\n  VOICE_DURATION_M  BIGINT,  /*--VOLTE语音通话时长(分钟)*/\\n  VOICE_COUNT  BIGINT,       /*     --VOLTE语音通话次数 */\\n  VIDEO_DURATION_M    BIGINT, /*--VOLTE视频通话时长(分钟)*/\\n  VIDEO_COUNT   BIGINT        /*     --VOLTE视频通话次数 */\\n)distributed by ('phone_no');\\n\\ninsert into dm.tmp_20210720_17_${dayid}\\nselect a.phone_no,\\n       nvl(b.cell_num,0), \\n       nvl(b1.imei_num,0),\\n       nvl(b2.b_opp_rule_no_num,0),\\n       nvl(b3.z_opp_rule_no_num,0),\\n       nvl(b4.z_opp_rule_no_ls,0),\\n       nvl(b5.z_cell_id_ls,0),\\n       case when c.user_id is null then '0' else c.SHOULD_fee end,\\n       case when d.phone_no is not null then 1 else 0 end,\\n       e.voice_duration_m, /*--VOLTE语音通话时长(分钟)*/\\n       e.voice_count,      /*     --VOLTE语音通话次数 */\\n       e.video_duration_m, /*--VOLTE视频通话时长(分钟)*/\\n       e.video_count       /*     --VOLTE视频通话次数 */\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join \\n(select phone_no,count(distinct cell_id) cell_num from gbasedwd.DWD_EVT_CDR_VOC_CELLTOT_Dm_${monthid} where call_type=1 and stat_date<='${day_id}' group by phone_NO) b on a.phone_no=b.phone_no\\nleft join\\n(select phone_no,count(distinct imei) imei_num from gbasedwd.dwd_evt_cdr_newbusi_svc_dm_${monthid} where obj_src_id=1 and STAT_MON<='${day_id}' group by phone_NO) b1 on a.phone_no=b1.phone_no\\nleft join\\n(select phone_no,count(distinct opp_rule_no) b_opp_rule_no_num from gbasedwd.DWD_EVT_CDR_VOC_BASETOT_Dm_${monthid} where call_type=2 and stat_date<='${day_id}' group by phone_NO) b2 on a.phone_no=b2.phone_no\\nleft join\\n(select phone_no,count(distinct opp_rule_no) z_opp_rule_no_num from gbasedwd.DWD_EVT_CDR_VOC_BASETOT_Dm_${monthid} where call_type=1 and stat_date<='${day_id}' group by phone_NO) b3 on a.phone_no=b3.phone_no\\nleft join\\n(select phone_no,sum(1)/count(distinct opp_rule_no) z_opp_rule_no_ls from gbasedwd.DWD_EVT_CDR_VOC_BASETOT_Dm_${monthid} where call_type=1 and stat_date<='${day_id}' group by phone_NO) b4 on a.phone_no=b4.phone_no\\nleft join\\n(select phone_no,sum(1)/count(distinct cell_id) z_cell_id_ls from gbasedwd.DWD_EVT_CDR_VOC_CELLTOT_Dm_${monthid} where call_type=1 and stat_date<='${day_id}' group by phone_NO) b5 on a.phone_no=b5.phone_no\\nleft join \\n(select user_id,round(sum(SHOULD_fee)/100,2) SHOULD_fee from gbasebas.int_03027_ms_${monthid} where op_time<='${day_id}' group by user_id) c on a.user_id=c.user_id\\nleft join (select * from dm.dm_pub_low_risk_result_ds_${dayid} where is_low_pro=1) d on a.phone_no=d.phone_no\\nleft join (select phone_no,  \\n                  sum(case when e.is_4g_voice=0 then e.call_duration_m else 0 end) as voice_duration_m, /*--VOLTE语音通话时长(分钟)*/\\n                  sum(case when e.is_4g_voice=0 then e.call_count else 0 end) as voice_count,      /*     --VOLTE语音通话次数 */\\n                  sum(case when e.is_4g_voice=1 then e.call_duration_m else 0 end) as video_duration_m, /*--VOLTE视频通话时长(分钟)*/\\n                  sum(case when e.is_4g_voice=1 then e.call_count else 0 end) as video_count       /*     --VOLTE视频通话次数 */\\n           from (select phone_no, is_4g_voice, call_type calltype_id,1 as call_count,orgn_call_dur call_duration,call_dur call_duration_m                        \\n                  from gbasedwd.DWD_EVT_CDR_VOC_BASETOT_DM_${monthid} where IS_VOLTE=1  and BEGIN_DATE>='${curm_first_day}' and BEGIN_DATE<='${day_id}' and call_type in ('1','2')\\n                ) e\\n           group by phone_no\\n           ) e on a.phone_no=e.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [580]-[index:959]-[2021年7月新增个人日累计指标]-[8]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table tmp_20210720_03_${dayid};\\ncreate table tmp_20210720_03_${dayid}\\n(product_no varchar(20),\\nis_campus_plan      bigint,  -- 是否校园套餐用户\\nfree_res_use_num      decimal(20,4),   -- 当月GPRS资源使用量（GB）\\nis_marketing    int,  -- 是否家宽可营销社区客户\\n is_lan_lten    int   -- 是否家宽潜在客户\\n)distributed by ('PRODUCT_NO');\\ninsert into tmp_20210720_03_${dayid}\\nselect a.phone_no,\\n       case when b.phone_no is not null then 1 else 0 end,\\n       nvl(free_res_use_num,0),\\n       nvl(d.marketing,-9),\\n       nvl(d.is_lan_lten,0)\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join (select distinct phone_no from gbasedwi.DWI_INST_OFFER_LIST_ALL_dS_${dayid}\\n           where plan_id in (111001001484,111001008000,111001013000,111001019000,111001025697,111001031277,111601003381)\\n           and CUR_CYCLE_STATE=1 and eff_time<='${day_id}' and exp_time>='${curm_last_day}'\\n)b on a.phone_no=b.phone_no\\nleft join (select phone_no,round(sum(USE_RES_NUM)/1024/1024/1024,4)free_res_use_num\\n           from gbasedwi.DWI_INCO_BILL_FREERES_dS_${dayid}\\n           where prod_id<>'54001105' and res_unit=1024\\n           group by phone_no\\n)c on a.phone_no=c.phone_no\\nleft join gbaseftt.${tableftt.tb} d on a.phone_no=d.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [581]-[index:960]-[2021年7月新增个人日累计指标]-[65]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_16_${dayid};\\ncreate table dm.tmp_20210720_16_${dayid}\\n(phone_no varchar(20),\\n next_zhu_zk_fee      bigint,  -- 主套餐折扣档位\\n next_gprs_zk_fee        bigint,  -- 流量可选包折扣档位\\n next_call_zk_fee      bigint     -- 语音可选包折扣档位\\n)distributed by ('phone_no');\\ninsert into tmp_20210720_16_${dayid}\\nselect phone_no,\\n       sum(next_zhu_zk_fee) , \\n       sum(next_gprs_zk_fee) ,\\n       sum(next_call_zk_fee) \\nfrom (select a.phone_no,\\n             sum(case when zk_type='主套餐折扣' then zk_fee else 0 end) next_zhu_zk_fee,\\n             sum(case when zk_type='流量可选包折扣' then zk_fee else 0 end) next_gprs_zk_fee,\\n             sum(case when zk_type='语音可选包折扣' then zk_fee else 0 end) next_call_zk_fee                                                                   \\n     from (select distinct a.phone_no,b.*                                                                \\n           from gbasedwi.dwi_inst_asset_ds_${dayid} a                                                    \\n           inner join  dm.dim_zhzk_list b on a.plan_id=b.plan_id\\n           where date(eff_time)<='${nextm_first_day}' and date(exp_time)>'${nextm_first_day}') a                    \\n     inner join (select distinct phone_no,plan_id                                                        \\n                 from gbasedwi.dwi_inst_asset_ds_${dayid}                                         \\n                 where plan_id in (111603011856,111603011857) \\n                 and date(eff_time)<='${nextm_first_day}' and date(exp_time)>'${nextm_first_day}'                                          \\n                 ) b on a.phone_no=b.phone_no and a.zk_id=b.plan_id  group by a.phone_no                            \\n     union all                                                                                                                                                                                                 \\n     select phone_no,\\n            sum(case when zk_type='主套餐折扣' then zk_fee else 0 end) zhu_zk_fee,\\n            sum(case when zk_type='流量可选包折扣' then zk_fee else 0 end) gprs_zk_fee,\\n            sum(case when zk_type='语音可选包折扣' then zk_fee else 0 end) call_zk_fee                                                              \\n     from gbasedwi.dwi_inst_asset_ds_${dayid} a                                               \\n     inner join dm.dim_zk_plan_list b on a.plan_id=b.plan_id                     \\n     where date(eff_time)<='${nextm_first_day}' and date(exp_time)>'${nextm_first_day}' group by phone_no\\n     ) a group by phone_no;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [582]-[index:961]-[2021年7月新增个人日累计指标]-[12]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into dm.dm_pub_20210720_${dayid}\\nselect '${day_id}',\\n       a.phone_no,\\n       b1.FEATURE_VALUE,\\n       b1.new_plan_name,\\n       is_campus_plan,\\n       free_res_use_num,\\n       is_marketing,\\n       is_lan_lten,\\n       is_31day_5g_dengw,\\n       is_31day_5g_dengw_fen,\\n       volume_5g,\\n       nongcun_user,\\n       add_fee,\\n       is_timeout_contract,\\n       is_no_contract,\\n       is_contract,\\n       xz_sms_date,\\n       is_5g_sa_open,\\n       is_overdeal,\\n       is_high_three,\\n       is_dengw_yij,\\n       is_high_one,\\n       is_high_two,\\n       z_call_days,\\n       shx_zk_name, \\n       taowai_gprs,\\n       taowai_gprs_fee,\\n       is_low_risk,\\n       nvl(dy_flow_d,0),\\nnvl(xmly_flow_d,0),\\nnvl(sjfs_flow_d,0),\\nnvl(hfx_flow_d,0),\\nnvl(yx139_flow_d,0),\\nnvl(xxqg_flow_d,0),\\nnvl(wyxw_flow_d,0),\\nnvl(zh_flow_d,0),\\nnvl(shsp_flow_d,0),\\nnvl(wb_flow_d,0),\\nnvl(pptv_flow_d,0),\\nnvl(mgyd_flow_d,0),\\nnvl(ls_flow_d,0),\\nnvl(blbl_flow_d,0),\\nnvl(kgyy_flow_d,0),\\nnvl(aqy_flow_d,0),\\nnvl(wzry_flow_d,0),\\nnvl(ks_flow_d,0),\\nnvl(xgsp_flow_d,0),\\nnvl(mgdm_flow_d,0),\\nnvl(wyyyy_flow_d,0),\\nnvl(kwyy_flow_d,0),\\nnvl(bd_flow_d,0),\\nnvl(mgzb_flow_d,0),\\nnvl(mgyx_flow_d,0),\\nnvl(bfyy_flow_d,0),\\nnvl(mgtv_flow_d,0),\\nnvl(qqyy_flow_d,0),\\nnvl(txsp_flow_d,0),\\nnvl(mgyy_flow_d,0),\\nnvl(jrtt_flow_d,0),\\nis_blxxdt_stop,is_two_rz_stop,second_iden_check,\\ntotalflow_wifi,\\ntotalflow_lt,\\ntotalflow_dx,\\nqdmc,\\nqdlx,\\nrwqd,\\ncount_rkdt,\\ncount_rkdtfj,\\nv_yy_calldur,  -- VOLTE语音主叫通话时长\\nv_sp_calldur,  -- VOLTE视频主叫通话时长\\nv_yy_callnum,  -- VOLTE语音主叫通话次数\\nv_sp_callnum,  -- VOLTE视频主叫通话次数\\nis_paizhao,           -- 2022年价值拍照客户  \\nis_paizhao_by,        -- 2022年价值拍照-保有\\nis_paizhao_ls,        -- 2022年价值拍照-流失\\nsnapshot_income,      -- 2022年价值拍照客户ARPU\\navg_income,            -- 2022年价值拍照客户折后ARPU-实时\\nduanxin_5G   ,  -- 5G短信（条）\\nxiaoxi_5G ,       -- 5G消息（条）\\nis_bother_avoid,\\nruwang90_phone_num,\\nnvl(b13.g5_dengw_yij_num,0),\\nnvl(b13.is_wlw_yj,0),\\nnvl(b13.dou_yj,0),\\nb13.is_5G_taobao_jt,\\nb12.yythdlsszwz,\\nb13.is_xinzeng_user,  -- 是否当月新增用户-新增质量日报口径\\nNVL(b14.NEXT_FEATURE_VALUE,0)-NVL(b16.next_zhu_zk_fee,0)  next_FEATURE_VALUE_zk,  -- 下月生效主套餐档位(剔除折扣产品)\\nNVL(b15.next_gprs_VALUE,0)-NVL(b16.next_gprs_zk_fee,0)  next_gprs_VALUE_zk,   -- 指定流量资源包-下月生效档位(剔除折扣产品)\\nNVL(b15.next_call_VALUE,0)-NVL(b16.next_call_zk_fee,0)  next_call_VALUE_zk, -- 指定语音资源包-下月生效档位(剔除折扣产品)\\nb17.cell_num ,          -- 日累计语音主叫基站个数\\nb17.imei_num ,          -- 日累计语音主叫终端个数\\nb17.b_opp_rule_no_num , -- 日累计被叫对端号码个数\\nb17.z_opp_rule_no_num  , -- 日累计主叫对端号码个数\\nb17.z_opp_rule_no_ls ,   -- 日累计主叫对端号码离散度\\nb17.z_cell_id_ls,         -- 日累计主叫基站离散度\\nb17.SHOULD_fee,            -- 出账收入（一经口径）\\nb17.is_low_pro,             -- 是否低风险pro\\ncase when c.product_no is not null then 1 else 0 end is_xinzeng_user_y, -- 是否当年新增用户-新增质量日报口径\\nb17.VOICE_DURATION_M,    /*--VOLTE语音通话时长(分钟)*/\\nb17.VOICE_COUNT ,        /*     --VOLTE语音通话次数 */\\nb17.VIDEO_DURATION_M,    /*--VOLTE视频通话时长(分钟)*/\\nb17.VIDEO_COUNT,\\nb18.is_chunxz_m,\\nb18.is_xlxz_m,\\nb18.is_chunxz_y,\\nb18.is_xlxz_y,\\nb19.is_labourwhite  , -- W1_手工白名单  \\nb19.is_offerwhite   , -- W2_业务白名单  \\nb19.is_CO_white     , -- W3_行业白名单  \\nb19.is_starwhite    , -- W5_星级过滤   \\nb19.is_numwhite     , -- W6_特殊号段   \\nb19.is_broad        , -- W7_宽带绑定用户 \\nb19.is_redlist      , -- W10_红名单   \\nb19.is_cust_id      , -- W11_单位户   \\nb19.is_hangye       , -- W12_行业应用  \\nb19.is_CO_user      , -- W15_CO用户  \\nb19.is_id_user      , -- W16_非身份证用户\\nb19.is_value_user   , -- W17_高价值用户\\nb19.is_cloud_app    , -- 是否移动云盘近6个月活跃   \\nb19.is_video_app    , -- 是否咪咕视频近6个月活跃\\nb19.is_tongxin_user , -- 是否通信客户（分公司考核）\\nb20.is_lan_rh_user  , -- 名下是否有移动宽带\\nb20.is_shenzx_user  , -- 是否神州行用户（一经口径）\\nb20.chl_lvl1        , -- 一级归类（发卡）-新增质量日报口径\\nb20.chl_lvl2        , -- 二级归类（发卡）-新增质量日报口径\\nb21.is_shipin_user  ,  -- 是否视频客户活跃客户\\nb21.bend_4G_GPRS   , -- 本地4G流量(MB)\\nb21.bend_5G_GPRS   , -- 本地5G流量(MB)\\nb21.manru_4G_GPRS  , -- 国内漫游4G流量(MB)\\nb21.manru_5G_GPRS  , -- 国内漫游5G流量(MB)\\nnvl(b9.ysj_flow_d,0), -- 云手机流量（MB）\\nnvl(b22.realname_channel_name,'不详'), -- 实名渠道方式（同‘入网数据实名合规性核查’实名渠道方式字段）\\nb23.voc_out_fee ,  -- 语音结出费用\\nb23.gprs_out_fee   -- 流量结出费用\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join tmp_20210720_02_${dayid} b1 on a.phone_no=b1.product_no\\nleft join tmp_20210720_03_${dayid} b2 on a.phone_no=b2.product_no\\nleft join tmp_20210720_11_${dayid} b3 on a.phone_no=b3.product_no\\nleft join tmp_20210720_05_${dayid} b5 on a.phone_no=b5.product_no\\nleft join tmp_20210720_06_${dayid} b6 on a.phone_no=b6.product_no\\nleft join tmp_20210720_07_${dayid} b7 on a.phone_no=b7.product_no\\nleft join tmp_20210720_08_${dayid} b8 on a.phone_no=b8.product_no\\nleft join tmp_20210720_09_${dayid} b9 on a.phone_no=b9.product_no\\nleft join tmp_20210720_10_${dayid} b10 on a.phone_no=b10.product_no\\nleft join tmp_20210720_12_${dayid} b12 on a.phone_no=b12.product_no\\nleft join tmp_20210720_13_${dayid} b13 on a.phone_no=b13.product_no\\nleft join tmp_20210720_14_${dayid} b14 on a.phone_no=b14.phone_no\\nleft join tmp_20210720_15_${dayid} b15 on a.phone_no=b15.phone_no\\nleft join tmp_20210720_16_${dayid} b16 on a.phone_no=b16.phone_no\\nleft join tmp_20210720_17_${dayid} b17 on a.phone_no=b17.phone_no\\nleft join (select distinct product_no from dm_pub_2021806383_xinzeng_user_ys_${year} where op_time<='${day_id}') c on a.phone_no=c.product_no\\nleft join tmp_20210720_18_${dayid} b18 on a.user_id=b18.user_id\\nleft join dm.tmp_20210720_19_${dayid} b19 on a.phone_no=b19.phone_no\\nleft join dm.tmp_20210720_20_${dayid} b20 on a.phone_no=b20.phone_no\\nleft join dm.tmp_20210720_21_${dayid} b21 on a.phone_no=b21.phone_no\\nleft join gbaserpt.rpt_nq201805890_mx_${dayid} b22 on a.phone_no=b22.phone_no\\nleft join dm.tmp_20210720_22_${dayid} b23 on a.phone_no=b23.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [583]-[index:962]-[2021年7月新增个人日累计指标]-[46]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_13_${dayid};\\ncreate table dm.tmp_20210720_13_${dayid}\\n(product_no   varchar(20),\\n is_paizhao    int,   -- 2022年价值拍照客户\\n is_paizhao_by   int,      -- 2022年价值拍照-保有客户\\n is_paizhao_ls    int,    -- 2022年价值拍照-流失客户\\n snapshot_income    bigint,  -- 2022年价值拍照客户ARPU\\n avg_income    bigint,  -- 2022年价值拍照客户折后ARPU-实时\\n  duanxin_5G   int,  -- 5G短信（条）\\n xiaoxi_5G   int,     -- 5G消息（条）\\n is_bother_avoid    smallint,\\n ruwang90_phone_num  bigint, -- 入网前90天内证件下入网其他手机号码\\n g5_dengw_yij_num  varchar(20), -- 5G登网天数（一经口径）\\n is_wlw_yj  int,     -- 是否为物联网卡用户（一经口径）\\n dou_yj     decimal(20,8),    -- 是否DOU（一经口径）\\n is_5G_taobao_jt int,    -- 是否5G套包(集团口径)\\n is_xinzeng_user int  -- 是否当月新增用户-新增质量日报口径\\n)distributed by ('product_no');\\n\\ninsert into dm.tmp_20210720_13_${dayid}\\nselect a.phone_no product_no,\\n         case when b.phone_no is not null then '1' else '0' end is_paizhao, -- 2022年价值拍照客户\\n         case when b.flag = 1 then '1' else '0' end is_paizhao_by,          -- 2022年价值拍照-保有客户\\n         case when b.flag = 0 then '1' else '0' end is_paizhao_ls,          -- 2022年价值拍照-流失客户\\n       nvl(b.snapshot_income,0) snapshot_income,                            -- 2022年价值拍照客户ARPU\\n       nvl(b.avg_income,0) avg_income,                                       -- 2022年价值拍照客户折后ARPU-实时\\n       nvl(duanxin_5G,0),\\n       nvl(xiaoxi_5G,0),\\n       case when d.PHONE_NO is null then 0 else 1 end is_bother_avoid,\\n       nvl(e.phone_num,0) ruwang90_phone_num, -- 入网前90天内证件下入网其他手机号码\\n       nvl(f.5g_dengw_num,0) 5g_dengw_yij_num,   -- 5G登网天数（一经口径）\\n       case when f1.msisdn is not null then 1 else 0 end, -- 是否为物联网卡用户（一经口径）\\n       nvl(f2.dou,0),    -- 是否DOU（一经口径）\\n       case when f3.user_id is not null then 1 else 0 end, -- 是否5G套包(集团口径)\\n       case when f4.user_id is not null then 1 else 0 end is_xinzeng_user\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join gbasemsm.msm_dw_basekpi_111194_detail_${dayid} b on a.phone_no=b.phone_no\\nleft join (select user_no phone_no,\\n            sum(case when BUSI_DTL_TYPE='S200004' then call_num else 0 end) duanxin_5G,\\n            sum(case when BUSI_DTL_TYPE='S200005' then call_num else 0 end) xiaoxi_5G\\n           from gbasedwd.dwd_evt_cdr_smms_basetot_dt_${dayid} group by user_no\\n          ) c on a.phone_no=c.phone_no\\nleft join (select distinct avoid_product_no as PHONE_NO from gbasedwi.dwi_usr_bother_avoid_product_ds_${dayid} /*免打扰用户表*/ \\n          ) d  on a.PHONE_NO=d.PHONE_NO\\nleft join dm.dm_pub_ruwang90day_${dayid} e on a.phone_no=e.phone_no\\nleft join (select phone_no,count(distinct op_time) 5g_dengw_num  from dm.dm_pub_20220915_5g_dm_${monthid} group by phone_no) f on a.phone_no=f.phone_no\\nleft join (select distinct msisdn,user_id from gbasebas.int_22012_internetthing_${dayid}) f1 on a.phone_no=f1.msisdn\\nleft join (select  msisdn ,sum(flow_up+flow_down)/1024/1024  dou\\n           from (select  msisdn ,flow_up,flow_down  from gbasebas.int_04002_DT_${monthid} where  op_time  <='${dayid}'  -- 此处为当天，则为日累计DOU，此为为月末，为月累计DOU， 原单位为byte，\\n                 union all\\n                 select   msisdn ,flow_up,flow_down from gbasebas.int_04024_DT_${monthid} where  op_time  <='${dayid}'\\n                 union all\\n                 select   msisdn ,flow_up,flow_down from gbasebas.int_04038_DT_${monthid} where  op_time  <='${dayid}'\\n                )a \\n            group by 1) f2 on a.phone_no=f2.msisdn\\nleft join gbasemsm.msm_dw_basekpi_111367_detail_${dayid} f3 on a.user_id=f3.user_id\\nleft join gbaserpt.nq_201806383_002_${dayid} f4 on a.user_id=f4.user_id\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [584]-[index:964]-[2021年7月新增个人日累计指标]-[59]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_14_01_${dayid};\\ncreate table dm.tmp_20210720_14_01_${dayid}\\nselect distinct a.phone_no,\\n                nvl((case when b.offer_id is not null then b.offer_id else c.new_plan_id end),'0') new_plan_id, -- 下月生效主套餐ID\\n                case when b.offer_name is not null then b.offer_name else c.new_plan_name end new_plan_name -- 下月生效主套餐名称\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join\\n(select a.phone_no,a.offer_id,b.offer_name \\nfrom\\n (select a.phone_no,\\n        max(b.offer_id) call_offer_id, \\n        max(c.offer_id) gprs_offer_id,\\n        concat(max(b.offer_id),'|',max(c.offer_id)) offer_id\\n  from gbasedwi.DWI_INST_ASSET_DS_${dayid} a\\n  left join dm.dim_offer_call_list b on a.plan_id=b.offer_id\\n  left join dm.dim_offer_gprs_list c on a.plan_id=c.offer_id\\n  where date(a.eff_time)<='${nextm_first_day}' and date(a.exp_time)>'${nextm_first_day}'\\n  group by phone_no) a\\nleft join dm.dim_offer_static b on a.offer_id=b.offer_id\\n) b on a.phone_no=b.phone_no\\nleft join\\n(select phone_no,\\n       max(case when CUR_CYCLE_STATE='1' and exp_time >= to_date('${curm_last_day}','YYYY-MM-DD')  then PLAN_ID end) as plan_id,\\n\\t     max(case when eff_time  <=  to_date('${nextm_first_day}','YYYY-MM-DD') and exp_time  >  to_date('${nextm_first_day}','YYYY-MM-DD')  then PLAN_ID end) as new_plan_id,\\n\\t     max(case when eff_time  <=  to_date('${nextm_first_day}','YYYY-MM-DD') and exp_time  >  to_date('${nextm_first_day}','YYYY-MM-DD')  then plan_name end) as new_plan_name\\n  from gbasedwi.DWI_INST_OFFER_PLAN_ds_${dayid}\\n  group by phone_no) c on a.phone_no=c.phone_no\\nwhere (a.ONNET_USER_FLAG=1 AND a.PROD_KIND_CODE='171000000001') or a.MONTH_OFF_FLAG =1;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [585]-[index:967]-[2021年7月新增个人日累计指标]-[44]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_12_${dayid};\\ncreate table dm.tmp_20210720_12_${dayid}\\n(product_no   varchar(20),\\n qdmc    varchar(500),   -- 上传渠道-断卡行动\\n qdlx    varchar(20),    -- 渠道类型-断卡行动\\n rwqd   varchar(20),    -- 入网渠道-断卡行动\\n yythdlsszwz varchar(100), -- 营业厅或者代理商所在位置-断卡行动\\n count_rkdt   int,      -- 人卡分离实人核验单停\\n count_rkdtfj    int,    -- 人卡分离实人核验单停复机\\n v_yy_calldur    bigint,  -- VOLTE语音主叫通话时长\\n v_sp_calldur    bigint,  -- VOLTE视频主叫通话时长\\n v_yy_callnum    bigint,  -- VOLTE语音主叫通话次数\\n v_sp_callnum    bigint   -- VOLTE视频主叫通话次数\\n)distributed by ('product_no');\\ninsert into dm.tmp_20210720_12_${dayid}\\nselect a.phone_no,\\n       b.qdmc,\\n       case when b.qdlx=1 then '自营营业厅' when b.qdlx=2 then '代理商' else '不详' end qdlx,\\n       case when b.rwqd=1 then '网络渠道入网' when b.rwqd=2 then '实体渠道入网' else '不详' end rwqd,\\n       b.yythdlsszwz,\\n       nvl(count_rkdt,0),\\n       nvl(count_rkdtfj,0),\\n       nvl(v_yy_calldur,0),\\n       nvl(v_sp_calldur,0),\\n       nvl(v_yy_callnum,0),\\n       nvl(v_sp_callnum,0)\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join dm.dm_pub_khqd_ds_${dayid} b on a.user_id=b.provsubsid\\nleft join (select user_id,\\n                  count(distinct case when note='人卡分离实人核验单停' then done_date end) count_rkdt,\\n                  count(distinct case when note in ('人卡分离实人核验单停复机','人卡分离实人核验通过复机')  then done_date end) count_rkdtfj\\n           from gbaseods.ods_d_f_crm_10005_insx_share_notes_d_${dayid}\\n           where note_type='注释' and note in ('人卡分离实人核验单停','人卡分离实人核验单停复机','人卡分离实人核验通过复机')\\n           group by user_id,bill_id)c on a.user_id=c.user_id\\nleft join (select phone_no,\\n                  sum(call_num) v_yy_callnum,\\n                  sum(call_dur) v_yy_calldur,\\n                  sum(case when is_4g_voice=1 then call_num else 0 end) v_sp_callnum,\\n                  sum(case when is_4g_voice=1 then call_dur else 0 end) v_sp_calldur\\n           from gbasedwd.dwd_evt_cdr_voc_basetot_dm_${monthid} where is_volte=1 and call_type=1 and stat_date<='${day_id}'\\n           group by phone_no\\n          )d on a.phone_no=d.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [586]-[index:969]-[2021年7月新增个人日累计指标]-[79]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_18_${dayid};\\ncreate table dm.tmp_20210720_18_${dayid} \\nselect distinct a.*,\\n           case when a.innet_date>='${curmfirstday}' and a.innet_date<='${dayid}' and a.cust_type='身份证' and b.cust_no is null then 1 \\n                when a.innet_date>='${curmfirstday}' and a.innet_date<='${dayid}' and d.user_no is not null then -9 else 0 end is_chunxz_m,\\n           case when a.innet_date>='${curmfirstday}' and a.innet_date<='${dayid}' and a.cust_type='身份证' and b.cust_no is not null then 1 \\n                when a.innet_date>='${curmfirstday}' and a.innet_date<='${dayid}' and d.user_no is not null then -9 else 0 end is_xlxz_m,\\n           case when a.innet_date>='${curyfirstday}' and a.innet_date<='${dayid}' and a.cust_type='身份证' and c.cust_no is null then 1 \\n                when a.innet_date>='${curyfirstday}' and a.innet_date<='${dayid}' and d.user_no is not null then -9 else 0 end is_chunxz_y,\\n           case when a.innet_date>='${curyfirstday}' and a.innet_date<='${dayid}' and a.cust_type='身份证' and c.cust_no is not null then 1 \\n                when a.innet_date>='${curyfirstday}' and a.innet_date<='${dayid}' and d.user_no is not null then -9 else 0 end is_xlxz_y   \\nfrom\\n(select distinct a.phone_no,a.user_id,a.innet_date,b.cust_no,b.cust_type \\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join (select distinct user_id, \\n                          case when user_type='单位客户' then use_no\\n                               when user_type='个人客户' then cust_no end cust_no,\\n                          case when user_type='单位客户' then use_type\\n                               when user_type='个人客户' then cust_type end cust_type\\n           from gbasedwi.DWI_USR_PESN_REALNAME_BASE_DS_${dayid} \\n           where user_type in ('个人客户','单位客户') and user_state in ('正常','保留期','营业暂停','停机')\\n          ) b on a.user_id=b.user_id\\nwhere a.BASS_USER_STATE in ('43','11','21','23','24','22','45','12')\\ngroup by a.phone_no,a.user_id,a.innet_date,b.cust_no,b.cust_type\\n) a\\nleft join (select cust_no \\n           from (select distinct a.user_id, \\n                                 case when user_type='单位客户' then use_no\\n                                      when user_type='个人客户' then cust_no end cust_no,\\n                                 case when user_type='单位客户' then use_type\\n                                      when user_type='个人客户' then cust_type end cust_type\\n                  from gbasedwi.DWI_USR_PESN_REALNAME_BASE_DS_${premlastday} a\\n                  left join gbasedwi.DWI_USR_PESN_THINGINTER_DS_${premlastday} b on a.phone_no=b.user_no\\n                  where a.user_type in ('个人客户','单位客户') and a.user_state in ('正常','保留期','营业暂停','停机') and b.user_no is null\\n                 ) a\\n           group by cust_no\\n          ) b on a.cust_no=b.cust_no \\nleft join (select cust_no \\n           from (select distinct a.user_id, \\n                                 case when user_type='单位客户' then use_no\\n                                      when user_type='个人客户' then cust_no end cust_no,\\n                                 case when user_type='单位客户' then use_type\\n                                      when user_type='个人客户' then cust_type end cust_type\\n                  from  dm.dim_pub_PESN_REALNAME_BASE_${preylastday}_dm a\\n                  left join gbasedwi.DWI_USR_PESN_THINGINTER_MS_${preylastmonth} b on a.phone_no=b.user_no\\n                  where a.user_type in ('个人客户','单位客户') and a.user_state in ('正常','保留期','营业暂停','停机') and b.user_no is null\\n                 ) a\\n           group by cust_no\\n          ) c on a.cust_no=c.cust_no \\nleft join gbasedwi.DWI_USR_PESN_THINGINTER_DS_${dayid} d on a.phone_no=d.user_no\\n;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [587]-[index:971]-[2021年7月新增个人日累计指标]-[61]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_14_${dayid};\\ncreate table dm.tmp_20210720_14_${dayid}\\nselect a.phone_no,\\n       a.new_plan_id, -- 下月生效主套餐ID\\n       a.new_plan_name, -- 下月生效主套餐名称\\n       case when b.plan_id is not null then b.cx_offer_level else c.FEATURE_VALUE end NEXT_FEATURE_VALUE -- 下月生效主套餐档位\\nfrom dm.tmp_20210720_14_01_${dayid} a\\nleft join (select concat(call_id,'|',gprs_id) plan_id,cx_offer_name,cx_offer_level \\n                      from dm.dim_cx_offer_type_list\\n                      ) b on a.new_plan_id=b.plan_id\\nleft join dm.dim_plan_name_fee c on a.new_plan_id=c.PRODUCT_ITEM_ID\\n;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [588]-[index:972]-[2021年7月新增个人日累计指标]-[38]-['str' object has no attribute 'lfind']:{"parentDsName":"GBASE_CAMPUS_100","dsName":"GBASE_CAMPUS_100","schema_union":"gbase_campus","schema_dev":"gbase_campus","schema_prod":"gbase_campus","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_10_${dayid};\\ncreate table dm.tmp_20210720_10_${dayid}\\n(product_no   varchar(20),\\nis_blxxdt_stop    int,  -- 是否不良信息单停\\nis_two_rz_stop    int,   -- 是否二次认证停机\\nsecond_iden_check  int\\n)distributed by ('product_no');\\ninsert into dm.tmp_20210720_10_${dayid}\\nselect a.phone_no,\\n       nvl(b.is_blxxdt_stop,0) is_blxxdt_stop,\\n       nvl(b.is_two_rz_stop,0) is_two_rz_stop,\\n       second_iden_check\\nfrom gbasedwi.DWI_USR_PESN_PARTINFO_ds_${dayid} a\\nleft join (select user_id,\\n                  max(case when substr(OS_STATUS,49,1)=1 then 1 else 0 end) is_blxxdt_stop,\\n                  max(case when substr(OS_STATUS,53,1)=1 then 1 else 0 end) is_two_rz_stop\\n          from gbasedwd.dwd_svc_inst_pre_01541_allinfo_ds_${dayid} group by user_id)b on a.user_id=b.user_id\\nleft join (select bill_id,second_iden_check\\nfrom(\\nselect bill_id,second_iden_check,done_date,row_number()over(partition by bill_id order by done_date desc)rn\\nfrom gbaseods.ods_d_f_crm_02611_user_contact_info_${dayid}\\n)a\\nwhere a.rn=1\\n)c on a.phone_no=c.bill_id\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [589]-[index:973]-[2021年7月新增个人日累计指标]-[19]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table tmp_20210720_04_${dayid};\\ncreate table tmp_20210720_04_${dayid} distributed by ('phone_no')\\nselect distinct a.msisdn as phone_no from\\n     (select distinct msisdn\\n        from gbasebas.int_02004_di_${dayid} where user_type<>3\\n     ) a\\n left join \\n     (select msisdn,sum(total_flow)\\n        from (select msisdn,sum(flow) total_flow from gbasebas.int_22154_ms_${pmonthid}\\n               where op_time>='${p30dayid}' group by msisdn  having sum(flow)>0\\n              union all\\n              select msisdn,sum(nvl(flow_up,0)+nvl(flow_down,0)+nvl(FLOW_UP_f,0)+nvl(FLOW_down_f,0)) total_flow \\n                from gbasebas.int_04038_dt_${pmonthid}\\n               where op_time>='${p30dayid}' group by msisdn\\n                having sum(nvl(flow_up,0)+nvl(flow_down,0)+nvl(FLOW_UP_f,0)+nvl(FLOW_down_f,0)) >0\\n              union all\\n              select msisdn,sum(flow) total_flow from gbasebas.int_22154_ms_${monthid}\\n               where op_time<='${dayid}'  group by msisdn  having sum(flow)>0\\n              union all\\n              select msisdn,sum(nvl(flow_up,0)+nvl(flow_down,0)+nvl(FLOW_UP_f,0)+nvl(FLOW_down_f,0)) total_flow \\n                from gbasebas.int_04038_dt_${monthid} \\n               where op_time<='${dayid}' group by msisdn\\n                having sum(nvl(flow_up,0)+nvl(flow_down,0)+nvl(FLOW_UP_f,0)+nvl(FLOW_down_f,0)) >0\\n              ) a\\n        group by msisdn\\n      ) b\\n  on a.msisdn=b.msisdn\\n left join gbasebas.int_22012_internetthing_${dayid} c on a.msisdn=c.msisdn\\n where b.msisdn is not  null and c.msisdn is null\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [590]-[index:974]-[2021年7月新增个人日累计指标]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.dim_plan_name_fee;\\ncreate table dm.dim_plan_name_fee distributed by ('PRODUCT_ITEM_ID')\\nselect distinct a.PRODUCT_ITEM_ID,nvl(offer_name,plan_name) plan_name,FEATURE_VALUE\\nfrom gbaseods.ods_d_f_crm_01553_up_item_feature_${dayid} a\\nleft join (select plan_id,plan_name\\nfrom (select *,row_number()over(partition by plan_id order by plan_name) rn  from (select distinct plan_id,plan_name,max(EFF_TIME)\\nfrom gbasedwi.dwi_inst_offer_list_all_ds_${dayid} group by  plan_id,plan_name)a ) a where rn=1 )b on a.PRODUCT_ITEM_ID=b.plan_id\\nleft join\\n(\\nselect distinct t.product_item_id offer_id, t1.name offer_name\\nfrom  gbaseods.ods_d_f_crm_01557_up_plan_prod_rel_${dayid} t\\nleft join gbaseods.ods_d_f_crm_01543_up_product_item_${dayid} t1 on t1.product_item_id = t.product_item_id\\n where \\n t.del_flag = 1 )c on a.PRODUCT_ITEM_ID=c.offer_id\\nwhere FEATURE_ID='2000021051'\\n;\\ndrop table tmp_20210720_01_${dayid};\\ncreate table tmp_20210720_01_${dayid}\\n(product_no varchar(20),\\nplan_id      bigint,\\nnew_plan_id   bigint,\\n new_plan_name  varchar(100)\\n)distributed by ('PRODUCT_NO');\\ninsert into tmp_20210720_01_${dayid}\\nselect a.phone_no,\\n       plan_id,\\n\\t   new_plan_id,\\n       new_plan_name\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a \\nleft join (select phone_no,\\n       max(case when EFF_TIME < to_date('${nextm_first_day}','YYYY-MM-DD')  then PLAN_ID end) as plan_id,\\n\\t   max(case when EFF_TIME  >=  to_date('${nextm_first_day}','YYYY-MM-DD')  then PLAN_ID end) as new_plan_id,\\n\\t   max(case when EFF_TIME  >=  to_date('${nextm_first_day}','YYYY-MM-DD')  then PLAN_NAME end) as new_plan_name\\n  from gbasedwi.DWI_INST_OFFER_PLAN_DS_${dayid}\\n  group by phone_no\\n)b on a.phone_no=b.phone_no\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [591]-[index:976]-[2021年7月新增个人日累计指标]-[35]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_09_${dayid};\\ncreate table dm.tmp_20210720_09_${dayid}\\n(product_no   varchar(20),\\ndy_flow_d    decimal(20,2),  --  抖音流量（MB）\\nxmly_flow_d  decimal(20,2),  --  喜马拉雅流量（MB）\\nsjfs_flow_d  decimal(20,2),  --  手机电视业务流量（MB）\\nhfx_flow_d   decimal(20,2),  --  和飞信流量（MB）\\nyx139_flow_d decimal(20,2),  --  139邮箱流量（MB）\\nxxqg_flow_d  decimal(20,2),  --  学习强国流量（MB）\\nwyxw_flow_d  decimal(20,2),  --  网易新闻流量（MB）\\nzh_flow_d    decimal(20,2),  --  知乎流量（MB）\\nshsp_flow_d  decimal(20,2),  --  搜狐视频流量（MB）\\nwb_flow_d    decimal(20,2),  --  微博流量（MB）\\npptv_flow_d  decimal(20,2),  --  pptv流量（MB）\\nmgyd_flow_d  decimal(20,2),  --  咪咕阅读流量（MB）\\nls_flow_d    decimal(20,2),  --  乐视流量（MB）\\nblbl_flow_d  decimal(20,2),  --  哔哩哔哩流量（MB）\\nkgyy_flow_d  decimal(20,2),  --  酷狗音乐流量（MB）\\naqy_flow_d   decimal(20,2),  --  爱奇艺流量（MB）\\nwzry_flow_d  decimal(20,2),  --  王者荣耀流量（MB）\\nks_flow_d    decimal(20,2),  --  快手流量（MB）\\nxgsp_flow_d  decimal(20,2),  --  西瓜视频流量（MB）\\nmgdm_flow_d  decimal(20,2),  --  咪咕动漫流量（MB）\\nwyyyy_flow_d decimal(20,2),  --  网易云音乐流量（MB）\\nkwyy_flow_d  decimal(20,2),  --  酷我音乐流量（MB）\\nbd_flow_d    decimal(20,2),  --  百度流量（MB）\\nmgzb_flow_d  decimal(20,2),  --  咪咕直播流量（MB）\\nmgyx_flow_d  decimal(20,2),  --  咪咕游戏流量（MB）\\nbfyy_flow_d  decimal(20,2),  --  暴风影音（MB）\\nmgtv_flow_d  decimal(20,2),  --  芒果TV流量（MB）\\nqqyy_flow_d  decimal(20,2),  --  QQ音乐流量（MB）\\ntxsp_flow_d  decimal(20,2),  --  腾讯视频流量（MB）\\nmgyy_flow_d  decimal(20,2),  --  咪咕音乐流量（MB）\\njrtt_flow_d  decimal(20,2),  --  今日头条流量（MB）\\nysj_flow_d   decimal(20,2)   -- 云手机流量（MB）\\n)distributed by ('product_no');\\ninsert into dm.tmp_20210720_09_${dayid}\\nselect a.phone_no,\\n       sum(case when Content_bill_id='1750000012' then a.total_flow_m else 0 end)  dy_flow_d,   -- 抖音流量（MB）\\n       sum(case when Content_bill_id='1750000089' then a.total_flow_m else 0 end)  xmly_flow_d,   -- 喜马拉雅流量（MB）\\n       sum(case when Content_bill_id='1030000006' then a.total_flow_m else 0 end)  sjfs_flow_d,   -- 手机电视业务流量（MB）\\n       sum(case when Content_bill_id='1750000064' then a.total_flow_m else 0 end)  hfx_flow_d,   -- 和飞信流量（MB）\\n       sum(case when Content_bill_id='1750000067' then a.total_flow_m else 0 end)  yx139_flow_d,   -- 139邮箱流量（MB）\\n       sum(case when Content_bill_id='1750000090' then a.total_flow_m else 0 end)  xxqg_flow_d,   -- 学习强国流量（MB）\\n       sum(case when Content_bill_id='1750000087' then a.total_flow_m else 0 end)  wyxw_flow_d,   -- 网易新闻流量（MB）\\n       sum(case when Content_bill_id='1750000097' then a.total_flow_m else 0 end)  zh_flow_d,   -- 知乎流量（MB）\\n       sum(case when Content_bill_id='1750000010' then a.total_flow_m else 0 end)  shsp_flow_d,   -- 搜狐视频流量（MB）\\n       sum(case when Content_bill_id='1750000084' then a.total_flow_m else 0 end)  wb_flow_d,   -- 微博流量（MB）\\n       sum(case when Content_bill_id='1750000008' then a.total_flow_m else 0 end)  pptv_flow_d,   -- pptv流量（MB）\\n       sum(case when Content_bill_id='1750000082' then a.total_flow_m else 0 end)  mgyd_flow_d,   -- 咪咕阅读流量（MB）\\n       sum(case when Content_bill_id='1750000001' then a.total_flow_m else 0 end)  ls_flow_d,   -- 乐视流量（MB）\\n       sum(case when Content_bill_id='1750000009' then a.total_flow_m else 0 end)  blbl_flow_d,   -- 哔哩哔哩流量（MB）\\n       sum(case when Content_bill_id='1750000054' then a.total_flow_m else 0 end)  kgyy_flow_d,   -- 酷狗音乐流量（MB）\\n       sum(case when Content_bill_id='1750000004' then a.total_flow_m else 0 end)  aqy_flow_d,   -- 爱奇艺流量（MB）\\n       sum(case when Content_bill_id='1750000031' then a.total_flow_m else 0 end)  wzry_flow_d,   -- 王者荣耀流量（MB）\\n       sum(case when Content_bill_id='1750000013' then a.total_flow_m else 0 end)  ks_flow_d,   -- 快手流量（MB）\\n       sum(case when Content_bill_id='1750000012' then a.total_flow_m else 0 end)  xgsp_flow_d,   -- 西瓜视频流量（MB）\\n       sum(case when Content_bill_id='1750000083' then a.total_flow_m else 0 end)  mgdm_flow_d,   -- 咪咕动漫流量（MB）\\n       sum(case when Content_bill_id='1750000052' then a.total_flow_m else 0 end)  wyyyy_flow_d,   -- 网易云音乐流量（MB）\\n       sum(case when Content_bill_id='1750000055' then a.total_flow_m else 0 end)  kwyy_flow_d,   -- 酷我音乐流量（MB）\\n       sum(case when Content_bill_id='1750000085' then a.total_flow_m else 0 end)  bd_flow_d,   -- 百度流量（MB）\\n       sum(case when Content_bill_id='1750000007' then a.total_flow_m else 0 end)  mgzb_flow_d,   -- 咪咕直播流量（MB）\\n       sum(case when Content_bill_id='1750000034' then a.total_flow_m else 0 end)  mgyx_flow_d,   -- 咪咕游戏流量（MB）\\n       sum(case when Content_bill_id='1750000011' then a.total_flow_m else 0 end)  bfyy_flow_d,   -- 暴风影音（MB）\\n       sum(case when Content_bill_id='1750000005' then a.total_flow_m else 0 end)  mgtv_flow_d,   -- 芒果TV流量（MB）\\n       sum(case when Content_bill_id='1750000053' then a.total_flow_m else 0 end)  qqyy_flow_d,   -- QQ音乐流量（MB）\\n       sum(case when Content_bill_id='1750000003' then a.total_flow_m else 0 end)  txsp_flow_d,   -- 腾讯视频流量（MB）\\n       sum(case when Content_bill_id='1750000056' then a.total_flow_m else 0 end)  mgyy_flow_d,   -- 咪咕音乐流量（MB）\\n       sum(case when Content_bill_id='1750000081' then a.total_flow_m else 0 end)  jrtt_flow_d,   -- 今日头条流量（MB）\\n       sum(case when Content_bill_id='1750000112' then a.total_flow_m else 0 end)  ysj_flow_d     -- 云手机流量（MB）\\nfrom\\n(select phone_no,Content_bill_id,round(sum(total_flow)/1024/1024,2) total_flow_M \\n from gbasedwd.dwd_evt_cdr_gprs_busitypetot_dm_${monthid}\\n where stat_date<='${day_id}'\\n     group by phone_no,Content_bill_id ) a  \\ngroup by phone_no"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [592]-[index:977]-[2021年7月新增个人日累计指标]-[75]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"delete from dm.dm_pub_2021806383_xinzeng_user_ys_${year} where op_time='${day_id}';\\ninsert into dm.dm_pub_2021806383_xinzeng_user_ys_${year}\\nselect distinct a.op_time,a.product_no \\nfrom gbaserpt.nq_201806383_002_${dayid} a\\nleft join dm.dm_pub_2021806383_xinzeng_user_ys_${year} b on a.product_no=b.product_no\\nwhere b.product_no is null;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [593]-[index:978]-[2021年7月新增个人日累计指标]-[63]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_15_${dayid};\\ncreate table dm.tmp_20210720_15_${dayid}\\n(phone_no varchar(20),\\n next_gprs_VALUE    bigint,         -- 指定流量资源包-下月生效档位\\n next_call_VALUE    bigint          -- 指定语音资源包-下月生效档位\\n)distributed by ('phone_no');\\n\\ninsert into tmp_20210720_15_${dayid}\\nselect a.phone_no,\\n       sum(case when b.plan_type='流量可选包' and date(a.eff_time)<='${nextm_first_day}' and date(a.exp_time)>'${nextm_first_day}' then b.plan_level end) next_gprs_VALUE,   -- 指定流量资源包-下月生效档位\\n       sum(case when b.plan_type='语音可选包' and date(a.eff_time)<='${nextm_first_day}' and date(a.exp_time)>'${nextm_first_day}' then b.plan_level end) next_call_VALUE   -- 指定语音资源包-下月生效档位\\nfrom gbasedwi.DWI_INST_ASSET_ds_${dayid} a\\nleft join dm.dim_zhuplan_kplan_id b on a.plan_id=b.plan_id\\ngroup by a.phone_no;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [594]-[index:979]-[2021年7月新增个人日累计指标]-[86]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseRPT","dsName":"GbaseRPT","schema_union":"GbaseRPT","schema_dev":"GbaseRPT","schema_prod":"GbaseRPT","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp_20210720_19_${dayid};\\ncreate table dm.tmp_20210720_19_${dayid} \\n(\\n  phone_no varchar(20) ,\\n  is_labourwhite  int,   -- W1_手工白名单     \\n  is_offerwhite   int,   -- W2_业务白名单     \\n  is_CO_white     int,   -- W3_行业白名单     \\n  is_starwhite    varchar(30),   -- W5_星级过滤      \\n  is_numwhite     int,   -- W6_特殊号段      \\n  is_broad        int,   -- W7_宽带绑定用户    \\n  is_redlist      int,   -- W10_红名单      \\n  is_cust_id      int,   -- W11_单位户      \\n  is_hangye       int,   -- W12_行业应用     \\n  is_CO_user      int,   -- W15_CO用户   \\n  is_id_user      int,   -- W16_非身份证用户 \\n  is_value_user   int,   -- W17_高价值用户 \\n  is_cloud_app    int,   -- 是否移动云盘近6个月活跃\\n  is_video_app    int,   -- 是否咪咕视频近6个月活跃\\n  is_tongxin_user int    -- 是否通信客户（分公司考核）\\n)distributed by ('phone_no');\\n\\ninsert into dm.tmp_20210720_19_${dayid}\\nselect a.phone_no,\\n       case when b1.phone_no is not null then 1 when b1.phone_no is null then 0 else -9 end ,  -- W1_手工白名单\\n       case when b2.phone_no is not null then 1 when b2.phone_no is null then 0 else -9 end ,  -- W2_业务白名单\\n       case when b3.phone_no is not null then 1 when b3.phone_no is null then 0 else -9 end ,  -- W3_行业白名单\\n       case when b4.phone_no is not null then b4.credit_name else 0 end ,  -- W5_星级过滤\\n       case when b5.phone_no is not null then 1 when b5.phone_no is null then 0 else -9 end ,  -- W6_特殊号段\\n       case when b6.phone_no is not null then 1 when b6.phone_no is null then 0 else -9 end ,  -- W7_宽带绑定用户\\n       case when b7.phone_no is not null then 1 when b7.phone_no is null then 0 else -9 end ,  -- W10_红名单\\n       case when b8.phone_no is not null then 1 when b8.phone_no is null then 0 else -9 end ,  -- W11_单位户\\n       case when b9.phone_no is not null then 1 when b9.phone_no is null then 0 else -9 end ,  -- W12_行业应用\\n       case when b10.phone_no is not null then 1 when b10.phone_no is null then 0 else -9 end ,  -- W15_CO用户\\n       case when b11.phone_no is not null then 1 when b11.phone_no is null then 0 else -9 end ,  -- W16_非身份证用户\\n       case when b12.phone_no is not null then 1 when b12.phone_no is null then 0 else -9 end ,  -- W17_高价值用户\\n       case when b13.phone_no is not null then 1 when b13.phone_no is null then 0 else -9 end ,  -- 是否移动云盘近6个月活跃\\n       case when b14.phone_no is not null then 1 when b14.phone_no is null then 0 else -9 end ,  -- 是否咪咕视频近6个月活跃\\n       case when b15.msisdn is not null then 1 when b15.msisdn is null then 0 else -9 end        -- 是否通信客户（分公司考核）\\nfrom gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} a\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_labourwhite_dd b1 on a.phone_no=b1.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_offerwhite_dd b2 on a.phone_no=b2.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_CO_white_dd  b3 on a.phone_no=b3.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_starwhite_dd b4 on a.phone_no=b4.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_numwhite_dd b5 on a.phone_no=b5.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_broad_dd b6 on a.phone_no=b6.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_redlist_dd b7 on a.phone_no=b7.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_cust_id_dd b8 on a.phone_no=b8.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_hangye_dd b9 on a.phone_no=b9.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_CO_dd b10 on a.phone_no=b10.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_id_dd b11 on a.phone_no=b11.phone_no\\nleft join gbasedwi.dwi_shazha_leiji_phone_no_value_dd b12 on a.phone_no=b12.phone_no\\nleft join gbaseods.${nbpopcloudapp.name1} b13 on a.phone_no=b13.phone_no\\nleft join gbaseods.${nbpopvideoapp.name} b14 on a.phone_no=b14.phone_no\\nleft join (select a.msisdn\\n           from gbasemsm.msm_dw_basekpi_110852_detail_${dayid}  a\\n           left join gbasedwi.dwi_usr_pesn_thinginter_ds_${dayid} b on a.msisdn  = b.user_no\\n           left join (select distinct phone_no from gbaseupd.dim_tongxin_delete_user_dm where date(op_time) like '%${month_id}%') c on a.msisdn=c.phone_no\\n           left join (select distinct a.phone_no from dm.dim_tongxin_delete_user_dm_over a -- 永久剔除\\n                      left join gbasedwi.dwi_usr_pesn_partinfo_ds_${dayid} b on a.phone_no = b.phone_no\\n                      where innet_date <='20221231'\\n                     ) d on a.msisdn=d.phone_no\\n           where c.phone_no is null and d.phone_no is null and b.user_no is null\\n           ) b15 on a.phone_no=b15.msisdn\\nwhere a.prod_kind_code='171000000001' and (a.month_arrive_flag = 1 or a.month_off_flag = 1 or a.month_new_flag = 1);"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [595]-[index:981]-[2021年7月新增个人日累计指标导表]-[5]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"5.插入数据","nodeId":"5","sql":"Insert into DM_PUB_20210720_${dayid}\\nselect * from DM_PUB_20210720_${dayid}@dblink_dm;\\n\\n"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [596]-[index:982]-[2021年7月新增个人日累计指标导表]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","name":"3.创建表","nodeId":"3","sql":"drop table DM_PUB_20210720_${dayid};\\ncreate table DM_PUB_20210720_${dayid} like DM_PUB_20210720_YYYYMMDD;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [597]-[index:984]-[免费资源视图（日累计）]-[13]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table dm.tmp02_dm_pub_gprs_zc_ds_${dayid};\\ncreate table dm.tmp02_dm_pub_gprs_zc_ds_${dayid} \\n(\\n  phone_no varchar(20) ,\\n  attr_value varchar(4000) ,\\n  send_gprs varchar(4000) ,\\n  staff_name varchar(200) ,\\n  send_type varchar(20),\\n  plan_id bigint(20) ,\\n  prod_id bigint(20) ,\\n  prod_eff_date varchar(30)\\n)distributed by ('phone_no') ;\\n\\ndrop table dm.tmp02_dm_pub_gprs_zc_ds_${dayid} ;\\ncreate table dm.tmp02_dm_pub_gprs_zc_ds_${dayid}  distributed by ('phone_no') \\nselect distinct \\n       a.phone_no,\\n       b.attr_value,   -- 个人业务批量BI-文件名称  \\n       b.send_gprs,    -- 个人业务批量BI-赠送资源量\\n       b.staff_name,   -- 个人业务批量BI-活动提交人\\n       '个人业务批量BI'  send_type,   -- 个人业务批量BI-系统\\n       a.plan_id,\\n       a.prod_id,\\n       a.prod_eff_date\\nfrom (select a.* ,b.plan_id offer_id from dm.TMP_DM_PUB_FREERES_DS_${dayid} a\\n      inner join DM.dim_DM_PLAN_LIST b on a.plan_id=b.plan_id or (b.plan_type in (1) and a.prod_id=b.prod_id)\\n      where b.plan_type=1\\n      )a\\ninner join (select a.*,row_number()over(partition by phone_no,plan_id order by begin_time desc) rm \\n            from dm.tmp01_dm_pub_gprs_pl_ds_${dayid} a\\n           ) b on a.phone_no=b.phone_no and a.offer_id=b.plan_id and a.prod_eff_date=date(b.begin_time) and b.rm=1;\\n\\ninsert into dm.tmp02_dm_pub_gprs_zc_ds_${dayid}\\nselect distinct \\n       a.phone_no,\\n       b.attr_value,   -- 个人业务批量BI-文件名称  \\n       b.send_gprs,    -- 个人业务批量BI-赠送资源量\\n       b.staff_name,   -- 个人业务批量BI-活动提交人\\n       '个人业务批量BI'  send_type,   -- 个人业务批量BI-系统\\n       a.plan_id,\\n       a.prod_id,\\n       a.prod_eff_date\\nfrom (select a.* from dm.TMP_DM_PUB_FREERES_DS_${dayid} a\\n      where plan_id like '9%' and prod_id like '9%' and PROD_ATTR_NAME like '%直充%'\\n      )a\\ninner join (select a.*,row_number()over(partition by phone_no,plan_id order by begin_time desc) rm \\n            from dm.tmp01_dm_pub_gprs_pl_ds_${dayid} a\\n           ) b on a.phone_no=b.phone_no and a.plan_id=b.plan_id and a.prod_eff_date=date(b.begin_time) and b.rm=1;\\n\\ninsert into dm.tmp02_dm_pub_gprs_zc_ds_${dayid}\\nselect distinct \\n       a.phone_no,\\n       'NULL' attr_value,   -- 个人业务批量BI-文件名称  \\n       'NULL' send_gprs,    -- 个人业务批量BI-赠送资源量\\n       'NULL' staff_name,     -- 个人业务批量BI-提出人\\n       '流量产品'  send_type,   -- 流量产品包-系统\\n       a.plan_id,\\n       a.prod_id,\\n       a.prod_eff_date\\nfrom dm.TMP_DM_PUB_FREERES_DS_${dayid} a\\ninner join DM.dim_DM_PLAN_LIST b on to_number(a.plan_id)=b.plan_id\\nwhere b.plan_type=2;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [598]-[index:985]-[免费资源视图（日累计）]-[2]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"insert into dm.DM_PUB_FREERES_DS_${dayid}\\nselect distinct \\n       a.*,\\n       b.attr_value,\\n       b.send_gprs,\\n       b.staff_name, \\n       b.send_type\\nfrom dm.TMP_DM_PUB_FREERES_DS_${dayid} a\\nleft join dm.tmp02_dm_pub_gprs_zc_ds_${dayid} b on a.phone_no=b.phone_no \\n                                               and (a.plan_id=b.plan_id or a.prod_id=b.prod_id)\\n                                               and a.prod_eff_date=b.prod_eff_date;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [599]-[index:987]-[免费资源视图（日累计）]-[3]-['str' object has no attribute 'lfind']:{"parentDsName":"Gbase_6_DM","dsName":"Gbase_6_DM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists dm.DM_PUB_FREERES_DS_${dayid};\\ncreate table if not exists dm.DM_PUB_FREERES_DS_${dayid} distributed by ('PHONE_NO')\\nselect * from DM_PUB_FREERES_DS_${dayid}@dblink_dm;"} 
2024-08-10 23:07:17 | 【ERROR】<run>@<step1_trans_sql_code> | [600]-[index:988]-[免费资源视图（日累计）]-[9]-['str' object has no attribute 'lfind']:{"parentDsName":"GbaseDM","dsName":"GbaseDM","schema_union":"DM","schema_dev":"DM","schema_prod":"DM","queue_union":"","queue_dev":"","queue_prod":"","sql":"drop table if exists dm.TMP_DM_PUB_FREERES_DS_${dayid};\\ncreate table if not exists dm.TMP_DM_PUB_FREERES_DS_${dayid} DISTRIBUTED BY('phone_no') \\nselect STAT_DATE,\\nPHONE_NO,\\nBRAND_ID,\\nSUB_BRAND_ID,\\nUSER_STATE,\\nACCT_ID,\\nCUST_ID,\\nUSER_ID,\\nPROD_ID,\\nPROD_ATTR_NAME,\\nITEM_CODE,\\nUSE_TYPE,\\nto_number(USE_RES_NUM) USE_RES_NUM,\\nto_number(TOTAL_RES_NUM) TOTAL_RES_NUM,\\nto_number(NORMAL_USE_RES_NUM) NORMAL_USE_RES_NUM,\\nto_number(NORMAL_TOTUSE_RES_NUM) NORMAL_TOTUSE_RES_NUM,\\nto_number(ROLL_USE_RES_NUM) ROLL_USE_RES_NUM,\\nto_number(ROLL_TOTUSE_RES_NUM) ROLL_TOTUSE_RES_NUM,\\nto_number(RES_UNIT) RES_UNIT,\\nto_number(PLAN_ID) PLAN_ID,\\nto_number(PLAN_ID) PLAN_ID2,\\nUSER_PROD_STATE,\\nPROD_EFF_DATE,\\nPROD_EXP_TIME,\\nUSER_BA_CODE,\\nLEN_PHONE_NO\\n from gbasedwi.DWI_INCO_BILL_FREERES_DS_${dayid}\\n \\n union all\\n \\nselect STAT_DATE,\\nPHONE_NO,\\nBRAND_ID,\\nSUB_BRAND_ID,\\nUSER_STATE,\\nACCT_ID,\\nCUST_ID,\\nUSER_ID,\\nPROD_ID,\\nPROD_ATTR_NAME,\\nITEM_CODE,\\nUSE_TYPE,\\nto_number(USE_RES_NUM),\\nto_number(TOTAL_RES_NUM),\\nto_number(NORMAL_USE_RES_NUM),\\nto_number(NORMAL_TOTUSE_RES_NUM),\\nto_number(ROLL_USE_RES_NUM),\\nto_number(ROLL_TOTUSE_RES_NUM),\\nto_number(RES_UNIT),\\nto_number(PLAN_ID),\\nto_number(PLAN_ID),\\nUSER_PROD_STATE,\\nPROD_EFF_DATE,\\nPROD_EXP_TIME,\\nUSER_BA_CODE,\\nLEN_PHONE_NO\\n from gbasedwi.DWI_INCO_BILL_EXP_FREERES_DM_${monthid} where PROD_EXP_TIME<'${day_id}';"} 
